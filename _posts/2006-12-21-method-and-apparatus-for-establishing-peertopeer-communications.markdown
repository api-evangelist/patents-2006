---

title: Method and apparatus for establishing peer-to-peer communications
abstract: A method and apparatus that establishes peer-to-peer communications is disclosed. The method may include determining a group to which a first device belongs, determining the identity of other devices in the group, sending an initial communication to the other devices to indicate that the first device will be joining the group, informing the other devices of applications that are available at the first device, and informing the applications about each equivalent application that is available in other devices in the group.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08027342&OS=08027342&RS=08027342
owner: Motorola Mobility, Inc.
number: 08027342
owner_city: Libertyville
owner_country: US
publication_date: 20061221
---
Traditional IP networking developed as an overlay on top of different types of link layers for communicating from a device to a remote device. The key applications for instance were the File Transfer Protocol FTP to move data from one device to another and the Network Virtual Terminal Protocol TELNET to log in to a remote device.

Utilizing this approach to communicate with a user is an after thought and is often implemented as an overlay on top of device centric Internet. For instance there is an overlay of Simple Mail Transfer Protocol SMTP servers to deliver email and an overlay of Session Initiation Protocol SIP servers to enable an end point reach a user. Internet Protocol IP itself is peer to peer in nature and was based on the end to end argument of intelligent end points with no service related state in the core. However the overlays on top of it have been based on a client server model with relatively dumb clients and with intelligence in the servers which reside the in core network. In such a model the clients require the core network entities to understand session application protocols to provide value to a user. Only the network has sufficient intelligence to act as a proxy for the user.

Some of the reasons for such an approach to gain hold have been a insufficient capabilities processing power and battery power of end points such mobile phones that users often use to communicate b lack of continuous presence home PC using dialup are not always connected cell phone may be powered off or out of coverage etc. and c low bandwidth last hop connectivity. While most of these reasons are either not valid today or will not be valid in the near future such approaches are still the main stream.

In this scenario there is a need for solutions that take advantage of the new end device capabilities and increasing network bandwidth and connectivity choices to a provide existing services at a significantly lower costs and b provide new services that are of tailored to the needs of users. The number of users for many new services may be small and so tailoring the core network to their needs would not have economics of scale to justify the capital and or operational expenditure. However there will be a large number of small groups of users with specific needs that can only be satisfied using service specific intelligence exclusively in the end points.

A method and apparatus that establishes peer to peer communications is disclosed. The method may include determining a group to which a first device belongs determining the identity of other devices in the group sending an initial communication to the other devices to indicate that the first device will be joining the group and informing the other devices of applications that are available at the first device.

Additional features and advantages of the invention will be set forth in the description which follows and in part will be obvious from the description or may be learned by practice of the invention. The features and advantages of the invention may be realized and obtained by means of the instruments and combinations particularly pointed out in the appended claims. These and other features of the present invention will become more fully apparent from the following description and appended claims or may be learned by the practice of the invention as set forth herein.

Various embodiments of the invention are discussed in detail below. While specific implementations are discussed it should be understood that this is done for illustration purposes only. A person skilled in the relevant art will recognize that other components and configurations may be used without parting from the spirit and scope of the invention.

The present invention comprises a variety of embodiments such as a method and apparatus and other embodiments that relate to the basic concepts of the invention.

This invention concerns peer to peer p2p communications using a universal identity for peering uIP framework. uIP is an architecture for developing a variety of p2p applications. Some of the features provided by uIP are an overlay identity space an overlay network layer to enable reachability to the overlay identity space and APIs to enable applications to use uIP.

uIP also enables different instances of peer entities to locate and organize themselves using the overlay identity space. For example uIP enables multiple devices corresponding to a user multiple devices present in a particular location or multiple devices having a copy of the same file to locate and coordinate with each other independent of their access network. Additionally by using an overlay on top of an underlying network such as Global System for Mobile communication GSM network Internet Protocol IP network the uIP enables disparate groups to communicate with each other even across different networks. The uIP in effect provides a protocol independent identity and the ability to reach between and across collections of peer instances.

Devices may be electronic devices belonging to one person or shared by a family office etc. For example devices may be mobile phones wireless telephones laptop computers radios personal computers wired phones MP3 players portable computers wireless radios personal digital assistants PDA residential gateways or any other communication device. Devices may communicate directly through communications networks or using the uIP network layer . Communications networks may represent any possible communications network including wireless telephone networks hardwired telephone networks wireless local area networks WLAN the Internet an intranet etc. Note that their can be multiple co existing uIP networks with a device belong simultaneously to multiple overlay networks.

The UIR functions as a contact point for the group. As the contact point for the group a primary function of a UIR is to let new members of a group find other devices that are currently members of the group. In one embodiment on receiving a request message with the right credentials from a new member the UIR provides the identities e.g. IP address of the other members in the response. Once the new member knows the identities of the other members it may contact them directly or via the UIR . This enables existing members to learn about the new member. As described below this exchange also enables applications on the devices to discover their peers in other devices in the group and form cliques.

A second function of the UIR is to receive packets on behalf of a group and distribute it to a subset group members based on the preferences of the members of the group. As described later based on their registration type the UIR may send either the full packet or simply an indication of the packet.

The UIR function may be provided by a member of the group or an external node. For example the UIR may be highly available network box with a static IP address and which is not part of the group that it serves. Alternatively one of the members of the group can register itself as a UIR . In some embodiments there is only a single UIR for a group but in some other embodiments there is more than one UIR for a group. Furthermore the UIR of a group can change during the lifetime of a group. For example when a more capable node becomes a member of a group it may become a second UIR may take over some or all functions of UIR from an existing UIR .

The MEI represents an instance of a member in a group. It typically resides in the devices that are part of the group. In some other embodiments it resides in a proxy device corresponding to the member of the group. The MEI and the UIR together form the uIP network layer . The MEI provides functions such as 

The MEI may also perform functions such as provide a support for legacy applications for example by exposing an IPv4 or IPv6 compatible version of overlay identity to applications and removing overlay network headers or uIP related information in a packet and transforming it to standard IP packets update the UIR with information about services for which the member is actively receiving packet and services for which packets need not be sent to the MEI enable optimized routing between MEI without going via UIR and track the liveliness of a UIR .

The uIP middleware module was discussed in detail above in relation to . Processor may include at least one conventional processor or microprocessor that interprets and executes instructions. Memory may be a random access memory RAM or another type of dynamic storage device that stores information and instructions for execution by processor . Memory may also store temporary variables or other intermediate information used during execution of instructions by processor . Memory may also include a read only memory ROM which may include a conventional ROM device or another type of static storage device that stores static information and instructions for processor . Memory may include a storage device that stores any type of media such as for example magnetic or optical recording media and its corresponding drive.

Transceiver may include one or more transmitters and receivers. The transceiver to may include sufficient functionality to interface with any network or communications station and may be defined by hardware or software in any manner known to one of skill in the art. The transceiver may be operable to support communication activities and links within the uIP network . The processor is cooperatively operable with the transceiver to support operations within the uIP network .

Communication interface may include any mechanism that facilitates the communication via the communications network . For example communication interface may include a modem. Alternatively communication interface may include other mechanisms for assisting the transceiver in communicating with other devices and or systems via wireless connections. In some implementations of the uIP network communication interface may not be included in the exemplary communication device when the communications handover process is implemented completely within the uIP network .

The communication device may perform such functions in response to processor by executing sequences of instructions contained in a computer readable medium such as for example memory a magnetic disk or an optical disk. Such instructions may be read into memory from another computer readable medium such as a storage device or from a separate device via communication interface .

The uIP network and the communication device illustrated in and the related discussion are intended to provide a brief general description of a suitable computing environment in which the invention may be implemented. Although not required the invention will be described at least in part in the general context of computer executable instructions such as program modules being executed by the communication device such as a communications server or general purpose computer. Generally program modules include routine programs objects components data structures etc. that perform particular tasks or implement particular abstract data types. Moreover those skilled in the art will appreciate that other embodiments of the invention may be practiced in communication network environments with many types of communication equipment and computer system configurations including cellular devices mobile communication devices personal computers hand held devices multi processor systems microprocessor based or programmable consumer electronics and the like.

For illustrative purposes the peer to peer communication establishment process will be described below in relation to the block diagrams shown in .

At step the uIP middleware module determines the identity of other devices in the group. In an embodiment this determination may be performed by sending a request to a contact point such as the UIR corresponding to the group and receiving a response with a list of devices in the group. The contact point can be determined by looking up a directory service such as a Domain Name Server DNS Distributed Hash Table DHT Light Weight Directory Access Protocol LDAP or from user input. In another embodiment the MEI may be use a configuration file that contains the identity of at least some members of a group. Additional exchange with other members in the group may be used to get information about more members in the group.

At step the uIP middleware module sends an initial communication or Hello message to the other devices to indicate that the first device will be joining the group. This message includes the device identifier namely a capability list. The capability list may contain information such as physical capabilities such as bandwidth and processing power and service capability such as applications in a device . Each application registers itself with the MEI indicating its service identifier and the group s to which it belongs there by providing the MEI with service capability information. In one embodiment a string such as VoIP which identifies a service may be used.

In another embodiment a destination port such as corresponding to application may be used as the service identifier. Equivalent application use equivalent service identifiers enabling MEI to determine their equivalency. For example an application in another device which provides VoIP service can register using a string VoIP Video or . On receiving a valid Hello from a peer uIP middleware module a uIP middleware module responds with a Hello Ack with information about its capabilities.

At step the uIP middleware module informs the other devices in the group of applications that are available at the first device . As stated above this may be part of the Hello message sent to other devices in some embodiments. Applications that are available at the first device comprises applications that reside in the first device and applications that are accessible through the first device. For instance a VoIP application residing in a home phone may register with a MEI in a residential gateway and becomes accessible other members of a group through the residential gateway.

At step the uIP middleware module informs the applications about each equivalent application that is available in other devices in the group. The service identifier can enable MEI to determine equivalent applications across devices in a group. MEI can inform local applications about equivalent applications corresponding to other devices in a group using callbacks for example . This enables applications to form application specific groups called cliques with in a larger group.

Members of a clique may act in concert to implement service logic. The MEI may also provide an application with information about other services or applications available to the group. In one embodiment a clique may consist of one or more applications cooperating to provide and enhanced application of service.

The MEI in a device may update a UIR corresponding to a group to send packet sent to a specific service id for example a specific uIP port only to a select list of members. MEI may also send an update indicating that it will be passive member i.e. all packets or selected packet for e.g. sent to a specific service id should not be sent to it.

The UIR uses this information to determine the active set i.e. the set of nodes to which the data packet destined to a particular service should be sent. The UIR or MEI may also notify another MEI to send packets directly to another MEI. For example if the size of active set is small say there is only one recipient for a service id on receiving a packet from a device the UIR may notify the sender to send packets directly to the one recipient.

When more recipients join the UIR or MEI may revoke this notification. Similarly an application such as APP in a device device for example may notify its MEI that the application will be the only recipient of packets to the service in a group. This can trigger the MEI to send an update to the UIR .

The MEI may also update the source MEI of a packet on receiving data destined to the service in a group. Based on application specified intent the local capability and the capability of other nodes in the group MEI may also update the registration with the UIR indicating its intent to receive only notification about a packet and not the entire packet sent to a group. In one embodiment there is one notification per packet. In another embodiment a single message may be used to provide information about multiple packets. The process goes to step and ends.

The uIP middleware module may register itself as the contact point in the group. In one embodiment when the uIP middleware module determines that there is no other entity registered as a contact point then the uIP middleware module registers itself as the contact point. In another embodiment the uIP middleware module may determine use the device and service capability information to determine that it is more suited to be the contact point and take over the function from another node.

The uIP middleware module may determine group membership using a number of schemes. In an embodiment every device may be configured with the names of the group s to which the device belongs and the corresponding membership credentials such as a password or certificate. Applications may also request the MEI using an Application Programming Interface API to join group. They may also supply the credentials or the location of the credentials using an API. Each device also has a device identifier which uniquely identifies the device.

When a device boots up its MEI maps the group name s into a uIP and corresponding UIR s IP address and registers the IP address of the device the HoA for a mobile IP device with UIR . The options for resolving group name into a uIP UIR are using a directory server such as Domain Name System DNS lookup Distributed Hash Table DHT lookup a Lightweight Directory Access Protocol LDAP or a combination. For instance consider the group name to be alice.motousers.net. A DNS lookup can be used to resolve the name into an overlay identifier termed uIP and a DHT lookup of uIP can provide the UIR s IP address. The UIR may be one of Alice s devices that has registered itself as the UIR in DHT. The DHT itself may be contacted by a DNS lookup of SRV DHT in domain motousers.net.

Once the MEI knows the uIP and UIR address it registers the address of the MEI with the UIR . In one embodiment this message includes the device identifier to enable UIR distinguish members from each other a time stamp an authentication code and an address to reach the member. The UIR updates the membership list of the group and provides their address of other members in the response message. In one embodiment the membership list in the UIR consists of a device identifier a timestamp and a reachable address corresponding to the member.

In some embodiments an error response may be sent to the sender. If the sender is authorized to join then at step the uIP middleware module determines the equivalent applications that are locally present. In one embodiment this is determined by application registering with the middleware module using a service id. In another embodiment the uIP middleware module determines the local ports that are in use and uses that information to determine applications for example if port is in use then a SIP based VoIP is present locally .

At step the middleware module sends a message to the sender providing information about local applications. In some embodiments the message may also include other information such as device capability. The process goes to and ends.

If the packet should not be redirected at step the uIP middleware module determines the group to which the packet is to be sent. At step the uIP middleware module determines at least one IP address to which the packet should be sent. In one embodiment information such as socket descriptor used to send the packet is mapped into group identifier using a mapping table in the MEI . The group identifier is then mapped to the IP address of a contact point such as UIR corresponding to the group. At step the uIP middleware module sends the packet. The process goes to step and ends.

The uIP middleware module may also determine the group by mapping the IP address in the destination to an identity corresponding to a group. In some instances MEI may receive a message from UIR or a peer MEI indicating a mapping between a group identifier and an IP address. The uIP middleware module may also use this information to determine the IP address to which the packet should be sent.

In another embodiment the uIP middleware module removes the uIP specific header fields sets the destination IP address to a particular interface IP address in the device and updates the checksum field in the network and transport headers.

At step the uIP middleware module determines if the packet should be redirected locally to another application. In one embodiment an application can use an API to request that packets destined to some service id in a group should be redirected to that application. If the packet should be redirected at step the uIP middleware module redirects the packet and the process goes to step and ends.

In one embodiment packet redirection is achieved by changing the destination port in the packet and recomputing the checksum. In another embodiment the contents of the packet are sent to the application in a new message and the processing of the original packet is paused until a response is received from the application. If the packet should not be redirected the process goes to step and ends.

At step the uIP middleware module determines that the device is authorized to join the group. In one embodiment the uIP middleware module has a key corresponding to the group that can be used to verify the authentication code and ensure that the sender is authorized to join. In another embodiment the module has an authorized list of device id that can join the group and a key corresponding to each device id. The uIP middleware module may then use the key to validate the identity of the sender using the key and then accept the device if the device id is in the authorized list.

At step the uIP middleware module updates a group membership list. In one embodiment the membership list consists of device id the contact address for the device and a timestamp. At step the uIP middleware module sends at least a subset of the group membership list in a response message. The process goes to step and ends. The UIR may also use soft state to timeout old entries in the membership list.

At step the uIP middleware module sends the packet to the active set. In one embodiment the entire packet may be sent to all members in the active set. In another embodiment the entire packet may be sent to only one member and only an indication about packet is sent to other members.

At step the uIP middleware module determines whether it should also process the packet locally. If the uIP middleware module determines that it should process the packet locally at step the uIP middleware module sends the packet to the local MEI . For example if the UIR is also an active member of the group the packet is scheduled for local processing. The process then goes to step and ends. If the uIP middleware module determines that it should not process the packet locally the process goes to step and ends.

Embodiments within the scope of the present invention may also include computer readable media for carrying or having computer executable instructions or data structures stored thereon. Such computer readable media can be any available media that can be accessed by a general purpose or special purpose computer. By way of example and not limitation such computer readable media can comprise RAM ROM EEPROM CD ROM or other optical disk storage magnetic disk storage or other magnetic storage devices or any other medium which can be used to carry or store desired program code means in the form of computer executable instructions or data structures. When information is transferred or provided over a network or another communications connection either hardwired wireless or combination thereof to a computer the computer properly views the connection as a computer readable medium. Thus any such connection is properly termed a computer readable medium. Combinations of the above should also be included within the scope of the computer readable media.

Computer executable instructions include for example instructions and data which cause a general purpose computer special purpose computer or special purpose processing device to perform a certain function or group of functions. Computer executable instructions also include program modules that are executed by computers in stand alone or network environments. Generally program modules include routines programs objects components and data structures etc. that perform particular tasks or implement particular abstract data types. Computer executable instructions associated data structures and program modules represent examples of the program code means for executing steps of the methods disclosed herein. The particular sequence of such executable instructions or associated data structures represents examples of corresponding acts for implementing the functions described in such steps.

Although the above description may contain specific details they should not be construed as limiting the claims in any way. Other configurations of the described embodiments of the invention are part of the scope of this invention. For example the principles of the invention may be applied to each individual user where each user may individually deploy such a system. This enables each user to utilize the benefits of the invention even if any one of the large number of possible applications do not need the functionality described herein. In other words there may be multiple instances of the uIP middleware module in each processing the content in various possible ways. It does not necessarily need to be one system used by all end users. Accordingly the appended claims and their legal equivalents should only define the invention rather than any specific examples given.

