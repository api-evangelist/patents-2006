---

title: Cross domain communication
abstract: Various embodiments utilize nested Iframes within a web page to allow cross domain communication. That is, various embodiments can create an embedded Iframe that shares the domain of an Iframe or web page with which communication is desired. Because the embedded Iframe shares the domain of the Iframe or web page with which communication is desired, restrictions on cross-site scripting do not inhibit communication or scripting between the domain-matched Iframe(s) and/or web page. This embedded Iframe can then provide a mechanism by which web pages or Iframes from other domains can communicate with the Iframe or web page with which the embedded Iframe shares a domain.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08250082&OS=08250082&RS=08250082
owner: Microsoft Corporation
number: 08250082
owner_city: Redmond
owner_country: US
publication_date: 20060623
---
Today many browsers are designed to disallow what is known as cross site scripting. That is web pages are associated with domains. If a web page from a one domain attempts to communicate or execute a script on a web page from a different domain many web browsers will disallow the communication or script execution. There are various reasons why this is done many of which pertain to security.

Notwithstanding the concerns associated with security and which have driven to a certain extent the restrictions on cross site scripting there is value that can arise by allowing communication across different domains.

Various embodiments utilize nested Iframes within a web page to allow cross domain communication. That is various embodiments can create an is embedded Iframe that shares the domain of an Iframe or web page with which communication is desired. Because the embedded Iframe shares the domain of the Iframe or web page with which communication is desired restrictions on cross site scripting do not inhibit communication or scripting between the domain matched Iframe s and or web page. This embedded Iframe can then provide a mechanism by which web pages or Iframes from other domains can communicate with the Iframe or web page with which the embedded Iframe shares a domain.

The inventive approach can be utilized in the context of sending insecure and secure messages. Further in at least some embodiments reliability can be enhanced by providing a reliability mechanism that can be used to track and confirm messages that are sent back and forth between the domain matched Iframe and web page.

Various embodiments utilize nested Iframes within a web page to allow cross domain communication. That is various embodiments can create an embedded Iframe that shares the domain of an Iframe or web page with which communication is desired. Because the embedded Iframe shares the domain of the Iframe or web page with which communication is desired restrictions on cross site scripting do not inhibit communication or scripting between the domain matched Iframe s and or web page. This embedded Iframe can then provide a mechanism by which web pages or Iframes from other domains can communicate with the Iframe or web page with which the embedded Iframe shares a domain.

The inventive approach can be utilized in the context of sending insecure and secure messages. Further in at least some embodiments reliability can be enhanced by providing a reliability mechanism that can be used to track and confirm messages that are sent back and forth between the domain matched Iframe and web page.

Iframes and the manner in which Iframes work will be appreciated by the skilled artisan and as such are not described in great detail here. However for some basic context on Iframes consider the following.

An Iframe is a construct which embeds a document such as a web page into an HTML document. Traditionally Iframes have been used so that embedded data can be displayed inside a subwindow of the browser s window. This does not mean full inclusion the two documents are independent and both them are treated as complete documents instead of treating one as part of the other.

Browsers which support Iframes display or load the document referred to by the URL in a subwindow typically with vertical and or horizontal scroll bars such browsers ignore the content of the iframe element i.e. everything between the start tag and the end tag .

In the discussion that follows Iframe are re purposed in a sense to enable cross domain communication.

In the discussion below the following primary sections are provided. First a section entitled Exemplary Environment is provided and describes but one example of an environment in which the inventive embodiments can be employed. Following this a section entitled Establishing A Cross Domain Message Delivery System is provided and describes how a cross domain message delivery system can be created in accordance with one embodiment. Next a section entitled Using the Cross Domain Message Delivery System is provided and describes how one can use the cross domain message delivery system in accordance with one embodiment. Following this a section entitled Reliable Messaging is provided and describes one embodiment in which a degree of reliability can be added to the cross domain communication of messages. Finally a section entitled Using Cross Domain Communication to Facilitate Social Networking is provided and describes but one example of how cross domain communication can be utilized.

Here system includes a client computing device which includes one or more processors and one or more computer readable media on which executable computer readable instructions reside. In this example computer readable media includes instructions in the form of code that implements one or more applications such as web browser . The various embodiments described below can be implemented in connection with any suitable type of application.

Web browser is configured to communicate with one or more servers via a network such as the Internet . In practice browser can receive web content from server and render such content for a user in the form of a web page an example of which is shown at . In the examples below browser can be used to render Iframes within a web page to create a cross domain message delivery system that can permit cross domain communication as will become apparent.

It is to be appreciated and understood that while computing device is illustrated as a desk top computing device other computing devices such as laptop devices notebook devices handheld devices and the like can be utilized without departing from the spirit and scope of the claimed embodiments.

Web page is said to be a containing page because it contains the two created Iframes. In this example web page has been created in a first domain domain A. Notice here that Iframe has been created in domain A and Iframe has been created in domain B. Each of Iframes and includes or contains in this example a listener Iframe that shares its Iframe s domain. Hence Iframe contains listener Iframe and Iframe contains listener Iframe . Iframes and can be considered as containing frames because they contain other Iframes. The listener Iframes can be considered as embedded or nested Iframes that serve as target windows for cross domain communication that takes place as will become apparent below.

In accordance with one embodiment the cross domain message delivery system can be created as follows.

When the containing page here page loads it creates Iframe in its own domain and passes into the Iframe a name that is to be used for a corresponding listener Iframe. Although any suitable name can be used in this example the name comprises a private hash which in the illustrated example is represented as abc . Iframe then creates the listener or nested Iframe in its domain using the private hash as its name. Nested Iframe is associated with an URL that is used for cross domain communication and is the message receiver or target window for messages intended for containing page .

In addition containing page can also create Iframe in a different domain domain B and pass in a name that is to be used for a corresponding listener Iframe. Although any suitable name can be used in this example the name comprises a private hash which in the illustrated example is represented as def . Iframe then creates the listener or nested Iframe in its domain using the private hash as its name. Nested Iframe is associated with an URL that is used for cross domain communication and serves as the message receiver or target window for messages intended for the containing Iframe .

In this example if communication is to take place between Iframes and each is provided with the name of the listener Iframe for the other. So for example Iframe is provided with the name def and Iframe is provided with the name abc . This can typically take place when the Iframe is initially created in the containing page .

Step loads a containing web page and step creates an Iframe that is contained within the web page. Step can be performed multiple different times to create multiple different Iframes in the same and or different domains from that of the containing web page. Step passes a name to the Iframe. This step can be performed multiple different times as well and can be performed as part of the process of creating the Iframe. The name is to be used in connection with a nested listener Iframe that is to be created. Step creates a nested Iframe using the name that was passed to the Iframe. This step can be performed multiple different times and can be performed by a corresponding Iframe that was created.

At this point a cross domain message system such as that illustrated in has been created and can be used to message across different domains.

In accordance with one embodiment when a web page from a different domain wishes to communicate with a particular Iframe it manipulates an URL associated with the Iframe s listener Iframe and includes in the URL the message that is desired to be communicated to the Iframe. In this particular example cross domain communication can take place in connection with a server. This can permit a degree of security that is provided by the server. That is the server can process the cross domain messages in many different ways such as by validating the messages verifying the sender and the like.

For example in the example of assume that web page wishes to communicate with Iframe . To do so web page might initiate a server call to open a window or load a page in the listener Iframe for Iframe as follows 

This call opens a window in the B domain and it calls a secure message page secure msg.aspx to implement some type of security procedure. After this portion of the URL the message that is intended to be sent i.e. message is appended as is the name of the window to which the message is targeted here def .

Assuming that any security issues pertaining to the message are resolved favorably the server then causes the message to load in the nested Iframe which is in Iframe s domain. Nested Iframe can then notify its parent or containing Iframe that it has a message. Iframe can then process the message accordingly as by executing scripts using the message.

To respond Iframe would simply issue a call to open a window or load a page in the listener Iframe for Iframe . This call routed through the server would then cause a window to be opened or a page which contains the message to be loaded in listener Iframe

This process is diagrammatically shown in . Here web page initiates a call to open a window in the listener Iframe for Iframe . The call which includes the message that is to be communicated across different domains is routed through the server and the server then causes a corresponding window or page to be loaded in the listener Iframe for Iframe . This page includes the message from web page .

Hence using this approach can allow messages and other information to be communicated across different domains.

Step creates a message that is intended to be communicated to a different domain. Any suitable type of message can be created. For example one message might be a refresh message that causes another document to refresh e.g. a stock list component can be notified to refresh stock quotes. Other messages can present ambient properties pertaining to the mode of a page such as author versus view mode or share stylistic information e.g. a stock quote component can switch to allow new stocks to be added or a particular theme can be shared with the component. Further some messages can request metadata e.g. a list of contacts books and the like can be requested and returned to the other page .

Step includes the message in an URL associated with a listener Iframe in the different domain. One example of how this can be done is provided above. Step initiates a call to a server that includes the URL. One example of how this can be done is provided above.

Step receives the call from the client at the server and step processes the message. Any suitable processing can take place. In the example above the processing that takes place pertains to security. Other types of processing can take place. Step returns to the client to cause the message to be processed by the listener Iframe.

Step processes the message with the listener Iframe and step notifies the containing Iframe that a message has been received. This step is performed by the listener Iframe.

In the embodiment described just above a server is utilized to facilitate cross domain message delivery. Incorporating a server into the process can enable the message processing to be augmented in some way such as by providing server enhanced security processes. It is possible however for cross domain message delivery to take place in a purely client side manner without round tripping to the server.

In this embodiment cross domain messages are sent by manipulating the URL of the Iframe that is contained with a web page. As an example consider the following. Each individual Iframe in a web page is associated with an URL. An URL typically has the following form 

The authority typically consists of the name or IP address of a server optionally followed by a colon and a TCP port number. It may also contain a username and password for authenticating to the server. The path is a specification of a location in some hierarchical structure using a slash as delimiter between components. The query typically expresses parameters of a dynamic query to some database program or script residing on the server. The fragment occurs after the hash and identifies a portion of a resource often a location in a document. Fragments or hashes are interpreted on the client side and are not typically used by the server.

In accordance with this embodiment when a containing page from a different domain wishes to communicate or send a message to an Iframe in another domain it appends the message to the appropriate Iframe s URL after the hash. Thus a message to an Iframe from another domain would take the following form 

when the Iframe detects the URL change it can parse the URL to access the message and can then process the message accordingly. If the Iframe wishes to communicate back to the containing page or another listener it uses a similar approach that is it manipulates the URL of the intended recipient to append the message after the hash in the recipient s URL. If the intended recipient is a listener Iframe for the containing page then the listener Iframe can receive the message and because it shares the domain of the containing page it can call functions in the containing page such as a notification function to notify the containing page that it has received a new message.

In this embodiment all of the message sending and receiving can take place without round tripping to the server. Thus server resources can be conserved.

In at least some embodiments message reliability can be enhanced by adding a unique message counter associated with each message that is sent from a particular domain. For example in some instances a particular Iframe may be the subject of a number of incoming messages. Yet if these messages arrive at the same time there is a chance that at least some of the messages will be missed. In this case each message from a particular domain is associated with a unique incremental ID that is incremented for each new message from that domain. When the Iframe receives a particular message from a particular domain if the message counter is off by one or more increments then the Iframe knows to request the missing messages from the sender. The message counter can be implemented as a field in the URL associated with the targeted recipient of the message.

Alternately or additionally reliable messaging can be enhanced by having individual Iframes communicate back acknowledgements to the message originator that a particular message has been received. The message originator can also if so desired query the recipient to ascertain whether the recipient received the message.

Using the above described approach a containing web page can also act as an intermediary between Iframes from different domains or allow the frames to communicate directly by giving each the name of the target window in the other. One of the things that this can enable is remote procedure calls or RPC. That is a message schema can be utilized that allows messages to be defined for invoking methods or operations in other domains. In this way a distributed RPC like mechanism is provided for executing actions in other domains.

There are instances when it would be desirable to enable a third party web site to utilize aspects of a user s relationships with others to provide the user a rich experience. For example a user may have a large buddy list as part of their instant messaging application. Some third party web site might have applications that could provide the user with a rich and robust experience if it only had access to the buddy list. For example a third party web site might be able to show you all of your buddies wish lists. Yet for purposes of privacy it is not desirable to provide the third party web site with access to the user s buddy list.

In the embodiment described below nested Iframes are utilized to provide a rich and robust experience in which relationship information can be shared yet protected.

As an example consider . There a web page or containing page created in domain A includes an Iframe created in domain B a buddy list that has been rendered in domain B and an Iframe in domain A that is contained within Iframe . Because of restrictions on cross site scripting neither web page nor Iframe can access the buddy list that resides in domain B. Yet there are circumstances when it might be desirable to allow web page to use relationship information associated with buddy list while at the same time allow cross site scripting restrictions to disallow access to the buddy list.

That is in this instance we would like to have the ability to send information associated with Iframe to web page . In accordance with one embodiment when web page loads it creates Iframe and provides it with a postback URL that can be used to communicate with web page . When Iframe creates nested Iframe in the same domain as web page it provides the nested Iframe with information on the postback URL. Since Iframe and web page are in the same domain there are no cross site scripting restrictions that would prevent them from communicating. The web page and Iframe can now communicate using for example jscript.

Consider now in conjunction with the following example. Assume that web page is associated with a large on line retailer that sells books music CDs and the like. Assume also that a user has browsed to the page and responsively Iframe has loaded their buddy list. Assume also that web page asks the user if they would like to view wish lists for any of their buddies. Assume now that the user clicks on one of their buddies. In this embodiment each buddy is mappable to a unique ID or Guid. Because of cross site scripting restrictions this mapping is available within domain B but not domain A. The Guid for the user s particular friend is retrieved and rendered as a web page inside Iframe using for example techniques described above. Now using the Guid that was just rendered Iframe uses the web page s post back URL or some other form of communication to provide the Guid to web page . Having the Guid web page has access to a mapping of Guids to wish lists. Hence the web page can now render the particular buddy s wish list for the user without having access to the buddy s identity or any other of the buddy s information.

In this way third party web sites can access and leverage relationship information associated with a particular user while at the same time such relationship information is protected.

Various embodiments utilize nested Iframes within a web page to allow cross domain communication. That is various embodiments can create an embedded Iframe that shares the domain of an Iframe or web page with which communication is desired. Because the embedded Iframe shares the domain of the Iframe or web page with which communication is desired restrictions on cross site scripting do not inhibit communication or scripting between the domain matched Iframe s and or web page. This embedded Iframe can then provide a mechanism by which web pages or Iframes from other domains can communicate with the Iframe or web page with which the embedded Iframe shares a domain.

Although the invention has been described in language specific to structural features and or methodological steps it is to be understood that the invention defined in the appended claims is not necessarily limited to the specific features or steps described. Rather the specific features and steps are disclosed as preferred forms of implementing the claimed invention.

