---

title: Image processing performing color conversion on an input image
abstract: An image processing apparatus performs color conversion processing on an input image. The image processing apparatus includes a block pallet conversion unit, a first color converting unit and a restoration unit. The block pallet conversion unit converts the input image in units of blocks into (i) pallet color information including pallet colors number of which is less than pixels included in one of the blocks and (ii) selection information used to select one of the pallet colors for each pixel. The first color converting unit performs color conversion on the pallet color information obtained by the block pallet conversion unit. The restoration unit selects for each pixel, based on the selection information, one of the pallet colors of the pallet color information, which is color-converted by the first color converting unit, to restores an image.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07881526&OS=07881526&RS=07881526
owner: Fuji Xerox Co., Ltd.
number: 07881526
owner_city: Tokyo
owner_country: JP
publication_date: 20061012
---
The invention relates to an image processing technique of performing color conversion processing on an input image.

Color conversion processing is performed on an image in various situations such as a situation that image processing is performed on a scanned in image and a resulting processed image is output to a print engine in a copier. Among conventional color conversion methods in copiers a method which uses a multi dimensional look up table with interpolation is called DLUT direct look up table .

For interpolation operation each divisional cube or rectangular parallelepiped is further divided into six tetrahedrons as shown in . To which tetrahedron input values L a b belong are judged on the basis of the input values L a b themselves and an interpolation operation is performed by using CMYK values corresponding to the four vertexes lattice points of the tetrahedron thus found. In this manner arbitrary input values L a b can be converted into CMYK values.

According to an aspect of the invention an image processing apparatus performs color conversion processing on an input image. The image processing apparatus includes a block pallet conversion unit a first color converting unit and a restoration unit. The block pallet conversion unit converts the input image in units of blocks into i pallet color information including pallet colors number of which is less than pixels included in one of the blocks and ii selection information used to select one of the pallet colors for each pixel. The first color converting unit performs color conversion on the pallet color information obtained by the block pallet conversion unit. The restoration unit selects for each pixel based on the selection information one of the pallet colors of the pallet color information which is color converted by the first color converting unit to restores an image.

The block pallet conversion section converts an image input through the input processing section in units of blocks into pallet color information which includes number of colors less than number of pixels of a block and selection information used to a pallet color for each pixel in the block.

The first color conversion section performs a color conversion on respective pallet colors of the pallet color information obtained by the block pallet conversion section . If the input image color space and the output image color space are different from each other the first color conversion section also performs a color space conversion. In this exemplary embodiment the first color conversion section performs a color conversion on images for which importance is attached to the gradation performance rather than the resolution such as pictorial images e.g. photographs . The first color conversion section can perform a highly accurate color conversion using a DLUT for example. Since the image has been converted into the pallet color information which includes the number of colors less than the number of pixels in the block the number of colors of the processing subject is much smaller than that of the original image and hence the amount of processing can be made much smaller than in the case where a color conversion is performed without the pallet conversion.

The restoration section selects the pallet color information on which the color conversion is performed by the first color conversion section in accordance with the selection information obtained by the block pallet conversion section to restore the image in units of the block.

The attribute judgment section judges attributes of respective regions of the input image and passes judgment results to the output image generation section and the output processing section . The attribute judging method is arbitrary and may be a known method. The attribute judgment section distinguishes between text line drawing portions and other portions.

The filtering section extracts edges from the input image and performs adaptive filtering on the input image. This is edge emphasis processing for increasing the image quality of the text line drawing portions. Also the filtering section may be omitted.

The second color conversion section performs a color conversion on a filtered image received from the filtering section . If the input image color space and the output image color space are different from each other the second color conversion section also performs a color space conversion. In this exemplary embodiment the second color conversion section performs a color conversion on images for which importance is attached to the resolution such as text images and line drawing images. Although the second color conversion section may also be configured to use a DLUT or the like the second color conversion section is not required to perform a highly accurate color conversion because the gradation performance is not very important. Therefore the second color conversion section can employ a color conversion method that is smaller in the amount of calculation than a color conversion method which is employed by the first color conversion section . The processing speed can be increased by simplifying the processing for example decreasing the number of reference data to simplify an interpolation method. Naturally color conversion methods other than the method using a DLUT such as a matrix conversion may be used.

The output image generation section generates an output image from the image restored by the restoration section in units of the block and or a color converted image received from the second color conversion section . Which of the image restored by the restoration section and the color converted image received form the second color conversion section should be selected can be determined on the basis of for example judgment results of the attribute judgment section preset processing modes and or system resources situations. For example an output image may be generated in the following manner. The color converted image received form the second color conversion section is selected for regions that have been judged to be text line drawing regions by the attribute judgment section and the image restored by the restoration section is selected for other regions and an output image is formed by synthesizing the thus selected portions.

For example the processing modes may include a document mode and a color mode. An output image may be generated by selecting the color converted image received form the second color conversion section if the document mode is a text mode and selecting the image restored by the restoration section if the document mode is a photograph mode. An output image may be generated by selecting the image restored by the restoration section if the color mode is color and selecting a black and white gradation converted image received from the second color conversion section or a filtered image produced by the filtering section no color conversion is performed by the second color conversion section if the color mode is black and white. Furthermore image switching may be made in accordance with a processing speed mode indicating whether importance is attached to the processing speed or the image quality. The image restored by the restoration section may be selected in a speed priority mode in which importance is attached to the processing speed and the color converted image received form the second color conversion section may be selected in an image quality priority mode in which importance is attached to the image quality. Naturally where another processing mode exists image switching may be made in a similar manner that is either image may be selected depending on whether importance is attached to the gradation performance or the resolution.

Still further the above processing modes and judgment results of the attribute judgment section may be used in combination. One example is such that the image restored by the restoration section is selected throughout the image in the speed priority mode and either image is selected on a region by region basis in accordance with the judgment results of the attribute judgment section in the image quality priority mode. Another example is such that either image is selected on a region by region basis in accordance with the judgment results of the attribute judgment section if the document mode is a text photograph mixture mode and either image is selected throughout the image if the document mode is the text mode or the photograph mode. The judgment results of the attribute judgment section may be combined with other processing modes in similar manners. Conversely where image switching is performed in accordance with only the processing modes the attribute judgment section may be omitted.

The output processing section performs various kinds of image processing on an image produced by the color conversion processing. This processing may be performed in accordance with the judgment results of the attribute judgment section .

The image of is processed by the input processing section and then input to the block pallet conversion section and the attribute judgment section . The block pallet conversion section converts the image shown in into the pallet color information and the selection information in units of the block. shows one of blocks included in the image shown in . In the one of the blocks shown in is converted into the pallet color information and the selection information as shown in . In this example one block consists of 4 4 pixels. Colors of the pixels included in this block are approximated to some of pallet colors of the pallet color information shown in . The number of the pallet colors is less than the number of pixels included in the block. In this example colors of 16 pixels included in one block are condensed into four pallet colors at maximum. Then each pixel is converted into the selection information used top select any of the pallet colors. At this time if a color of a pixel is different from any of the pallet colors a pallet color similar to the color of the pixel is selected. By this processing a color of each pixel is approximated to any of the pallet colors.

The first color conversion section performs a highly accurate color conversion process for pictorial images on each pallet color of the thus obtained pallet color information. The first color conversion section performs this color conversion process the number of times which is equal to the number of the pallet colors less than the number of pixels included in the block.

Thereafter the restoration section selects a pallet color from the pallet color information which has been subjected to the color conversion process in accordance with the selection information shown in to obtain a color converted block shown in . Although a single block is shown in as an image stored by the restoration section the above described series of processings are performed on each of blocks included in the input image.

On the other hand the attribute judgment section judges for each pixel or each set of plural pixels an attribute of the image processed by the input processing section . Assume here that as shown in the attribute judgment section has judged that the upper photograph portion has a picture attribute and the lower text portion has a text line drawing attribute.

The filtering section performs the filtering on the image processed by the input processing section to emphasize the edges of the image and then the second color conversion section performs the color conversion processing for a text line drawing on the filtered image. The color conversion processing for a text line drawing is not required to be highly accurate and hence may be of a type that the amount of processing is small and enables high speed processing. shows a color converted image generated by the second color conversion section .

The output image generation section generates an output image in accordance with the judgment results of the attribute judgment section . Based on the judgment results shown in the output image generation section selects the restored image of for the upper portion of the image and selects the color converted image of generated by the second color conversion section for the lower portion of the image. As a result the output image generation section generates an output image of . The output image is processed by the output processing section and then output.

As described above whereas the photograph portion of the output image is lowered in substantial resolution because it has been subjected to the pallet conversion process and the color conversion process it is color converted with high accuracy. The text portion is color converted while the resolution is maintained.

In the configuration of further increase in processing speed is possible in the attribute judgment section and the filtering section . is a block diagram showing an example of the attribute judgment section . In reference numeral denotes a first edge detection section and reference numeral denotes a second edge detection section. Whereas various attribute judging methods are available this example employs a simple attribute judging method that uses the edge amount.

The first edge detection section detects an edge amount by means of a simple edge detection filter for example. The first edge detection section produces a judgment result text attribute if the edge amount is larger than a first threshold value produces a judgment result picture attribute if the edge amount is smaller than a second threshold value which is smaller than the first threshold value and produces a judgment result attribute unknown in the other case. The first and second threshold values may be varied in accordance with the attribute judgment result of the preceding pixel. For example only the first threshold value or both of the first and second threshold values are decreased if a judgment result text attribute is produced for the preceding pixel. This increases the probability that a judgment result text attribute is also produced for the subject pixel. For example only the second threshold value or both of the first and second threshold values are increased if a judgment result picture attribute is produced for the preceding pixel. This increases the probability that a judgment result picture attribute is also produced for the subject pixel. Varying the threshold values in the above manner can increase the number of pixels whose attributes are determined by the first edge detection section which requires a small amount of processing.

The second edge detection section judges attributes by more detailed processing than the first edge detection section and can judge attributes by one or a combination of various methods. For example even where the second edge detection section uses an edge detection filter it may employ a filter having a lager size than the first edge detection section . An attribute judgment which uses an edge amount obtained in this case may be made by comparing the edge amount with another prescribed threshold value. This threshold value may be weighted by using the edge amount obtained in the first edge detection section more specifically by the difference between the edge amount and the intermediate value of the first and second threshold values of the first edge detection section .

A pixel or a region consisting of plural pixels that has been judged to be a text attribute pixel by the first edge detection section or the second edge detection section is subjected to filtering in the filtering section . Edge amounts obtained in the first edge detection section of the attribute judgment section may be used in the filtering. For example a result of a sum of products operation on the edge amounts and edge intensities obtained by an edge emphasis filter may be employed as a filtering result.

Also in the filtering section the filtering may be switched in accordance with the judgment results of the attribute judgment section in particular whether a text attribute has been detected in the first edge detection section or the second edge detection section . For example filtering may be performed by a small size emphasis filter if a text attribute has been detected in the first edge detection section and by a large size emphasis filter if a text attribute has been detected in the second edge detection section . Naturally the filtering method may be changed.

The configuration of the attribute judgment section shown in the modification to the processing of the filtering section and other features can also be applied to the following exemplary embodiments in similar manners.

In the exemplary embodiment of color conversion processing is performed by the first color conversion section and the second color conversion section for regions that will not be selected by the output image generation section . In contrast in the second exemplary embodiment color conversion processing is performed by only one of the first color conversion section and the second color conversion section . Therefore the total processing time can be shortened and the total processing speed can be increased even in the case where for example the second color conversion section performs color conversion processing that is relatively high in accuracy.

The input processing section interprets input image data that are written in PDL and judges attributes of respective drawing objects. Therefore in this modification the input processing section also performs the function of the attribute judgment section . For example if a PDL judged attribute is a text attribute data in that region are input to the filtering section and then subjected to the color conversion processing of the second color conversion section . If a PDL judged attribute is a picture attribute data in that region are input to the block pallet conversion section and then subjected to the color conversion processing of the first color conversion section . If PDL data include a raster image the raster image may be subjected to area separation processing and then subjected to color conversion processing for a text or a picture.

This configuration is effective in applying the invention to a printer or an apparatus having a printer function.

The attribute judgment section produces control information on the basis of attribute judgment results a given processing mode etc. and supplies it to the block pallet conversion section and the restoration section . In this exemplary embodiment the processing of the filtering section is performed for regions that have been judged to be text line drawing regions.

The block pallet conversion section sets the maximum number of pallet colors of the pallet color information based on control information received from the attribute judgment section . Then the block pallet conversion section converts the image received through the attribute judgment section into the pallet color information and the selection information in units of the blocks. The first color conversion section performs the color conversion process on the respective pallet colors included in the pallet color information. The restoration section selects any of the pallet colors of the pallet color information which has been subjected to the color conversion process in accordance with the selection information. Then the restoration section outputs the selected pallet color.

With the above configuration in a high speed processing mode or for pictorial regions such as photograph regions the amount of processing of the first color conversion section can be reduced by decreasing the maximum number of the pallet colors of the pallet color information to be less than the number of pixels of a single block. Hence the total processing speed can be increased. In an image quality priority mode or for text line drawing regions the color conversion processing of the first color conversion section may be performed by increasing the maximum number of the pallet colors of the pallet color information for example to be equal to the number of pixels in a single block. In this case an image that is high in both resolution and gradation performance can be obtained.

As described above by controlling the number of the pallet colors of the pallet color information generated by the block pallet conversion section the third exemplary embodiment can increase the processing speed and suppress reduction in resolution to an extent desired.

Even if the number of the pallet colors of the pallet color information is increased in text line drawing regions the number of colors is small number inmost cases. Therefore number of pallet colors actually used is small number.

Furthermore if number of colors in text line drawings is limited a color of each pixel may be approximated using pallet colors number of which is similar to number of pallet colors for the pictorial regions. In this case the pallet conversion process the color conversion process and the restoration process may be performed on the entire image region.

All or part of the configuration of each of the above described embodiments and modifications can be realized by the program which can be run by a computer. Where it is realized by the program the program data used by the program and other information can be stored in a computer readable storage medium. The term storage medium means a medium which makes it possible to transmit the description contents of a program to a reading device as a hardware resource of a computer in the form of a signal corresponding to variation states of magnetic optical electrical or like energy that are caused according to the description contents of the program. Examples of the storage medium are the magneto optical disc the optical disc including a CD and a DVD the magnetic disk and the memory including an IC card and a memory card . Naturally the storage medium is not limited to portable ones.

The functions of image processing apparatus according to the invention can be performed or processing can be performed according to the image processing method according to the invention by storing the program in one of those storage media in advance mounting the storage medium in the magneto optical disc drive the optical disc drive the magnetic disk drive a memory slot not shown or an interface not shown of the computer for example and causing the computer to readout the program . The functions of image processing apparatus can be performed or processing can be performed according to the image processing method by mounting or incorporating a storage medium in the computer in advance transferring the program to the computer over a network for example and storing the program in the storage medium and causing the computer to run the program . Naturally all or part of the functions may be implemented by hardware.

