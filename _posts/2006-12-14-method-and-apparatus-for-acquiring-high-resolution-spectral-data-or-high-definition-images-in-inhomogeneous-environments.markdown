---

title: Method and apparatus for acquiring high resolution spectral data or high definition images in inhomogeneous environments
abstract: A method and apparatus for treating a sample for acquiring high-definition magnetic resonance images (MRI images) or high resolution nuclear magnetic resonance (NMR) spectra even in the presence of magnetic field distortions within one or multiple scans. The spatial nature and temporal dependence of the field inhomogeneities are determined a priori using any of several literature procedures. A static or oscillating magnetic field gradient is applied on the sample so as to endow spins at different positions within the sample with different resonance frequencies. A phase- and amplitude-modulated radiofrequency (RF) pulse is applied in unison with the magnetic field gradient so as to endow spins at different positions within the sample with a homogeneous excitation/inversion profile. The nature of the spatially-selective RF irradiation is tailored in such a way that, when added on top of the effects of the inhomogeneities, the spins' evolution phases and their signal amplitudes at the time of the acquisition become independent of the inhomogeneities. The spin signals thus created are captured and decoded, so as to obtain the spins' response as if the inhomogeneity was not present. The collected data is processed to a suitable rearrangement and Fourier analysis procedure to retrieve a final undistorted image or spectrum. The magnetic field gradient can be oscillated to impose this kind of inhomogeneity corrections on multiple spatial dimensions sequentially, or simultaneously.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07944206&OS=07944206&RS=07944206
owner: Yeda Research and Development Co. Ltd.
number: 07944206
owner_city: Rehovot
owner_country: IL
publication_date: 20061214
---
This application is a continuation of PCT US2006 047689 filed Dec. 14 2006 which claims the benefit of U.S. Provisional Application Nos. 60 752 489 filed Dec. 21 2005 and 60 799 527 filed May 11 2006.

This invention was made in part by government support under Grant No. R21 GM072565 awarded by the NIH. The United States government has certain rights in the invention.

The present invention relates to a method and apparatus for acquiring well resolved high definition images or high resolution spectral data even when dealing with heterogeneous media. And more particularly to a method and apparatus for acquiring uni or multidimensional nuclear magnetic resonance images or spectra within a single or multiple scans even when the sample is subject to inhomogeneous magnetic fields or to other kinds of spatial or chemical heterogeneities. The present invention also relates to a variety of methods employing the principles of these methods or techniques.

 Ultrafast nuclear magnetic resonance imaging MRI methods can afford multidimensional profiles of a sample in a non invasive fashion and within a fraction of a second 1 2 .Pivotal to this development was Mansfield s introduction of the k space concept 3 leading eventually to echo planar imaging EPI and to subsequent ultrafast propositions 4 6 . Like its Jeener Ernst nD nuclear magnetic resonance NMR spectroscopy counterpart 7 8 EPI retrieves multidimensional information by monitoring the spins behavior as a function of time rather than by monitoring their response at a predefined set of irradiation frequencies. A subsequent Fourier transform FT of the free induction decay signals FIDs is thus needed to extract the relative contributions of the intervening Bohr precession frequencies to the spins spectrum. Unlike what is done in conventional 2D NMR spectroscopy where the two frequencies to be correlated occupy separate portions of the experiment 2D EPI alternates the relative contributions of the frequencies defining the spins evolution in such fashion so as to deliver the complete 2D time domain interferogram following a single excitation of the spins. This k walk principle can be carried out by switching the intervening gradients or by modulating them in a concurrent fashion leading to a variety of related ultrafast acquisition modes 1 4 9 12 . These have eventually become one of the cornerstones of modern MRI and underlie several contemporary fields in medical research including functional organ studies the imaging of rapidly changing and or pulsating systems real time interventional imaging and rapid angiographic characterizations 1 2 . Abbreviations EPI echo planar imaging FID free induction decay FOV field of view FT Fourier transformation MRI magnetic resonance imaging nD arbitrary one or multi dimensional experiment NMR nuclear magnetic resonance.

In an effort to emulate EPI s advantages it has been recently proposed to use an alternative nD NMR acquisition scheme capable of affording arbitrarily high dimensional data sets within a single scan 13 16 . By contrast to the imaging derived k scanning methodologies however the new nD single scan protocol is applicable within a purely spectroscopic scenario or within an imaging oriented one 16 17 . Underlying this ultrafast NMR approach is the sequential single shot encoding of the NMR interactions one is attempting to measure along an ancillary inhomogeneous frequency domain. This is most often introduced by the application of an external magnetic field gradient which endows spins located at different positions with individually addressable frequencies. When applied in conjunction with a frequency incremented excitation or inversion of the spins such gradients lead to the possibility of spatial encoding the NMR interactions to be measured. In other words they allow one to encode the spin interactions with a phase r C r r rather than with the usual temporal encoding t t. Patterns encoded in such fashion can be subject to a mixing process and subsequently read out with the aid of a seconds acquisition gradient revealing their initial evolution frequencies according to echo positions arising at k C . Furthermore subjecting this acquisition gradient to multiple oscillations allows one to monitor the actions of a second direct domain set of NMR Hamiltonians. This multiple readout feature opens up the possibility to collect multidimensional NMR correlations within a single scan irrespective of the details of the NMR experiment under question. At the moment spatial encoding offers the sole approach to the completion of generic nD NMR spectroscopic acquisitions within a single scan at the same time and within a purely imaging framework it offers an alternative to ultrafast MRI protocols based on 2D FT such as EPI.

In addition to enabling the acquisition of multidimensional NMR MRI data sets within a single scan the position dependent encoding of the interactions just described opens up another possibility the acquisition of high resolution NMR spectra from bulk samples even when these are subject to local or global inhomogeneities of the magnetic field. Indeed as we have illustrated in a purely spectroscopic scenario 18 19 the spatial encoding underlying ultrafast NMR can also be exploited in order to correct at the time of the spatially dependent spin excitation for the effects that field distortions will have at a later time when the signal acquisition will take place. Related compensation principles have also been demonstrated along direct acquisition domains with the introduction of so called shim pulses 20 . These procedures do not entail a betterment of the fields but rather radiofrequency RF manipulations which can address either longitudinal B or transverse B field distortions by manipulations of the phase and or amplitudes of the pulses.

Nuclear Magnetic Resonance spectroscopy can deliver unique chemical insight in a non invasive fashion 33 . To do so however it demands an extremely high homogeneity from the external magnetic field Bwhere the experiment takes place. Field inhomogeneities B r r need to be reduced until made small vis vis the smallest internal shifts or couplings to be measured when considered over the full sample volume. This translates in demanding that field perfections be better than 1 part in 10over sample volumes on the order of 1 cm a significant challenge requiring serious investments in both the size of the main magnet and the number of auxiliary shimming coils to be used 34 . Moreover instances arise where even the most extensive efforts cannot deliver the required field homogeneity for example when dealing with samples subject to substantial internal susceptibility distortions or when dealing with sudden changes in the nature of the medium being examined. All of these are common scenarios in a variety of in vivo NMR spectroscopy experiments 35 where the achievement of high resolution is further aggravated by the relatively low length to width ratio of the typical animal or clinical magnet and by the advent of higher magnetic field strengths requiring an increasing number of higher order shims to achieve the needed field corrections. An ultimate example of these complications is found in ex situ NMR experiments whose goal is to obtain high resolution spectroscopic information from objects operating on the basis of single sided magnets 36 .

In an effort to overcome these complications a number of alternatives have been proposed for collecting high resolution chemical information in the presence of field distortions. One of the first strategies to be demonstrated involved the use of two dimensional 2D NMR experiments where high resolution was achieved by correlating the effects of arbitrary field inhomogeneities at a particular chemical site with identical effects affecting neighboring sites in the spin system 37 38 . While the reliance of these experiments on relatively weak multi spin correlations did not endow them with the highest of sensitivities they showed an advantage over competing proposals in that they dealt equally well with 1D 2D or 3D r distributions. These 2D correlations have therefore served as basis for a variety of high resolution NMR experiments in inhomogeneous fields 39 40 . Another compensation approach to remove field inhomogeneities proposed the use of custom built radiofrequency RF coils whose Bdistortions matched spatially those of the Bfield 41 42 . Recently a different route for exploiting RF fields to compensate for Binhomogeneities possessing a priori arbitrary spatial dependencies has been described this involved the combined application of a field gradient spreading out the spins resonance frequencies according to their spatial positions in conjunction with a suitable train of excitation or refocusing RF pulses whose phases compensate for the cumulative effects of the inhomogeneities 18 19 . Worth mentioning in connection to this approach yet in a fast imaging context is also the use of tailored RF excitation pulses applied in combination with a slice selection gradient in order to compensate for susceptibility distortions arising in echo planar imaging acquisitions at the instant of the main gradient echo formation 44 32 .

The purpose of the present invention is to provide a method and apparatus that enables acquisition of high definition images or high resolution spectral data in inhomogeneous environments. The manner of how this is accomplished will be elaborated upon in the following further to potential spectral applications also shall be described the compensating potential of the spatial encoding principle within a purely imaging scenario where it is positions rather than internal shifts that are being sought. In particular what will be demonstrated is how the inhomogeneity compensating capabilities that characterize spatial encoding methods can be combined with a number of NMR data acquisition protocols enabling the acquisition of high definition nD MRI images and of nD NMR spectra even when spins are subject to sizable r spatial distortions of the ideal Bstatic NMR field. In order to facilitate the visualization of how these complementary features come together one begins by reviewing the principles of the spatial encoding methodology as applied to an ideal NMR MRI scenario. Then one proceeds to describe the basis of the compensation procedure in 1D NMR MRI and conclude by sketching its extension to higher dimensional single scan experiments. All these pre eminently theoretical treatments are accompanied with demonstrations of their validity using 1D and 2D NMR MRI experiments on simple phantoms.

Accordingly it is a principal object of the present invention to provide a method and apparatus for treating a sample to acquire high definition multidimensional images and spectra even if under the action of heterogeneities comprising the steps of 1 defining the spatial distribution of the active heterogeneities 2 partitioning a sample into a set of independent subensembles endowed with different resonance frequencies 3 implementing an irradiation of the sample whereby the various subensembles are selectively manipulated by a series of excitation or refocusing sequences capable of compensating for the heterogeneities at the time of the data acquisition 4 applying thereafter if needed additional encoding sequences capable of monitoring additional spectroscopic or spatial dimensions from each of the subensembles 5 monitoring the observable signals arising from the various subensembles by applying a time dependent field gradient capable of unraveling and if needed be of further restoring the ideality of the spatial image 6 suitably processing the observable signals acquired in this manner into a complete multidimensional image.

In the method described above the partitioning effected during the excitation and or encoding periods can be effected notionally. Also it is possible to that the polychromatic irradiation and the resolved detection scheme is selected to suit the particular kind of imaging including of optical paramagnetic electron mass and nuclear magnetic resonance origin. Further the acquisition of either a single or a multi dimensional image can be completed in several scans and in a preferred embodiment the acquisition of either a single or a multi dimensional image is completed in a single scan.

In the method as described the corrective encoding is applied sequentially or on the full sample at once. Also magnetic field gradients are used for exciting refocusing and acquiring the image. The magnetic field gradients can be used for compensating for potential spatial inhomogeneities in the course of the excitation or refocusing sequences. The method can be carried out wherein sequences capable of distinguishing between the spatial and chemical origin of the resonance frequencies are effected.

In the method as described above the corrective spatial encoding procedure may be combined with other image acquisition protocols to obtain a high definition image even in the presence of external field distortions.

The invention further contemplates a method for treating a sample to acquire high definition magnetic resonance images MRI images even in the presence of magnetic field distortions within one or multiple scans comprising the steps of 1 quantifying a priori the spatial nature of the field inhomogeneities using any of several literature procedures 2 applying a static or oscillating magnetic field gradient on the sample so as to endow spins at different positions within the sample with different resonance frequencies 3 applying a phase and amplitude modulated radiofrequency RF pulse in unison with this gradient so as to endow spins at different positions within the sample with a homogeneous excitation inversion profile 4 tailor the nature of the spatially selective RF irradiation in such a way that when added on top of the effects of the inhomogeneities the spins evolution phases and their signal amplitudes at the time of the acquisition became independent of the inhomogeneities 5 capturing the spin signals thus created while using a second set of acquisition magnetic field gradients which decodes the spins spatial locations as if the inhomogeneity was not present 6 subjecting the collected data to a suitable rearrangement and Fourier analysis procedure so as to retrieve the final undistorted image being sought. This method can be carried out wherein the magnetic field gradient oscillates so as to impose the inhomogeneity correction on multiple spatial dimensions simultaneously.

In addition to the foregoing the purpose of the present invention is to further demonstrate the potential of these gradient assisted spatially encoded manipulations towards the acquisition of high resolution NMR spectra in inhomogeneous or unstable fields. To accomplish this one focuses initially on static one dimensional inhomogeneities and proceeds to extend the basic spatial encoding framework laid out in the inventors previous work 18 19 to describe a variety of compensating sequences. These include a spatially continuous indirect domain single scan compensation approach a new kind of shim pulses somewhat different in nature from those recently discussed by Pines et al 43 and a novel class of multi scan 2D compensation experiments. The applications of these techniques are illustrated without loss of generality to 1D and 2D NMR acquisitions stressing their usefulness and potential as well as their respective limitations. In particular it is shown that the last of the approaches mentioned can considerably alleviate the complications associated to hitherto available sequences both in terms of the achievable resolution as well as of spectral sensitivity. Possible extensions of all the assessed methods to deal with inhomogeneities in multiple spatial temporal dimensions are also noted

Accordingly it is another principal object of the present invention to provide a method and apparatus for treating a sample to acquire high definition uni and multidimensional spectra even if under the action of heterogeneities comprising the steps of 1 defining the spatial distribution of the active heterogeneities 2 partitioning a sample into a set of independent subensembles endowed with different resonance frequencies for instance via the application of field gradients 3 implementing an irradiation of the sample whereby the various subensembles are selectively manipulated by a series of excitation or refocusing sequences capable of compensating for the heterogeneities at the time of the data acquisition 4 applying thereafter if needed additional encoding sequences capable of encoding additional spectroscopic or spatial dimensions from each of the subensembles 5 monitoring the observable signals arising from the various subensembles 6 suitably processing the observable signals acquired in this manner into a complete spectrum and or image.

In addition the method may include partitioning effected during the excitation and or encoding periods is effected notionally. Also the polychromatic irradiation and the data detection scheme can be selected to suit the particular kind of spectroscopy desired including of optical paramagnetic electron mass and nuclear magnetic resonance origin. Further acquisition of either a single or a multi dimensional spectrum can be completed in several scans. Still further the corrective encoding is applied sequentially or on the full sample at once. In the practice of the method and the apparatus the magnetic field gradients are used during the excitation and or refocusing of the system and during the data acquisition period. The magnetic field gradients can be used for compensating for potential spatial inhomogeneities in the strengths of the excitation refocusing or detection sequences. Also the corrective spatial encoding procedure may be combined with other data acquisition protocols to obtain a high resolution spectrum even in the presence of external field distortions.

The present invention also contemplates a method and apparatus for treating a sample to acquire high resolution nuclear magnetic resonance spectra NMR spectra even in the presence of magnetic field distortions within one or multiple scans comprising the steps of 1 quantifying a priori the spatial nature of the field inhomogeneities using any of several literature procedures 2 applying a static or oscillating magnetic field gradient on the sample so as to endow spins at different positions within the sample with different resonance frequencies 3 applying a phase and amplitude modulated radiofrequency RF pulse in unison with this gradient so as to endow spins at different positions within the sample with a homogeneous excitation inversion profile 4 tailor the nature of the spatially selective RF irradiation in such a way that when added on top of the effects of the inhomogeneities the spins evolution phases and their signal amplitudes at the time of the acquisition became independent of the inhomogeneities 5 capturing the spin signals thus created as a coherent superposition of the spins from all spatial locations as if the inhomogeneity was not present and 6 subjecting the collected data to a suitable rearrangement and Fourier analysis procedure so as to retrieve the final undistorted spectrum being sought. The magnetic field gradient can be oscillated so as to impose the inhomogeneity correction on multiple spatial dimensions simultaneously.

Other and further objects of the present invention will become evident from the following detailed description of the invention when taken in conjunction with the appended drawings.

The inventor s hereby incorporate by reference in their entirety the following documents previously filed Provisional Appl. Ser. No. 60 398 822 filed Jul. 26 2002 International Patent Appl. PCT US2003 021314 filed Jul. 7 2003 and International Patent Appl. PCT US2004 040449 filed Dec. 3 2004.

Before dwelling on the potential opened up by spatial encoding towards the acquisition of undistorted images in inhomogeneous fields we briefly review the basis of spatial encoding as it applies to single scan nD MRI acquisitions. Moreover we begin with the simplest of cases the mapping of a unidimensional spin density profile along a single axis z. Whereas the spatial encoding experiment underlying this kind of acquisition is not very different from that underlying conventional Fourier imaging B their physics actually are. This distinction arises from the fact that in conventional k space MRI spins are homogeneously excited via the application of a single hard pulse whereas spatial encoding relies on imparting on the spins an initial spatially dependent phase z . One possible way of achieving this is by exciting the spins using a selective RF pulse whose offset O is swept while in the presence of an excitation gradient Gcircumflex over z . This pulse will address spins sequentially according to their coordinate z at times z when the RF offset O matches the spin s resonance frequency z i.e. 1 where is the site s chemical shift. For the simplest case of an offset being swept at a constant rate R between initial and final values O O the instant at which the RF will address spins at a coordinate z will be given by

The overall position dependent phase z accumulated over the course of such sweep can be expressed apart from an arbitrary phase constant as 3 where is the overall duration of the frequency chirped pulse and

This expression is to be contrasted with the conventional MRI post excitation phase which is simply a z independent constant. When the FID arising from such homogeneously excited spin ensemble is subject to digitization under the presence of a constant Gcircumflex over z acquisition gradient the result

FT against k is thus needed as part of the image formation process. By contrast when a spin ensemble that has teen spatially encoded as in eq. 6 is subject to a similar acquisition process the resulting FID

Furthermore for the case of this acquisition being implemented by a constant gradient applied over a time Tchosen so as to unravel the full extent of the initial encoding i.e. GT G eq. 12 can be simplified into

The signal detected in this fashion for a particular k value can be explicitly described by expanding the overall acquisition phase around the relevant extremum 

Eqs. 13 and 17 mean that the time domain signal will in this case probe the spins density z in a one to one fashion interrogating spins from the position that was excited last assumed to be z L 2 and walking its way backwards to the position that was first excited by the frequency chirp z L 2 . As for the weighting factor appearing in the collected FID 

For the sake of completion it is worth reviewing a second spatial encoding alternative this one arising from the action of a frequency swept pulse driving an inversion of the spins coming in the wake of an initial homogeneous hard pulse excitation . Following the arguments above as well as guidelines described elsewhere 21 22 one can estimate the overall encoding imparted during the course of such inversion pulse as 2 . 19 

On comparing this expression with its analogue for the case of a frequency chirped 2 excitation eq. 3 we notice an additional term z reflecting the encoding accumulated prior to the instant when the inversion pulse reached an offset z and a doubling of the net influence. Following the same assumptions as before 0 O O GL 2 R GL this encoding phase can be written as

Main distinctions thus resulting between this driven encoding and that arising from its 2 counterpart eq. 6 include the absence of a linear term and a doubling of the quadratic coefficient. The first of these features implies that upon imposing the stationary phase approximation the decoded positions will be given by

The initial position thus rasterized will correspond to the center of the sample meaning that the full field of view FOV will be missed by the signal acquisition process unless an initial purging gradient pulse k G 2 is first applied. As for the second of these features it implies that given identical conditions the driven encoding will be characterized by a voxel size that is square root over 2 time smaller i.e. by a square root over 2 higher resolution than its 2 encoding counterpart.

These expressions summarize the main features of 1D spatially encoded MRI exemplifies their experimental realization as applied to the profiling of a simple water phantom. Several features of this acquisition method had been presented in part in an earlier publication 17 also compared there in further detail were issues concerning the overall sensitivities and demands on field gradients of the conventional vis vis the spatially encoded imaging approaches. It was then concluded that whereas the former could be made comparable conventional imaging makes a more efficient use of its excursion along the k domain monitoring signals from all voxels in the sample at once rather than unraveling them in a voxel by voxel fashion. It follows that for a given number Nof spatial elements the wavenumber k GTto be used in the spatial encoding case has to exceed its conventional counterpart by a factor square root over N . This may often be a serious complication yet not always will it be an incapacitating one for instance along the read out dimension of a single scan 2D EPI experiment where gradients may have to be chosen small due to sampling rather than due to hardware requirements. Another main difference between the methodologies is given by the built in capabilities of the spatial encoding to compensate experimentally for field distortions as further discussed herein. Before going into this aspect however we briefly describe how the 1D spatial encoding principle described can be extended to single scan acquisitions in multiple dimensions. In that previous 2D oriented publication the encoding time was referred to as tand the acquisition time t as t.

As in traditional FT MRI the spatial encoding procedure just described retrieves its imaging information by relying on the application of a field gradient. Since gradient effects can be reversed with a nearly complete efficiency within arbitrarily short periods of time spatial encoding will enable as EPI does to monitor spin distributions along multiple dimensions in an ultrafast fashion i.e. within a single continuous acquisition. Such an extension to multiple dimensions does not necessarily imply that all domains to be explored need to be spatially encoded performing the spatial encoding procedure along a given axis does not preclude the use of a conventional Fourier encoding along another orientation. Without attempting to present an exhaustive description of possibilities exemplifies this flexibility by presenting four different non EPI approaches to the collection of 2D NMR images within a single scan. Also included in this Figure are cartoons depicting the different kinds of r k domain scannings that occur in each scheme. Panel A presents a sequence where spins that have been spatially encoded along one axis have their 1D profiles repeatedly rasterized during the course of the acquisition while another gradient incrementally blips their phases along an orthogonal domain. Panel B is another r k encoding hybrid where it is the spatial encoding dimension that now gets incrementally unraveled while the orthogonal axis is repeatedly imaged in reciprocal space via the application of a strong oscillatory gradient. is a purely spatially encoded 2D MRI possibility where orthogonal quadratic encoding phases are generated by frequency swept excitation 2 and inversion pulses applied consecutively while under the action of corresponding gradients. Panel D is another pure spatially encoded alternative where a different quadratic pattern was generated by applying a pair of adiabatic inversions following an initial homogeneous excitation and the ensuing spatial encoding is subsequently unraveled in an out spiraling fashion.

The hybrid cases depicted in combine a unidimensional spatial encoding along one of the dimensions with a conventional k domain encoding along an orthogonal axis. The image formation process underlying these sequences can thus be directly derived from the unidimensional arguments that were given in the previous paragraph eqs. 7 and 9 if applied along orthogonal dimensions. Presented in are experimental realizations of these two procedures including for clarity some of the intermediate processing stages. Both of these experiments involved the continuous acquisition of a single scan FID containing data in the mixed spatial wavenumber domain z k these data had to be suitably rearranged prior to its further processing. In the A case this entailed a splicing of the individual z profiles and their suitable rearrangement in a 2D matrix including alternating reversals of the even odd images as a function of monotonically increasing kvalues. In B by contrast the S k echoes were the ones which had to be spliced reversed and subsequently positioned in a 2D matrix as a function of a monotonically rasterized z coordinate. Finally in both cases a 1D FT along the kdimension preceded and or followed by suitable ancillary manipulations such as zero filling weighting echo alignment procedures magnitude calculations etc. are needed for obtaining the full 2D image. Presented for completion in is a single scan image collected using a traditional blipped k space EPI encoding.

Application of the EPI type decoding scheme illustrated in will thus yield an FID whose magnitude records the x z sample profile in real space starting from one end of the sample and then rastering the object along a zigzag trajectory towards the opposite corner. presents an experimental example of the corresponding image once again collected for a simple cylindrical water phantom. Notice in it a ribbed structure along the z direction associated to the relatively coarse zigzag chosen for this particular acquisition. By contrast to eq. 22 the encoding procedure illustrated in will result on the purely quadratic form

The initial x z 0 0 coordinate at which the ensuing decoding will thus begin makes this approach particularly well suited for a spiral like decoding involving oscillating and time incremented orthogonal gradients. illustrates a phantom image obtained in this fashion. Notice that by contrast to its counterpart no details regarding a coarse rasterization of the image are evident. A point worth remarking again in connection to the spatially encoded acquisitions displayed in B is that no Fourier processing was needed for arriving to these single scan 2D images. Therefore the absence of an equidistant grid of points within the bidimensional FIDs afforded by these spatially encoded procedures constitutes a minor graphic display inconvenience rather than as is the case for FT based k domain acquisitions an actual problem to be solved by sophisticated numerical algorithms 1 23 .

An extension of the one dimensional Taylor expansion arguments given for the 1D case eq. 15 can also yield the spatial resolution of the ensuing S t r voxel element. In the 3D case this will be related to the determinant of the Hessian matrix

Unidimensional arguments can also be extended in a straightforward fashion to derive the FOVs along the independent axes as well as to compare the demands that purely spatially encoded vis vis traditional EPI encoding make in terms of gradient strengths etc. Yet rather than continuing with these extensions we turn to the central topic of this work on how to integrate field inhomogeneity compensations into the spatial encoding procedure.

Spatially Encoded 1D MRI in the Presence of Field Inhomogeneities Compensating for Field Inhomogeneities

For the sake of simplicity we begin by describing the retrieval of undistorted one dimensional z profiles in the presence of field inhomogeneities leaving for the next discussion an extension to higher dimensional cases. illustrates experimentally the actual capabilities of the approach comparing for a simple water phantom results obtained in the presence and absence of inhomogeneities when utilizing both conventional and spatially encoded 1D MRI approaches under similar gradient strength conditions. Upon executing either one of the imaging procedures described in Paragraph 2.1 while under the action of similar Binhomogeneities all methods will fail to deliver faithful representations of the object. The distortions imparted by these inhomogeneities onto the FT Fourier and spatially encoded images will actually be different as is to be expected given the differing physical procedures underlying these procedures. And while ideally such distortions could be accounted for at a post acquisition level via numerical compensation procedures 1 24 25 these compensations tend to be numerically unstable and therefore restricted under limited signal to noise conditions. On the other hand owing to the voxel by voxel encoding and read out involved in the spatial encoding procedures introduced in the previous discussion the latter have a built in capability of restoring at an experimental level the faithfulness of the collected image. This capability is illustrated by the trace in collected using the same average gradient strength as the profile in but following a suitable temporal shaping of the RF encoding pulse and of the subsequent decoding gradient. Such shaping does actually require an a priori knowledge of the field inhomogeneity profile B z z yet given this knowledge the procedure can compensate distortions using gradients whose span is only a few times larger than that of the inhomogeneities ca. a factor of four for the case illustrated in .

Recording such undistorted z profiles while in the presence of field inhomogeneities will require restoring the two basic conditions which defined the ideal spatial encoded image formation process a linearity between coordinate z and the acquisition time t eq. 13 and a constant pixel size z throughout the acquisition process eq. 18 . The physics that define these two parameters will not change fundamentally upon going from a homogeneous to an inhomogeneous field acquisition voxels will still be decoded according to the stationary phase condition

The effects of the field inhomogeneities will be expressed by the fact that there will now be an additional contribution defining the overall phase z arising from z effects which will have to be compensated out. To visualize how this distortion can be removed we will assume for concreteness that spins were excited by the action of a swept 2 chirped RF nutation.The z contribution will be given by an extra term in the excitation phase 32 as well as by an addition to the overall acquisition phase 33 The description for the case of a based encoding follows very similar and in fact somewhat simpler lines

If the encoding and decoding processes were to proceed as in the homogeneous case it is clear that these new terms would break both the linear z t relation as well as the constant voxel size demand leading to distortions such as those illustrated in . Yet we can force a reintroduction of the ideal behavior by tailoring at least two of the several free parameters at our disposal these include z i.e. the shape of the RF encoding pulse k t i.e. the shape of the acquisition gradient Gand or of the dwell time t as well as the encoding gradient G. In the present exposition we have chosen z and G t in order to carry out the correction.

The demand for a linearity between z and t can be used to derive the shape of the acquisition gradient. To do so we insert eq. 33 into expression 30 and solve for G t dk dt

The t dependence in this expression can be translated into a z dependence or vice versa by imposing the demand

Inserting into this expression the definitions given in eqs. 33 and 35 results in demanding that z and z be related by

Notice that according to this derivation the voxel size correction i is introduced at an excitation but not at an acquisition level ii will not be needed if s effects are linear which would introduce a constant displacement of the image but no intra voxel distortions iii will only affect third and higher orders of z terms which were absent in the homogeneous case eq. 6 and iv will allow by a single integration for the calculation of the acquisition gradient G t pending certain simple boundary conditions that we proceed to discuss.

Eq. 37 defines the encoding profile that we would like applied on the spins as a function of their z positions. This z profile depends on fixed parameters we shall assume known G and z in eq. 32 as well as on an RF driven phase

Since the offset also has to fulfill the condition O z Gz z the first and last terms on the right hand side of this expression will cancel each other out one can then solve for z as

The expression for d dz involved in this equation can be obtained from the z profile following a double integration of eq. 37 subject to the initial and final boundary conditions of the RF sweep 2 2 0 40 

Notice that after the First of these integration processes all the functions required to define the G t gradient profile are already known. Finally the last step in deriving the RF offset profile to be used in the experiment requires inverting z into z and plugging the result into O Gz z .It appears that in the small inhomogeneity limit d z dz 

From an experimental standpoint it is often simpler to program the resulting pulse as a phase table to be read at a constant dwell by the spectrometer s RF generation hardware. Moreover since the inhomogeneity will in general affect the rate at which the RF sweeps any given range of frequencies it also follows that the amplitude of the RF may have to be tailored during the clocking out of the pulse. Indeed as described elsewhere for the case of spatial encoding under homogeneous conditions e.g. Appendix of ref. 17 the strength Bof a chirped pulse that is swept at a constant rate R can be calibrated so as to impart a non adiabatic 2 nutation of the spins. This in turn requires setting Bas 0.25 square root over R which is a constant for the homogeneous field scenario. In the inhomogeneous field situation by contrast the sweep rate R dO d is no longer constant and hence spins positioned at different z coordinates will be nutated by different extents unless the Bfield is suitably compensated for this. This can be simply done by setting a second amplitude modulating table as part of the pulse definition with B defined as 0.25 square root over dO d not accounting for this leads to image distortions as further illustrated below.

Having derived the conditions under which the spatial encoding protocol can compensate for 1D field inhomogeneities it is pertinent to discuss what will be the limits of such procedure. Some of these may arise from non coherent decay factors that will not be here addressed including T diffusion and motions. But we have also identified two main methodological limitations worth discussing. One of these arises from our demand that the z in eq. 39 be invertible into a z expression. Numerical simulations for various arbitrary z profiles reveal a variety of instances where for large enough inhomogeneities this is no longer possible.In principle one should be able to accommodate the profile requested by the compensation as long as z is a univalued function where each z voxel can be addressed independently and at will during by an RF pulse of duration . This in turn requires that d z dz 0 throughout the course of the encoding assuming that the inhomogeneity gradients we are dealing with are smaller than the the Ggradient this translates into requesting

A second physically different limitation to the method described above is posed by the effects that will be introduced by z during the course of the acquisition which entailing a time Tthat is usually longer than may eventually control the maximum limits of tolerable inhomogeneities. These longer term distortions are mathematically represented by the multiple zroots that for long enough acquisition times t will be able to satisfy the condition stated in eq. 30. Indeed when considering in this equation k and t as fixed parameters one realizes that the signal detected at any given time will contain contributions from all z coordinates fulfilling the stationary phase condition

In the 0 case z is a second degree polynomial and thus only a single zvalue eq. 12 will satisfy this condition. By contrast we have seen that when z 0 then also d dz 0 and the stationary phase condition may exhibit multiple roots. One of these will of course derive from the undistorted z t L 2 L T t solution for which and Gwere originally designed but eventually other positions may end up satisfying eq. 42 putting an end to the method s ability to deliver undistorted images. illustrates with a series of graphs the appearance of this multiple roots phenomenon. Ways to deal with this problem reside in either setting all conditions such that the undesired stationary phase voxels fall outside the FOV of the object that has been excited or alternatively so that they only begin to appear at virtual times t T. Another possibility entails relying on the fact that different voxels fulfilling eq. 42 will in general be associated to different resonance frequencies. A judicious application of suitable time and frequency dependent filtering functions can therefore help select solely the faithful solution being sought. Multiple experimental parameters G G T are available to achieve and define these procedures some of these are illustrated in the following Paragraph.

Before proceeding with an extension of the protocol just presented to multidimensional cases we deem it valuable to illustrate the implementation of the various calculations in the paragraphs above for two additional examples. We focus first on an explicit derivation of the compensating functions and G t for the simplest relevant distortion. Since as mentioned earlier spatially encoded voxels are free from distortions upon being subject to linear field inhomogeneities we shall consider towards this end a quadratic inhomogeneity . 43 

This in turn yields an explicit form for the gradient that needs to be applied over the course of the acquisition 

Notice that just as the legitimate solution being sought this position is also decoded linearly with time. This in turn enables one to avoid its interfering effects by making sure that the different parameters making up the constant term of this position already place z t 0 outside the object s FOV. illustrates an example of this carried out in this instance by a judicious choice of the sign of the Ggradient chosen for the encoding.

The conclusion reached above also indicated how double integration of eq. 44 bound to eqs. 45 enables one to derive the tailored offset chirp to be applied for avoiding the dephasing effects introduced by the inhomogeneity. For the case of a quadratic z this can be carried out analytically and following some algebra leads to

From here the tailored RF amplitude B proportional to square root over dO d can also be worked out. illustrates the relevance of suitably tailoring this nutation with an image decoded using all the right compensation parameters except for such RF amplitude correction. While the idealized inhomogeneity in eq. 43 gives the opportunity to explore analytically variably aspects of the compensation procedure we anticipate most of the latter s applications to involve numerical solutions of cases where z is a more or less arbitrary distribution that has been a priori measured. Furthermore and working with the case of an EPI type read out dimension in mind the compensation problem will most likely have to deal with larger objects smaller inhomogeneities and weaker read out gradients than those treated in . To illustrate the methodology s capability to deal also with such cases we show in another example this time dealing with a synthetic inhomogeneity constructed on the basis of a damped Airy function containing an oscillating spatial dependency panel A . Both conventional k as well as spatially encoded procedures fail to yield appropriate profiles under EPI type read out conditions C while a compensation based on the numerical resolution of the above equations successfully yields an undistorted image FIG. D even if relying on acquisition gradients of similar strength.

The compensation principles described above for the case of 1D acquisitions can be expanded to multidimensional acquisitions. A main demand of these multidimensional procedures is that suitable encoding and decoding sequences be devised whereby each voxel r is addressed independently and only once both during the initial excitation as well as during the latter acquisition stages. A one to one relation during the encoding is required in order to be able to compensate each r element in the field distribution. The analogous decoding demand derives from the fact that the protocol enables the correct compensation of r solely for a single acquisition time t but not for multiple times. For instance 2D encoding schemes of the kind illustrated in will be unable to compensate generic x z 2D distributions as they both address all elements positioned perpendicular to a particular x or z coordinate at once. Neither will decoding schemes such as the ones in succeed in compensating distortions along the x direction as several individually encoded coordinates along this axis are interrogated multiple times during the acquisition discussion. In general full compensation of an arbitrary inhomogeneity along n dimensions will demand the use of an nD spatial encoding pulse followed by a continuous n dimensional rasterization of the image. When viewed as a function of and t both the nD encoding and decoding processes regain in this fashion a one dimensional character and the various equations and conditions derived in Section 3 can be re applied.

The mathematics of a full 3D inhomogeneity compensation are quite involved and their general treatment will be deferred to a subsequent publication. Still we would like to exemplify some of the new issues that will arise even when dealing with the simplest of nD compensation cases. One feature that was absent in both the 1D inhomogeneous field treatment as well as in the homogeneous nD one but which is a regular feature of all r nD compensation schemes concerns the fact that spins will no longer be addressed along orthogonal directions. This will in turn shift the initial coordinate of the rasterization from its ideal position and mix the constant voxel and linear rasterization demands among all n dimensions. This feature can be appreciated by considering the nD stationary phase condition eq. 27 which will now become

Once again the Jacobian relating the encoding frequencies a and orthogonal directions r will intervene in this matrix via the derivatives of r making Q off diagonal as long as 0.

Rather than considering such full treatment we shall focus here on the simpler and arguably more relevant case of how to compensate a 2D spatially encoded experiment for a 1D inhomogeneity of the type z . Specifically we shall consider the 2D spin encoding instance illustrated in which will now lead to 53 now defined as a function of the swept the RF encoding frequencies 54 and . 55 

Whereas the encoding will be imparted as a function of these frequency variables the decoding process will still be given by gradients acting along orthogonal directions r. A decision is thus to be made in terms of choosing a set of variables for describing the experiment either for r or for . Going for the former implies rewriting the stationary phase condition in eq. 27a as

As in the 1D case eq. 56 will have to be derivatized with respect to time in order to extract the acquisition gradients G t and G t . Given the one to one relation between t and z eq. 57 this is equivalent to taking a derivative with respect to z. Notice that this one to one relation is an important demand that could not have been fulfilled if considering the orthogonal x axis of which t in eq. 57 is not a single valued function thus giving mathematical expression to the physical demands noted above. Notice as well that since in the general case and will be high dimensional polynomials of x z we may once again have to deal here with the possibility of multiple root solutions of the kind introduced above.

Also as in the unidimensional case the set of second order spatial derivatives of x z that are needed for defining the acquisition gradients G t G t can be retrieved from the constant voxel condition. According to eqs. 51 and 52 this will now require finding the determinant of the matrix

Then setting its time i.e. its z derivative to zero and looking for the appropriate solutions. It can be shown that for the present case this becomes equivalent to demanding

Notice that the bracketed term in this derivative is akin to a product among the second derivatives defining the x and z spatial resolutions distorted as they now are by the effects of the inhomogeneity. A simple way to solve for the multiple mixed derivatives posed by this equation is to carry out the encoding by means of a linear frequency sweep for instance via an adiabatic sweep leading to c and port all the necessary corrections to a tailored encoding solely along the z axis. This shifts all the focus onto the

Based on the resulting relations a software package capable of providing the encoding RF profile z and decoding gradient G t capable of correcting for given z inhomogeneity affecting a 2 z x encoding experiment was written as mentioned all Ggradients as well as the x related functions x and G t could be left out of the correcting task even in this 2D scenario. Experiments were then carried out based on the zigzagging rasterization in eq. 57 for the sake of testing the capabilities of the ensuing compensation. illustrates a set of representative results obtained in this fashion. Illustrated in panels A and B are single scan 2D MRI profiles obtained on a 5 mm water phantom in the absence of inhomogeneities utilizing EPI and spatial encoding approaches both images are comparable even if the former is of a slightly higher definition. Shown in is an analogous comparison but upon subjecting the sample to a ca. 10 kHz inhomogeneity artificially induced by de shimming the sample along the z axis both images are severely distorted as expected along this weak gradient read out direction. illustrates the recovery potential of the spatial encoding approach upon applying the compensation just described as can be appreciated the quality of the resulting 2D image is not significantly different from that of its homogeneous field analog in panel B. A few additional comparisons between un corrected and corrected features worth remarking in this 2D procedure are illustrated in .

By treating the sample in a non uniform fashion the spatial encoding protocol enables the acquisition of nD MR images within a single scan while at the same time opening up various possibilities to deal with field inhomogeneities. The present study focused on compensating artifacts that arise from a Bfield distribution we shall discuss elsewhere additional opportunities that arise in terms of compensating B related inhomogeneities for dealing with the presence of multiple chemical sites as well as for removing artifacts that arise from the combined action of all of these factors. As for the specific Bcompensation procedures described herein we believe that while many of their principles will remain valid their implementation could be improved over the particular set of choices made in the experiments and calculations hereby presented. In particular the ways that have been employed namely sweeping the RF pulses to achieve the desired r profiles or to reintroduce the image ideality while keeping the encoding gradients and the acquisition dwell time constant are the best modes presently known but others may be found. Work is still going on to explore various options and of assessing their relative merits and performance.

We believe that although much simpler and apparently less general than its higher dimensional counterpart the one dimensional Bcompensation scheme introduced above can proof particularly practical. Indeed instances often arise where field inhomogeneities even though three dimensional are primarily relevant along one of the spatial directions. This is the case for instance along the read out direction of a 2D EPI scan or in an ex situ single sided imaging setup. In such cases the execution of a hybrid spatial encoding Fourier scheme of the type illustrated in where the small bandwidth axis would undergo a blipped incrementation and concomitant 1D field compensation while FIDs are actually digitized while under the action of a strong orthogonal k space encoding could offer several of the advantages while avoiding the comparative disadvantages of spatially encoded MRI. Furthermore the spatially selective nature of this procedure also makes it particularly well suited to spatially discriminating detection setups such as those arising in parallel imaging 29 30 . Combination of the scheme hereby discussed with other EPI derived inhomogeneity compensation procedures 31 32 are also avenues worth pursuing. Further tests of these options are currently continuing.

To give effect to the present invention any general purpose computer or computer system including a set of Computer Nodes and or Group Members can be employed. A typical group member can be an IBM eServer iSeries server system. Any suitably configured processing system is similarly able to be used by embodiments of the present invention. The computer system has a processor that is connected to a main memory mass storage interface terminal interface and network interface. These system components are interconnected by a system bus. Mass storage interface is used to connect mass storage devices such as a DASD device to the computer system. One specific type of DASD device is a floppy disk drive which may be used to store data to and read data from a floppy diskette.

The Main Memory contains application programs objects data and an operating system image. The applications programs objects data and operating system are not required to be completely resident in the main memory at all times or even at the same time. The computer system can utilize conventional virtual addressing mechanisms to allow programs to behave as if they have access to a large single storage entity referred to herein as a computer system memory instead of access to multiple smaller storage entities such as main memory and DASD device. Note that the term computer system memory is used herein to generically refer to the entire virtual memory of computer system.

The operating system is a suitable multitasking operating system such as the IBM OS 400 operating system. Embodiments of the present invention are able to use any other suitable operating system. Operating system includes a DASD management user interface program a DASD storage management program and a group user interface program. Embodiments of the present invention can utilize architectures such as an object oriented framework mechanism that allows instructions of the components of operating system to be executed on any processor within the computer.

Embodiments of the present invention incorporate interfaces that include separate fully programmed microprocessors that are used to off load processing from the CPU. Terminal interface is used to directly connect one or more terminals to the computer system. These terminals which are able to be non intelligent or fully programmable workstations are used to allow system administrators and users to communicate with the computer system.

A network interface can be used to connect other computer systems or group members to the computer system. The present invention works with any data communications connections including present day analog and or digital techniques or via a future networking mechanism. Although the exemplary embodiments of the present invention are described in the context of a fully functional computer system those skilled in the art will appreciate that embodiments are capable of being distributed as a program product via floppy disk e.g. floppy disk CD ROM or other form of recordable media or via any type of electronic transmission mechanism.

Embodiments of the present invention include an operating system that includes a DASD management user interface program that performs functions related to configuration operation and other management functions including functions for selecting one or more DASDs for an auxiliary storage pool ASP . An ASP is defined as a set of disk units and an independent auxiliary storage pool IASP is a set of disk units independent of a system. An IASP can be switched between systems if its disk units are switchable and follow configuration and placement rules. The DASD management user interface program is able to communicate with DASD storage management DSM program which is a component of operating system that provides internal support for managing disk units.

Non limiting Software and Hardware Examples Embodiments of the invention can be implemented as a program product for use with a computer system such as for example the cluster computing environment described herein. The program s of the program product defines functions of the embodiments including the methods described herein and can be contained on a variety of signal bearing medium. Illustrative signal bearing medium include but are not limited to i information permanently stored on non writable storage medium e.g. read only memory devices within a computer such as CD ROM disk readable by a CD ROM drive ii alterable information stored on writable storage medium e.g. floppy disks within a diskette drive or hard disk drive or iii information conveyed to a computer by a communications medium such as through a computer or telephone network including wireless communications. The latter embodiment specifically includes information downloaded from the Internet and other networks. Such signal bearing media when carrying computer readable instructions that direct the functions of the present invention represent embodiments of the present invention.

In general the routines executed to implement the embodiments of the present invention whether implemented is part of an operating system or a specific application component program module object or sequence of instructions may be referred to herein as a program. The computer program typically is comprised of a multitude of instructions that will be translated by the native computer into a machine readable format and hence executable instructions. Also programs are comprised of variables and data structures that either reside locally to the program or are found in memory or on storage devices. In addition various programs described herein may be identified based upon the application for which they are implemented in a specific embodiment of the invention. However it should be appreciated that any particular program nomenclature that follows is used merely for convenience and thus the invention should not be limited to use solely in any specific application identified and or implied by such nomenclature.

It is also clear that given the typically endless number of manners in which computer programs may be organized into routines procedures methods modules objects and the like as well as the various manners in which program functionality may be allocated among various software layers that are resident within a typical computer e.g. operating systems libraries API s applications applets etc. It should be appreciated that the invention is not limited to the specific organization and allocation or program functionality described herein. The present invention can be realized in hardware software or a combination of hardware and software. A system according to a preferred embodiment of the present invention can be realized in a centralized fashion in one computer system or in a distributed fashion where different elements are spread across several interconnected computer systems. Any kind of computer system or other apparatus adapted for carrying out the methods described herein is suited. A typical combination of hardware and software could be a general purpose computer system with a computer program that when being loaded and executed controls the computer system such that it carries out the methods described herein.

Each computer system may include inter alia one or more computers and at least a signal bearing medium allowing a computer to read data instructions messages or message packets and other signal bearing information from the signal bearing medium. The signal bearing medium may include non volatile memory such as ROM Flash memory Disk drive memory CD ROM and other permanent storage. Additionally a computer medium may include for example volatile storage such as RAM buffers cache memory and network circuits. Furthermore the signal bearing medium may comprise signal bearing information in a transitory state medium such as a network link and or a network interface including a wired network or a wireless network that allow a computer to read such signal bearing information. The present invention can be realized in hardware software or a combination of hardware and software. A system according to a preferred embodiment of the present invention can be realized in a centralized fashion in one computer system or in a distributed fashion where different elements are spread across several interconnected computer systems. Any kind of computer system or other apparatus adapted for carrying out the methods described herein is suited. A typical combination of hardware and software could be a general purpose computer system with a computer program that when being loaded and executed controls the computer system such that it carries out the methods described herein.

An embodiment of the present invention can also be embedded in a computer program product which comprises all the features enabling the implementation of the methods described herein and which when loaded in a computer system is able to carry out these methods. Computer program means or computer program in the present context mean any expression in any language code or notation of a set of instructions intended to cause a system having an information processing capability to perform a particular function either directly or after either or both of the following a conversion to another language code or notation and b reproduction in a different material form.

A computer system may include inter alia one or more computers and at least a computer readable medium allowing a computer system to read data instructions messages or message packets and other computer readable information from the computer readable medium. The computer readable medium may include non volatile memory such as ROM Flash memory Disk drive memory CD ROM and other permanent storage. Additionally a computer readable medium may include for example volatile storage such as RAM buffers cache memory and network circuits. Furthermore the computer readable medium may comprise computer readable information in a transitory state medium such as a network link and or a network interface including a wired network or a wireless network that allow a computer system to read such computer readable information.

The computer system can include a display interface that forwards graphics text and other data from the communication infrastructure or from a frame buffer not shown for display on the display unit . The computer system also includes a main memory preferably random access memory RAM and may also include a secondary memory . The secondary memory may include for example a hard disk drive and or a removable storage drive representing a floppy disk drive a magnetic tape drive an optical disk drive and more The removable storage drive reads from and or writes to a removable storage unit in a manner well known to those having ordinary skill in the art. Removable storage unit represents a floppy disk magnetic tape optical disk and more which is read by and written to by removable storage drive . As will be appreciated the removable storage unit includes a computer usable storage medium having stored therein computer software and or data.

In alternative embodiments the secondary memory may include other similar means for allowing computer programs or other instructions to be loaded into the computer system.

Such means may include for example a removable storage unit and an interface . Examples of such may include a program cartridge and cartridge interface such as that found in video game devices a removable memory chip such as an EPROM or PROM and associated socket and other removable storage units and interfaces which allow software and data to be transferred from the removable storage unit to the computer system.

The computer system may also include a communications interface . Communications interface allows software and data to be transferred between the computer system and external devices. Examples of communications interface may include a modem a network interface such as an Ethernet card a communications port a PCMCIA slot and card and more Software and data transferred via communications interface are in the form of signals which may be for example electronic electromagnetic optical or other signals capable of being received by communications interface . These signals are provided to communications interface via a communications path i.e. channel . This channel carries signals and may be implemented using wire or cable fiber optics a phone line a cellular phone link an RF link and or other communications channels.

In this document the terms computer program medium computer usable medium and computer readable medium are used to generally refer to media such as main memory and secondary memory removable storage drive a hard disk installed in hard disk drive and signals. These computer program products are means for providing software to the computer system. The computer readable medium allows the computer system to read data instructions messages or message packets and other computer readable information from the computer readable medium. The computer readable medium for example may include non volatile memory such as Floppy ROM Flash memory Disk drive memory CD ROM and other permanent storage. It is useful for example for transporting information such as data and computer instructions between computer systems. Furthermore the computer readable medium may comprise computer readable information in a transitory state medium such as a network link and or a network interface including a wired network or a wireless network that allow a computer to read such computer readable information.

Computer programs also called computer control logic are stored in main memory and or secondary memory . Computer programs may also be received via communications interface . Such computer programs when executed enable the computer system to perform the features of the present invention as discussed herein. In particular the computer programs when executed enable the processor to perform the features of the computer system. Accordingly such computer programs represent controllers of the computer system.

Further Single Scan Strategies for the Acquisition of High Resolution NMR Data in Inhomogeneous Fields

As explained spatially encoded RF based corrections can also compensate for field inhomogeneities within spectroscopic NMR settings. Consider a field inhomogeneity profile B t r t that has been a priori characterized acting in simultaneity with a set of internal frequencies stemming for instance from chemical shifts or J couplings or extend gradient derived frequencies right arrow over X right arrow over G right arrow over r whose spectral distribution I we are attempting to measure. A conventional excitation will lead in the transverse rotating frame plane to a uniformed phase spin density profile which in the absence of relaxation will result in a time domain signal

In general this signal will decay within a timescale that is inverse to s span over the detected volume of interest precluding a resolution of interactions situated closer than this spread. By contrast if one departs from a uniform spin excitation and replaces it with a phase encoded r t exp i r t state where r t r t t it is clear that the resulting time domain signal will be free from the effects of the inhomogeneity and therefore solely reflective of the internal interactions. From an analysis of S t a high resolution inhomogeneity free I spectrum would follow. This simple argument highlights the two main challenges to overcome towards the successful exploitation of this approach i an optimal strategy for imparting for a given time t the spatially selective z rotation represented by r t r t t needs to be designed and ii a way of extending the single instant correction imparted by this r t towards the acquisition of a full S t set multiplexing all spectral information needs to be found. The latter appears to be the main of the two challenges particularly if one wishes to implement it on a single scan acquisition basis. And yet two examples have recently exemplified the use of spatially selective manipulations of the kind just described to the acquisition of high resolution data within a single scan 18 43 . This portion of the description is devoted to brief theoretical descriptions of these methods and to the experimental demonstration of their potential.

One of the solutions proposed for achieving the high resolution goals just mentioned relied on exploiting the principles involved in single scan nD NMR 13 14 . By already relying on a spatially resolved encoding of the interactions this methodology provides a natural starting point for a r based inhomogeneity compensation. Unlike what happens in conventional time domain experiments single scan nD NMR delivers its high resolution spectroscopic information within an acquisition time Tthat can in principle be made arbitrarily short. This is the consequence of a read out process where peak positions become determined by the action of an acquisition gradient Gdefining spectral widths according to a wavenumber

A number of strategies have been proposed for achieving the spatial encoding underlying single scan nD NMR 13 14 21 22 45 46 . One of these relies on a series of Ndiscrete excitation pulses that trigger the evolution of spins placed at different positions rover a series of incremented times t r C r r . In order to implement such spatially selective excitation a suitably refocused encoding gradient Gis activated and the offset of the excitation pulses is evenly spread between the GL 2 frequency bounds dictated by the sample length L 14 . In the presence of the inhomogeneities individual positions rare then addressed by this train of RF excitation pulses according to . 62 

This is correct within an undetermined error r Ggiven by the a priori unknown off resonance values an error which for simplicity we shall assume small. The overall position dependent phase r accumulated by the spins following such discrete spatial encoding process will then reflect a free evolution depending on the internal shifts as well as on the inhomogeneity effects one is trying to remove t 1 . . . 63 

Here r denotes the relative phase of the RF pulse used to excite the i th discrete spin packet and is a key parameter that we can freely manipulate to remove the apparent effects of the inhomogeneity. Indeed since both r and t r are known functions setting the phases of the RF pulses equal to r t r r within an arbitrary constant value will ensure that the overall encoding stemming from eq. 3 ends up free from the effects of the field inhomogeneity yet reflective of the evolution to be measured 18 .

A number of alternatives to this discrete option have been proposed for implementing the spatial encoding underlying single scan 2D NMR. These include the application of pairs of chirped 2 pulses 45 pairs of adiabatic pulse sweeps 46 and 2 pulse combinations 21 22 all of these acting while under the action of suitable field gradients and capable of yielding the linear C r r encoding required for the subsequent G driven readout of the interactions. Like their discrete counterpart all these continuous alternatives possess an inhomogeneity compensation potential given the proven advantages of these frequency swept options we address next their mode of compensation. For simplicity we shall focus on the 2 2 combination an experiment where continuously swept RF pulses are applied twice first over an initial time t to effect a progressive excitation of the spins and then over a final time t to implement a regressive storage of the transverse evolution. As a result of these pulses an amplitude modulation is created encoding the teffects of the shifts and couplings as a spatial pattern of stored magnetizations. In the usual homogeneous field scenario the offset of these two chirped pulses is swept over the relevant GL frequency intervals at a constant rate R 2 GL tduring equal periods t t t 2 while the sign of Gis alternated between the excitation and storage. It can then be shown that by setting the RF intensity B 0.25 square root over R identical 2 nutations are achieved the resulting amplitude modulated signal possesses the kind of pattern required by the spatial encoding procedure 45 . In order to derive the conditions under which such pair of pulses will deliver the same r C r r spin evolution even in the presence of field inhomogeneities we shall consider as in the discrete case a 1D problem where once again GL . The first of these pulses will then address spins progressively at times r when its RF offset O matches the spin s resonance frequency r Gr r the second one will act at a time r when its offset O matches r Gr r . Following an extension of eq. 63 the overall phase that gets evolved by the spins magnetizations as a function of their position will be given by . 64 

The first two terms in this expression denote the free evolution undergone by spins as a result of the gradient and of the inhomogeneity as these are both artifacts of the experiment our aim will be to remove them. To do so we shall be aided by the two terms in eq. 64 s right hand side which are added and subtracted from the spins evolution by the excitation and storage pulses respectively. These latter contributions can be summarized as

The inhomogeneity refocusing condition can be summarized by requesting that eq. 64 be deprived of its spatial dependence i.e. by claiming

Simultaneously the RF sweeps leading to this condition need to allow for a linear spatial encoding of the internal interactions in other words the overall free evolution time tmust as in the homogeneous Bsituation fulfill 67 with C t L and r L 2. Eqs. 64 67 suffice to derive the times r at which the continuously swept RF offsets have to excite store spin coherences positioned at a given coordinate r and at the same time remove the effects of the inhomogeneity. Assuming for simplicity that as in the homogeneous encoding cases one uses G G G these times need to fulfill

From these expressions the frequency sweep profiles of the encoding pulses can be obtained by inverting r into r numerically if need be and by then plugging the resulting function into the frequency modulated excitation storage profiles O Gr r . As in the homogeneous case a suitable amplitude modulation of such frequency shaped pulses also needs to be introduced so that the adiabaticity parameters of the sweeps keep on maintaining the B 0.25 square root over dO d condition required for imparting 2 nutations 17 . Notice that as a result of the inhomogeneity the durations of the swept pulses cease to be identical and become instead given by the

The strategies just described amount to shaping the RF excitation storage pulses so as to impart spatially dependent z rotations that at the conclusion of an in indirect time tshall be able to remove known inhomogeneity profiles. Spatially dependent z rotations can also be used in an alternative way to remove previously known field inhomogeneities namely by applying them on spins after they have been excited into the transverse x y plane. This results in shim pulses spatially dependent rotations designed to refocus the effects of inhomogeneities acting within a particular dwell time twhile preserving at least to some extent the effects of chemical shifts. As discussed in Ref. 43 a pair of consecutive pulses spanning the shortest possible times t t and applied in between the signal digitization provide a particularly simple way to impart this kind of spatially selective z rotations . Indeed as each pulse reverses the effects of the chemical shifts while leaving homonuclear couplings unaffected a spectrum will result where chemical shifts appear scaled by a factor

Following arguments given elsewhere concerning the use of adiabatic sweeps to obtain spatially encoded signals 21 22 46 47 we can describe the overall phase evolved during the course of each of transverse dwell time tin as 70 

Here the functions 2 71 denote the phase evolutions that in the rotating frame of reference the two consecutive inversions lasting times t will impart while the

A redundancy arises here in control variables given by the fact that either the r or r functions i.e. either one of the RF sweeps originating and could in principle be modulated for the sake of compensating out the effects of r . To further determine this problem we chose a symmetric like solution where the compensating tasks are equally split between the two sweeps. This in turn leads to the functions

The boundary conditions L 2 L 2 0 L 2 t L 2 t can then be used to define the length of the pulses and gradients to be used for a given inhomogeneity profile and tvalue with these parameters at hand the correcting functions can be derived as

As in the case of the longitudinal compensation these demands can be inverted to derive the r functions from which the offset frequency shapes O r follow. Also in this instance the amplitudes of the resulting RF sweeps need to be tailored to fulfill in all cases the adiabaticity demands of inversions.

In order to evaluate the refocusing performance of the inhomogeneity compensation approaches introduced in the preceding paragraphs a series of simple tests were carried out utilizing the H NMR spectrum of a nButylchloride CDClsolution as target. Under normal high resolution conditions the four individual chemical sites and the mutual H H J couplings within this compound are clearly visible . An uniaxial field inhomogeneity was mimicked by setting the various spectrometer z shim currents to arbitrary values leading to a continuous H lineshape containing few discernible site related features. Still a conventional mapping of the sites resonance frequencies vs position had no difficulties in revealing the circumflex over z inhomogeneity profiles for every site . Using such artificially broadened spectrum as starting point the strategies sketched in were assayed results arising from the approach in are not hereby presented as they have already been illustrated in Ref. 18 . shows the kind of resolution improvement obtained with the longitudinal corrective scheme in . The indirect domain spatially encoded compensation employed a t 40 ms two 2 chirped pulses applied while in the presence of a G 10 G cm encoding gradient along the circumflex over z direction and a data decoding period T 0.4 ms under the action of a G 10 G cm acquisition gradient. Arguably a stronger encoding gradient could have lead to smaller shift induced errors in the inhomogeneity correction which for the present case were given by G 0.1 mm. On the other hand stronger gradients would also have exacerbated the potential effects of diffusion over the course of t. The effective half line width observed for the peaks in this corrective experiment was ca. 30 Hz sufficient to unambiguously resolve the inequivalent chemical sites yet not their internuclear spin spin couplings.

The two inhomogeneity refocusing solutions just described are in a way complementary one operates by spatially encoding its compensations along an indirect tevolution domain while the other refocuses inhomogeneities in between tdirect domain dwell times. A natural approach to try out is consequently to combine both 1D refocusing strategies so as to explore new opportunities towards the acquisition of two dimensional NMR spectra in inhomogeneous fields. Indeed neither of the two corrective approaches just described makes any special demands on the evolutions that might have occurred in a complementary time domain space thereby allowing for their natural integration without substantial additions or modifications. illustrates results obtained from such combination using once again the conditions of as an example. Notice that the resulting 2D spectra which exhibit a remarkable high resolution along their two dimensions are in all cases the result of single scan acquisition experiments.

The spatially selective encoding strategies described above can sharpen up spatially inhomogeneous NMR peaks by orders of magnitude. Yet as the experimental results also illustrate these approaches face a number of limitations in delivering an optimum chemical shift information. The main limitation of the indirect domain spatial encoding approach concerns as is also the case for single scan 2D NMR the issue of sensitivity. Indeed although a variety of manipulations and optimizations could lead to a resolution that exceeds the one exemplified in such experiments would demand that the actual acquisition time of the data T be made much shorter that the decay time introduced by the inhomogeneity. And although this can always be achieved by employing a sufficiently large acquisition gradient G a price has to be paid in terms of a larger filter bandwidth proportional to GL and of a stronger ensuing noise affecting the data. As for the direct domain compensation approach it s main drawback appears to stem from the substantial scaling of the chemical shifts on which it incurs. Once again it seems likely that a number of optimizations could be here implemented to reduce the duration taken by the z rotations for instance by applying the two refocusing pulses in near simultaneity rather than in the sequential fashion depicted in . Still it is not evident that the resulting improvements could enable the routine use of the compensation towards chemical shift based identifications particularly in the relatively low fields normally associated to MR imaging and spectroscopy in wide bore animal or clinical scanners.

And yet in these latter cases where sensitivity is usually limited by low metabolite concentrations and completing acquisitions within a single scan is not a primary concern the single instant nature of the spatially encoded compensation principle can be combined with the classical scheme of 2D NMR to deliver a robust approach for correcting the inhomogeneities. In such cases one can envision a family of experiments where inhomogeneities acting over the course of the indirect domain are corrected in advance and at the time of the excitation by a suitable polychromatic pulse 48 acting in a spatially selective manner owing to the application of a strong magnetic field gradient . This in turn requires setting for each tincrement within an otherwise freely evolving 2D acquisition the phases of the individual N components making the polychromatic excitation pulse according to 1 . . . 76 where is the duration of the polychromatic pulse and O r Gr r constitute the pulse s basic N frequency elements. The position dependent evolution phases introduced by the excitation gradient and the r distribution would then cancel out at the culmination of the indirect domain evolution period enabling a high resolution signal S t to be sampled. Repeating the procedure a suitable number of tfree evolution increments should then yield a conventional high resolution time domain signal when viewed along the indirect domain. Notice that since such signals can be observed while in the absence of ancillary field gradients no extra sensitivity penalties will be involved and that since in general 

To explore the compensation abilities of the scheme just described a series of tests were carried out. An illustration of the experiment s performance is demonstrated in which summarize the 2D results arising from the n butylchloride CDClstandard subject once again to a ca. 1.5 kHz inhomogeneity along the z axis. Although these inhomogeneities result in a conventional FID whose T is only a few ms long signals evolving for hundreds of ms along both tand tare obtained upon using the inhomogeneity compensation procedure . For this particular example the inhomogeneity averaging reflects the compensation introduced by a single 400 s long 2 polychromatic pulse triggering the tevolution and the refocusing effects brought about by a train of hard CPMG pulses executed every 4 ms during t. Notice that by virtue of the free evolution experienced by the spins during tchemical shifts and J couplings result in a spectrum with a completely normal appearance yet with linewidths that are ca. 400 times sharper than in their single pulse counterpart. A similar approach could be employed over the phase encoding period of a gradient echo MRI acquisition to yield high definition images in the presence of gross inhomogeneities.

It follows that a spatially encoded 2D corrective approach can significantly improve the appearance of spectroscopic or imaging NMR data without incurring in any apparent penalties at least for cases where numerous scans are to be collected in any case for the sake of improving sensitivity. A question that then naturally arises concerns the potential limitations of this 2D inhomogeneity compensation procedure. In principle one could assume that given an encoding gradient that is large enough compared to the local inhomogeneity and sufficient RF power to efficiently excite the resulting gradient induced bandwidth arbitrarily large inhomogeneities could be compensated by the procedure. While at the same time the low sensitivities following from the short T s imposed by the magnet s inhomogeneities could be dealt with by the application of a signal enhancing CPMG train. Given such considerations it appears that even currently available commercial gradient probeheads capable of reaching in excess of 2000 G cm could go to great lengths towards dealing with the 100 ppm inhomogeneities normally characterizing high field Physics oriented magnets. At some point however a new inhomogeneity driven line broadening mechanism will arise associated now to the incoherent motions that spins in a liquid will undergo over the course of the tperiod between the time they are excited and the time when their coherent echo is detected. Such diffusion effects are known to inflict decays of the form

By treating the sample in a spatially selective fashion the combined application of external field gradients and of frequency selective pulses opens up a number of new opportunities towards the acquisition of high resolution NMR spectra and high definition MRI images within inhomogeneous fields. The discussion of the present invention employed an artificially broadened 1D model in order to focus on some single and multiple scan compensating alternatives. The former have obvious speed advantages but achieve their aim at the expense of either sensitivity or resolution limitations. For low sensitivity low field cases where signal averaging may anyhow be required and where chemical shift resolution is at a premium such sacrifices may be unacceptable. An alternative was thus presented based on merging multiscan acquisitions with the spatially encoded inhomogeneity compensation procedure within the framework of a traditional 2D NMR experiment. The resulting compensation is then endowed with a good sensitivity by virtue of the summations involved in the tFourier transformation and the tCPMG acquisition together with an unsealed spectral information reflecting the free evolution occurring along t. A further homonuclear J domain encoding unimportant at high Bfields but potentially diagnostic at lower fields 52 also arises along the direct domain. All these features combined could proof particularly useful in a number of scenarios including in vivo analyses of metabolites in animal or human scanners studies that are generally characterized by relatively high heterogeneities limited shimming capabilities and relatively low magnetic fields where chemical shift displacements are at a premium.

A number of simplifications adopted throughout the discussion are worth remarking. One involved the Binhomogeneities which were assumed one dimensional and time independent. Another concerned the RF manipulations which were assumed to act instantaneously and on the basis of the small angle approximation. While these assumptions were taken for the sake of evidencing more clearly the nature of the compensation procedures none of them is actually essential and all can be dispensed of in realistic applications. From a practical standpoint the greatest challenge is probably posed by the extension of the procedure hereby described from one spatial dimension to three. There are a number of different ways by which such extension can be carried out these range from transforming the single axis compensation procedure into a multiple axis one where multiple corrective RF pulses are applied while under the action of linearly independent gradients to the design of a compensation procedure based on the application of a single multi dimensional corrective RF pulse. The first of these approaches could be readily incorporated into standard spectroscopic sequences such as STEAM or PRESS 35 yet the nature of r profiles that could be thus compensated is mostly limited to products of 1D field inhomogeneities. The latter approach by contrast would be truly general yet given the lengthier nature of multidimensional RF pulses vis vis their 1D counterparts 53 it could be more susceptible to signal losses. In between solutions involving sequential 1D and 2D RF compensating pulses could constitute a good compromise to overcome these limitations. The single instant nature of the various schemes hereby discussed also makes them suitable for dealing with periodic time dependent Bvariations provided these are amenable to characterizations by means navigator scans 54 . As for the design of all our RF compensations based on the small angle approximation it is also worth noting that numerous different alternatives discussed in the literature are worth exploring within an inhomogeneity compensation context 53 .

The invention of the method and apparatus includes a protocol for retrieving multidimensional nuclear magnetic resonance NMR spectra and magnetic resonance imaging MRI profiles within a single scan as has been recently proposed based on a spatial encoding of the MR interactions. It has also been shown that the selectivity with which spins are manipulated during this encoding process opens up the possibility for compensating for magnetic field inhomogeneities not by demanding extreme uniformities from the Bfields employed but rather by compensating for their effects at a radiofrequency excitation and or refocusing level. The present invention here employs its potential in an MRI setting and in a purely spectroscopic scenario where the goal is the acquisition of high definition multidimensional images of the spins density and or their spectral response. It is shown that in combination with time dependent gradient manipulations such compensation approach offer a greater flexibility and can be used to counteract substantial field inhomogenities at either global or local levels over relatively long periods of time for both one as well as multi dimensional single scan MRI situations or experiments. The upper tolerable limits in the field distortions talus become much larger than those acceptable in comparable NMR MRI acquisition modes based on a simple excitation of the spins and Fourier transformation FT of the data. The new compensation method and apparatus provide a scheme that could find uses in areas where heterogeneities in magnetic fields present serious obstacles including functional studies in regions near tissue air interfaces imaging or spectroscopy of high susceptibility areas real time imaging in surgical environments ex situ MRI etc. Modified versions of the compensation method and apparatus hereby presented that could also offer a robust route to eliminate other common NMR MRI artifacts including spatial heterogeneities in the BRF fields amplitudes as well as chemical shift artifacts in imaging experiments. The principles of the Bcompensation method and apparatus of the present invention have been disclosed for one and higher dimensional cases and experimentally demonstrated on a series of 1D and 2D NMR and MRI experiments of simple phantoms subject to field inhomogeneities.

As proposed according to the present invention a protocol is presented for retrieving nuclear magnetic resonance NMR spectra based on a spatially dependent encoding of the MR interactions. It has also been shown that the spatial selectivity with which spins are manipulated during such encoding opens up new avenues towards the removal of magnetic field inhomogeneities not by demanding extreme Bfield uniformities but rather by compensating for the dephasing effects introduced by the field distribution at a radiofrequency excitation and or refocusing level. The present invention discusses in further detail a number of strategies deriving from this principle geared at acquiring both uni as well as multi dimensional spectroscopic data at high resolution conditions. Different variants are presented tailored according to the relative sensitivity and chemical nature of the spin system being explored. In particular a simple multi scan method and apparatus is discussed capable of affording substantial improvements in the spectral resolution at nearly no sensitivity or scaling penalties. This new compensation method and apparatus is therefore well suited for the collection of high resolution data in low field systems possessing limited signal to noise ratios where magnetic field heterogeneities might present a serious obstacle. Potential areas of applications of these techniques include high field in vivo NMR studies in regions near tissue air interfaces clinical low field MR spectroscopy on relatively large off center volumes difficult to shim and ex situ NMR. The principles of the different compensation methods have been reviewed and experimentally demonstrated for one dimensional inhomogeneities further improvements and extensions have also been briefly discussed.

Referring now to there is shown in block diagram a preferred embodiment of an NMR MRI apparatus according to the present invention with the types of signals shown in the block diagram shown in the legend box at the lower right of the drawing. As shown the apparatus consists of a magnet that generates a high quality high intensity magnetic field that is uniform within the volume of a sample undergoing test or monitoring. As shown the magnet includes an ancillary shim coil system for achieving a good homogeneity over the desired volume. Included within this embodiment are the coils for generating the magnetic field gradients required by the invention. The magnetic field strength may be stabilized with the aid of an additional locking circuitry. Within a probehead unit in the magnet is positioned the sample and one or multiple RF coils .

The probehead unit probe contains the sample to be studied as well as ancillary electronic equipment including the coils needed for generating the field gradients required by the invention the electronics associated with an efficient PF irradiation of the spins and the circuitry for an efficient detection of the spins signal. Numerous such gradient and RF circuits are present in the single probe the former for accounting for the three spatial directions the latter for the simultaneous irradiation of multiple nuclear species H H C etc. as well as for the detection of signals coming from multiple coils.

The gradient wave form generator and driver unit is comprised of a digital gradient waveform generator and a gradient driver that translates these digital signals into low level analog currents which are fed to gradient amplifiers X Y Z via lines where these low level signals are translated into intense high gradient driving currents that are supplied via lines to the gradient coils surrounding the sample . Three such units are independently present driving orthogonal x y and z geometries.

RF Generation and Irradiation Unit is comprised of an RF unit having a low level synthesizer generating the basic low power RF signal used to irradiate EL spin an amplitude and phase control stage capable of creating pulses of different frequencies and shapes. Unit is coupled via lines to and feeds high power amplifiers that translate these low level signals into the intense pulses that are fed via lines to common lines into the RF coils in the probe for the actual irradiation. Common lines serve as multiple RF Channels In Signals Out. Unit also provides a reference RF for the subsequent demodulation of the spins signal from the radio MHz to the audio kHz range via line to RF Signal Detection Demodulation Unit . Several such units are usually present one per spin species to be irradiated during a particular sequence .sup.1 H .sup.3 C .sup.15 N .sup.2 H etc. .

A Signal Detection Unit receives the RF signal from spins via multiple RF channels In Signals Out line and coupled line . The Unit is comprised of one or several RF signal preamplifier amplifier to effect the requisite preamplification and then amplification. Preamplifier amplifier is coupled in turn to an RF Signal Detection Demodulation unit including the functions of demodulation and detection which in turn is coupled to an Analog to Digital Data Acquisition Unit that contains the digitization components capable of transforming the voltage originally generated by the spins following their irradiation into a string of complex numbers the Free Induction Decay or FID .

A Computer and Display is coupled to Fast Pulse Programmers which receive instructions from the computer via bus as indicated in . These components and are responsible for interfacing to the user and then creating the desired sequence of commands that all remaining units in the apparatus will carry out during the course of the operation of the apparatus or the experiment. Thus the computer also provides instructions via bus to the RF generation unit and to the Gradient Wave Form Generator Driver Unit . In accordance with standard computer practice users commands input via a standard I O such as a keyboard or other such input device are translated by the computer into strings of binary digits and logical timing signals that are in turn executed by the various units. The computer containing adequate memory is also usually the final depository of the digitized FID where its data is processed into an NMR spectrum according to the algorithms and other information set forth above and display takes place. The Fast Pulse Programmers are connected by buses and to provide fast timing control to the RF Signal Detection Demodulation Unit the RF generation unit and the Gradient Wave Form Generator and Driver Unit .

The present invention i.e. system or apparatus described in detail in this description of specific embodiments and as generally depicted in or any part thereof as previously noted may be implemented using hardware software or a combination thereof and may be implemented in one or more computer systems or other processing systems and the capability would be within the skill of one ordinarily skilled in the art of programming of computers from the teachings and detailed disclosure provided in the foregoing description of the apparatus and the process. As noted the computer system utilized in the invention represents any single or multi processor computer and in conjunction therewith single threaded and multi threaded applications can be used. Unified or distributed memory systems can be used. In one example the system and method of the present invention is implemented in a multi platform platform independent programming language such as Java programming language structured query language PL SQL hyper text mark up language HTML practical extraction report language PERL Flash programming language common gateway interface structured query language CGI SQL or the like and can be implemented in any programming language and browser developed now or in the future as would be apparent to a person skilled in the relevant art s given this description. In another example the system and method of the present invention may be implemented using a high level programming language e.g. C and applications written for the Microsoft Windows NT or SUN OS environments. It will be apparent to persons skilled in the relevant art s how to implement the invention in alternative embodiments from the teachings herein.

The Computer system of the invention includes one or more processors and can execute software implementing the routines described above. Various software embodiments are described in terms of this exemplary computer system. After reading this description it will become apparent to a person skilled in the relevant art how to implement the invention using other computer systems and or computer architectures.

Although specific embodiments of the invention have been disclosed those having ordinary skill in the art will understand that changes can be made to the specific embodiments without departing from the spirit and scope of the invention. The scope of the invention is not to be restricted therefore to the specific embodiments. Furthermore it is intended that the appended claims cover any and all such applications modifications and embodiments within the scope of the present invention.

