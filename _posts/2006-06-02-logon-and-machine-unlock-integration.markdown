---

title: Logon and machine unlock integration
abstract: A method of avoiding a second login of user information in an encrypted disk computer system includes a communications path for transferring user login information. The login information is acquired and used by a first software module which authenticates the user to decrypt a disk with an encrypted operating system. The same login information is transferred using the communications channel to a second use which logs the user into the decrypted operating system. The method also supports multiple users through maintenance of multiple users credentials.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07818255&OS=07818255&RS=07818255
owner: Microsoft Corporation
number: 07818255
owner_city: Redmond
owner_country: US
publication_date: 20060602
---
User authentication onto a computer system is typically accomplished with a user identification and password or smartcard together with access control mechanisms. These are effective ways of providing access control for data when an operating system OS is running. When the OS is not running most platforms require other mechanisms to protect data because the disk containing the data and access control restrictions can be mounted by an OS that does not honor the access control proclamations associated with the data to be protected.

In such circumstances encryption technology is commonly employed so that data accessed by an unauthorized operating system is unreadable. Such data is generally contained on disk storage such as a hard disk drive magnetic or optical . If encryption of the disk is used then the key used to encrypt the data must itself be protected. There are a variety of technologies that are widely employed to protect keys. Common techniques include deriving the key from a password or saving the key on a storage device itself perhaps protected by a key such devices may include a smartcard or USB token. Other ways to protect keys include deriving or gating access to a key based on a biometric device which measures some physical element of the user or authenticating only the operating system to which the key is disclosed so that other operating systems that do not honor the access control metadata can be barred from disk access.

Password protection the use of a smartcard or USB token and the use of biometric devices are only useful if a user is present. As such they are employed by encrypted file systems but only for user or administrator configured storage locations. This is done because there is no user present for much of the uptime on an OS. The problem with this is that applications and the system do not necessarily put all of the data that a user needs to protect in these protected locations. Part of this is poor application design but part of it is a necessary consequence of the OS being a multi user platform.

To avoid the placement of confidential data in unencrypted portions of the disk the simple measure of encrypting the whole disk and deriving the encryption key from a user entered credential may be used. But the following problems can arise a the OS cannot boot without a user present b the user requires two credentials one to derive a disk decryption key and allow the OS to boot and one to log on to the system or c the user logs on twice but uses the same credential each time effectively turning the PC into a single user device. Other problems with user credentials in managed environments include the fact that a domain password can be changed when the OS is offline.

It is desirable to address the multiple credential entry requirement when operating with a multi user system where the OS is encrypted on a storage disk The present invention addresses these and other concerns.

This Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used to limit the scope of the claimed subject matter.

The undesirable double logon aspect present in the prior art can be overcome in a multi user environment where an operating system and other computer resources are protected via disk storage encryption. In such a system one solution is to add a communication path that allows a pre operating system component or module to pass a credential to a logon component of the operating system. The single user management aspect of the prior art can be addressed by providing a protected database of authorized users that is updated by the domain administration system when the OS is running. This database is used during boot to authenticate users and derive disk encryption keys.

Once the encrypted portion of the disk is decrypted the operating system OS that resides on the now decrypted disk is allowed to boot step . This opens up a login program that prompts the user to once again provide login information. The user logs into the computer system a second time step by providing a username and password. The OS now authenticates the user information step . And the user then has access to the computer system resources such as operating system capabilities and application programs and data.

The method of demonstrates that an encrypted system as described requires a first login of user information for authentication by a Pre OS software module in order to generate a key for unlocking the encrypted disk. After the disk is unlocked and decrypted the user has to again log on in order to access the OS resources. This second login can be avoided using aspects of the invention.

User credential information flows from the login entry device to the Pre OS login module which represents a software component of the unencrypted portion of the disk . The Pre Login Module can authenticate the user as a bona fide user of the computer system. The user credential information may also be placed in storage such as on the unencrypted portion of the disk via link . Once authenticated the pre OS module can generate a decryption key for the disk . The encryption key is transferred from the Pre OS Module to the Pre OS disk decryption module where the encrypted portion of the disk is accessed via link and the encrypted portion of the disk is decrypted using the decryption key. Once the decryption is complete the decrypted OS is able to boot up. The Pre OS logon module may access an unencrypted portion of a disk a separate storage location or an element such as a BIOS module.

At this point the OS can re use the credentials of the user by accessing the stored credential information. For example if the stored credential information were placed on the unencrypted portion of that disk as previously described link may be used. The user credentials are then automatically recalled and used to login the user onto the decrypted OS. The user is then able to access the resources of the computer system such as the applications without having to re enter his credentials or any other form of user login information. This contrasts with the scenario where the user was required to enter in his information twice to access the OS resources.

In another aspect of the architecture of successive users such as other registered users of system may log onto the system via the login entry device. In this situation where the OS is already operating the login entry device can provide the new users credentials directly to the decrypted OS via link . Thus a multi user capability can be implemented in the present single login encrypted disk computer system.

Thus a credential generated via a user password smart card or biometric device that is collected early in boot or even pre boot by the BIOS may be used to derive a disk encryption key for the entirety or vast majority of the data on the hard disk. The architecture of employs a communications path from the early boot or pre boot environment to the logon manager i.e. WinLogon on the Windows system available from Microsoft Corporation of Redmond Wash. that allows the early boot authentication information to be re used. In the architecture of the communications channel includes path to for storage and path for retrieval of the user credential information. In another aspect the storage of the user credential information via path is a caching of user credential information and can be performed using any memory element available to the pre OS components. The caching of the credential information is preferably performed using a secure storage technique to prevent unauthorized access.

In general the details of the data that needs to be transferred will depend on the authentication mechanism used. In the case of password logon the pre OS component might collect a user name domain name and password and if the pre OS authentication succeeds also yielding a disk decryption key this information is passed to the logon component to automatically log the user on to the system.

For smartcard authentication the user provides a PIN which enables access to keys on the smartcard for unlocking of access to the disk decryption key. Here user credentials are also stored for later use to avoid a second set of logon information from being required of a user. For biometric authentication the minutiae are typically matched against a template in the logon device and then used to unlock a local credential store containing a key or password. The pre OS component could either pass the minutiae to the logon component for rechecking against a different database or could pass the password or key.

The Windows OS already has a pluggable authentication architecture. This allows an embodiment to be implemented that comports with the current invention to collect a pre OS credential and pass it to a disk encryption subsystem and in turn to a custom logon provider. Alternately the credential may be collected by firmware such as a BIOS and may be passed to the a disk encryption system. Thus a standard interface and third party collected credentials logon functionality may be built into an OS such as Windows so that any pre OS credential provider could enable single sign on without needing to write a custom interface. Windows derives EFS keys from logon credentials. In one embodiment EFS may run with a key derived from the individual user s password.

In one aspect of the invention the encrypted disk is encrypted with a single key. There are standard techniques for deriving a key from a password but a computer is typically used by many users whose passwords are managed centrally and change often. Also for security reasons users should be discouraged from sharing passwords. These limitations mean that a user would normally need two passwords or the PC needs to be turned into a single user device.

Enrollment of a new user can be accomplished by having a database of the disk encryption key encrypted with every domain authenticated user available in the pre OS environment. This database may be the same as or separate from the disk . Access to the disk may be implemented in either pre OS module and or . When a user tries to logon the users domain username and password are used to select a Binary Large Object BLOB not shown that the key recovery entity tries to decrypt with the supplied password. If the decryption succeeds then the key is used to decrypt the rest of the disk and continue boot the OS. In one embodiment the database contains a disk encryption key encrypted by the user credential key obtained for each user.

In one aspect of the invention the database of authenticated users is updated when the OS is running and actively managed e.g. domain joined . If the OS is booted often this technique can also be used to ensure that password changes on other machines are properly propagated to the computer being protected. In the non domain joined managed case the problem of adding users and keeping the password database up to date is easier because the OS is always running when users are added or passwords are changed. A database of authenticated users may be accessed either remotely or locally. The database may be updated via a remote pushdown of data as needed or on a periodic basis. User information may be added deleted or modified via standard database manipulation.

A similar management technique could be used with a smartcard. In this embodiment the smartcard contains the user key protected by a PIN. The user key is used similarly as the password is as mentioned above. Biometric authentication may require a database of templates possibly within the device for all authenticated users and corresponding keys encrypted to a key available only to the pre OS environment.

The disk decryption key is used to decrypt the encrypted disk step . Once the disk is decrypted the now decrypted OS can boot step . Any new data that the OS writes is preferably encrypted with the proper encryption key. The OS accesses the user specific credentials previously stored the secure storage location step . These credentials are then used by the OS login program to automatically log in the specific user onto the computer system step . This action avoids the entry by the user of his login information or his credentials. The specific user now has access to the system with out the user performing a second login step . According to another aspect of the invention a subsequent different user can use the computer terminal to directly log into the running OS using his domain username and password or other equivalent credentials.

The computer system saves the PIN in a secure storage area for later use step . The computer sends the PIN to a the smart card to unlock a private key step . The private key is used to access the disk decryption key step . At this point the encrypted disk may be decrypted using the disk decryption key step . This action allows the decrypted OS to boot step .

As the OS boots a login program of the OS automatically access the user specific PIN from the secure storage location and unlocks the smart card to access the private key step . The private key may then be used by the OS login program to log in the specific user onto the newly booted OS step . Thus the specific user has access to the system without re entering his PIN or other identifying information for the smartcard to allow access into the system OS step . Optionally after the system has logged on the specific user onto the system it may delete the user PIN or other identifying information form the secure storage location step . If a subsequent different user arrives to access the computer system use of his smartcard would allow access to the computer OS directly using his PIN step because the system OS is up and running and entry via a pre OS module is unnecessary.

Upon successful match of the biometric minutiae the biometric device provides a private key to the computer system step . The private key may then be stored in a secure storage location step . The private key is used to access the disk decryption key hidden in a secure location on the computer step . The encrypted disk is then decrypted using the disk decryption key step . Once the encrypted disk having the OS is decrypted the decrypted OS boots up step . A login program or utility of the OS can then access the stored private key step by retrieving it from the secure location. The recovered private key is then used to login the specific biometrically identified user onto the OS computer system step . Thus the user has access to the OS and other computer system resources without a second login or second use of the biometric identification device step . The computer system may then optionally delete the private key from the secure location to enhance security of the private key step . The next user of the system can then simply use the biometric identification technique to log onto the OS directly because the OS is up and running.

It should be noted that in and the storage of the user information PIN or private key into secure storage location may be performed anytime after data to be stored is available but before it dissipates. For example the PIN in may be stored after the PIN is used to unlock the private key used to access the disk decryption key.

As an aspect of the invention a computer readable medium such as but not limited to magnetic storage devices optical devices such as CD and DVD media may be used to store computer program instructions which can implement methods discussed or suggested herein. Such computer media are envisioned to retain executable instructions for use on a general purpose computer to enable it to practice aspects of the invention.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

Although not required embodiments of the invention can also be implemented via an operating system for use by a developer of services for a device or object and or included within application software. Software may be described in the general context of computer executable instructions such as program modules being executed by one or more computers such as client workstations servers or other devices. Generally program modules include routines programs objects components data structures and the like that perform particular tasks or implement particular abstract data types. Typically the functionality of the program modules may be combined or distributed as desired in various embodiments. Moreover those skilled in the art will appreciate that various embodiments of the invention may be practiced with other computer configurations. Other well known computing systems environments and or configurations that may be suitable for use include but are not limited to personal computers PCs automated teller machines server computers hand held or laptop devices multi processor systems microprocessor based systems programmable consumer electronics network PCs appliances lights environmental control elements minicomputers mainframe computers and the like. Embodiments of the invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network bus or other data transmission medium. In a distributed computing environment program modules may be located in both local and remote computer storage media including memory storage devices and client nodes may in turn behave as server nodes.

With reference to an exemplary system for implementing an example host computer includes a general purpose computing device in the form of a computer system . Components of computer system may include but are not limited to a processing unit a system memory and a system bus that couples various system components including the system memory to the processing unit . The system bus may be any of several types of bus structures including a memory bus or memory controller a peripheral bus and a local bus using any of a variety of bus architectures.

Computer system typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer system and includes both volatile and nonvolatile media removable and non removable media. By way of example and not limitation computer readable media may comprise computer storage media and communication media. Computer storage media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer storage media includes but is not limited to Random Access Memory RAM Read Only Memory ROM Electrically Erasable Programmable Read Only Memory EEPROM flash memory or other memory technology Compact Disk Read Only Memory CDROM compact disc rewritable CDRW digital versatile disks DVD or other optical disk storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can accessed by computer system .

The system memory includes computer storage media in the form of volatile and or nonvolatile memory such as read only memory ROM and random access memory RAM . A basic input output system BIOS containing the basic routines that help to transfer information between elements within computer system such as during start up is typically stored in ROM . RAM typically contains data and or program modules that are immediately accessible to and or presently being operated on by processing unit . By way of example and not limitation illustrates operating system application programs other program modules and program data .

The computer system may also include other removable non removable volatile nonvolatile computer storage media. By way of example only illustrates a hard disk drive that reads from or writes to non removable nonvolatile magnetic media a magnetic disk drive that reads from or writes to a removable nonvolatile magnetic disk and an optical disk drive that reads from or writes to a removable nonvolatile optical disk such as a CD ROM CDRW DVD or other optical media. Other removable non removable volatile nonvolatile computer storage media that can be used in the exemplary operating environment include but are not limited to magnetic tape cassettes flash memory cards digital versatile disks digital video tape solid state RAM solid state ROM and the like. The hard disk drive is typically connected to the system bus through a non removable memory interface such as interface and magnetic disk drive and optical disk drive are typically connected to the system bus by a removable memory interface such as interface .

The drives and their associated computer storage media discussed above and illustrated in provide storage of computer readable instructions data structures program modules and other data for the computer system . In for example hard disk drive is illustrated as storing operating system application programs other program modules and program data . Note that these components can either be the same as or different from operating system application programs other program modules and program data . Operating system application programs other program modules and program data are given different numbers here to illustrate that at a minimum they are different copies.

A user may enter commands and information into the computer system through input devices such as a keyboard and pointing device commonly referred to as a mouse trackball or touch pad. Other input devices not shown may include a microphone joystick game pad satellite dish scanner or the like. These and other input devices are often connected to the processing unit through a user input interface that is coupled to the system bus but may be connected by other interface and bus structures such as a parallel port game port or a universal serial bus USB . A monitor or other type of display device is also connected to the system bus via an interface such as a video interface which may in turn communicate with video memory not shown . In addition to monitor computer systems may also include other peripheral output devices such as speakers and printer which may be connected through an output peripheral interface .

The computer system may operate in a networked or distributed environment using logical connections to one or more remote computers such as a remote computer . The remote computer may be a personal computer a server a router a network PC a peer device or other common network node and typically includes many or all of the elements described above relative to the computer system although only a memory storage device has been illustrated in . The logical connections depicted in include a local area network LAN and a wide area network WAN but may also include other networks buses. Such networking environments are commonplace in homes offices enterprise wide computer networks intranets and the Internet.

When used in a LAN networking environment the computer system is connected to the LAN through a network interface or adapter . When used in a WAN networking environment the computer system typically includes a modem or other means for establishing communications over the WAN such as the Internet. The modem which may be internal or external may be connected to the system bus via the user input interface or other appropriate mechanism. In a networked environment program modules depicted relative to the computer system or portions thereof may be stored in the remote memory storage device. By way of example and not limitation illustrates remote application programs as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.

Various distributed computing frameworks have been and are being developed in light of the convergence of personal computing and the Internet. Individuals and business users alike are provided with a seamlessly interoperable and Web enabled interface for applications and computing devices making computing activities increasingly Web browser or network oriented.

For example MICROSOFT s .NET platform available from Microsoft Corporation includes servers building block services such as Web based data storage and downloadable device software. While exemplary embodiments herein are described in connection with software residing on a computing device one or more portions of an embodiment of the invention may also be implemented via an operating system application programming interface API or a middle man object between any of a coprocessor a display device and a requesting object such that operation may be performed by supported in or accessed via all of .NET s languages and services and in other distributed computing frameworks as well.

As mentioned above while exemplary embodiments of the invention have been described in connection with various computing devices and network architectures the underlying concepts may be applied to any computing device or system in which it is desirable to implement a method for re using user login credentials to eliminate a second credential entry. Thus the methods and systems described in connection with embodiments of the present invention may be applied to a variety of applications and devices. While exemplary programming languages names and examples are chosen herein as representative of various choices these languages names and examples are not intended to be limiting. One of ordinary skill in the art will appreciate that there are numerous ways of providing object code that achieves the same similar or equivalent systems and methods achieved by embodiments of the invention.

The various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the invention or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium wherein when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the invention.

While aspects of the present invention has been described in connection with the preferred embodiments of the various figures it is to be understood that other similar embodiments may be used or modifications and additions may be made to the described embodiment for performing the same function of the present invention without deviating therefrom. Furthermore it should be emphasized that a variety of computer platforms including handheld device operating systems and other application specific operating systems are contemplated especially as the number of wireless networked devices continues to proliferate. Therefore the claimed invention should not be limited to any single embodiment but rather should be construed in breadth and scope in accordance with the appended claims.

