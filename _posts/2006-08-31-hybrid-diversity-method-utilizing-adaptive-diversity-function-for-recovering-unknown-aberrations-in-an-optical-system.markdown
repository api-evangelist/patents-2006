---

title: Hybrid diversity method utilizing adaptive diversity function for recovering unknown aberrations in an optical system
abstract: A method of recovering unknown aberrations in an optical system includes collecting intensity data produced by the optical system, generating an initial estimate of a phase of the optical system, iteratively performing a phase retrieval on the intensity data to generate a phase estimate using an initial diversity function corresponding to the intensity data, generating a phase map from the phase retrieval phase estimate, decomposing the phase map to generate a decomposition vector, generating an updated diversity function by combining the initial diversity function with the decomposition vector, generating an updated estimate of the phase of the optical system by removing the initial diversity function from the phase map. The method may further include repeating the process beginning with iteratively performing a phase retrieval on the intensity data using the updated estimate of the phase of the optical system in place of the initial estimate of the phase of the optical system, and using the updated diversity function in place of the initial diversity function, until a predetermined convergence is achieved.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07635832&OS=07635832&RS=07635832
owner: The United States of America as represented by the Administrator of the National Aeronautics and Space Administration
number: 07635832
owner_city: Washington
owner_country: US
publication_date: 20060831
---
The benefit of priority is claimed under 35 U.S.C. 119 e of commonly assigned U.S. Provisional Patent Application No. 60 713 616 filed Aug. 31 2005 entitled Wavefront Sensing Devices and Methods which is incorporated by reference herein in its entirety.

The invention described herein was made by an employee of the United States Government and may be manufactured and used by or for the Government of the United States of America for governmental purposes without the payment of any royalties thereon or therefor.

The present invention relates generally to optical systems and in particular to the recovery of aberrations in optical systems.

Phase retrieval is an image based wavefront sensing method that utilizes point source images or other known objects to recover optical phase information.

Conventional image based phase retrieval techniques may be classified into two general categories iterative transform methods and parametric methods. Modifications to the original iterative transform approach have been based on the introduction of a defocus diversity function or on the input output method. Various implementations of the focus diverse iterative transform method have appeared that deviate slightly by utilizing a single wavelength or by varying the placement and number of defocused image planes. Modifications to the parametric approach include minimizing alternative merit functions as well as implementing a variety of nonlinear optimization methods such as Levenburg Marquardt simplex and quasi Newton techniques. The concept behind an optical diversity function is to modulate a point source image in a controlled way. The purpose of a diversity function in wavefront sensing is to spread out the optical response to expose aberration information. In principle any known aberration can serve as a diversity function but defocus is often the simplest to implement and exhibits no angular dependence as a function of the pupil coordinates. Since defocus has only angular dependence no one part of the point spread function is emphasized more than any other.

The iterative transform method can result in phase retrieval recoveries with higher spatial frequency content than is practical with parametric methods that solve directly for aberration coefficients of a given basis set such as for example a Zernike basis set. From a different viewpoint the method operation may be analyzed as consecutive projections onto convex sets. A disadvantage of the iterative transform approach is that recovery results are prone to spurious phase values and branch points as well as wrapped phase values for aberration contributions larger than one wave. As a result it is well known that the iterative transform method while especially suited for high spatial frequency phase recoveries has a limited dynamic range when compared with the parameter based approach in which multi wave recoveries are possible but are generally of lower spatial frequency. Multi wave phase recoveries are possible but generally require an additional phase unwrapping post processing step.

One particular approach is the Misell Gerchberg Saxton MGS method. The MGS approach is well suited for high spatial frequency phase map recoveries but is not well suited for multi wave recoveries due to the well known 2 phase wrapping problems inherent in the iterative transform approach. Nevertheless the MGS method approach can be utilized for multi wave phase recoveries but requires an additional phase unwrapping post processing step.

For the reasons stated above and for other reasons stated below which will become apparent to those skilled in the art upon reading and understanding the present specification there is a need in the art for alternative approaches for recovering aberrations in optical systems.

Particular embodiments of the method of the present invention are presented. It should be understood that the invention in its broadest sense could be practiced without having one or more features of these embodiments. It should also be understood that these embodiments are merely exemplary.

In one embodiment the invention provides a method of recovering unknown aberrations in an optical system comprising collecting intensity data produced by the optical system generating an initial estimate of a phase of the optical system iteratively performing a phase retrieval on the intensity data to generate a phase estimate using an initial diversity function corresponding to the intensity data generating a phase map from the phase retrieval phase estimate decomposing the phase map to generate a decomposition vector generating an updated diversity function by combining the initial diversity function with the decomposition vector generating an updated estimate of the phase of the optical system by removing the initial diversity function from the phase map. The method may further comprise repeating the process beginning with iteratively performing a phase retrieval on the intensity data using the updated estimate of the phase of the optical system in place of the initial estimate of the phase of the optical system and using the updated diversity function in place of the initial diversity function until a predetermined convergence is achieved.

In another embodiment the invention provides a method of recovering unknown aberrations in an optical system comprising introducing one or more known aberrations into the optical system for each known aberration collecting intensity data produced by the optical system generating an initial estimate of a phase of the optical system iteratively performing a phase retrieval on each set of the intensity data to generate a phase estimate using an initial diversity function corresponding to the sets of the intensity data combining each of the phase retrieval phase estimates to generate a phase map decomposing the phase map to generate a decomposition vector generating an updated diversity function by combining the initial diversity function with the decomposition vector generating an updated estimate of the phase of the optical system by removing the initial diversity function from the phase map. The method may further comprise repeating the process beginning with iteratively performing a phase retrieval on each set of the intensity data using the updated estimate of the phase of the optical system in place of the initial estimate of the phase of the optical system and using the updated diversity function in place of the initial diversity function until a predetermined convergence is achieved.

Aside from the structural and procedural arrangements set forth above the invention could include a number of other arrangements such as those explained hereinafter. It is to be understood that both the foregoing description and the following description are exemplary only.

In the following detailed description of embodiments of the invention reference is made to the accompanying drawings that form a part hereof and in which are shown by way of illustration specific embodiments that may be practiced. These embodiments are described in sufficient detail to enable those skilled in the art to practice disclosed subject matter and it is to be understood that other embodiments may be utilized and that process changes may be made without departing from the scope of the claimed subject matter. The following detailed description is therefore not to be taken in a limiting sense and the scope of the claimed subject matter is defined only by the appended claims and equivalents thereof.

Performance of optical systems such as those found in cameras telescopes microscopes and other systems for the collection of images can often be improved by actively correcting for aberrations in the optical system. Wavefront sensing is a technique to obtain phase information from a wavefront to recover such aberrations.

In one application the method of the present invention may be utilized on a space based telescope such as NASA s James Webb Space Telescope JWST for example. On JWST the primary mirror is a 6.5 meter segmented mirror having 18 segments in a hexagonal array. The method according to an embodiment of the invention may be used with an image based wavefront sensing and control system in such a telescope to align the mirror segments minimize the effects of figure error and position the secondary mirror of the three mirror anastigmat design. The wavefront sensing method specified for JWST is image based in the sense that point source stellar images are collected and processed to recover optical phase information. In addition to wavefront sensing and control applications with active and adaptive optical systems embodiments of the invention may be used for optical system verification and testing such as for example quantitative measurement of optical system performance. The optical systems in those applications may comprise at least one of a lens a mirror an imaging system a camera a detector and a laser. The optical systems may also comprise compound systems including combinations of those elements.

In one example the method of the present invention has been used in an image based wavefront sensing and control system in a meter class laboratory based testbed telescope. Several exemplary embodiments of the method will be described with reference to the testbed telescope.

The various embodiments described herein will be referred to as a Hybrid Diversity Method HDM . According to some embodiments the method produces an unwrapped phase result and may be based on a more direct computational procedure thus eliminating additional post processing steps of traditional phase retrieval processes. Further some embodiments may facilitate high speed multi processor implementations for reduced latency.

The HDM may utilize an iterative transform phase retrieval approach without focusing on a convergence of the iterative transform phase retrieval or utilizing a phase unwrapping post processing step. Instead embodiments of the HDM utilize a floating i.e. adaptive diversity function to incorporate feedback during phase recovery to guide the phase retrieval process. Further some embodiments of the method may resolve issues associated with conventional iterative transform phase retrieval including the convergence criterion and unbiased phase estimation as detailed below.

Iterative transform phase retrieval is pixel based i.e. it operates by iteratively enforcing known constraints between conjugate Fourier domains to recover point by point phase maps. This approach has been termed the error reduction method in the literature.

Various embodiments of the invention may use a variety of iterative transform phase retrieval processes and are not limited to the types discussed above with reference to conventional methods.

Embodiments of the invention may overcome limitations in the dynamic range of the conventional iterative transform approach because no phase wrapping occurs when a multi wave aberration is incorporated as a known diversity function. That is for focus diverse phase retrieval according to embodiments of the invention the diversity defocus term is often orders of magnitude larger than other unknown aberrations in the system. Therefore in those embodiments if the unknown aberrations can be converted to a known diversity function during the recovery process then point by point phase recoveries of multi wave aberrations may be realized without a phase unwrapping post processing step. In some embodiments this is achieved by transferring the resulting sensed aberration into a continually updated i.e. adaptive diversity function during the recovery process. In other words in those embodiments the method incorporates feedback. The final aberration estimate may comprise the diversity function itself after subtraction of any other known diversity components. As a result the method may produce a null i.e. a flat as the aberration content is continually fed into the diversity function during subsequent iterations of the method.

As discussed above this nulling behavior of some embodiments of the method in turn may provide a natural convergence criterion since the measure of convergence may now be based on the RMS wavefront error of the null similar to specifying the figure quality of an optical reference flat . Being adaptive in nature some embodiments of the method may reduce the estimation bias that stems from imperfect prior knowledge of the diversity function. That is diversity defocus is not perfectly known at the outset but a refined and corrected estimate may be obtained during each iteration of the method. In one embodiment the initial diversity function and or phase estimate can be presumed to be some predetermined value. In one example the predetermined value may be zero. Other non zero values may also be used. In some embodiments the initial phase estimate comprises the output of another method such as an estimation method for example.

The embodiment of the invention described above utilizes focus diversity in which a known defocus aberration is introduced into an optical system. Other embodiments may utilize other known aberrations including for example one or more of piston tip tilt defocus astigmatism coma spherical and trefoil.

As shown in the individual images are then processed to obtain phase information. For example the images may be processed using a nonlinear optimization procedure or a modified MGS iterative transform method. Some embodiments of the method are model based in the sense that method parameters such as defocus f wavelength and detector pixel size and data parameters such as image bias and flux are estimated directly from the image data as a pre processing step prior to phase retrieval. This process may be handled for example using a nonlinear least squares or an optimization method such as the Levenburg Marquardt method. In practice the values of these parameters may affect how the Fourier transforms are implemented in the iterative transform method.

As shown in the output of the iterative transform procedure at this stage is a phase estimate for each image of the defocus diversity data set. Any phase wrapping issues of the iterative transform procedure may be ignored. These individual phase estimates are then combined such as by using a weighted average denoted by the symbol to form the phase estimate as illustrated in and labeled as the inner loop. It is well known that the iterative transform method stagnates quickly after a relatively small number of iterations. Therefore the overall method efficiency is improved from a computational standpoint by restricting the inner loop iterations to a small number. In the implementation considered here this process is repeated for three iterations to take advantage of the rapid initial gain in convergence that is characteristic of the iterative transform method while avoiding stagnation. Other numbers of iterations may also be used. Because of the feedback of the updated diversity function into subsequent iterative transform phase retrieval calculations the need to force convergence of any one iterative transform procedure through repeated iterations may be obviated.

After exiting from the inner loop a phase map is produced that is partially consistent with each image used in the data set. This phase map is then decomposed into a basis set for representation of wavefront data. A basis set may be selected that is suitable for the aperture shape. The basis set may comprise orthogonal or non orthogonal functions. In one example the phase map may be decomposed into a Zernike basis set for a given sampling and aperture shape. In another example a fully orthogonal basis set may be used. The vector of decomposition coefficients may be written as Orthogonal Fit . Eq. 1 

This process is shown in where right arrow over a a a . . . a is the decomposition vector and nz z 1 z 2 is the number of terms. These numerical values are then transferred to the previous diversity function using the update . Eq. 2 

This process may incorporate higher order basis sets in the aberration off loading process. Alternatively the order four set nz 15 may be utilized to capture the controllable modes of an optical system.

In the example implementation global tip and tilt correspond to the coefficients aand a which are used to update the image registration of individual diversity images. An updated diversity data set may then be produced for re processing by the inner loop via return to the outer loop. In this embodiment image registration may be adaptive and may be based on the amount of tip and tilt returned in the outer loop iterations. Image registration errors which may be present due to the image centering pre processing step may be thus averaged out as the global tip and tilt are minimized by the method. Similarly in some embodiments imperfect knowledge of either the image f or diversity defocus value for individual images can lead to the recovery of an overall global defocus error. However diversity data may optionally not be updated in performance of the methods.

This possibility of recovering a global defocus error is due to an ambiguity between f and defocus z which are related in the paraxial region by z 8 fa Eq. 3 where ais the defocus term in quadratic curvature units. i.e. a where is the normalized radial pupil coordinate. In the Zernike basis set the defocus coefficient a is related to the quadratic curvature coefficient by a factor of two a a 2.

In the illustrated embodiment of the method previous diversity defocus values are adaptively updated according to the recovery of global defocus in the phase estimate . In turn as the amount of diversity defocus varies in each image aberration recovery varies with differing amounts of defocus and thus feedback is incorporated into the recovery process. As shown this process is continued until the global defocus error is driven to some predetermined convergence criteria and may be driven substantially to zero.

In some embodiments each aberration contribution may far exceed one wave after exiting the inner loop portion of the method and as is well known the classical iterative transform method cannot by itself recover multi wave aberrations. Accordingly the method may produce a wrapped phase map in the absence of some form of aberration off loading. However an aberration fitting procedure may still be applied in Eq. 1 to this wrapped phase data to return at least some portion of the multi wave aberration to the variable right arrow over a . These numerical values may then be transferred to the diversity function and become part of the known phase values. In this way a multi wave aberration may be recovered incrementally by successively applying the aberration fitting procedure to intermediate wrapped phase maps.

As shown in during recovery as more and more of the aberration is transferred to the diversity function following successive iterations of the outer loop the estimated phase no longer wraps since the multi wave unknown aberration values become incorporated as part of the diversity function. As a result begins to resemble a reference flat i.e. a null see as the aberration content is transferred to the diversity function. The process of aberration transfer is illustrated in with a calculated interferogram from both the adaptive diversity function right arrow over a and the reference flat as the method nears convergence for a wavefront dominated by astigmatism.

In some cases when representing obscurations or edges in the pupil constraint of the phase retrieval process the Fourier transform used in diffraction modeling may alias power into the complex amplitude of the image plane point spread function PSF . This artificial power may be problematic when using coarsely sampled edges and can contribute to an artificial and undesirable ringing that appears in the recovered phase maps. To reduce this phase artifact the various embodiments may use a filtering technique based on Gaussian smoothing to soften edges in a coarsely sampled aperture. Other techniques also exist such as for example edge weighting based on the area of pixel coverage along a segment edge and may be utilized with the various embodiments. are visualizations demonstrating filtering artificial phase artifacts from phase retrieval results for use with embodiments of the invention. shows an example of aliasing from a fast Fourier transform FFT of a hexagon mask without filtering. shows the analytic i.e. ideal response of the same hexagon mask. shows an example of aliasing from a FFT of a Gaussian smoothed hexagon mask.

In some cases the Gaussian filtered result may compare more favorably to the analytical result although some residual aliasing effects still appear. One may conclude from that a basic trade occurs between aliased power and the spatial frequency response of the FFT method. The implication for the iterative transform process is that the mid or higher spatial frequency components may be damped in the recovered phase maps. This smoothing or filtering may effectively reduce artificial phase artifacts due to aliasing.

As discussed above orthogonal or non orthogonal basis sets may be used with embodiments of the method of the invention. A basis set may be chosen that is best suited to the aperture under consideration. For example the Zernike basis functions are orthogonal over a circular aperture. An alternative basis set may be developed for more complex shapes such as for example the hexagonal apertures used herein for the example implementation with the testbed telescope mirror segments. Basis functions for hexagonal apertures called hexikes have been previously derived. The order 4 modes 15 terms are illustrated in .

The various embodiments are further adaptable to more complex geometries. For example the testbed telescope pupil consists of more complicated apertures than the simple hexagonal shapes of the mirrors see . Out of 18 testbed telescope segments only five are regular hexagons due to vignetting that results from alignment fiducials and secondary mirror safety support ears. The remaining segment apertures deviate significantly from hexagonal shapes. A set of orthogonal basis functions may be generated over a sampled irregular aperture starting from a set of seed basis functions based on well known Gram Schmidt orthogonalization. shows a comparison of how several of the orthogonal basis functions compare with the standard Zernike basis functions for segment selected arbitrarily . Such methods are applicable to other non circular apertures.

The residual i.e. null wavefront that is produced by HDM for segment in accordance with one embodiment as detailed above is also shown in . Given that this residual is essentially what is left after the first 15 Zernike basis functions are extracted i.e. off loaded to the diversity array stress points on the mirror are clearly visible illustrating the hexagonal symmetry of the hexapod mount in addition to a mid spatial frequency residual that is a product of the mirror figuring process. The dominant aberration term for segment is astigmatism. The overall peak valley wavefront error in double pass is 1.85 waves at a wavelength of 633 nm. The residual RMS wavefront error is 45 nm which translates to a method convergence stability of 30 RMS in single pass. This means that when using an order 4 aberration basis set 15 terms for the aberration transfer described above the aberration transfer has converged to the 30 level. Different optical systems may have different convergence results.

Using the phase retrieval results shown in a model of the intensity data is constructed and then compared to the actual data. This comparison is made in showing full PSFs and x y cross sections for both the data and model. The double pass phase retrieval results shown in and are typical of the other testbed telescope segments. A summary of these results is shown in indicating that the dominant aberration on the segments is astigmatism.

A visualization of wavefront residual results from the subtraction of the diversity defocus image of each segment of e.g. the first 15 Zernike basis functions from its corresponding phase retrieval result of . The results of may serve as a diagnostic illustrating mirror stress points induced by the radius of curvature actuation that is used to correct segment focus errors in the example implementation. Mirror segments requiring the greatest radius of curvature control exhibit a slight edge effect along the interior edges of these segments. Also visible is a mid spatial frequency residual that is a product of the mirror figuring process. As calculated above the single pass residual wavefront error for is approximately 20 nm RMS or 32 establishing the magnitude of the residuals due to actuation stress and the mirror figuring process.

Upon correction for aberrations recovered in a representation of the source producing the wavefront may be calculated. is a visualization of the calculated point spread function corresponding to the diversity focus images of showing good correlation to a laboratory point source as utilized in generating the example diversity focus images.

While the various embodiments have been described with reference to a narrowband or monochromatic wavefront the embodiments of the invention are also suitable for use with broadband data i.e. white light. Traditional iterative transform phase retrieval approaches have required such narrowband monochromatic images. However narrowband filters may reduce signal level and increase detector integration times. Because of the adaptive diversity function of the various embodiments recovery of phase information and aberrations may be possible without requiring narrowband filtering. In addition to permitting the use of broadband filters which produce less signal loss and facilitate faster integration times when compared to narrowband filters the various embodiments may even be used without filtering of the wavefront thus further reducing system complexity.

The various embodiments described herein include methods of recovering unknown aberrations in a variety of optical systems. Some embodiments use feedback through an adaptive diversity function and may avoid a phase unwrapping post processing step typical of conventional iterative transform phase retrieval methods. In some embodiments this may yield a more direct computational procedure and may eliminate one or more additional software processes.

It will be apparent to those skilled in the art that various modifications and variations can be made to the structure and methodology described herein. Thus it should be understood that the invention is not limited to the examples discussed in the specification. Rather the present invention is intended to cover modifications and variations.

