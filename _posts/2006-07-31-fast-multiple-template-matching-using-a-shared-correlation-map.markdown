---

title: Fast multiple template matching using a shared correlation map
abstract: A method is provided that increases throughput and decreases the memory requirements for matching multiple templates in image. The method includes determining a set of inter-template early elimination values that characterize the degree of matching between various templates and the image, at various locations in the image. A later-analyzed template may be rejected as a potential match at a location in the image based on comparing a value characterizing its degree of match at that location to an inter-template early elimination value corresponding to the degree of match of an earlier-analyzed template at that location. The compared values may be determined by different sets of operations, and may be normalized such that they are properly comparable. The inter-template early elimination conditions may be stored in a shared correlation map. The shared correlation map may be analyzed to determine the matching locations for multiple templates in the image.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07636478&OS=07636478&RS=07636478
owner: Mitutoyo Corporation
number: 07636478
owner_city: Kawasaki-shi
owner_country: JP
publication_date: 20060731
---
The invention relates generally to methods for operating a machine vision inspection system and more particularly to methods for matching multiple templates or patterns within an image.

Precision machine vision inspection systems or vision systems in short can be utilized to obtain precise dimensional measurements of inspected objects. Such systems may include a computer a camera and optical system and a precision stage that is movable in multiple directions so as to allow the camera to scan the features of a workpiece that is being inspected. One exemplary prior art system that is commercially available is the QUICK VISION series of PC based vision systems and QVPAK software available from Mitutoyo America Corporation MAC located in Aurora Ill. The features and operation of the QUICK VISION series of vision systems and the QVPAK software are described in the QVPAK 3D CNC Vision Measuring Machine User s Guide published January 2003 and the QVPAK 3D CNC Vision Measuring Machine Operation Guide published September 1996 each of which is hereby incorporated by reference in their entirety. This product as exemplified by the QV 302 Pro model uses a microscope type optical system to provide images of a workpiece at various magnifications and moves the stage to traverse the workpiece surface beyond the limits of any single video image.

High throughput operation is generally desired in such systems. Also increasingly it is expected that intelligent programs operations and or video tools will operate to inspect a wider range of workpieces with less customized programming. Also increasingly 100 inspection is required. The present invention is directed to systems and methods for enhancing these capabilities for general purpose precision machine vision inspection systems.

This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This summary is not intended to identify key features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

A novel method that increases the throughput for matching multiple templates in image and reduces the memory requirements that may otherwise be associated with matching multiple templates in an image is provided. The method may be used to further enhance the throughput that may be achieved with previously known methods that speed up the matching of single templates in an image.

It should be appreciated that although increased template matching speed may contribute simultaneously to all of the desired improvements outlined above e.g. higher throughput less need for program or video tool customization a greater capability to inspect 100 of the various features in an image etc. the problem of high speed template matching is already well studied and is in general a relatively mature field. Therefore even small additional improvements in template matching throughput may be highly valued.

The novel multiple template matching method presented here may increase the template matching throughput and reduce the template matching memory use of a general purpose precision machine vision inspection system by several percent or more in various applications depending on the number type and spatial distribution of features to be inspected in an image. Generally as the number of different templates to be matched in an image increases and as the number of features to be matched in an image increases the benefits of the methods disclosed herein will also increase.

In accordance with one aspect of the invention the method may comprise determining at least one early elimination condition the at least one early elimination condition comprising an inter template early elimination condition wherein the inter template early elimination condition is based at least partially on an inter template early elimination value that characterizes the degree of matching between one of the plurality of templates and the image at a location in the image. In accordance with a further aspect of the invention a first inter template early elimination value may be determined for at least a first location an the image the first inter template early elimination value characterizing the degree of matching between a first template of the plurality of templates and the image at the first location and at least a second template of the plurality of templates may be rejected as a potential match at the first location based on comparing the first inter template early elimination value to a second value characterizing the degree of matching between the second template of the plurality of templates and the image at the first location.

In accordance with another aspect of the invention the first inter template early elimination value may be determined according to a first set of operations and the second value may be determined according to a second set of operations that is different than the first set of operations. In accordance with a further aspect of the invention the first inter template early elimination value may consist of a correlation function value determined based on a complete set of correlation function value determining operations comprising pixel by pixel comparison operations between the first template and the image at a first level of resolution and the second value may consist of an incomplete correlation function value determined based on an incomplete set of correlation function value determining operations comprising pixel by pixel comparison operations between the second template and the image at the first level of resolution. In accordance with a further aspect of the invention the incomplete set of correlation function value determining operations may be ended when an incomplete correlation function value corresponding to the second template at the first position indicates a worse template match than the first inter template early elimination value.

In accordance with another aspect of the invention each respective inter template early elimination value may be normalized such that each of their values reflect the degree to which their respective templates match the image at their respective locations in the image relative to the other respective inter template early elimination values.

In accordance with another aspect of the invention a shared correlation map may be determined the shared correlation map comprising at least one respective inter template early elimination value stored in a manner such that it is associated with its corresponding respective location in the image and for each respective inter template early elimination value of the shared correlation map an indication of its corresponding respective template may be stored. In accordance with a another aspect of the invention each respective inter template early elimination value of the shared correlation map may be a normalized correlation function value determined based on a complete set of correlation function value determining operations comprising pixel by pixel comparison operations at a first level of resolution between its corresponding respective template and the image at the corresponding respective location. In accordance with a further aspect of the invention determining the shared correlation map may comprise replacing a respective normalized inter template early elimination value of the shared correlation map and its corresponding respective template that are associated with a particular location in the image when a subsequent normalized correlation function value determined based on the complete set of correlation function value determining operations comprising pixel by pixel comparison operations between a different respective template and the image at a first level of resolution at the particular location indicates that the different respective template provides a better match to the image at that particular location.

In accordance with another aspect of the invention the method may comprise determining a set of respective template matching positions and their corresponding respective matching templates based on analyzing the shared correlation map. In accordance with a further aspect of the invention analyzing the shared correlation map may comprise treating the shared correlation map as a pseudo image determining at least a first template matching region in the pseudo image and determining a first respective template matching position for a first respective matching template within the first template matching region. In accordance with a further aspect of the invention each respective inter template early elimination value of the shared correlation map may be a correlation function value determined based on a complete set of correlation function value determining operations comprising pixel by pixel comparison operations at a first level of resolution between its corresponding respective template and the image at the corresponding respective location the first respective template matching position may be a preliminary template matching position and the method may further comprise estimating a refined matching position for the first respective matching template based on a fine resolution correlation map wherein the fine resolution correlation map may be determined based on correlating the first respective matching template to the image at a higher level of resolution than the first level of resolution in a local area including the preliminary first respective template matching position.

The vision measuring machine includes a moveable workpiece stage and an optical imaging system which may include a zoom lens or interchangeable lenses to provide various magnifications. The machine vision inspection system is generally comparable to the QUICK VISION series of vision systems and the QVPAK software discussed above and similar state of the art commercially available precision machine vision inspection systems. The machine vision inspection system is also described in U.S. patent application Ser. No. 10 978 227 which is incorporated herein by reference.

A workpiece that is to be imaged is placed on the workpiece stage . One or more of the light sources and emits source light or respectively to illuminate the workpiece . The source light is reflected or transmitted by the workpiece as workpiece light which passes through the objective lens and the turret lens assembly to the camera system . The image of the workpiece captured by the camera system is output on a signal line to the control system portion .

The light sources and are all connected to the control system portion through signal lines or busses and respectively. In various embodiments the optical assembly portion may include additional or different lenses and other optical elements such as apertures beam splitters and the like such as may be needed for providing coaxial illumination or other desirable machine vision inspection system features. When it is included in the machine vision inspection system the turret lens assembly may include at least a first turret lens position and lens and a second turret lens position and lens . The control system portion controls rotation of the turret lens assembly about axis between at least the first and second turret lens positions through a signal line or bus .

The distance between the workpiece stage and the optical assembly portion can be adjusted to change the focus of the image of the workpiece . In various embodiments the optical assembly portion is movable in the vertical Z axis direction relative to the workpiece stage using a controllable motor that drives an actuator a connecting cable or the like. The term Z axis as used herein refers to the axis that is intended to be used for focusing the image. The controllable motor when used is connected to the input output interface via a signal line .

As shown in in various embodiments the control system portion includes a controller an input output interface a memory a workpiece program generator and executor and a power supply portion . The input output interface may include an imaging control interface a motion control interface a lighting control interface and a lens control interface . Each of these components as well as the additional components described below may be interconnected by one or more data control buses and or application programming interfaces or by direct connections between the various elements.

The memory includes an image file memory portion a workpiece program memory portion that may include one or more part programs or the like and a video tool portion . The video tool portion may include tool portions for example which determine the GUI image processing operations etc. for each of the corresponding video tools. The video tool portion may include a region of interest generator that supports automatic semi automatic and or manual operations that define various regions of interest that are operable in various video tools included in the video tool portion . In various embodiments of the present invention the video tool portion also includes a template definition tool which determines the GUI image processing operations etc. for defining a template and or parameters that may be included in multiple template matching operations to be used during learn mode operations of a machine vision inspection system.

The memory also includes a template memory portion a multiple template setup portion and a multiple template matching portion that may include an early elimination portion and a shared correlation map portion . The template memory portion may store the various templates and corresponding parameters that are defined using the template definition tool as described in greater detail below. The various templates may be stored as one or more general template libraries or in one or more workpiece specific sets or application specific sets or the like. The template memory portion may also store any other useful template matching parameters including parameters that may be specific to certain multiple template matching operations or that may be specific to using a particular template e.g. image and template pre filtering parameters or set of templates to inspect a particular workpiece during run mode operations and also during learn mode operations in a test run . It may also include routines for modifying template parameters based current image parameters e.g. brightness contrast magnification etc. or based on accumulated matching data or the like. The multiple template setup portion may include routines for defining a multiple template set for a specific type of image or application for automatically determining a set of rotated and or scaled versions of a template or the like. It may also include a routine for determining and or storing a preferred matching sequence for multiple templates. For example if a previously determined template parameter or operator knowledge indicates that several matches may be expected for a template in a workpiece image to be inspected then other factors being equal it may be advantageous to search a workpiece image using that template before searching the image using a template where only one match is expected. The reason is that when using an inter template early elimination criteria according to this invention if multiple matches for a template are found in an image an inter template early elimination criteria e.g. the correlation value for that template at the match location will be established at each of the match locations. Subsequent template searches may then be preempted or terminated at any of the multiple locations as soon as it is apparent that the correlation value for the second template cannot be better than the previously determined inter template early elimination criteria. Thus the later search may potentially be accelerated at multiple locations.

The multiple template matching portion may include an early elimination portion and a shared correlation map portion . In one embodiment routines and or operations included in the early elimination portion may include known types of successive elimination algorithm SEA operations. Briefly SEA operations efficiently compute certain values that bound possible correlation value outcomes. The bounding computations may depend on both the current template to be matched as well as image data corresponding to the various locations to be searched in the image. Prior to determining full correlation results for example by a sum of absolute differences SAD correlation method at each location in the shared correlation map the appropriate bounding value may be compared to any previously established required matching threshold or the like. Alternatives to a SAD correlation may include a sum of squared differences SSD method or a normalized cross correlation NCC image template similarity measures or the like. If the bounding value fails to satisfy the required matching threshold at that location which may be the best previous correlation value determined by previous template matching operations at that location as described further below it is certain that the full correlation result for the current template at that location will also fail. Therefore that location may be eliminated as a potential match location for the current template without the full computation of the correlation at that location. The shared correlation map portion may include routines and or operations that perform correlation operations e.g. by a sum of absolute differences correlation method or the like compare the resulting correlation values to previously established limits and or correlation values and store the best correlation value for a location in a shared correlation map for example as described in greater detail below with reference to . It should be appreciated that in various embodiments the portions and may be merged and or indistinguishable.

In general the memory portion stores data usable to operate the vision system components portion to capture or acquire an image of the workpiece such that the acquired image of the workpiece has desired image characteristics. The memory portion further stores data usable to operate the machine vision inspection system to perform various inspection and measurement operations on the acquired images either manually or automatically and to output the results through the input output interface .

The signal lines or busses and of the light and are all connected to the input output interface . The signal lines and from the camera system and the controllable motor respectively are connected to the input output interface . In addition to carrying image data the signal line may carry a signal from the controller that initiates image acquisition. One or more display devices and input devices can also be connected to the input output interface in order to view create and or modify part programs workpiece programs to view the images captured by the camera system and or to provide a user interface that allows direct control of the vision system components portion .

In various exemplary embodiments a user may use the machine vision inspection system to create workpiece image acquisition instructions for the workpiece by explicitly coding the instructions using a workpiece programming language e.g. a machine vision inspection system scripting language and or by generating the instructions by moving the machine vision inspection system through an image acquisition training sequence such that the workpiece program instructions capture the training sequence. Once a set of workpiece image acquisition instructions are defined the control system executes the instructions and commands the camera system to capture one or more images of the workpiece according to the instructions. The control system will then under control of the controller input the captured image s through the input output interface and store the captured image s in the memory . The controller may also display the captured images on the display device . The control system portion is further usable to recall stored workpiece inspection images to inspect and analyze workpiece features in such workpiece inspection images and to store and or output the inspection results. Some or all of these methods may be embodied in various video tools included in the video tool portion of the memory such as an autofocus tool edge boundary detection tools dimension measuring tools template matching tools and the like. Some of these tools are routinely used in a variety of commercially available machine vision inspection systems such as the QUICK VISION series of vision systems and the associated QVPAK software. After the image inspection analysis operation using one or more of these video tools is completed the control system outputs the results of each analysis inspection operation to the input output interface for outputting to various display devices such as a video display printer and the like. The control system may also store the results of each inspection operation in the memory . The procedures outlined above may be used to create a program or routine that implements a multiple template matching method according to this invention and or to automatically run that program or routine to inspect an image if desired.

In general an inter template early elimination condition comprises determining or identifying a correlation value or other template matching parameter or result that is associated with a first template and then applying that correlation value or other parameter to expedite template matching operations for a one or more additional templates. Briefly one exemplary inter template early elimination condition that may be applied in various embodiments comprises using a first correlation value determined for a first template at a particular template matching location in an image as a matching threshold which must be bettered by a second correlation value determined for a second template at that location in order for the second template to be considered a match at that location. For such a condition matching operations for a second template at that location may be preempted or terminated as soon as it is apparent that the correlation value for the second template cannot be better than the first correlation value. Thus evaluation of subsequent potential template matches at that location may be expedited in accordance with one aspect of this invention.

At a block a shared correlation map may be created while searching the image using the multiple templates. The image is searched according to the early elimination conditions including the at least one inter template early elimination condition. Briefly a shared correlation map may be a map or pseudo image that mirrors the potential matching locations pixels in the image to be searched. In various embodiments correlation values corresponding to potential matches are recorded at the potential matching location in the shared correlation map during each of the multiple template searches. The shared correlation map may both facilitate a multiple template matching process according to this invention as well as record its progress and outcome. Various other aspects of the creation and use of a shared correlation map are described further below.

At a block the shared correlation map may be analyzed to determine a set of candidate template matching positions and the corresponding matching templates. Finally at a block a final set of template matching positions and corresponding matching templates may be identified based on the set of candidate template matching positions and the corresponding matching templates determined at block and the method ends.

At a block a resolution level other than a full resolution level may be determined for following multiple template search operations. For example the teachings of U.S. Pat. No. 6 928 116 and or U.S. Patent Application Publication No. 2003 0198295 United States each of which is incorporated herein by reference in its entirety may be applied to prepare lower resolution versions of the templates to be matched and to prepare the image data in a corresponding manner. The advantage of lower resolution template matching is that in various embodiments according to this invention a multi level matching process similar to that described in the previously incorporated 116 and 295 references may be used. In this example a two level process is described. In such a case lower resolution preliminary matching operations are greatly accelerated in comparison to full resolution matching operations. In various embodiments a similarly sub sampled version of each of the multiple templates may be prepared according to known techniques and the image may be similarly sub sampled. In one embodiment a maximum size limit or limiting number of pixel operations during image template matching may be imposed on the sub sampled versions if desired. Larger templates may be sub sampled at a coarser level than smaller templates in order to comply with a maximum size limit or a maximum number of operations limit. In one embodiment a nominal initial resolution level may be two times coarser than the full resolution level that is pixels in alternate rows and columns may be skipped reducing the number of pixel processed by a factor of four .

At a block a first or next template is selected as the current template to be used for the operations of blocks through . At the block pre correlation elimination operations are performed for potential match locations in the shared correlation map. The pre correlation elimination operations may be adapted for each new current template that is selected at block . In general for the current template the operations of block may eliminate some of the potential match locations in the image to be searched. The shared correlation map may be used to implement the pre correlation elimination operations. In general as previously mentioned the shared correlation map mirrors the potential matching locations pixels in the image to be searched. As a current template is used to search the image correlation values corresponding to potential matches are recorded at the potential matching locations in the shared correlation map and used as thresholds that may preempt or terminate matching operations for subsequent templates at those locations. However locations in the shared correlation map may also simply be filled or initialized with default values or the like that may also be used as thresholds in the manner just described. Filling or initializing the shared correlation map is one of the operations that may be performed at block . In one embodiment if the shared correlation map has not previously been initialized and does not yet include correlation values determined by previous template matching operations then the entire shared correlation map is initialized with a default noise threshold value that is certain not to eliminate correlation values corresponding to potential matches. Ideally the default threshold value may also potentially eliminate at least some correlation values that are certainly too weak to correspond to potential matches. If a template specific matching threshold value is available for the current template e.g. as one of the template parameters defined for the current template and if it increases the range of correlation values that are certainly too weak to correspond to potential matches without the possibility of rejecting true matches by other types of templates then that template specific matching threshold value may replace the default threshold value in the shared correlation map.

In one embodiment once the shared correlation map is filled as outlined above operations continue at block . However in other embodiments additional pre correlation elimination operations are performed at block . In one embodiment known types of successive elimination algorithm SEA operations may be performed at block . As previously indicated SEA operations may efficiently compute certain values that bound possible correlation value outcomes. The bounding computations may depend on both the current template to be matched as well as image data corresponding to the various locations to be searched in the image. Prior to determining full correlation results e.g. by a sum of absolute differences correlation method at each location in the shared correlation map the appropriate bounding value may be compared to any previously established required matching threshold or the like. If the bounding value fails to satisfy the required matching threshold at that location which may be the best previous correlation value determined by previous template matching operations at that location it is certain that the full correlation result for the current template at that location will also fail. Therefore that location may be eliminated as a potential match location for the current template without the full computation of the correlation at that location.

At a block a first or next remaining potential match location is selected as the current location for the operations of blocks through . At block correlation value determination operations start or continue for the current potential match location by traversing the template according to the current sampling level e.g. pixel by pixel and determining a first or next increment of an accumulated correlation value according to known methods e.g. by an SAD correlation method or the like . It should be appreciated that in various embodiments the correlation values may be normalized by dividing them by the image template overlap size for the given current potential match location to obtain per pixel correlation averages. All termination thresholds stored in the shared correlation map may also be expressed as per pixel correlation averages. In this manner a correlation value a match value that is independent from the image template overlap size and or number of active pixels in the template can be achieved. That is the correlation values for templates of different sizes may be legitimately compared to determine the best match at a location. In general it is anticipated that templates of various sizes will be matched to an image. Therefore in a majority of embodiments and applications it may be assumed that the various correlation values described herein are normalized correlation values.

Next at a decision block if the accumulated correlation value determined at block guarantees that a complete correlation value e.g. a complete normalized correlation value will be worse than the matching threshold in the shared correlation map for the current location then operation returns to block where a new potential match location is selected for subsequent operations. Otherwise operation continues at the decision block .

When operation continues at the decision block if the entire correlation value calculation has not been completed for the current location then operation returns to block where the correlation value calculation is continued. Otherwise operation continues at block where the previous operations have insured that the current complete correlation value e.g. a complete normalized correlation value is the best correlation value so far determined for the current location. Therefore the current correlation value is entered into the shared correlation map at the current location where it functions as an inter template early elimination value and provides a new matching threshold for subsequent template matching operations at that location. In addition since it provides the best correlation value so far determined at that location the current template is recorded or stored in manner that indicates it to be the tentative best matching template at the current location. Operation then continues at a decision block where it is determined whether the current match location is the last potential match location. If there are additional potential match locations to be evaluated then operation returns to block . Otherwise operation continues to decision block where it is determined whether matching operations have been completed for the entire set of multiple templates. If there are more templates to be for matching in the current image then operation returns to block . Otherwise operation continues to block where the ending shared correlation map is saved along with the ending set of template identities and corresponding locations as determined according to the previous operations of block and the method ends.

It will be appreciated that a pixel corresponding to an inter template EEV e.g. a best correlation value for a pixel location will generally correspond to a significant template correlation value that is better than the global EEV or a default threshold value. In various embodiments this may be a value determined in the correlation map according to operations of block of for example. As shown in in the vicinity of a matching location at least some of the inter template EEVs may generally form inter template EEV regions such as the regions and . Depending on the global EEV or default threshold value and or preliminary thresholding operations that may be performed an inter template EEV region may be significantly smaller than the illustrated relative sizes of the regions which are illustrative only and not limiting. In general for pixel locations in the shared correlation map that include a significant correlation value there will be an associated template identity as previously described. In general depending on the global EEV or default threshold value and or preliminary thresholding operations more than one template identity may be included in an inter template EEV region such as one of the regions . Various methods for determining whether a template identity corresponds to an actual match or noise are outlined below.

At a block for the first or next candidate template matching region determined at block the operations at blocks to are to be performed. At a block the best matching template is identified for the current candidate template matching region e.g. the template having the best normalized correlation value within the candidate template matching region or the greatest number of corresponding pixels within the candidate template matching region or the strongest correlation gradient within the candidate template matching region or the like and a best coarse matching position is determined for that best coarse matching template e.g. a centroid or correlation peak position within the candidate template matching region etc. . It will be appreciated that if multiple template identities are included within or associated with a particular candidate template matching region that the operations of block may eliminate those that are best characterized as noise and define the best matching template within a particular candidate template matching region. The routine then continues to a point A as will be described in more detail below with respect to .

As shown in from the point A the routine continues to a block . At block a full resolution local correlation map in the local area including the best coarse matching position is determined using the current best matching template. At a block a refined matching position is estimated and a matching strength e.g. normalized correlation value is determined in a full resolution local correlation map for the current matching template and all of the results are stored. At a decision block if it is determined that the current candidate template matching region is not the last candidate template matching region then the routine continues to a point B which returns to block of . If at decision block it is determined that the current region is the last candidate template matching region then the routine continues to a block .

At block for each type of the best matched template one or more best matching positions are identified corresponding to a sufficient or largest matching strength as probable template matching positions. Probable template matching positions may be screened to eliminate false matches based on other criteria if applicable e.g. known position limits expected number of matches position relationships orientation etc. . At a block for each type of matched template a final set of template matching positions is determined and the process ends.

The Multiple Template Search Setup window may appear when a multiple template matching operation is requested during manual operation or learning mode operation or when editing a part program for example. The window may include a multiple template setup file management portion that includes a data entry box for entering and displaying a multiple template search setup file name a button that may be clicked to load that file to be associated with the operations of the window a button that may be clicked to save the setup information currently associated with the operations of the window to that file and a button to clear the setup information currently associated with the operations of the window .

The window may also include a Global Parameters portion for defining certain preferences for the multiple template search operations. In the embodiment shown in the user may select certain preferences using mutually exclusive radio buttons. The user may select the Fast radio button to enhance the speed of the search. In that case the template matching operations may comprise methods that provide the matching location for a particular template based on coarse matching locations e.g. within a few pixels or the like without performing full resolution correlation operations to refine a matching location. For example for a particular template or type of template operations such as those outlined for block of may provide the final matching location and for that particular template the location refinement operations at blocks and may be omitted. Such a coarse matching location may provide sufficient accuracy if the objective is to position a workpiece in a field of view with sufficient accuracy for performing subsequent edge finding operations in a subsequent image of the workpiece for example. If the user instead selects the Accurate radio full resolution 2D template matching may be provided for example according to known practices in commercially available systems. This may be advantageous for many templates in many applications since full correlation in a local area e.g. the location refinement operations at blocks and in is generally not computationally expensive and may be more reliable and more accurate. The Normal radio button may be selected to provide a balance between execution speed and position accuracy. In the embodiment shown in the user may also define a desired matching threshold e.g. to define the threshold for a sufficient matching strength in the operations of block in by dragging the slider until the desired matching threshold value appears in the dynamically updated box . In various embodiments a matching threshold of 100 may correspond to the perfect match of a template with itself.

The window may also include a browser portion for reviewing the multiple templates associated with the current setup. The browser portion may include forward and back buttons for stepping through the various templates in a current set a dynamically updated template box that displays the identifier or position of a the currently browsed member of the set in a searching sequence a thumbnail display box of the currently browsed member of the set and a dynamically updated total in set box that displays the total number of templates in the current multiple template search setup. In some embodiments the user may enter a new number in the template box in order to position the currently browsed member of the set at a new position in the search sequence. In some embodiments the user may click on the thumbnail display box in order to activate the currently browsed member of the set in the Current Template Setup window and display its parameters therein making it the current template .

The image display window shows four types of features that may be located by a multiple template search if desired. Four instances a polygon feature one rotated instance of the polygon feature a circular feature and a rectangular feature . One of the features is surrounded by a template definition box which may be created at any time in any portion of the image by using the cursor in a known rubberband mode when the window is active. The contents of the template definition box define a potential template that may be extracted from the image when the user clicks an Extract from Image button included in the window . When the user clicks the Extract from Image button the sub image in the template definition box is activated in the Current Template Setup window e.g. it is displayed in a thumbnail display box and its parameters and name are initially set to default values which may subsequently be edited by the user. It becomes the current template. 

At any time that a current template is active in the Current Template Setup window when the user clicks the Add Current Template button in the window that template including the template information and parameters currently associated the operations of the window is recorded as a member of the current multiple template search setup. In various embodiments it is displayed in the thumbnail display box and the boxes and are updated.

At any time a current multiple template search setup may be tested or run by clicking the SEARCH IMAGE button . The resulting matches may be indicated on the display and or their identities and positions output according to known techniques. The user may then evaluate the efficacy of the current set or templates and their various parameters and update the set and or parameters and retest etc. until the search results are acceptable. The user may then save the tested multiple template search setup in a file and for execution in a part program if desired.

The Current Template Setup window may in various embodiments supplement or replace other template definition tools included in a machine vision inspection system. The window may include a template file management portion that includes a data entry box for entering and displaying a template file name a button that may be clicked to load that file from a library such that the information is then associated with the operations of the window a button that may be clicked to save the template information currently associated with the operations of the window to that file name and a button to clear the information currently associated with the operations of the window e.g. by clearing the current template or resetting the current information of the window to default values . An image of the current template may be displayed in a thumbnail display box .

The window may also include a Current Template Variations portion for providing rotated and scaled versions of the current template to be used in the multiple template search. In the embodiment shown in either or both of these types of variations may be enabled by radio buttons which may be toggled on off by a user. The user may enter minimum and maximum values for an angular variation range e.g. an angular search range in degrees and the number of equally spaced steps for which rotated versions of the template are to be generated for searching an image. Similarly the user may enter minimum and maximum values for a scaling variation range e.g. in terms of a contraction expansion coefficient that multiplies an original template size and the number of steps to be provided. Generally scaling may be applied to each angular variation of the template as well as the original template. It will be appreciated that each of the template variations is in effect an additional member template of the multiple template search setup and may be generated and stored as such in various embodiments.

The window may also include a Pre Processing portion for defining pre processing operations that are to be applied to a template and image before searching the image using the template. Typical generic options may include a Smoothing Filter morphological Opening Closing sequences e.g. to remove noise and smooth boundaries and Brightness normalization each of which may be added to the preprocessing operations by activating an associated radio button for example. It will be appreciated that the various multiple template searching techniques described herein included the shared correlation map techniques may be applied to any type of similarly configured pseudo template and pseudo image. That is conventional images are not required. Therefore the Pre Processing portion may include an option to prepare a template and image to be matched as transformed gradient pseudo images or the like.

The window may also include a Global Parameter Override portion wherein the user may turn on a radio button to override the previously described search style for the current template to determine the matching position s for the current template with the maximum accuracy for example. A global parameter than is overridden for the current template may still apply to the other templates in the set. At any time the current template parameters may be tested or run by clicking a SEARCH IMAGE button in the window . The resulting matches for the current template only may be indicated on the display and or their identities and positions output according to known techniques. The user may then evaluate the efficacy of the current template parameters and update the parameters and retest etc. until the search results are acceptable. The user may then save the tested template parameters to a template library file and or add the tested current template to the current multiple template setup by clicking the Add Current Template button in window which may operate to automatically save the template to the template library in various embodiments .

Although the various systems and methods outlined above have been described as providing and operating on various images pseudo images and maps for purposes of explanation it will be appreciated that such images pseudo images or maps essentially comprise data that may be organized stored and or represented mathematically in a variety of alternative configurations. Thus it should be appreciated that the expression shared correlation map essentially refers to any of a variety of data configurations usable according to the basic teachings disclosed herein whether or not such configurations are readily recognized as conventional images pseudo images or maps. 

While preferred and exemplary embodiments of the invention have been illustrated and described it will be appreciated that various changes can be made therein according to the principles of this invention without departing from the spirit and scope of the invention.

