---

title: Determining engine cylinder contribution from indexed engine data
abstract: An engine diagnostic system is provided that enables a service technician to evaluate engine cylinder contribution to output power. The service technician couples one or more signal leads to the vehicle's battery, alternator, or accessory receptacle (e.g., cigarette lighter receptacle) to provide an alternator output signal to a signal analyzer. The signal analyzer processes the alternator output signal to generate an engine signature, which represents engine cylinder contribution to engine output power.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07286927&OS=07286927&RS=07286927
owner: Snap-On Incorporated
number: 07286927
owner_city: Pleasant Prairie
owner_country: US
publication_date: 20061012
---
This application is a divisional application of Ser. No.10 840 434 filed May 7 2004 now U.S. Pat. No. 7 171 303 and is related to the U.S. patent application Ser. No. 11 512 349 filed on Aug. 30 2006 as a Continuation of U.S. patent application Ser. No. 10 840 509 filed May 7 2004 entitled Determining Engine Cylinder Contribution from Indexed Engine Data.

The present disclosure relates generally to engine diagnostics and more particularly to evaluating engine cylinder contribution to output power by analyzing the diode ripple signal from an alternator driven by the engine.

One type of engine performance problem found in internal combustion engines is poor cylinder contribution. In a properly functioning engine each cylinder contributes equally to the total output power for balanced operation. One problem with conventional diagnostic instruments that measure cylinder contribution is that they often require complicated or time consuming connections to the engine. Further conventional diagnostic instruments may display results that are difficult to interpret or provide only general information. That is a technician may invest time setting up a diagnostic instrument yet not receive specific enough information about a problem or performance issue to perform a repair efficiently.

Another conventional technique for measuring engine cylinder contribution derives information about cylinder contributions from the alternator output signal. This technique typically involves a simple electrical connection at the alternator battery or electrical accessory receptacle e.g. a cigarette lighter receptacle . In a typical engine system a crank pulley on the engine drives an associated alternator pulley using a belt. The alternator pulley is coupled to the alternator rotor which rotates to generate electrical energy. A typical alternator internally generates a multiphase e.g. 3 phase alternating current AC signal. This multiphase signal is rectified by a number of diodes such that the alternator outputs a mostly direct current DC signal. The alternator output signal also includes however a small AC component known as the ripple voltage or diode ripple signal.

Engine speed varies slightly as each cylinder fires. More specifically the engine accelerates immediately after a cylinder firing and then decelerates until another cylinder firing occurs. Cylinder contribution can be assessed therefore by analyzing the instantaneous variations in engine speed. The diode ripple signal is proportional to the instantaneous speed of the engine because the alternator is coupled to the engine s crankshaft. That is variations in the engine speed modulate the diode ripple signal in a mathematically meaningful manner.

In some prior approaches the diode ripple signal is demodulated using a frequency modulation FM receiver or analog phase locked loop. One problem with these approaches however is the accuracy or precision of the resulting demodulated signal. The diode ripple signal is typically corrupted by electrical noise or other signals that emanate from various sources. For example the alternator itself may produce undesirable transients and amplitude modulations in the diode ripple signal. These noise signals can make it difficult to demodulate the diode ripple signal accurately or precisely. Given that an engine performance problem is likely attributable to the malfunction of a single engine cylinder a technician does not want to receive inaccurate information and therefore consume diagnostic or repair time on a properly functioning cylinder.

What is needed is a system and method for demodulating the diode ripple signal that is robust in the presence of amplitude variations and impulse impairments. What is further needed is a system and method that filters the alternator output signal to reduce interference.

In one aspect a signal processing system generates an engine signature from indexed engine data. The engine signature represents the contribution to output power provided by the firing of each cylinder. The engine signature may be displayed in various ways. For example the engine signature may be displayed as a waveform as numerical data or as a comparative percentage of contribution for each cylinder. The signal processing system includes a buffering unit an engine data repair unit a synchronization unit a signature filter and an integrator. The buffering unit receives the indexed engine data from the front end or from a storage device. The engine data repair unit reconstructs discontinuity errors in the engine data and provides the engine data to the synchronization unit which filters and resamples the engine data. The signature filter and the integrator further filter the engine cycle data for display.

In another aspect a method for generating an engine signature from indexed engine data includes receiving the indexed engine data generating reconstructed engine data producing an engine cycles signal and filtering the engine cycles signal to produce the engine signature. The method further includes receiving a data tag in a tag collection unit and providing an external trigger tag to a synchronization unit and an error tag to an engine data repair unit.

In a further aspect a method for processing indexed engine data includes calculating a number of indexed engine samples per engine cycle and constructing an engine cycles signal using the number of indexed engine sample per engine cycle. An internally generated phase control bias signal or an external trigger signal be used to control the starting position of the engine cycles signal.

In another aspect a method for repairing engine data includes receiving indexed engine data and at least one error tag and creating an interpolation of the indexed engine data based on the at least one error tag. The interpolation uses the at least one error tag to connect a last good data point with a next good data point.

Additional aspects and advantages of the present disclosure will become readily apparent to those skilled in this art from the following detailed description wherein only exemplary embodiments are shown and described simply by way of illustration of the best mode contemplated for carrying out the present disclosure. As will be realized the present disclosure is capable of other and different embodiments and its several details are capable of modifications in various obvious respects all without departing from the disclosure. Accordingly the drawings and description are to be regarded as illustrative in nature and not as restrictive.

The present disclosure is now described more fully with reference to the accompanying figures in which several embodiments are shown. The embodiments described herein may include or be utilized with any appropriate engine having an appropriate voltage source such as a battery an alternator and the like providing any appropriate voltage such as about 6 Volts 12 Volts 24 Volts 42 Volts and the like. As one skilled in the art will appreciate from the following detailed description the embodiments described herein may operate independent of a particular direct current DC voltage. The embodiments described herein may be used with any desired system or engine. Those systems or engines may comprise items utilizing fossil fuels such as gasoline diesel natural gas propane and the like electricity such as that generated by battery magneto solar cell and the like wind and hybrids or combinations thereof. Those systems or engines may be incorporated into other systems such as an automobile a truck a boat or ship a motorcycle a generator an airplane and the like.

One skilled in the art will recognize that methods apparatus systems data structures and computer readable media implement the features functionalities or modes of usage described herein. For instance an apparatus embodiment can perform the corresponding steps or acts of a method embodiment.

One skilled in the art will further recognize that arrangement of the features or functions of the present disclosure into particular functional blocks of the block diagrams illustrated in represent one example of how the features or functions of the present disclosure can be implemented. For instance represents another embodiment or implementation of the front end illustrated in . Particular ones of the functional blocks may include more less or different functionality as desired.

In an embodiment of the present disclosure an engine diagnostic system is provided that enables a service technician to evaluate engine cylinder contribution to output power quickly accurately and precisely. In a typical application of the present disclosure the service technician couples one or more signal leads to the vehicle s battery alternator or accessory receptacle e.g. cigarette lighter receptacle . These signal leads provide an electrical signal including a diode ripple signal which the disclosed systems and methods analyze in order to display engine cylinder contribution information for the service technician s review. As one skilled in the art will appreciate an advantage of the present disclosure is that accurate and precise information about engine performance can be obtained using an uncomplicated electrical connection to the engine under test.

The alternator output signal is provided to the filter amplifier circuit . The filter amplifier circuit applies a bandpass filter to the alternator output signal to reduce unwanted interference while preserving the diode ripple signal. The filter amplifier circuit also amplifies the passband with an AC gain of about 10. In an exemplary application the diode ripple signal has a nominal frequency of about 1 kHz.

The filter amplifier circuit generates a filtered ripple signal that is provided as an input to the signal analyzer . The signal analyzer decodes the filtered ripple signal to generate an engine signature for an engine cycle i.e. a single firing of each cylinder in the firing order . The engine signature represents the contribution to output power provided by the firing of each cylinder. The engine signature may be displayed in various ways. For example the engine signature may be displayed as a waveform see e.g. as numerical data or as a comparative percentage of contribution for each cylinder.

The signal analyzer is a diagnostic instrument with suitable signal inputs or interfaces such as a MODIS device with the lab scope accessory which is commercially available from Snap on Diagnostics Inc. of San Jose Calif. . The signal analyzer includes input signal conditioning external trigger conditioning an analog to digital converter ADC and a digital signal processor DSP . The input signal conditioning receives the filtered ripple signal and adjusts the peak to peak amplitude of the filtered ripple signal for processing by the ADC and the DSP . The ADC samples the output of the input signal conditioning and provides a digital bitstream output to the DSP . The DSP controls the amplitude of the digital bitstream via a control signal which is coupled to the input signal conditioning . An external or inductive pickup can also be used as an external signal for synchronization. This signal is processed by the external signal conditioning block and sent to the DSP .

In the illustrated embodiment the ADC is a conventional ADC that samples the input signal at 1.5 MHz with a 12 bit resolution. The DSP can be a conventional DSP such as DSP 5409A which is commercially available from Texas Instruments Inc. of Dallas Tex. . The DSP may also include internal and or external storage memory not illustrated . The DSP 5409A includes 32 Kbytes of internal storage. and 512 Kbytes of external storage. Example uses for these storage memories include storing the processed data and recording data signals for offline analysis.

The DSP provides an output signal that includes the engine signature. The signal analyzer includes two operating modes real time analysis and off line analysis. More specifically the signal analyzer may perform the acquisition and processing of the filtered ripple signal and generate an output signal e.g. an engine signature in real time. The signal analyzer may also be configured to acquire and to process the filtered ripple signal into indexed engine data that can be conveniently stored for offline analysis. The functionality of the signal analyzer is described in further detail below and with reference to .

The computing device can be used for example to display the diagnostic data or results. The computing device includes a communications interface a processor memory modules and a connection network . The connection network operatively couples each of the communications interface the processor and the memory modules . The memory modules include a data memory a presentation unit and business logic unit . The connection network can be an electrical bus switch fabric optical interconnect or other suitable interconnection system.

The computing device interfaces with the signal analyzer via an application programming interface API . The API allows the computing device or other host to collect data from the signal analyzer and to provide data such as control information to the signal analyzer . The API operates in conjunction with the presentation unit to retrieve the output data from the DSP and to display the data or results. The API also provides a programming interface for the computing device to interact with the signal analyzer . Accordingly the API module sends information e.g. user input and configuration parameters to the signal analyzer and receives messages from the signal analyzer . More specifically messages from the signal analyzer can include data related to the engine signature and engine parameters generated by the DSP as well as operating instructions or other textual information. As one skilled in the art will appreciate the API software functions can be implemented in various programming languages or scripts to interface with the signal analyzer . That is the API can provide a high level interface for programmatically interacting with the signal analyzer and the functionality provided therein. Table 1 includes a description of exemplary API functions that may be used to interface with the signal analyzer .

The processor is a conventional microprocessor. In one embodiment the computing device is portable and powered by a battery. In this instance the processor may be designed for low power operation in order to provide satisfactory runtime before requiring recharging or replacement of the battery. In a typical service facility satisfactory runtime is approximately 8 hours or the duration of a technician s shift.

The processor executes instructions or program code modules from the memory modules . The operation of the computing device is programmable and configured by the program code modules. Such instructions may be read into the memory modules from another computer readable medium. Execution of the sequences of instructions contained in the memory modules causes the processor to perform the method or functions described herein. In alternative embodiments hardwired circuitry may be used in place of or in combination with software instructions to implement aspects of the disclosure. Thus embodiments of the disclosure are not limited to any specific combination of hardware circuitry and software. The memory modules can be represented for example by one or more random access memory RAM devices flash RAM or electronically erasable programmable read only memory EEPROM devices.

The data memory provides data storage capability for program code that the executed by the processor . The business logic unit includes program code for implementing the functionality of the application. More specifically the business logic unit interacts with the API to gather data from the signal analyzer and to provide control information to the signal analyzer. The business logic unit also coordinates with the presentation unit to generate screen displays or receive user input.

The presentation unit includes display elements that can be presented on a display screen not illustrated . The presentation unit can generate user interface displays including waveform data test results and the like. An example engine signature that may be displayed by the presentation unit is described below and with reference to .

The term computer readable medium as used herein refers to any medium that participates in providing instructions to the processor for execution. Such a medium may take many forms including but not limited to non volatile media volatile media and transmission media. Non volatile media includes for example optical or magnetic disks. Volatile media includes dynamic memory such as the memory . Transmission media includes coaxial cables copper wire and fiber optics including the wires or communication paths that comprise the connection network . Transmission media can also take the form of acoustic or light waves such as those generated during radio wave and infrared data communications.

Common forms of computer readable media include for example a floppy disk a flexible disk hard disk magnetic tape or any other magnetic medium a CD ROM any other optical medium punch cards paper tape any other physical medium with patterns of holes a RAM a programmable ROM PROM an electrically PROM EPROM a flash EPROM any other memory chip or cartridge a carrier wave or any other medium from which a data processing system can read.

Various forms of computer readable media may be involved in carrying one or more sequences of one or more instructions to the processor for execution. For example the instructions may initially be carried on a magnetic disk of a remote data processing system such as a server. The remote data processing system can load the instructions into its dynamic memory and send the instructions over a communications link. The communications interface can receive the data from the communications link and place the data on the connection network . The connection network can then carry the data to the processor for execution.

The communications interface provides bidirectional data communication coupling for the computing device . In one embodiment the communications interface provides one or more input output ports for receiving electrical radio frequency or optical signals and converts signals received on the port s to a format suitable for transmission on the connection network . For example the communications interface may include one or more analog to digital A D converters or other logic for sampling input signals such as the alternator output signal .

Referring now to there is shown a system overview block diagram according to another embodiment of the present disclosure. The computing device implements data processing that is functionally similar to the signal analyzer . The computing device receives the alternator output signal and the inductive pickup signal via the communications interface . As described above the communications interface can provide the ADC capabilities and carry the digital data to the processor via the connection network .

As one skilled in the art will appreciate the filtering functions provided by the filter amplifier circuit may also be performing in the digital signal domain. The use of the filter amplifier circuit depends on the sampling capabilities of the ADC circuits and or signal processing capabilities of the host system. Thus for clarity of the generalized or high level system overview illustrated in the functionality of the filter amplifier circuit is integrated into the signal processing performed in the computing device .

The computing device receives and processes the alternator output signal in a similar manner to the DSP related processing described herein and with more specific reference to . The processor can execute program code to generate an engine signature or other engine cylinder contribution data.

In operation the alternator output signal is provided as an input to the high pass filter . The transformer amplifies the resulting signal. In the illustrated embodiment the transformer is an audio band transformer with a gain of about 10. An audio band transformer is suitable for this embodiment because of its low cost and passband frequency range. Of course other types of signal amplifiers and filter circuits such as operational amplifier based active circuits may be used. As one skilled in the art will appreciate an active filter amplifier circuit may have improved linearity characteristics.

An amplified diode signal is desirable in order to provide a sufficient dynamic range in the AC small signal levels for proper processing. The range of the AC small signal varies from about 10 mV peak to peak to about 6 V peak to peak. The low pass filter is employed to complete the bandpass filter. The bandpass frequency characteristic accepts the diode ripple signal that is expected from various common alternator systems. Typically the first cutoff frequency is from about 155 Hz to 215 Hz and the second cutoff frequency is from about 27.5 KHz to 37.5 KHz. Of course the filter amplifier circuit may be modified or adjusted to work with rare or uncommon alternator systems.

The DC coupler provides a DC signal path from the input to the output of the filter amplifier circuit although a DC signal path is not necessary for proper operation. In the illustrated embodiment the DC coupler is also configured to attenuate the alternator DC output signal to about 90 percent. The adder then adds the attenuated alternator DC output signal to the amplified diode ripple signal to generate the filtered ripple signal .

The filter amplifier circuit is advantageously configured to apply an AC load on the input signal e.g. battery in the passband. However as one skilled in the art will appreciate the alternator may need additional DC loading in order to generate a sufficient alternator output signal. Typically a sufficient alternator output signal is one that includes nominal current for charging the battery or operating the electrical system of the vehicle. More specifically without some DC loading the alternator may not be providing an output current that includes a diode ripple signal for which the signal analyzer can process. A simple way of obtaining a sufficient DC loading can be activating the vehicle s headlights during the time period for which the signal analyzer or the computing device is acquiring data. Of course other types of electrical loads can be directly or indirectly applied to the system e.g. a carbon pile coupled to the battery . The filter amplifier circuit may also be modified to include a conventional DC loading component.

The back end block uses a FIR filter for processing the data for the display. These FIR filter taps are generated by FIR filter design using low frequency and high frequency responses relative to the engine signature filter specification. Further details of the operation or functionality of the front and back ends are provided below and with reference to .

Referring now to there is shown a block diagram of the slew rate limiter . In the illustrated embodiment a filtered ripple signal is shown that corresponds to first and second engine speeds. As illustrated in the first ripple signal has a frequency of about 800 Hz. The second ripple signal has a frequency of about 830 Hz indicating a change in frequency.

Large impulses in the diode ripple data can cause ringing in the complex band pass filter . The slew rate limiter is used to reduce these impulses while also controlling the rate of change of these large signals. A differencing block receives the diode ripple sampled at 100 KHz . The differencing block calculates the difference in amplitude from samples x n 1 to x n . The output of the differencing block is provided to decision tree . Block determines whether this absolute value amplitude change is above a predetermined threshold or sigma. This threshold or sigma is computed by slew rate limits block and it is based on the center frequency of diode tone that was determined by the spectrum analysis routine . If the amplitude exceeds the sigma limit then an impulse condition is set. A set impulse condition activates which outputs the previous signal plus a delta which was also determined by slew rates limit block . If the difference signal is below the sigma value then the output is equal to the input . The output signal in both conditions is the slew rate limited diode ripple sampled at 100 KHz.

Returning to a 128 tap FIR band pass filter and amplitude scaler processes the slew rate limited data . This filter removes harmonics produced by the slew rate limiter and low frequency that were not removed by filter amplifier circuit . This band pass slew rate limited signal data is sent to the overlapped running fast Fourier transform FFT .

The band pass slew rate limited signal data contains the angle modulated diode tone. An overlapped running FFT can be used to transform the discrete samples of the band pass slew rate limited signal data from the time domain to the frequency domain. The frequency of the diode tone can be detected using a spectrum analysis .

Returning to a complex impulse response bandpass filter may be synthesized using the frequency information determined by the spectrum analysis routine . The band pass slew rate limited signal data is then passed through the over lapped 1024 running FFT transforming the bandpass slew rate limited signal data into the frequency domain. This signal is then processed by the complex impulse response bandpass filter in order to extract the complex diode ripple tone. The complex impulse response bandpass filter may also down sample the data by a factor of 4 in the frequency domain. At this point in the processing the data rate is 25 KHz.

An overlapped 256 running IFFT transforms the diode tone back into the time domain. The complex time domain samples are complex signals that have real and imaginary components. The phase of these complex time domain samples are a function of time and by differentiating this phase the diode fundamental frequency and the angle modulating signal can be detected. As described above the angle modulating signal correlates to the variations in the engine speed that occur due to the cylinder firings.

The phase of the diode tone can be determined by using the arctangent function applied to the real and complex components. Phase differentiation is then accomplished by taking the point to point difference which results in detection of the diode tone frequency as well as the variations in this tone or the modulating signal. The signal produced is identified as the decoded engine data .

More specifically the diode ripple data contains an angle modulated tone that is proportional to the engine revolutions per minute RPM and the cylinder firing sequence. An angle demodulator such as the arctangent function and the phase differentiator can be used to detect this tone and its variations. Although the illustrated embodiment describes angle demodulation by phase differentiation other forms of demodulation may be used. For example an alternative front end is described below that illustrates another demodulation technique. The angle modulation can be expressed as shown in Equation 1 where is t a time varying signal. t is described in Equation 2 where fis the diode tone center frequency and t is the varying phase of the diode tone. cos 1 2 2 

By differentiating the phase of x t t the diode tone frequency and its variations can be obtained as shown in Equations 3 5. cos cos 2 3 2 4 2 5 

Phase differentiation is generally obtained by taking the finite difference of the phase of x t from point n to n 1. However the diode ripple data is a real signal so the imaginary component is extracted by band pass filter . A complex signal is needed to determine the phase of a signal and from these complex parts the phase can be obtained. A complex signal has real and imaginary parts where the phase can be expressed as shown in Equation 6. phase arc tan imaginary part real part 6 

If the DSP cannot acquire the diode tone frequency sufficiently from the input signal the signal analyzer may display a notification to the service technician to select an alternative source for the input signal or to check the alternator belt for proper tension. For example in some vehicles the power signal being applied to the accessory receptacle may include additional filtering that may complicate diode ripple signal recovery. In this case it may be more efficient for the service technician to provide the alternator output signal directly from the alternator or across the negative battery terminal and the alternator case ground rather than performing more extensive analysis on an equivalent of the alternator output signal .

If there are phase discontinuities in the diode ripple tone the phase differentiator produces large impulses. shows an example of an impulse in the phase demodulated signal. A slope rate limiter can be used to find these large impulses in the demodulated signal. Once these impulses are found their location is error tagged and sent to the resampler . The amplitude of the error signal is processed as a sample and hold. The sloped limited data is then low pass filtered by an anti aliasing filter prior to indexing to produce the raw engine data .

The slope metric signal can be used as a metric for determining the length i.e. number of samples of the detected impulse. The slope metric signal is compared to a reference value. The reference value is a value selected to be the maximum allowable the slope of the signal. A counter is incremented and stopped once the slope of the signal falls below the reference. shows an example waveform diagram in which the slope of the signal has exceeded the reference value and the sample and hold employed. For example if the reference level is then the comparing examines the slope metric signal and produces a pulse equivalent in length when the slope metric signal exceeded a value of 20. In phantom or dotted lines are used to illustrate the signal before the application of slope rate limiting.

The embodiment illustrated in includes a sample and hold reconstruction approach. The threshold detection compares the slope metric to a threshold. If the threshold is reached then an error signal is sent to the error spreading and delay block . This error remains set until the slope metric falls below the threshold. The spreading routine is used to widen this error to guarantee the error signal being a significant value after the error tag is down sampled by the filtered diode ripple indexing tone . When the threshold detection is set the slope rate limited decoded engine data is set equal to the substitution value. If the threshold detection is below the threshold then the slope rate limited decoded engine data is set equal to the decoded engine data . The substitution value is recomputed using Equation 7. substitution value substitution value decoded engine data 8 7 

Returning to the slope limited demodulated data is related to the engine signature. However it is advantageous to express this data independent of the engine RPM and consequently diode ripple tone frequency. In the illustrated embodiment an indexer uses the diode ripple tone frequency as an index for sampling the angle demodulated signal. This indexing uses the real part of the diode tone as the sampling frequency. The real part of the diode tone is differentiated twice . This process provides for consecutive zero crossings that guarantee no missing engine data sample points. Of course the dual differentiation may be viewed as a filter. The zero crossing detector senses the positive or negative zero crossing of the diode ripple tone and provides this information to the indexer as the sampling signal. The indexer effectively down samples the data by the ratio of 25 KHz diode tone frequency to yield a signal with a time base that is independent of engine RPM and diode ripple tone frequency. After indexing the data provided to a storage unit . The indexed data can be referred to as raw indexed engine data . The resampler also provides other data related to the raw indexed engine data. Data tags consist of an external trigger a time base and error tags and a signal indicating the number of samples per block .

The raw indexed engine data may also be concurrently provided to the back end for further processing. The back end may also retrieve the raw indexed engine data from the storage unit in real time i.e. via multiple concurrent read write ports or subsequently in an offline processing mode.

An additional feature allows the indexing block to produce data at one half the frequency of the filtered diode ripple indexing tone . Some vehicles are equipped with non standard alternators which produce over zero crossings per engine cycle some alternators produce as many as 1000 zero crossings per engine cycle . Because this may be a considerable amount of data to process the indexing block can discard every other raw indexed data sample and data tags .

Frequency and period are inverse functions so the diode ripple tone frequency can be written as shown in Equation 8 where Pequals the time between positive zero crossings. 1 8 

Period measurement measures the time period in samples of the real time domain signal . The positive zero crossing detector determines when the real time domain signal has crossed zero in the positive direction. A signal is sent to period sample counter . This counter starts counting at the sampling rate. When the zero crossing detector senses another zero crossing the value in the period sample counter is then stored in store sample count . The period sample counter then is reset and the process starts over. The store sample count block has now measured the period of the diode ripple tone. This period varies with the phase modulation of the diode ripple tone. Thus the diode ripple tone is decoded as a variation of the diode tone period. Because the zero crossings are used as the strobe to store the diode tone period the engine data is effectively indexed by the diode tone frequency. The output is the raw indexed engine data .

The raw indexed engine data is collected in a sample buffer synchronized by the number of samples per block . This block of data enters the engine data repair block . The data tags go into a tag collection buffer . These data tags provide information as to where the error occurs in the raw engine data which is used for data reconstruction.

The engine data repair uses a first order approximation for reconstructing the engine data that has errors. The error tag indicates where the engine data is error. The engine data repair determines the last good data point and the next good data point from the error tags. A first order slope m is determined using these points by Equation 9 where x n k is the last good data point x n next good data point and k is the length of the error. 9 

Once the slope is determined the engine repair routine uses Equation 10 where i 1 to k for data reconstruction. shows this signal. In phantom or dotted lines are used to illustrate the signal before the reconstruction. 1 10 

The reconstructed engine data and the external trigger tags are then used by the synchronization block to produce the engine cycles signal . Further details of the synchronization block are described below and with reference to .

After synchronization the engine cycles data passes through the 512 tap FIR engine signature filter determined by adjustable FIR Taps to smooth the reconstruction for subjective presentation. This signal is then given to the display integrator for more filtering which produces the engine cycle signature . The engine cycles signal is also provided to the engine cycle parameter calculator which passes on the engine parameters to the display processor. The engine cycle parameter calculator computes the RPM per engine cycle as the mean value of the RPM of engine cycles signal . Specifically each point of engine cycles signal is a value representing the frequency of the diode ripple. The mean over an engine cycle is taken and divided by the number of indexed samples per engine cycle . This value is multiplied by 60 seconds minute and 2 revolutions per engine cycle to yield the RPM per engine cycle.

The display integrator operates by filtering each individual display pixel column with the corresponding value from previous engine cycles. For example there are 500 display values representing an engine cycle. The first new display value is weighted and added to the previously displayed value also weighted. Specifically if setting of 70 is selected the new display value is multiplied by 0.3 and the previously displayed value is multiplied by 0.7 and the two values are added to produce a new display value. This process is repeated for each of the display values e.g. 500 values across the horizontal axis of the display.

A complex impulse response band pass filter is synthesized. The output of the over lapped 1024 running FFT is then filtered by frequency domain filter . After filtering an overlapped 1024 running IFFT is performed in order to transform the signal back into the time domain. The output of the anti aliasing FIR filter is time delayed by to time align the signals entering the resampler .

The phase of this time domain signal is calculated using the arctangent function and presented to the resampler . The functionality of the resampler is further described below. The engine data phase signal is differentiated to yield the relative cylinder firing frequency which is averaged and converted to a period related to the number of cylinder firings and the number of cylinders. The period is in terms of the number of indexed samples per engine cycle. This engine cycle period is provided to an out of range limiting block and then to an infinite impulse response IIR filter . Equation 11 defines the period y x n where x n is the mean. 2 number of cylinders 11 

As can be appreciated from Equation 11 the frequency to period converter receives as an input the number of cylinders. The number of cylinders may be provided in a number of ways as one skilled in the art will appreciate including keyboard entry or database lookup or decoding of the vehicle identification number VIN . Furthermore an additional signal can be provided to the signal analyzer for use in determining the number of engine cylinders. For example a voltage clamp placed on a cylinder spark plug wire can be used to provide a periodic input signal that corresponds with an engine cycle. In an embodiment the inductive pickup is used to determine the number of indexed samples per engine cycle which consequently displays the correct number of cylinders.

The number of samples per period of the raw indexed engine data that are determined per engine cycle are forwarded to the resampler . The phase of the cylinder firing is also forwarded to the resampler . This is used to synchronize the output of the resampler to start at the 0 degree selectable point in the raw indexed engine data. A fixed phase starting position is advantageous so that a waveform display of the output data is more understandable to the service technician.

A resample rate control signal is generated to control the phase out put of the Signature Amplitude . The signature phase illustrated in of the signature amplitude is compared to a signature phase reference . This signature phase reference is generated internally depending on the number of cylinders internal trigger only . A phase error is developed based on the difference of the reference phase and the signature phase . The phase error consists of the number of display points e.g. 500 points . These display points are provided to a vector mean value block which takes the average of the display points creating the engine cycle phase offset . This signal is processed by a lead lag digital filter creating a phase offset error signal . The signal is amplified by the gain adjust servo loop. The number of cylinders and the engine cycle period determine the gain of this block cycle period. The output of the servo loop and the number of indexed samples per engine cycle are added to together creating the re sample rate control . This process produces a second order closed loop servo mechanism that displays the signature amplitude starting point at 0 degrees or at some other selected starting phase position .

Alternatively the external trigger tags may be used in place of blocks . In this case the number of raw indexed engine data points is counted over the interval between the external trigger tag locations. This is followed by out of range limiting . If the external trigger tags are missing the resultant trigger may be determined one of two ways. When a normal trigger mode is selected amplitude and data entering the re sampler are discarded resulting in no data output from . When an automatic mode is selected the out of range limiting block is allowed to set the number of samples per engine cycle to a predetermined maximum.

The number of raw indexed engine data samples per engine cycle which may be determined by the cylinder firing frequency may have numerous values. Typically these values range from 120 samples to 430 samples per engine cycle depending on physical parameters such as the alternator pulley ratio. Additionally some alternator systems may have 430 to 800 samples per engine cycle. In these cases the front end operates in the one half rate mode as described above and with reference to indexing block . Therefore the processing load of converting the raw indexed engine data to a fixed number of engine signature data points i.e. 500 may vary.

As described above it is possible to have different periods for different engine signatures depending on the number of cylinders and the vehicle s charging system construction. As an example if an engine has an engine signature period of 150 points the resampler may output 500 points. For this example the resampling ratio is 150 to 500. This implies that 500 points are interpolated from 150 points. As one skilled in the art will appreciate the resampler may or may not include the original data points in the output. In an embodiment of the present disclosure the resampler uses a linear weighted interpolation to construct the extra data points.

An interpolation example for a few data points is provided below for a resampling ratio of 150 500 or 0.3. An output counter m is incremented by 1 and an input counter n is incremented by the ratio in this case 0.3. The first output point is calculated by taking the nth input point and multiplying it by 1 counter fraction adding the nth 1 input times the counter fraction and dividing the sum by 2. An example calculation is illustrated in Equations 12 14. output input 1 fraction input 1 fraction 2 12 output 1 input 1 1 0.3 input 2 0.3 2 13 output 1 input 1 0.7 input 2 0.3 2 14 

The output counter is incremented by 1 and the input counter is incremented by 0.3. The input counter is now 0.6. Because the counter did not roll over to the next integer the same input data points will be used as illustrated in Equations 15 17. output 1 input 1 fraction input n 1 fraction 2 15 output 2 input 1 1 0.6 input 2 0.6 2 16 output 2 input 1 0.4 input 2 0.6 2 17 

The output counter is incremented by 1 and the input is incremented by 0.3. This yields an input counter equal to 0.9 and an output counter equal to 3. Thus Equations 18 19 define the output equation. output 3 input 1 1 0.9 input 2 0.9 2 18 output 3 input 1 0.1 input 2 0.9 2 19 

Incrementing the output counter again yields an output counter equal to 4 and incrementing the input count by 0.3 yields 1.2. Because the input count rolled over to 1 the input data used is incremented by 1. The fractional part of 0.2 is used as the scaling factor as shown in Equations 20 21. output 4 input 2 1 0.2 input 3 0.2 2 20 output 4 input 2 0.8 input 3 0.2 2 21 

Of course the interpolation process is performed iteratively or recursively until the desired number of output data points e.g. 500 points is reached. At this point the synchronization sub system presents a complete engine cycle having 500 display points.

The normal engine signature shows a small amount of change in the engine speed as each of the cylinders fire. shows an example engine signature for a 5 cylinder engine. In this case each cylinder of the engine is contributing approximately equally to the total power output. Specifically if the peak to peak amplitude of the signal is the same for all cylinders then all cylinders are contributing equally to the total power output.

On the other hand the poorly contributing cylinder engine signature indicates a contribution problem with one of the cylinders. When a cylinder fails to contribute equally the engine speed responds to this lack of a single power stroke and slows accordingly. Specifically if a particular cylinder is contributing less than the average of the other cylinders the power stroke fails to generate the engine speed needed to maintain a steady state peak to peak amplitude.

Having described embodiments of determining engine cylinder contribution from indexed engine data which are intended to be illustrative and not limiting it is noted that modifications and variations can be made by persons skilled in the art in light of the above teachings. It is therefore to be understood that changes may be made in the particular embodiments disclosed that are within the scope and spirit of the disclosure as defined by the appended claims and equivalents.

