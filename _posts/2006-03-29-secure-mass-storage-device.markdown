---

title: Secure mass storage device
abstract: A USB mass storage device includes a memory, USB interface and USB controller. A biometric circuit provides biometric authentication and a secure microcontroller is operatively connected to the biometric circuit and the USB controller and operative in accordance as a trusted platform and having a command set to access security functions and trust authentication of a user using the biometric circuit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09081946&OS=09081946&RS=09081946
owner: STMICROELECTRONICS, INC.
number: 09081946
owner_city: Coppell
owner_country: US
publication_date: 20060329
---
The present invention relates to the field of mass storage devices and more particularly this invention relates to USB mass storage devices.

Since the late 1990 s the universal serial bus USB has become firmly established and has gained wide acceptance in the PC marketplace. The USB was developed in response to a need for a standard interface that extends the concept of plug and play to devices external to a PC. It has enabled users to install and remove external peripheral devices without opening the PC case or removing power from the PC. The USB provides a low cost high performance half duplex serial interface that is easy to use and readily expandable.

USB uses four wires. The power supply is carried with two wires VBus and ground and data is carried with the other two wires D D . The latest version of the USB is currently defined by the Universal Serial Bus Specification Revision 2.0 written and controlled by USB Implementers Forum Inc. a non profit corporation founded by the group of companies that developed the USB Specification. This specification is incorporated herein by reference in its entirety. The increasingly widespread use of the USB has led manufacturers to develop USB interfaces for connection of their products to host computers to complement the existing serial and parallel interfaces. These devices are becoming increasingly smaller such as USB mass storage tokens.

One type of mass storage device is a USB flash drive that is typically a NAND type flash memory integrated with a USB interface. It uses the USB mass storage standard for removable storage devices. In many examples of such devices a small printed circuit board is encased in a plastic housing allowing a standard type A USB connection or interface to be connected directly to a port on a personal computer. The flash drives are active when powered by a USB computer connection and typically require no other external power source or source of battery power.

Usually the drives are run off a limited supply and are forwarded by a USB connection of about 5 volts and up to 500 milliamps. The flash drive typically includes the mail type A USB connector and a USB mass storage controller that implements a USB host controller to provide a linear interface to some type of block oriented serial flash devices. This could contain a small RISC microprocessor and some on chip ROM and RAM. In this type of circuit a NAND flash memory chip stores the data and a crystal oscillator provides a clock signal and controls the data output. An LED could indicate data transfer or data reads and writes in some devices.

Typically these flash drives and similar USB mass storage devices implement a USB mass storage device class allowing most computer systems to read the device. Most USB flash drives do not use a write protect mechanism. Some flash drives however encrypt data using an encrypted file system including True Crypt CryptoBuddy and Private Disk as examples. It is believed there have been some proposals for biometric fingerprinting but these proposals have not been commercially implemented and the design has been technically complete and expensive.

It should be understood that the large acceptance of USB mass storage devices and flash drives in the PC world and their use in corporate environments indicates that the products are becoming ubiquitous for a PC user. These portable devices are USB plug and play compliant. They are small in size and are often lost with their sensitive information including sensitive data keys or credentials of a user. Additionally with the proliferation of USB devices the user may have to connect a multitude of USB products to a user s computer to store information to authenticate at the computer network or web page to pay on line or to encrypt sensitive data and verify the integrity of a platform application.

There are proposals to implement smart card technology to USB mass storage devices but much of the hardware security provided by a smart card chip is limited to its use of the ISO 7816 protocol to communicate with a USB controller. It would be advantageous to incorporate a physical interface such as the USB low pin count LPC Inter Integrated Circuit I2C serial peripheral interface SPI or other serial or parallel input output interface such as the InterChip USB with a higher protocol layer not based on ISO 7816 3.

Some USB flash drive devices offer content protection by user name and password access and use software encryption having a memory partition using a public and secure area. A security token could be made from a USB token including a custom USB controller or made from two chips i.e. a smart card in a USB controller with a smart card reader functionality such as described in U.S. Pat. Nos. 6 748 541 and 6 763 399 to Margalit et al. the disclosures which are hereby incorporated by reference in their entirety. As disclosed generally in these references a smart card chip can communicate to a USB controller using an ISO 7816 interface and protocol. In other examples the token could use a USB reader with an ISO 7816 smart card or USB smart card as defined in ISO 7816 12.

Some proposals such as disclosed in U.S. Patent Publication No. 2002 0073340 published on Jun. 13 2002 disclose a secure mass storage device having an embedded biometric record that blocks access by disabling plug and play configuration. The system can use a thumbprint that is captured and compared to templates to either block the secured drive access or continue initializing the secured drive to allow access. Although some biometric circuit is provided in the disclosure it may not provide the desired level of trusted authentication.

It is therefore an object of the present invention to provide a mass storage device that can operate as a USB peripheral with data integrity without using the ISO 7816 3 protocol.

It is still another object of the present invention to provide a mass storage device that can be a trusted USB peripheral having data integrity and provide a user secure authentication and mass storage capability.

A USB mass storage device includes a memory for storing data. A USB interface couples the USB mass storage device to a host computer. A USB controller is operatively connected to the memory and USB interface and operative for transferring mass storage data between the host computer and memory. A biometric circuit provides biometric authentication of a user. A secure controller is operatively connected to the biometric circuit and the USB controller and operative in accordance as a trusted platform. It has a command set to access security functions and trust authentication of a user using the biometric circuit.

In yet another aspect the secure controller is operatively connected between the biometric circuit and the USB controller. This secure controller can be operative to access security functions performed by logic that complies with the Trusted Computing Group TCG specification. The biometric circuit can be formed as one of a capacitance optical and RF scanner circuit. The memory can be formed as a non volatile memory such as EEPROM NVRAM or flash memory.

In yet another aspect of the present invention a serial communications interface interconnects the USB controller and secure controller and can be formed as one of at least a RS232 I2C SPI or interchip USB communications link. A serial communications interface can interconnect the secure controller and the biometric circuit.

In yet another aspect of the present invention a USB mass storage system includes a computer host that includes a USB interface and receives mass storage data through the USB interface and communicates with the USB mass storage device.

Different embodiments will now be described more fully hereinafter with reference to the accompanying drawings in which preferred embodiments are shown. Many different forms can be set forth and described embodiments should not be construed as limited to the embodiments set forth herein. Rather these embodiments are provided so that this disclosure will be thorough and complete and will fully convey the scope to those skilled in the art. Like numbers refer to like elements throughout.

In accordance with a non limiting example of the present invention the mass storage device is operative as a secure USB mass storage device for example a USB flash drive which integrates several devices into one. The mass storage device has hardware security and a similar level of protection profile as a smart card to secure content. A user can have secure authentication with mass storage capability and operability as a trusted USB peripheral. The mass storage device includes data integrity and does not use the ISO 7816 3 protocol. It has compatibility with the Trusted Platform Module TPM as instituted by the Trusted Computing Group TCG initiative. The device can include key credential and password storage into a secure memory in accordance with the standard. The password can be replaced by a biometric sensor.

In one non limiting example of the present invention a system has a USB host and a USB peripheral connected one to one to each other. The USB host could be a PC host an embedded PC host or an embedded USB host in a consumer or telecom application. The USB peripheral could offer several functions including a a USB mass storage class function for storing data of a user and b security functions for example storing public private and symmetric keys or cryptographic hashing for integrity checking or digital signing or sealing data to a system state. These functions can be used by security applications running on top of the hardware and software driver.

It should be understood that although a flash drive is described the mass storage device could be a USB mass storage token or other mass storage device including in some embodiments a reconfigured smart card or similar device.

For purposes of background and description the basic USB data flow between a USB host and a USB device and the various implementations and layers in accordance with the universal serial bus specification 2.0 are set forth in .

As shown in the connection of a host to a physical device requires the interaction between different layers i.e. the USB bus interface layer USB device layer and function layer . An interconnect between the host and device is illustrated.

The USB bus interface layer includes a USB bus interface circuit and serial interface engine SIE at the device that communicates with a serial interface engine SIE and its host controller at the host via a physical wire . The USB device layer includes at the physical device a collection of endpoints as a USB logical device . An endpoint zero is operable in communication via the default pipe to USB system software that is operable for device management at the host . The function layer includes at the physical device a logical function as an interface collection and the interface that communicates via a plurality of pipe bundles to client software that is operable for interface management.

The USB bus interface layer provides the physical wire for the traffic signaling and packet conductivity between the host and physical device . The USB device layer views the USB system software to perform generic USB operations with the physical device via the default pipe to endpoint zero . The functional layer adds capabilities to the host using matched client software. The USB Device Layer and Function Layer each view logical communications within their layers and use the USB Bus Interface Layer for any data transfer. The USB host coordinates the overall USB system controls access and monitors the USB topology.

Logical communications exist between the client software and the Function Layer and the USB system software and USB logical device . Actual packets flow between the USB host controller and the USB bus interface circuit .

As is known USB physical devices add functionality to the host and have the same interface. Each physical device carries and reports configuration related data which it forwards to the host to allow the host to identify and configure the USB device. Typically devices on the USB are connected to a host using a tiered star topology including the hub. The host on the other hand communicates with each logical device as if it were directly connected to a root port. The client software manipulates a USB function interface of a device only as an interface of interest.

It should be understood that the actual communication flows across several interface boundaries. The two software interfaces for the host are a host controller driver HCD and a USB driver USBD . A software interface between a USB host controller and USB system software implements the host controller driver and allows the host controller to implement functions without requiring the host software to be dependent on any particular implementation. One USB driver can support different host controllers. Specific knowledge of a host controller implementation is not required.

The USB logical device can be considered a collection of endpoints and are grouped into endpoint sets to implement the interface. The USB system software manages or controls the device using the default pipe to the endpoint zero . Client software manages the interface using pipe bundles associated with an endpoint set. Data is moved between a buffer on the host and an endpoint on the USB device when client software requests the data. The host controller or USB device depending on the direction of data transfer packetizes the data and forwards the packets over the bus. It also coordinates bus access. The host communicates with the physical device using a desired communication that is designed to match any communication requirements of the physical device and transfer characteristics provided by a USB.

The endpoint is an identifiable portion of the device that terminates the communication between the host. It can be a collection of independent endpoints. Default control uses input and output endpoints and the endpoint number zero as part of the default pipe .

The data transport mechanism includes transfers of data between the host controller and the USB system software at the host . Buffers can be used as a data transport mechanism between the USB system software and the client software at the host . The other data transport mechanism includes transactions between the host controller and the serial interface engine within the USB bus interface of the host.

The data transport mechanism also exists as a data per endpoint between the USB bus interface circuit and the USB logical device at the physical device . The data transport mechanism between the function and with the interface and the endpoint zero is interface specific.

USB relevant format of transported data occurs as USB frame data between the serial interface engine and the host controller and between the host controller and the USB system software at the host . No USB format for transporting data exists between the client software that manages an interface and the USB system software .

At the device USB relevant format of transported data exists as USB frame data between the USB bus interface circuit and the USB logical device . No USB format of data occurs between the interface and the endpoint zero at the device .

Further details of the functioning of the USB host and device and data flow can be found in the Universal Serial Bus Specification Revision 2.0 including Chapter 5 entitled USB Dataflow Model the disclosure for the entire Specification Revision 2.0 which is hereby incorporated by reference in its entirety.

As illustrated the basic components of this USB peripheral include a USB device controller i.e. a USB controller in this non limiting example. The USB controller interfaces with a USB interface and communicates with the USB host via the USB protocol and provides a serial and parallel interface communicating to a non volatile memory for example an EEPROM NVRAM or flash memory. Communication can be via the protocol required by a selected type of memory and a serial interface communicating to a secure controller for example a microcontroller or microprocessor as a Trusted Platform Module TPM product via a communications interface such as SPI I2C LPC or USB in case of an interchip USB chip to chip if the system architecture allows it. It should be understood that an RS232 connection could also be used.

The secure controller can provide an optional secondary serial interface communicating to a biometric circuit as a separate subsystem that includes a biometric sensor for example fingerprint sensor and a biometric processor for example operative as a coprocessor which securely stores a biometric template into the USB peripheral to authenticate a user. This biometric circuit can allow biometric authentication of a user to the mass storage device while the secure controller allows trusting of the authentication.

In this non limiting example the secure controller allows a TPM command to access security functions. An SPI interface as a serial peripheral interface and its related protocol have been found advantageous for use between the USB controller and the secure controller . The non volatile memory can be a flash memory type NAND as known by those skilled in the art. The biometric circuit has a coprocessor that is operative with the finger sensor or other sensor receiving section typically positioned on an outer housing forming the USB mass storage device or peripheral as illustrated.

The secure controller as a TPM can store keys passwords and digital certificates and could be affixed to any support or board positioned within the housing defining the mass storage device . The secure controller can also protect and authenticate user passwords. The secure controller typically acts as a slave to higher level services and applications by storing and reporting pre run time configuration information in some non limiting examples. Typically the secure controller can use a low pin count LPC bus interface and provide crypto capabilities. A hardware engine can perform up to 2 048 bit RSA encryption decryption. It can use a built in hash engine to compute hash values or small pieces of data. It can also use a random number generator to generate keys for various purposes.

An endorsement key can be used as a public private key pair of about 2 048 bits and could be unique to a particular TPM and platform. The attestation identity key AIK can authenticate a service provider. Different certificates can be used and stored including an endorsement certificate platform certificate and conformance certificate. The endorsement certificate can contain the public key of the endorsement key and provide attestation that a particular TPM is genuine and the endorsement key is protected. Platform certification can be provided by a platform vendor and provide attestation that the security components of a platform are genuine. A conformance certificate can be provided by a platform vendor or an evaluation laboratory.

The TPM secure controller can access any TCPA software stack TSS using a TPM device driver library. A TSS uses modules and components to support functionality to the TPM. The TSS can off load security function to a CPU. The TPM can encrypt data using a one time symmetric key that can be protected by TPM.

It should be understood that the biometric subsystem can include many different types of biometric systems. The illustrated fingerprint sensor or scanner is a preferred design in this non limiting example. It is possible to use many different types of biometric circuits that can sense or scan physical characteristics for example the face fingerprints irises or veins. Alternatively the biometric circuits can sense or scan behavioral characteristics including voice handwriting or typing rhythm depending on the size of the housing used with the mass storage device and whether it can support such sensor pad or circuit. For example it is possible not only to analyze a letter in a handwriting detection system but it is also possible to analyze the act of writing such as pressure speed and rhythm with which one writes an initial or name on a sensor pad. Accuracy can be determined by a False Except Rate FAR False Reject Rate FRR Failure To Enroll Rate FTE and Failure To Acquire Rate FTA .

It is possible to use some systems that have a voice print recognition system such that wave patterns can be memorized and sound spectrograms used for identity detection. Voice print recognitions could also be used. It is also possible to use layered systems that combine biometrics with a keycard or Personal Identification Number PIN and systems that combine multiple biometric methods including an iris scanner a voice print system or fingerprint sensor. Iris scanning is possible and is typically not the same as retinal scans in which a picture of the blood vessel structure in the back of the eye is scanned. It is possible to use vein geometry in which a camera takes a digital picture of a vein structure in for example a hand using near infrared light.

The preferred fingerprint sensor or scanner would obtain an image of a finger and determine whether any pattern of ridges and valleys in the image matches the pattern of ridges and valleys in a prescan image. Optical scanning and capacitance scanning could be used. The optical scanners would typically include a Charge Coupled Device CCD with its own light source and an array of light embedding diodes. Capacitance scanners use a tiny array of cells that include conductor plates covered with insulating layers or other similar systems in some non limiting examples. Feed back loops could be used in such systems. It is also possible to use RF signals to detect a fingerprint ridge and valley pattern where a fingerprint pattern can be read from the conductive layer of skin beneath the dry outer surface skin layer. Pixel sensor plates could be operative with an excitation signal reference plane in a semiconductor substrate having sense amplifiers that are output. The templates would be stored as part of the biometric circuit .

It should be understood that the TSS software specification can provide a standard application programming interface for accessing functions of the TPM. A USB firmware library can also be included.

Many modifications and other embodiments of the invention will come to the mind of one skilled in the art having the benefit of the teachings presented in the foregoing descriptions and the associated drawings. Therefore it is understood that the invention is not to be limited to the specific embodiments disclosed and that modifications and embodiments are intended to be included within the scope of the appended claims.

