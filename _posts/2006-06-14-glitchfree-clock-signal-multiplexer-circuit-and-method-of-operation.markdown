---

title: Glitch-free clock signal multiplexer circuit and method of operation
abstract: Techniques for the design and use of a digital signal processor, including for processing transmissions in a communications system. Reduced glitch occurs in switching from a first clock input to a second clock input driving a clock multiplexer. The clock multiplexer receives a first clock input and provides a clock output and determines a low phase output level in the clock output. For a limited period of time, a low phase output level is forced. The clock multiplexer receives a second clock input and determines a low phase input level in the second clock input signal. Switching to providing the clock output in response to the second clock input occurs during the low phase input level in the second clock input signal. Then, the output of the clock multiplexer follows the phase level of the second clock signal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07911239&OS=07911239&RS=07911239
owner: QUALCOMM Incorporated
number: 07911239
owner_city: San Diego
owner_country: US
publication_date: 20060614
---
The disclosed subject matter relates to digital circuitry such as digital circuitry for digital signal processing wireless communications and other applications. More particularly this disclosure relates to a novel and improved glitch free clock signal multiplexer circuit such as may be useful for many types of digital circuits.

The use of code division multiple access CDMA techniques in a multiple access communication system is disclosed in U.S. Pat. No. 4 901 307 entitled SPREAD SPECTRUM MULTIPLE ACCESS COMMUNICATION SYSTEM USING SATELLITE OR TERRESTRIAL REPEATERS and U.S. Pat. No. 5 103 459 entitled SYSTEM AND METHOD FOR GENERATING WAVEFORMS IN A CDMA CELLULAR TELEHANDSET SYSTEM both assigned to the assignee of the claimed subject matter. A CDMA system is typically designed to conform to one or more standards. One such standard is offered by a consortium named the 3rd Generation Partnership Project 3GPP and embodied in a set of documents including Document Nos. 3G TS 25.211 3G TS 25.212 3G TS 25.213 and 3G TS 25.214 which are readily available to the public. The 3GPP standard is hereinafter referred to as the W CDMA Standard.

In a further enhancement W CDMA broadband technology one particular type of chipset for WCDMA handsets is known as the Mobile Station Modem MSM chipset line of chipsets. The MSM chipset line of chipsets is offered by the present assignee of the disclosed subject matter and at least some of such chipsets use 65 nm CMOS technology and interface to RF CMOS single chip transceiver and multi band receiver devices to provide great cost efficiency. The MSM chipset line of chipsets for example support EDGE GPRS and GSM networks and provide multimedia capabilities integrated into camera and image processing video streaming playback recording and video telephony streaming and playback of popular audio codecs such as MP3 AAC aacPlus and Enhanced aacPlus Bluetooth connectivity 2D 3D graphics as well as OMA 2.0 compliant digital rights management DRM . Moreover some MSM chipset provide interoperability between single chip Radio on Chip for Mobile ROCm solutions giving them the ability to support 802.11g and 802.11a g wireless LAN WLAN technology.

MSM chipset and similar chipsets oftentimes use multiple clocks that feed multiple subsystems. These clocks are generally asynchronous to each other because to operate properly the various subsystems require different clocks at different times. With more and more multi frequency clocks being used in these and similar chipsets especially in the communications field it is often necessary to switch the source of a clock line while the chip is running. This is usually implemented by multiplexing two or more different frequency clock sources in hardware and controlling the multiplexer select line by internal logic. The two clock frequencies could be totally unrelated to each other or they may be multiples of each other. In either case there is a chance of generating an undesirable glitch on the clock line at the time of the switch. A glitch on the clock line is hazardous to the whole system as it could be interpreted as a capture clock edge by some registers while missed by others or provide too little time for the computations in programs to finish.

One approach to address this problem is to provide a circuit for selecting and switching from one to another of a plurality of clock sources having different frequencies without generating runt pulses electrical glitches metastable conditions or other anomalies is described in U.S. Pat. No. 4 853 653. In such a solution a multiple input clock selector is provided for switching asynchronously from one to another of a plurality of oscillators that generate clock signals having different frequencies. The clock selector has a plurality of sections corresponding to the plurality of oscillators. Each section of the clock selector comprises an initial AND gate a pair of flip flops and a final AND gate all connected in series. The oscillator signal for each section is applied to the final AND gate and to the flip flops as a clock input. An inverted signal from the second flip flop of each section is fed back as an input to the initial AND gates of all the other sections. An oscillator select signal is also provided as an input to the initial AND gate of each section. The outputs of all final AND gates pass through an OR gate that provides the selected clock output. The clock selector switches between oscillators as determined by the select signals without producing runt pulses metastable conditions or other anomalous signals. However this solution requires that the select lines remain stable until the switching operation is complete otherwise the circuit may produce glitches.

Another approach uses a phase switch multiplexer. The phase switch multiplexer unfortunately demonstrates the undesirable behavior of compressing some clock phases. It is also subject to metastability. Metastability exists when the storage node of a sequential element goes to a state between an ideal one and an ideal zero. A metastable state can be interpreted differently by the clock multiplexer and the enable feedback of the other flip flop. Therefore it is required that capturing edges of both flip flops and the launch edge of the SELECT signal should be set apart from each other to avoid any asynchronous interfacing.

Accordingly there is the need for a solution to the problem of switching between clocks in a glitch free and phase compression free manner.

There is a need for fast switching time and simplicity in clock switching circuits that may be used for mobile system chipsets and similar applications.

There is a further need for a clock signal switching circuit that provides a low probability of metastability or other anomalies during the switching process.

Techniques for providing a novel and improved glitch free clock signal multiplexer circuit are disclosed which techniques improve both the operation of a digital signal processing chipsets for increasingly powerful software applications including applications operating in personal computers personal digital assistants wireless handsets and similar electronic devices as well as increasing the associated digital processing speed energy use and service quality.

According to one aspect of the disclosed subject matter there is provided a method and system that prevent glitches in clock signal switching from a first clock input driving a clock multiplexer circuit to a second clock input driving the clock multiplexer. The method and system provide for receiving a first clock input signal in a clock multiplexer circuit and providing a clock signal output from the clock multiplexer circuit in response to the clock multiplexer circuit receiving the first clock input signal. The disclosed subject matter determines a low phase output level in the clock signal output in response to a low phase input level in the first clock signal output and forces for a limited period of time the clock multiplexer circuit to maintain the low phase output level irrespective of the phase level of the first clock input signal. The clock multiplexer circuit also receives a second clock input signal and determines the presence of a low phase input level in the second clock input signal. Switching from providing the clock signal output in response to the first clock input signal to providing the clock signal output in response to the second clock input signal occurs while maintaining the low phase output level and during the low phase input level in the second clock input signal. Then method and system allow the output of the clock multiplexer circuit to follow the phase level of the second clock signal input after the switching step.

These and other advantages of the disclosed subject matter as well as additional novel features will be apparent from the description provided herein. The intent of this summary is not to be a comprehensive description of the claimed subject matter but rather to provide a short overview of some of the subject matter s functionality. Other systems methods features and advantages here provided will become apparent to one with skill in the art upon examination of the following FIGUREs and detailed description. It is intended that all such additional systems methods features and advantages be included within this description be within the scope of the accompanying claims.

The disclosed subject matter for a novel and improved glitch free clock signal multiplexer circuit may find use for signal processing applications of any type for which the benefits here presented may be advantageous. One such application appears in telecommunications and in particular in wireless handsets that employ one or more digital signal processing circuits.

In the MSM chipset example of dual memory busses interface various memory and related functional circuits. These may include EB1 for interfacing memory devices such as SDRAM Burst P SRAM and Burst NOR and EB2 for interfacing LCD NAND and other devices . Also MDDI mobile display digital interface Host may provide an interface with LCD . MSM chipset may also include graphics circuitry for supporting OpenGL ES 3D and 2D functions and video circuitry for supporting MPEG 4 H.263 and H.264 functions. In addition processing functions such as those of CDMA processor GSM GPRS processor gpsOne processor and BT 1.2 processor may be included in MSM chipset . Providing signal conversion processes and the like MSM chipset may include serial bus interface SBI receive A D converter Rx ADC and transmit D A converter Tx DAC .

MSM chipset may further include various chipset processors such as Qualcomm Inc. s QDSP 4000 processor Arm Inc. s ARM 926EJS processor and Qualcomm Inc. s Modem QDSP 4000 as well as one or more phase lock loop PLL circuits . PLLs assist with the generation of a clock signal. Essentially any portion of MSM chipset that needs a clock signal for digital circuit operation may draw upon PLLs for such clock signals. In addition there may be many PLLs e.g. six or more operating in different embodiments of MSM chipset .

At times it is possible to have one PLL provide a clock to two or more portions of MSM chipset . This is advantageous from a power use standpoint in that the same PLL may provide a clock signal to two or more portions of MSM chipset e.g. to CDMA processor GSM GPRS processor and gpsOne processor . With PLLs providing multi frequency clocks to the various components of MSM chipset it is often necessary to switch the source of a clock line while the respective component is running. Control of which PLL may provide the desired clock signal is the focus of the present disclosure with one embodiment appearing below in .

The disclosed subject matter provides for multiplexing two different frequency clock sources in hardware and controlling the multiplexer select line by internal logic. The two clock frequencies could be totally unrelated to each other may have some arbitrary relationship to one another or they may be multiples of each other. In either case the present disclosure avoids generating a glitch on the clock line at the time of the switch. A glitch on the clock line is hazardous to all of MSM chipset as it could be interpreted as a capture clock edge by some registers while missed by others or provide to little time for the computations in programs to finish.

In contrast a multiplexer designed specifically for multiplexing clock signals. The select lines are allowed to switch asynchronously. The clock circuit ensures that output clock never glitches i.e. its high or low phase does not get compressed . The disclosed subject matter provides such a clock switching circuit.

Setup and hold time violations can lead to metastability which may exist for an undetermined amount of time. Theoretically therefore the time required to resolve the state of the latch may then be infinite. There will always be points in the continuous domain which are equidistant or nearly so from the points of the discrete domain making a decision as to which discrete point to select a difficult and potentially lengthy process. If the inputs to an arbiter or flip flop arrive almost simultaneously the circuit most likely will traverse a point of metastability. The disclosed subject matter as will be shown below addresses this problem in providing the desired glitch free clock signal switching.

In clka line provides clka signal into clock control pipeline CCP . CCP may be one of a number of CCPs that control inputs into multiplexer circuit . That is clka signal is one of for example five 5 possible clock signal inputs from which multiplexer circuit may generate output clock signal .

Locking circuitry further includes early select lines and late select lines . shows with more specificity one embodiment of the inputs for the clock control pipelines through that may be employed to achieve the objects of the present disclosure.

Clock switching circuit provides control logic for switching from one clock to another that includes waiting for a low phase level of the current clock. When no selects into multiplexer circuitry are active the output is low. Clock switching circuit forces the output of multiplexer circuitry low and waits for the low phase of the new clock signal. Then clock circuitry allows multiplexer circuitry to follow the high and low phase levels of the new clock.

In clock switching circuit select lines sela selb selb and seld may switch asynchronously to clka clkb clkc and clkd while fully avoiding output clock glitches. The disclosed embodiment of clock switching circuit supports four 4 CCPs including pipelines through . Clock switching circuit merges logic of CCP with that of a multiplexer to reduce the number of stages in the PLL clock path. A technical advantage of the disclosed embodiment is significant improvement in both jitter and duty cycle distortion. In addition clock switching circuit allows the CCP logic to be disabled when not needed. Additional technical advantages of the disclosed subject matter include clock switching support for a 1.0 GHz clock in one embodiment. The present disclosure demonstrates a low probability of metastability low jitter low duty cycle distortion low power and energy requirements low area requirements and low skew.

Some time later req may switch Step . Then reqd now goes high and replaces reqb still with no immediate effect on the multiplexer output clock signal step . At some point the early select for clka will fall. This will lock the internal request lines feeding pipelines through step . Then decoder circuitry may become metastable. Within one clock cycle the disclosed circuit substantially reduces the probability that metastability occurs step . After one cycle sela will fall as well. At this point in time none of the select lines sela selb selc or seld are active thereby causing clock switching circuit to drive the output of the multiplexer circuitry clk low step . Now reqd is allowed to inject a one into the pipeline controlling clkd step . Eventually seld will go high which will unlock the internal request lines and place clock switching circuit back in steady state step .

As flowchart of details clock switching circuit also effectively addresses decoder circuitry metastability. Beginning at step assume that clock switching circuit is in steady state with clka selected step . The external request lines are not blocked from propagating through the decoder. Assume that req rises and that clkb is now being requested step . The event propagates through decoder circuitry forcing reqa low and reqb high step . Then reqa injects a zero in the pipeline controlling sela step . At some point the early select circuitry for clka will fall. This will lock the internal request lines feeding pipelines through step . Decoder circuitry may become metastable if req falls at the same time step . Metastability on reqa can be tolerated because the next sampling event for it will occur only one clock cycle later step . Metastability on reqb reqc and reqd can also be tolerated since sela the late select for clka will remain high for another cycle step .

In the disclosed embodiment a test mode of operation may also be provided for selecting the test clock. Selecting the test clock clkt bypasses the functional clock normally produced by 5 to 1 multiplexer circuitry . Selecting the clkt does not impact the state of clock switching circuit in controlling the operation of multiplexer circuitry . Selecting the clkt does not impact clock switching circuit . The test clock select line overrides clock switching circuit .

In summary the present disclosure provides a method and system that prevent glitches in clock signal switching from a first clock input driving a clock multiplexer circuit to a second clock input driving the clock multiplexer. The method and system provide for receiving a first clock input signal in a clock multiplexer circuit and providing a clock signal output from the clock multiplexer circuit in response to the clock multiplexer circuit receiving the first clock input signal. The disclosed subject matter determines a low phase output level in the clock signal output in response to a low phase input level in the first clock signal output and forces for a limited period of time the clock multiplexer circuit to maintain the low phase output level irrespective of the phase level of the first clock input signal. The clock multiplexer circuit also receives a second clock input signal and determines the presence of a low phase input level in the second clock input signal. Switching from providing the clock signal output in response to the first clock input signal to providing the clock signal output in response to the second clock input signal occurs while maintaining the low phase output level and during the low phase input level in the second clock input signal. Then method and system allow the output of the clock multiplexer circuit to follow the phase level of the second clock signal input after the switching step.

The processing features and functions described herein for reducing glitch in switching from a first clock signal input driving a clock multiplexer circuit to a second clock input driving said clock multiplexer circuit may be implemented in various manners. Moreover the process and features here described may be stored in magnetic optical or other recording media for reading and execution by such various signal and instruction processing systems. The foregoing description of the preferred embodiments therefore is provided to enable any person skilled in the art to make or use the claimed subject matter. Various modifications to these embodiments will be readily apparent to those skilled in the art for example one further embodiment may include an N to 1 version of the circuit and the generic principles defined herein may be applied to other embodiments without the use of the innovative faculty. Thus the claimed subject matter is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

