---

title: Portable authorization device for authorizing use of protected information and associated method
abstract: An authorization system and associated method for selectively authorizing a host system to use one or more items of protected information associated with the host system. The authorization system includes a portable authorization device that is removably couplable to the host system. The portable authorization device is capable of receiving and storing multiple items of authorization information associated with a plurality of respective items of protected information from one or more information authorities. Preferably, the portable authorization device is capable of communicating with multiple types of information authorities. The portable authorization device selectively authorizes the host system to use the one or more respective items of protected information based upon the respective authorization information stored therein.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09305173&OS=09305173&RS=09305173
owner: Pace Anti-Piracy, Inc.
number: 09305173
owner_city: Campbell
owner_country: US
publication_date: 20060331
---
This application is a Continuation of U.S. patent application Ser. No. 09 503 778 filed Feb. 14 2000 and assigned to the same assignee as the present invention.

This invention relates generally to techniques for authorizing the use of protected information and in particular to a portable authorization device commonly known as a dongle for authorizing a host system to use protected information.

A software wrapper is a commonly used technique for selectively authorizing the use of protected information associated with a host system such as a personal computer or a server. The protected information for example may comprise a software program to be executed or data to be processed by the host system. The software wrapper permits an end user to access or execute the protected program or data only if a predetermined condition is met. The predetermined condition can be for example the running of a trial period that allows the end user to evaluate the protected program or data or the presentation of the proper authorization information by the end user. The authorization information for example may be a password manually entered by the end user or digitally encoded data. A discussion of software wrappers can be found for example in December 1997 no. 4 vol. 2 p. 3.

There are several techniques known in the art for delivering authorization information to authorize a host system to use protected information. In one technique the authorization information is stored on a portable authorization device that is commonly known as a dongle. Dongles are small readily transportable electronic devices as described for example in U.S. Pat. No. 4 562 306. Dongles are typically provided by the software vendor together with the wrapped software program they are intended to authorize.

To enable the software program to run on a particular computer the end user simply connects the dongle to a communications port of the computer such as a parallel port or Universal Serial Bus USB port. Therefore the end user can authorize a number of different computers to run the program simply by connecting the dongle to whichever computer that he or she desires to run the program on at any given time.

However a disadvantage presented by dongles is that they typically store authorization information for only one software program or perhaps for a group of software programs from a single vendor. Consequently because an end user typically might use several software programs from multiple vendors at any given time he or she might have to carry around multiple dongles which could be cumbersome and inconvenient.

Another disadvantage is that the authorization information stored in the dongle is typically set by the software vendor during manufacture and generally cannot be subsequently updated. As a result when a software vendor provides an end user with a software upgrade add on or plug in etc. for a protected software program the vendor often also delivers a new dongle to authorize the associated software. This is not very cost effective for software vendors because the cost of the dongle itself can be significant in relation to the value of the associated software.

In a second technique known in the art the authorization information is stored on a magnetic floppy disk known as a key diskette. The key diskette may be considered a type of information authority which is a secure and trusted device for transmitting and receiving information. The key diskette is typically provided by the software vendor with the wrapped software program. To authorize the software program to run on a particular computer the end user inserts the key diskette in the computer to transfer the authorization information typically a secret key from the key diskette to the hard disk drive of the computer. Before the computer begins execution of the program the software wrapper verifies that the correct key is present on the hard disk drive and if so allows the computer to execute the program. This technique is used in the Pace Anti Piracy InterLok product which was developed by the applicant of the present invention.

An advantage of this technique over dongles is that authorization information for many different software programs from multiple vendors can be stored on the hard disk drive of the computer. Consequently an end user who runs multiple programs on a computer does not need to keep multiple key diskettes on hand to authorize each of the programs.

This technique suffers from several shortcomings however. First the authorization information is not readily transferable between computers. Typically the key diskette is permitted to transfer the authorization information to only a limited number of computers at any given time. Once the authorization information is transferred to a particular computer the authorization cannot be readily transferred from that computer to another computer because it is stored on that computer s internal hard disk drive. Consequently if the end user wants to authorize a new computer to run a software program but the key diskette has run out of authorizations the authorization information must be removed from one of the computers containing the authorization information and transferred to the new computer a rather cumbersome operation. Therefore unlike dongles this technique does not allow authorization information to be readily transferred between computers. Another disadvantage of this technique is that floppy disks are gradually being phased out of use as data input devices for computers so that in the near future computers may not be able to read the key diskettes.

A third technique described in U.S. Pat. No. 5 854 891 issued to Postlewaite the 891 patent describes a security device for enabling selected functions to be performed by or within a computer connected to the security device. The security device includes a smart card reader for reading data from smart cards which may be considered to be a type of information authority. The security device also includes a control module having a segmented non volatile memory composed of a plurality of segments. Enabling data from a plurality of smart cards is read by the smart card reader and entered into the segmented non volatile memory. Each segment of the segmented non volatile memory creates a virtual token essentially duplicating the enabling ability of the corresponding smart card. The security device is detachable from the computer and thus can be used to enable functions on multiple computers.

An advantage of the security device described in the 891 patent is that it is relatively inexpensive for a software vendor to provide authorization information for software updates add ons plug ins etc. because the authorization information is delivered using smart cards rather than dongles. Smart cards are significantly less expensive than conventional dongles because they are typically implemented with simpler hardware.

However the security device of the 891 patent suffers from several disadvantages. First the security device requires a segmented memory to prevent the smart cards stored in the memory from interfering with each other and possibly corrupting one another s data. This increases the complexity and cost of the security device because it necessitates that the device implement memory management or protection mechanisms in hardware and or software. Second the security device apparently is not capable of receiving authorization information from multiple types of information authorities. The 891 patent mentions that the security device can receive enabling data or authorization information from smart cards. However the patent does not disclose or suggest that the device can receive authorization information from other types of information authorities such as floppy disks or computer servers. Consequently it appears that the use of the security device as an authorization device is limited to those software vendors that support smart cards as a data delivery mechanism.

In view of the shortcomings of the above described techniques it is an object of the invention to provide an authorization device for authorizing the use of protected information that can be updated with new authorization information and yet is removably couplable to host devices readily portable and relatively inexpensive.

A second object of the invention is to provide a portable authorization device that can receive and store authorization information from multiple types of information authorities.

A third object of the invention is to provide a portable authorization device that offers a high level of security to prevent unauthorized access to the authorization information when stored or being transmitted.

The invention provides an authorization system and associated method for selectively authorizing a host system to use one or more items of protected information associated with the host system. The authorization system includes a portable authorization device that is removably couplable to the host system. The portable authorization device is capable of receiving and storing multiple items of authorization information associated with a plurality of respective items of protected information from one or more information authorities. Preferably the portable authorization device is capable of communicating with multiple types of information authorities.

The portable authorization device of the present invention selectively authorizes the host system to use the one or more respective items of protected information based upon the respective authorization information stored therein.

These and other features of the invention will be better appreciated from the following detailed description of the invention together with the appended drawings.

The invention comprises an authorization system including a portable authorization device and associated method for selectively authorizing a host system to use a plurality of items of protected information. The following description is presented to enable any person skilled in the art to make and use the invention and is provided in the context of a particular application and its requirements. Various modifications to the preferred embodiment will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other embodiments and applications without departing from the spirit and scope of the invention. Moreover in the following description numerous details are set forth for purpose of explanation. However one of ordinary skill in the art would realize that the invention may be practiced without the use of these specific details. In other instances well known structures and devices are shown in block diagram form in order not to obscure the description of the invention with unnecessary detail. Thus the invention is not intended to be limited to the embodiment shown but is to be accorded the widest scope consistent with the principles and features disclosed herein.

Each of the access control programs which may also be referred to as a software wrapper is used to control access to one of the respective items of protected information . The access control program authorizes the host system to use the associated item of protected information only if the end user provides the correct authorization information to the access control program. The access control programs in conjunction with the host system are also used to control communications between the indirect information authorities and and the host system . Each item of protected information and respective access control program are typically provided by the software vendor as an integrated product for installation on the host system .

In a presently preferred embodiment of the invention the items of protected information may each comprise a software program or data. The host system in this embodiment may comprise a personal computer or a server computer connected to a network.

The portable authorization device of the authorization system is a relatively small and simple dongle like device that stores one or more items of authorization information for authorizing the host system to use the respective items of protected information . The portable authorization device includes a microprocessor or dedicated logic for performing secure transactions with the host system and a memory for storing the authorization information . Like a conventional dongle the portable authorization device is readily transportable and can be used with a number of different host systems . To use the portable authorization device with a host system the end user may simply connect the device to a communications port of the host system such as a parallel port or USB port. Unlike a conventional dongle however the portable authorization device can store multiple items of authorization information to authorize the use of respective items of protected information .

Furthermore the portable authorization device can be updated with new authorization information from information authorities as explained below. An advantage provided by this feature is that it is relatively inexpensive for a software vendor to authorize the use of a new version of software. The vendor can update the portable authorization device with the new authorization information by providing a relatively simple and inexpensive information authority rather than a dongle to the end user.

In a presently preferred embodiment of the invention the authorization information stored in the portable authorization device comprises one or more dynamic key selectors which are used to derive the secret keys. In other embodiments the authorization information may consist of one or more secret keys. The portable authorization device may be referred to as a key repository as it is used to store multiple dynamic key selectors or keys for authorization purposes.

The information authorities and are trusted devices for transmitting and receiving information such as messages from the portable authorization device . The information authorities and provide respective authorization information for transmission to the portable authorization device to authorize the use of the items of protected information . In a presently preferred embodiment the information authorities and comprise message authorities for transmitting and receiving messages from the portable authorization device . The information authorities and may be used for example by software vendors as a means to deliver software upgrades authorization information etc. to end users.

In a presently preferred embodiment of the invention the authorization information transmitted by the information authorities and comprises dynamic key selectors which do not themselves authorize the use of the protected information on the host system but are used to generate the secret keys that perform such authorization. In other embodiments however the authorization information may comprise the secret keys themselves.

In addition to providing authorization information the information authorities and may also provide user data and other types of data for transmission to the portable authorization device . The user data transmitted by the information authorities and may be used to replace or update the user data stored in the portable authorization device . Alternatively for example the user data may comprise data that enables specific security options in the portable authorization device .

The authorization system may support multiple types of information authorities. The types of information authorities supported may include a physical direct information authority a physical indirect information authority and a networked indirect information authority . The multiple types of information authorities and each communicate with the portable authorization device in a different manner as explained below. An advantage provided by this feature is that unlike the security device of the 891 patent the portable authorization device is capable of receiving software upgrades or authorization information from multiple software vendors supporting different types of information authorities such as magnetic media e.g. key diskettes servers connected to the Internet smart cards etc.

The access control programs of the host system may be used to control which of the information authorities and are permitted to communicate with the portable authorization device . The access control programs may also be used to control the order in which the information authorities are to be accessed by the portable authorization device. The access control programs can be configured with this information by the software vendor prior to delivery of the respective items of protected information to the user.

A physical direct information authority can be a relatively small simple and transportable device that stores authorization information and other data associated with one or more items of protected information for transmission to the portable authorization device . The direct information authority is direct in that it communicates directly with the portable authorization device rather than through some intermediary device. The physical direct information authority interfaces with the portable authorization device by being placed either in direct contact with or in close physical proximity to the authorization device. The physical direct information authority includes a microprocessor or dedicated logic for performing secure transactions with the portable authorization device and a memory for storing the authorization information and other data.

Unlike a conventional dongle or smart card the physical direct information authority is not required to perform or support the authorization process itself but merely can provide an item of authorization information used to perform the authorization. As a result the physical direct information authority can have more modest hardware and software requirements than either a dongle or a smart card and can be smaller and less expensive. Examples of physical direct information authorities include smart cards as well as devices with more rudimentary processing and storage capabilities than smart cards.

The physical direct information authority is typically supplied to the end user by the vendor of the item of protected information together with the protected information. The physical direct information authority may be referred to as a license chip as it in effect confers a license to use the item of protected information .

The physical indirect information authority and the networked indirect information authority are devices that communicate with the portable authorization device through the host system and are thus indirect. The access control programs of the host system control which one of the indirect information authorities or communicates with the portable authorization device at any given time. The access control programs also provide the communication protocol for communications between the indirect information authorities and and the host system .

The physical indirect information authority can be a physical medium that stores authorization information and other data associated with one or more items of protected information . In a preferred embodiment of the invention the physical indirect information authority is a magnetic medium such as the key diskette described above that is inserted into a floppy disk drive on the host system . Unlike conventional key diskettes however the physical indirect information authority transfers the authorization information to the portable authorization device rather than to the host system for storage. The physical indirect information authority is significantly less expensive than a dongle due to its relative simplicity. The physical indirect information authority is typically supplied by the vendor of the item of protected information together with the protected information.

The networked indirect information authority can be a system such as a computer server that stores authorization information and other data associated with one or more items of protected information . Unlike conventional networked schemes however the networked indirect information authority transmits the authorization information to the portable authorization device rather than to the host system for storage. The networked indirect information authority is connected to a network such as the Internet and communicates with the portable authorization device via the network the host system and the host system interface circuit . The networked indirect information authority is typically operated by the vendor of the item of protected information .

In a presently preferred embodiment of the invention the authorization information stored in the information authority comprise dynamic key selectors. The dynamic key selectors do not themselves authorize the use of the protected information on the host system but are used to generate the secret keys that perform such authorization. As described in detail below the portable authorization device uses one of the dynamic key selectors to generate a secret key i.e. an item of generated authorization information for authorizing the use of the item of protected information . Thus unlike the security device of the 891 patent described above which merely duplicates the enabling ability of the smart cards that it reads the portable authorization device is capable of generating the authorization information internally. An advantage of this feature is that it prevents the generated authorization information from being intercepted during transmission thereby providing the authorization system with increased security.

The authorization process involves two basic steps. First the information authority transfers the authorization information to the portable authorization device for storage therein step . This step is referred to as a key exchange. The end user initiates the key exchange by establishing a connection between the information authority and the portable authorization device for example by inserting the direct information authority into a reader on the portable authorization device . Second the portable authorization device authorizes the host system to use the item of protected information step . The end user initiates this step by connecting the portable authorization device to the host system . After this process is completed the end user is permitted to use the item of protected information on the host system as required. The first and second steps of the process do not need to be performed consecutively and in addition may be performed using different host systems .

The host system interface circuit and the direct message interface circuit provide an electrical interface to the host system or the physical direct information authority respectively. In a preferred embodiment of the invention the host system interface circuit may consist of a USB connector and associated circuitry that connects to a USB port on the host system . The direct message interface circuit in this embodiment may consist of a card reader and associated circuitry.

 1 Host command processor . The host command processor is the main processing component of the portable authorization device and manages the operation of the other program ROM components. The host command processor through the host system interface receives and processes commands sent by the access control program of the host system . The host command processor includes security routines to ensure that the access control program cannot overstep its authority in controlling the portable authorization device however.

 2 Host system interface . The host system interface provides a communications protocol for the portable authorization device to communicate with the host system . The host system interface in conjunction with the access control programs of the host system is also used for communications with the physical and networked indirect information authorities and . The access control programs handle the portion of the communications occurring between the host system and the indirect information authorities and . Information is transmitted between the portable authorization device and the host system via the host system interface circuit . In a preferred embodiment of the invention that uses a USB port the host system interface communicates with the host system using a USB communications protocol.

 3 Key manager . The key manager coordinates the storage removal and verification of dynamic key selectors i.e. authorization information dynamic user data and other data in the storage medium . The key manager coordinates the storage and removal of dynamic key selectors during key exchange operations between the portable authorization device and the information authorities and as described below. The key manager also coordinates the transfer of dynamic key selectors during the host system authorization process.

 4 Host authenticator . The host authenticator is used to verify the identity of i.e. authenticate the physical and networked indirect information authorities and so that secure and trusted communications can be established between the portable authorization device and the information authorities. The authentication process is performed to prevent the portable authorization device from inadvertently transmitting confidential information to an unauthorized source and breaching the security of the device. The authentication process is performed before the portable authorization device is allowed to exchange information e.g. dynamic key selectors with the physical and networked indirect information authorities and . If the authentication is successful and if the operation being performed involves the transfer of dynamic key selectors to or from the storage medium the host authenticator then calls the key manager to perform the transfer. In a preferred embodiment of the invention the host authenticator performs the authentication using a challenge response transaction which is a technique known in the art for establishing trusted communications between devices. The challenge response transaction uses a fixed secret key see shared by both the portable authorization device and the indirect information authorities and to authenticate the information authority. In other embodiments of the invention the host authenticator may use other authentication methods such as exchanging passwords.

 5 Key encryptor . The key encryptor is used to encrypt and decrypt or more generally encode and decode the dynamic key selectors i.e. authorization information dynamic user data and other associated data in the storage medium . The key encryptor performs the encryption and decryption using any of the conventional types of encryption algorithms known in the art such as block cipher stream cipher or public key algorithms. The particular algorithm used is unique to the individual portable authorization device . In a presently preferred embodiment of the invention the key encryptor is also used to blend and unblend the dynamic key selectors as explained below.

 6 Host authorizer . The host authorizer is used to authorize the host system to use the item of protected information . The authorization process includes generating the secret key from the dynamic key selector associated with the item of protected information . The host authorizer performs the authorization using a challenge response transaction. The host authorizer works with the key manager to find and retrieve the dynamic key selector from the storage medium .

 7 Direct information authority interface . The direct information authority interface provides a communications protocol for the portable authorization device to communicate with the physical direct information authority . Information is transmitted between the portable authorization device and the direct information authority via the direct information authority interface circuit . In a preferred embodiment of the invention the direct information authority interface communicates with the physical direct information authority using an I2C serial communications protocol.

 8 Direct information authority authenticator . The direct information authority authenticator is used to verify the identity of i.e. authenticate the physical direct information authority so that secure and trusted communications can be established between the portable authorization device and the direct information authority. The authentication process is performed before the portable authorization device is allowed to allowed to exchange information e.g. dynamic key selectors with the direct information authority . If the authentication is successful and if the operation being performed involves the transfer of dynamic key selectors to or from the storage medium the direct information authority authenticator then calls the key manager to perform the transfer. In a preferred embodiment of the invention the direct information authority authenticator performs the authentication using a challenge response transaction. The challenge response transaction uses a fixed secret key see shared by both the portable authorization device and the direct information authority to authenticate the information authority.

 9 Message manager . The message manager regulates which messages e.g. dynamic key selectors transmitted by the information authorities and can be processed by the portable authorization device . Conversely the message manager also regulates which messages can be transmitted by the portable authorization device for processing by the information authorities. The message manager performs this regulation by determining whether the messages are authorized for use with the portable authorization device and halting the processing of those messages without proper authorization. If a message is determined to be authorized the message manager then calls the direct information authority authenticator to perform the authentication of the information authority .

 2 Fixed secret key . The fixed or shared secret key is a secret key that is known and stored in i.e. shared by both the portable authorization device and the information authorities and . The fixed secret key is used to generate a response message as part of a challenge response transaction used for authenticating the information authority as explained below. The fixed key ID and fixed secret key are encrypted using a conventional encryption algorithm.

 3 Fixed user data . The fixed user data is used to store alphanumeric strings or other data not related to the authorization function of the portable authorization device . The fixed user data may include a manufacturing secret key which identifies the particular product type of the portable authorization device and a serial number that uniquely identifies the individual portable authorization device. The fixed user data is preferably not encrypted.

 4 Password . The password is set by the end user and is unique to the individual portable authorization device . The password protects the portable authorization device against unauthorized use as explained below.

 5 Dynamic seed . The dynamic seed is mathematically combined with one of the dynamic key selectors i.e. authorization information to generate the secret key i.e. generated authorization information . The dynamic seed is unique to the individual portable authorization device .

 6 Dynamic key selector data . In a preferred embodiment of the invention the dynamic key selector data comprises blended and encrypted dynamic key selectors i.e. authorization information stored in the storage medium . In other embodiments with lesser security requirements the dynamic key selectors may be stored in the storage medium without blending. Each item of dynamic key selector data comprises data derived from the blending two or more of the dynamic key selectors . The dynamic key selectors are blended in a systematic way such that the dynamic key selector data cannot be partitioned into segments exclusively associated with individual dynamic key selectors. The dynamic key selectors may be blended using any of a variety of mathematical algorithms known in the art ranging from simple to complex. The blending algorithm selected depends on the degree of security required and the processing and storage capabilities of the portable authorization device . An exemplary blending algorithm is described below in association with . The dynamic key selectors are encrypted using a conventional encryption algorithm. The encryption and blending of the dynamic key selectors are performed by the key encryptor stored in the program ROM . The dynamic key selector data may also include the key IDs associated with the dynamic key selectors . The key IDs are preferably not encrypted or blended. An advantage provided by the blended dynamic key selector data is that it prevents unauthorized access to and tampering with the dynamic key selectors thereby increasing the security of the portable authorization device .

 7 Dynamic user data . The dynamic user data comprises miscellaneous data stored in the storage medium . The structure of the dynamic user data is not necessarily formalized and can be adapted for a variety of uses by the manufacturer of the portable authorization device . In one preferred embodiment the dynamic user data may comprise data pertaining to the end user of the portable authorization device such as registration information. This data may be transmitted back to the information authority for retrieval and use by the software vendor. In another preferred embodiment the dynamic user data may comprise data that enables specific security options in the portable authorization device . The dynamic user data is preferably encrypted to prevent unauthorized access to the dynamic user data stored in the storage medium . The dynamic user data is encrypted using the key encryptor stored in the program ROM .

In a presently preferred embodiment of the invention the storage medium of the portable authorization device is specific to that individual authorization device. In this embodiment the processing unit is a secure microcontroller in which the key encryptor stored in the program ROM can be read only with proper authorization. Consequently even if an unauthorized user copies the encrypted data stored in the storage medium to a second portable authorization device the second device cannot access the data because the unauthorized user cannot copy the key encryptor used to decrypt the data. An advantage of this feature is that it prevents an unauthorized copy of the dynamic key selectors dynamic user data and other encrypted data stored in the storage medium from being made and used in a duplicate portable authorization device .

The dynamic user data is composed of two fields a 56 bit feature enable field shown as XXXXXXXXXX and an 8 bit feature credit counter shown as YY the X and Y represent hexadecimal numbers . The feature enable field allows the end user to enable individual products or features by setting the appropriate bits of the feature enable field . The software developer decides the exact meaning of each bit of the feature enable field i.e. what the bit enables . For example bit of the feature enable field can be used to turn on a first feature of the host software program and bit can be used to activate a second feature. The procedure for using this feature will be described later.

It should be noted that although the direct information authority appears similar to the portable authorization device in this embodiment the direct information authority can be constructed of components having significantly less processing and storage capabilities than those required by the portable authorization device. This is because the portable authorization device participates in the authorization process itself which is a rather complex process while the direct information authority merely supplies an item of authorization information that is used in the authorization process.

The direct information authority executes several functional components during its operation in a presently preferred embodiment of the invention. In this embodiment the functional components are implemented as groups of program instructions stored in the program ROM that are executed by the processing unit . In other embodiments the functional components may be implemented with varying combinations of hardware and software. The functional components of the direct information authority include not shown 

 1 Authorization device interface. The authorization device interface provides a communications protocol for the direct information authority to communicate with the portable authorization device . Information is transmitted between the direct information authority and the portable authorization device via the authorization device interface circuit .

 2 Authorization device authenticator. The authorization device authenticator is used to verify the identity of i.e. authenticate the portable authorization device so that secure and trusted communications can be established between the direct information authority and the portable authorization device . The authentication process is performed before the direct information authority is allowed to access the dynamic key selectors i.e. authorization information and other information stored in the portable authorization device . In a preferred embodiment of the invention the authorization device authenticator performs the authentication using a challenge response transaction. The challenge response transaction uses the fixed secret key shared by both the direct information authority and the portable authorization device to authenticate the portable authorization device.

 1 Key ID . The key ID is used to specify the identity of the desired dynamic key selector during a challenge response transaction as explained below.

 2 Dynamic key selector i.e. authorization information . The dynamic key selector is associated with an item of protected information . The dynamic key selector is transmitted to the portable authorization device during a key exchange.

 3 Key authorization counter . The key authorization counter is used to keep track of and limit the number of times the dynamic key selector can be transferred to a portable authorization device .

 4 User data . The user data is used to replace or update the dynamic user data stored in the portable storage device during a key exchange as explained below.

 5 User data authorization counter . The user data authorization counter is used to keep track of and limit the number of times the user data can be used to replace or update the user data in a portable authorization device .

The key exchange process is initiated and controlled by the access control program associated with the item of protected information in conjunction with the host system . The operation of the portable authorization device during this process is conducted by the various components stored in the program ROM under the control of the host command processor . The host command processor includes security routines to ensure that the access control program cannot overstep its authority in controlling the authorization device however.

The process for transferring the authorization information is as follows. First in a present embodiment of the invention the end user connects the portable authorization device to a host system step . The portable authorization device in this embodiment receives power from the host system to operate its internal circuitry because it does not have its own power supply.

Second the end user establishes a connection between the information authority and the portable authorization device so that the devices may begin communicating with each other step . For the physical direct information authority the end user first inserts the direct information authority into the portable authorization device . The direct information authority interface of the portable authorization device then establishes communications with the direct information authority . For the physical indirect information authority the end user first inserts the physical indirect information authority into the floppy disk drive of the host system . The host system interface of the portable authorization device then establishes communications with the physical indirect information authority via the host system . For the networked indirect information authority the end user first establishes a network connection between the networked indirect information authority and the host system . The host system interface of the portable authorization device then establishes communications with the networked indirect information authority via the host system .

Third the portable authorization device authenticates the information authority using a challenge response transaction step . The authentication process verifies the identity of the information authority to establish secure and trusted communications with the authority. The direct information authority authenticator performs the authentication of the direct information authority while the host authenticator performs the authentication of the indirect information authorities and .

In a preferred embodiment of the invention the challenge response transaction for authenticating the information authority is performed as follows. First the host authenticator or the direct information authority authenticator as appropriate of the portable authorization device generates and transmits a challenge message to the respective information authority . The challenge message consists of a large randomly generated number. Second the information authority generates and sends back a response message based upon a mathematical combination of the challenge message and the fixed secret key stored in the information authority. Third the respective authenticator or determines if the response message is correct based upon the fixed secret key stored in the portable authorization device . If the response message is correct this indicates that the information authority properly contains the same fixed secret key as the portable authorization device and that the authentication is successful. Finally the portable authorization device sends a receipt indicating success or failure of the authentication to the information authority .

Fourth the portable authorization device optionally verifies that it is authorized to receive the dynamic key selector from the information authority step . During this step the information authority transmits identification information not shown associated with the dynamic key selector to the portable authorization device . In a preferred embodiment of the invention the identification information is a number used to uniquely identify the item of protected information authorized by the dynamic key selector . In this embodiment the fixed key ID stored in the storage medium is used to identify the portable authorization device . The portable authorization device then determines based on a comparison of the identification information with the fixed key ID whether the item of protected information identified by the identification information is authorized for use with the portable authorization device. Depending on the outcome of this determination the portable authorization device then authorizes or declines receipt of the dynamic key selector . The authorization process is performed by the message manager of the portable authorization device .

An advantage provided by the authorization process is that it allows the dynamic key selector to be targeted at specific types of portable authorization devices . For example the authorization process can be used is to ensure that dynamic key selectors from company A s information authority cannot be placed in company B s portable authorization device or vice versa.

Fifth if the authentication and authorization steps successfully complete the information authority determines whether the dynamic key selector already exists in the portable authorization device step . The information authority makes this determination by reading the appropriate location s in the dynamic key selector data region of the storage medium . If it does the dynamic key selector is not transferred to the portable authorization device .

Sixth if the dynamic key selector does not exist in the portable authorization device the information authority determines whether the key authorization counter stored in the storage medium is greater than zero step .

Seventh if the key authorization counter is greater than zero the information authority transmits the dynamic key selector to the portable authorization device step . The information authority encrypts the dynamic key selector using an encryption algorithm before it is transferred to prevent unauthorized access to the selector during transmission. The portable authorization device performs its part of the dynamic key selector transfer process using the key manager under the control of the message manager . During this step the key authorization counter is decremented by one. If the key authorization counter is zero however the information authority does not transfer the dynamic key selector because the maximum number of transfers has been reached.

Eighth the portable authorization device encrypts and stores the dynamic key selector in the storage medium step . Since the dynamic key selector is transmitted to the portable authorization device in encrypted form the dynamic key selector is decrypted before storage. The dynamic key selector is then encrypted using an algorithm unique to the individual portable authorization device and stored in the storage medium . The encryption and storage is performed by the key encryptor of the portable authorization device . In a presently preferred embodiment of the invention the dynamic key selector is also blended in the storage medium using the key encryptor to provide increased security. In other embodiments with lesser security requirements the dynamic key selector is not blended. The dynamic key selector is now stored in the portable authorization device so that the authorization device may be used to authorize a host system to use the item of protected information associated with the dynamic key selector .

In a presently preferred embodiment of the invention the dynamic key selectors may also be removed from the portable authorization device for transfer back to the information authority . Once the dynamic key selector is returned to the information authority the dynamic key selector can then be transferred to another portable authorization device . An advantage of this feature is that unused dynamic key selectors stored in the portable authorization device can be reused in another portable authorization device.

The dynamic key selector removal is performed by the key manager in coordination with the key encryptor . The process for transferring the dynamic key selectors back to the information authority is similar to the process for transferring the dynamic key selectors from the information authority to the portable authorization device shown in except that the fifth through eighth steps are replaced as follows steps .

Fifth if the authentication and authorization steps successfully complete the portable authorization device determines whether the dynamic key selector already exists in the information authority . If it does the dynamic key selector does not need to be transferred to the information authority . If it does not a key authorization counter is created in the storage medium of the information authority and is set to zero.

Sixth the portable authorization device locates reads and decrypts the dynamic key selector from the storage medium of the portable authorization device . The decryption is performed by the key encryptor of the portable authorization device . In a presently preferred embodiment of the invention where the dynamic key selector is blended the dynamic key selector is also unblended using the key encryptor .

Seventh the portable authorization device transfers the dynamic key selector to the information authority . The portable authorization device encrypts the dynamic key selector before it is transferred to prevent unauthorized access to the selector during transmission. The portable authorization device performs its part of the dynamic key selector transfer process using the key manager under the control of the message manager . During this step the key authorization counter is incremented by one.

Eighth the information authority encrypts and stores the dynamic key selector in the storage medium . Since the dynamic key selector is transmitted to the information authority in encrypted form the dynamic key selector is decrypted before storage. The dynamic key selector is then encrypted and stored in the storage medium . Upon completion of this step the dynamic key selector is ready for transfer to another portable authorization device .

In a presently preferred embodiment of the invention the information authority may also replace or update the dynamic user data in the storage medium of the portable authorization device following the transfer of the authorization information step of . As mentioned earlier the dynamic user data may comprise for example registration information pertaining to the portable authorization device or data for enabling security options in the authorization device. The procedure by which the dynamic user data is replaced or updated is as follows. First the user data authorization counter is transmitted from the information authority to the portable authorization device using a challenge response transaction. Second if the user data authorization counter is greater than zero the information authority uses the user data to replace or update the dynamic user data of the portable authorization device . Replacement of the dynamic user data consists of overwriting the existing user data stored in the portable authorization device . Updating of the dynamic user data consists of performing an operation on the existing user data to change its value. Whether the dynamic user data is replaced or updated depends on the nature of the user data. Third the user data authorization counter is decremented by one. If the user data authorization counter is zero however the information authority does not replace or update the dynamic user data because the maximum number of transfers has been reached.

In some embodiments of the invention it may not be necessary to replace or update the dynamic user data in the portable authorization device . For example the dynamic user data in a portable authorization device may be more recent than the user data in the information authority . In this case it would not make sense to overwrite the newer dynamic user data in the portable authorization device . As a result the developer s product will be given the opportunity through PACE Application Programming Interfaces APIs to check and avoid any dynamic user data updates that do not make sense.

In a presently preferred embodiment of the invention the portable authorization device may also transfer the dynamic user data associated with an item of protected information back to the information authority . The user data transfer is performed by the key manager of the portable authorization device . An advantage of this feature is that the software vendors for the items of protected information authorized by the portable authorization device are able to obtain information from and about the end user of the device such as registration information or the identity of the other programs or data stored on the portable authorization device .

The process for authorizing the host system is as follows. First the end user connects the portable authorization device to the host system associated with the item of protected information he or she desires to use step .

Second the end user begins executing or accessing the item of protected information such as a software program or a collection of data stored on the host system step . The access control program associated with the item of protected information halts the execution or access of the protected information however because it has not yet received the proper authorization. In a presently preferred embodiment of the invention the access control program displays messages on the host system indicating that the program or data is not authorized to be executed or accessed and prompting the end user to connect the portable authorization device to the host system to resume execution.

Third a password manager of the access control program displays a message on the host system prompting the end user to enter a password for the portable authorization device step . The password manager then verifies that the entered password is correct by checking the entered password against the password for the portable authorization device . The password is stored in encrypted form in the storage medium of the portable storage device so that it cannot be read by an unauthorized user. A user interface of the password manager allows the end user to set the password upon correctly entering the original password value. In a presently preferred embodiment of the invention the end user is required to enter a password only to use the portable authorization device for the first time on a new host system . The password requesting step is optional but is performed in a presently preferred embodiment of the invention. An advantage of this feature is that it protects against the use of the portable authorization device by an unauthorized user.

In the fourth through eighth steps described next the access control program of the host system and the portable authorization device conduct a challenge response transaction to determine whether the authorization device contains the proper authorization information for the item of protected information . In the fourth step the access control program on the host system initiates the challenge response transaction with the portable authorization device by sending a challenge message to the portable authorization device step . The challenge response transaction determines whether the portable authorization device contains the correct authorization information associated with the item of protected information . The challenge response transaction does not transmit any authorization information from the portable authorization device to the host system thereby preventing the authorization information from being intercepted by an unauthorized person. In a presently preferred embodiment of the invention the challenge message is a randomly generated number. The challenge message in this embodiment is transmitted to the portable authorization device together with the key ID associated with the item of protected information .

Fifth the portable authorization device initiates a response to the challenge message by generating the secret key from the dynamic key selector step . The portable authorization device first searches the storage medium for the dynamic key selector corresponding to the key ID . During the search the dynamic key selector data stored in the storage medium is decrypted and unblended to temporarily regenerate the dynamic key selectors . Specifically the unblending process consists of regenerating each dynamic key selector from one or more items of dynamic key selector data . This process is performed by the host authorizer in coordination with the key manager and the key encryptor .

If the correct dynamic key selector is present the portable authorization device generates the secret key using the host authorizer of the portable authorization device . The secret key is generated by mathematically combining the dynamic key selector that corresponds to the key ID with the dynamic seed . In other embodiments in which the secret key itself is stored in the portable authorization device this step is skipped. In a presently preferred embodiment containing dynamic key selector data the dynamic key selector is unblended during this step as described below.

Sixth the portable authorization device generates and transmits a response message to the host system step . The response message is generated using an algorithm that mathematically combines the challenge message and the secret key . The response message is generated by the host authorizer of the portable authorization device . In a presently preferred embodiment of the invention the response message is a mathematical combination of the challenge message and the key generated by the portable authorization device .

Seventh the access control program verifies that the portable authorization device returns a response message and further that the response message is correct step .

Eighth if the response message is correct the access control program authorizes the host system to use the item of protected information e.g. to execute the software program or access the data step .

The challenge response transaction used by the authorization process just described may be performed using one of several algorithms. In one preferred embodiment of the invention the challenge response transaction uses a symmetric algorithm. In the symmetric algorithm the secret key is the same for the host system and the portable authorization device . In another preferred embodiment the challenge response transaction uses an asymmetric algorithm. In the asymmetric algorithm the secret key for the host system is different from the secret key for the portable authorization device where a predetermined mathematical relationship exists between the two keys. An advantage of the asymmetric algorithm is that an unauthorized user cannot generate the correct response message merely by obtaining access to the secret key from the host system .

In a presently preferred embodiment of the invention the encryption algorithm used to encrypt and decrypt the dynamic key selectors stored in the storage medium may be changed in the field as required. The key encryptor in this embodiment is capable of performing a number of different encryption algorithms one of which is selected for use at any given time. The encryption algorithm is selected by transmitting encryption algorithm selection information not shown either from the information authority or the host system to the portable authorization device . The software vendor may transmit the algorithm selection information together with messages e.g. for product updates encrypted using the new algorithm. Once the encryption algorithm is changed the authorization information dynamic user data and other data encrypted using the previous algorithm cannot be used by the portable authorization device . An advantage of this feature is that it enables software vendors to readily change in the field the encryption algorithm used by the portable authorization device if the original encryption algorithm is discovered thereby making it difficult for the authorization device to be tampered with or used in an unauthorized manner.

In this embodiment the algorithm used to generate the response message during the challenge response transaction may also be changed in the field as required. The host authorizer is capable of generating the response message using a number of different algorithms one of which is selected for use at any given time. The response algorithm is selected by transmitting response algorithm selection information not shown either from the information authority or the host system to the portable authorization device . Once the response algorithm is changed the items of protected information must be replaced or updated with new versions compatible with the new algorithm to work with the portable authorization device . An advantage of this feature is that it enables software vendors to readily change in the field the response algorithm used by the portable authorization device if the original encryption algorithm is discovered thereby making it difficult for the authorization device to be tampered with or used in an unauthorized manner.

In a presently preferred embodiment of the invention following the authorization process of the portable authorization device may also transfer selected dynamic user data to the host system . The dynamic user data transferred only if requested by the software program i.e. protected information associated with the host system. The dynamic user data is transferred under the control of the host software program rather than the access control program . The host software program first sends a request to read the selected dynamic user data from the portable authorization device . The request specifies the key ID associated with the selected dynamic user data . The portable authorization device then returns the selected dynamic user data to the host system .

Referring again to the process for enabling specific features or products in a presently preferred embodiment of the invention is as follows. The bits of the feature enable field are initialized to a logic value of zero indicating that none of the features or products are enabled. Through a user interface provided by the item of protected information e.g. the host software program the end user buys or enables the desired features or products by setting the appropriate bits of the feature enable field to a logic value of one. For every feature product enabled the feature credit counter is decremented by one. Once the feature credit counter reaches zero no more features or products can be purchased or enabled for that item of protected information until the end user buys more counts via the information authorities or some other secure key authority. It should be noted that the purchase or enabling of a feature or product is final. In other words once a bit of the feature enable field is set and the feature credit counter decremented the bit cannot be traded back for a count in the feature credit counter.

The figure shows three items of dynamic key selector data and and three dynamic key selectors and shown as hexadecimal numbers . Each item of dynamic key selector data and comprises data derived from the blending of two of the three dynamic key selectors and . The items of dynamic key selector data and are stored at adjacent locations in the storage medium of the portable authorization device and are generated from the three dynamic key selectors and . The dynamic key selectors and are dynamic key selectors that are transmitted sequentially from one or more information authorities for storage in the portable authorization device . Each item of dynamic key selector data and and each dynamic key selector and is 32 bits wide. For this algorithm each item of dynamic key selector data is divided into two 16 bit halves and . Each dynamic key selector is also divided into two 16 bit halves and .

The blending procedure using this key blending algorithm is described as follows using the blending of dynamic key selectors to generate the item of dynamic key selector data as an example. The first half of the dynamic key selector data item 3333 is generated simply by transmitting the first half of the dynamic key selector 3333 . The second half of the dynamic key selector data item CCCC is generated by adding the second half of the dynamic key selector 4444 and the first half of the third dynamic key selector 8888 . Thus the item of dynamic key selector data is derived from the two dynamic key selectors and . Consequently the dynamic key selector data stored in the storage medium cannot be partitioned into segments exclusively associated with individual dynamic key selectors.

The unblending procedure using this key blending algorithm is simply the reverse of the blending procedure. The first half of the dynamic key selector 3333 is generated simply by transmitting the first half of the dynamic key selector data item 3333 . The second half of the dynamic key selector 4444 is generated by subtracting the first half of the third dynamic key selector data item 8888 from the second half of the dynamic key selector data item CCCC . Thus the dynamic key selector is derived from the two items of dynamic key selector data and .

Another alternative embodiment of the invention provides an authorization log file not shown for securely reconstructing the portable authorization device . The authorization log file is stored on the host system to which the portable authorization device is connected. An advantage of this embodiment is that it enables the portable authorization device to be securely reconstructed in case the device is misplaced or stolen.

The authorization log file consists of reconstruction data for reconstructing the authorization information stored on the portable authorization device . Specifically the authorization log file contains information identifying the items of authorization information e.g. dynamic key selectors stored in the portable authorization device . The authorization log file does not contain the items of authorization information themselves however. The authorization log file is stored in encrypted form on the hard disk drive of the host system in a hidden location. The authorization log file is generated by the portable authorization device at the request of the access control program associated with the host system .

The portable authorization device is reconstructed using the authorization log file as follows. The reconstruction is performed in a secure environment under the supervision of the manufacturer of the portable authorization device or some other authorized party. First the authorization log file is read from the hard disk drive of the host system to identify the items of authorization information stored in the original portable authorization device . Second the manufacturer or other authorized party retrieves from secure storage the items of authorization information identified by the authorization log file. Finally the retrieved items of authorization information are stored in the storage medium of the replacement portable authorization device to form a reconstruction of the original portable authorization device .

While specific embodiments of the invention have been described and illustrated it will be appreciated that modifications can be made to these embodiments without departing from the spirit of the invention. Therefore it is intended that the scope of the invention be defined by the following claims and their equivalents.

