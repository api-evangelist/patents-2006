---

title: Multi-region autofocus tool and mode
abstract: A system and method are provided for a “multi-region” autofocus video tool-type or mode within a machine vision inspection system. The user may efficiently define multiple regions of interest that are grouped as a “multi-region” set. The autofocus operations for the multi-region set are defined with a shared set of autofocus parameters. The same set of autofocus images may be used for the autofocus operations of the multi-region set. The user may conveniently also define individual autofocus regions of interest, defined with individual autofocus parameters, within the same field of view. Various user interface features allow a user to conveniently change between the individual autofocus tool-type or mode and the multi-region autofocus tool-type or mode.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07570795&OS=07570795&RS=07570795
owner: Mitutoyo Corporation
number: 07570795
owner_city: Kawasaki-shi
owner_country: JP
publication_date: 20060718
---
The invention relates generally to machine vision inspection systems and more particularly to video metrology tool modes and tools usable to define inspection operations for such systems.

Precision machine vision inspection systems or vision systems for short can be utilized to obtain precise dimensional measurements of inspected objects and to inspect various other object characteristics. Such systems may include a computer a camera and optical system and a precision stage that is movable in multiple directions so as to allow the camera to scan the features of a workpiece that is being inspected. One exemplary prior art system that is commercially available is the QUICK VISION series of PC based vision systems and QVPAK software available from Mitutoyo America Corporation MAC located in Aurora Ill. The features and operation of the QUICK VISION series of vision systems and the QVPAK software are generally described for example in the 3 published January 2003 and the 3 published September 1996 each of which is hereby incorporated by reference in their entirety. This product as exemplified by the QV 302 Pro model for example is able to use a microscope type optical system to provide images of a workpiece at various magnifications and move the stage as necessary to traverse the workpiece surface beyond the limits of any single video image. A single video image typically encompasses only a portion of the workpiece being observed or inspected given the desired magnification measurement resolution and physical size limitations of such systems.

Machine vision inspection systems generally utilize automated video inspection. U.S. Pat. No. 6 542 180 the 180 patent teaches various aspects of such automated video inspection and is incorporated herein by reference in its entirety. As taught in the 180 patent automated video inspection metrology instruments generally have a programming capability that allows an automatic inspection event sequence to be defined by the user for each particular workpiece configuration. This can be implemented by text based programming for example or through a recording mode which progressively learns the inspection event sequence by storing a sequence of machine control instructions corresponding to a sequence of inspection operations performed by a user or through a combination of both methods. Such a recording mode is often referred to as learn mode or training mode. Once the inspection event sequence is defined in learn mode such a sequence can then be used to automatically acquire and additionally analyze or inspect images of a workpiece during run mode. 

The machine control instructions including the specific inspection event sequence i.e. how to acquire each image and how to analyze inspect each acquired image are generally stored as a part program or workpiece program that is specific to the particular workpiece configuration. For example a part program defines how to acquire each image such as how to position the camera relative to the workpiece at what lighting level at what magnification level etc. Further the part program defines how to analyze inspect an acquired image for example by using one or more video tools such as edge boundary detection video tools.

Video tools or tools for short may be used manually to accomplish manual inspection and or machine control operations. Their set up parameters and operation can also be recorded during learn mode in order to create automatic inspection programs or part programs. Such tools may include for example edge boundary detection tools autofocus tools shape or pattern matching tools dimension measuring tools and the like. For example such tools are routinely used in a variety of commercially available machine vision inspection systems such as the QUICK VISION series of vision systems and the associated QVPAK software discussed above.

The currently available features and graphical user interface GUI controls for video tools and particularly dimensional metrology video tools are limited. In particular alternatives for setting up video tool regions of interest ROIs and operating parameters during learn mode or manual mode are limited. Existing alternatives may be difficult to adapt for efficient use with different applications or workpieces. Existing user interfaces may be difficult for users to understand intuitively making user learning and retention difficult. Video tools that overcome these and other disadvantages to allow more efficient intuitive and flexible use of precision machine vision inspection systems would be desirable.

Currently the users of precision machine vision inspection systems may spend a majority of their part programming time setting up video tools and adjusting their parameters. Thus even small improvements in their ease of use in comparison to their parameter customization capability their GUI features and other ergonomic factors may be highly valued. In addition even in small improvements inspection throughput are highly valued in industrial environments. Accordingly the present invention is directed toward a novel and efficient multi region autofocus video tool mode for configuring a multi region autofocus video tool in an easy to use and flexible manner. In addition the resulting multi region autofocus tool may generally be operated to provide increased throughput compared to a conventional autofocus tool.

According to one feature of the invention a system and method are provided which allow users to define and or edit tool parameters for a plurality of autofocus ROIs with a reduced number of operations. The plurality of ROIs may be readily configured by the user to have different sizes and or overlap each other etc. In one embodiment these new video tool methods may be implemented as an alternative multi region tool type or tool mode that along with a conventional tool type or mode gives users a high level of control over autofocus tool set up and operation alternatives with a simple and intuitive user interface.

According to one feature of the invention a multi region set of autofocus ROIs may be defined and or displayed while operating in a multi region autofocus tool mode. According to one feature of the invention each member ROI in the multi region set of autofocus ROIs may be governed by the same combination of autofocus operation parameters.

According to one feature of the invention an indication of the ROIs of one or more multi region sets may be displayed superimposed on the image of a portion of a workpiece that is located in the field of view of the machine vision inspection system. The indication of the ROIs belonging to the multi region set may be displayed at least while defining the members of a multi region set when adding a new member or when editing a member of the set.

According to one feature of the invention the indication of the member ROIs and or the operation of the multi region tool mode in general may be provided by displaying at least one line linking the ROIs of a multi region set by displaying the member ROIs in the same color by displaying the member ROIs with a similar line type or by drawing a boundary around the multi region set or the like.

According to various features of the invention a new multi region set of ROIs may be defined and or displayed when the user selects or continues in the multi region autofocus tool mode of operation as the current mode of operation and defines a first member ROI of the new multi region set. The user may then define a second member ROI while the current mode of operation is the multi region autofocus tool mode. The user may also interrupt the multi region autofocus tool mode and perform an operation unrelated to this mode. The user may subsequently resume the multi region autofocus tool mode and define an additional member of the set.

According to one feature of the invention the user may toggle the multi region autofocus tool mode on by toggling the mode button or by simply selecting a member of an existing multi region autofocus set. The user may subsequently define an additional member of that set revise its operating parameters etc.

According to one feature of the invention the user may toggle the multi region autofocus tool mode off by toggling the mode button or by simply selecting the ROI of an existing individual mode autofocus tool or another type of video tool. The user may subsequently revise the operating parameters of the individual mode autofocus ROI or other tool or perform other operations as desired.

According to one feature of the invention autofocus operations to determine the respective Z coordinates associated with the respective ROIs of a multi region set may include acquiring a set of images over a Z height search range that is estimated or defined to include a plurality or all of the expected Z height values corresponding to the multi region set. The set of images may be acquired during continuous motion over the Z height search range. A plurality or all of the set of images may be analyzed to determine the Z height for each respective ROI. The analysis may begin before the set of images is complete if desired. The search range may be set to a default range or defined by a user or defined based on operations during learn mode e.g. based on the Z height positions used while defining a multi region set or by one or more automatic autofocus operations or the like . A default range may be determined based at least partially on a current optical configuration.

According to one feature of the invention the user interface may provide one or more means for the user to select an ROI of a multi region set for editing whereby the user may modify the location and dimensions of the ROI define an estimated Z height to be associated with that ROI or the like.

According to one feature of the invention a user may select an accuracy level for the autofocus calculations associated with multi region set. This may be advantageous because the higher accuracy levels require the images used for autofocus analysis to be more closely spaced and may require more calculations. Thus if the user judges that lower accuracy levels are sufficient the throughput may be increased.

According to one feature of the invention the user interface may provide the user with a plurality of autofocus measurement options for a multi region set. In a first option a Z height value may be determined for each ROI in a multi region set. This provides information that the user of the machine vision inspection system may use to adjust the machine to a Z position that matches the Z height value of any selected member of the multi region set or may simply allow the output of any or all of the Z height values as measurement values. In a second option the maximum Z height value may be determined among the set of ROIs. The machine vision inspection system may then be adjusted to a Z position that matches the maximum Z height value or may simply return the maximum Z height value as a measurement value. In a third option the minimum Z height value may be determined among the set of ROIs. The machine vision inspection system may then be adjusted to a Z position that matches the minimum Z height value or may simply return the minimum Z height value as a measurement value. Additional options may include determining the maximum minimum difference value or average Z height value etc.

The vision measuring machine includes a moveable workpiece stage and an optical imaging system which may include a zoom lens or interchangeable lenses. The zoom lens or interchangeable lenses generally provide various magnifications for the images provided by the optical imaging system . The machine vision inspection system is generally comparable to the QUICK VISION series of vision systems and the QVPAK software discussed above and similar state of the art commercially available precision machine vision inspection systems. The machine vision inspection system is also described in copending and commonly assigned U.S. patent application Ser. No. 10 978 227 which is hereby incorporated herein by reference in its entirety. Various aspects of vision measuring machines and control systems are also described in more detail in copending and commonly assigned U.S. patent application Ser. Nos. 10 808 948 filed Mar. 25 2004 and Ser. No. 10 632 823 filed Aug. 4 2003 which are also hereby incorporated herein by reference in their entirety. As previously indicated the users of such general purpose precision machine vision inspection systems are often occasional and or inexperienced users. Such users may spend a majority of their programming time refreshing their understanding of video tools setting up their ROIs adjusting their parameters etc. Thus even small improvements in the intuitiveness of their graphical user interface and or their overall ease of use in comparison to their parameter customization capability their user interface options and other ergonomic factors may be highly valued.

A workpiece that is to be imaged using the machine vision inspection system is placed on the workpiece stage . One or more of a stage light a coaxial light and a surface light may emits source light or respectively to illuminate the workpiece . The source light is reflected or transmitted as workpiece light which passes through the interchangeable objective lens and the turret lens assembly and is gathered by the camera system . The image of the workpiece captured by the camera system is output on a signal line to the control system portion . The light sources and may be connected to the control system portion through signal lines or busses and respectively.

When it is included in the optical assembly portion the turret lens assembly may include at least a first turret lens position and lens and a second turret lens position and lens . To alter the image magnification the control system portion may rotate the turret lens assembly along axis between at least the first and second turret lens positions through a signal line or bus .

In various exemplary embodiments the optical assembly portion is movable in the vertical Z axis direction relative to the workpiece stage using a controllable motor that drives an actuator a connecting cable or the like to move the optical assembly portion along the Z axis to change the focus of the image of the workpiece captured by the camera system . The term Z axis as used herein refers to the axis that is intended to be used for focusing the image obtained by the optical assembly portion . The controllable motor when used is connected to the input output interface via a signal line .

As shown in in various exemplary embodiments the control system portion includes a controller an input output interface a memory a workpiece program generator and executor and a power supply portion . It will be appreciated that each of these components as well as the additional components described below may be interconnected by one or more data control buses and or application programming interfaces or by direct connections between the various elements.

The input output interface includes an imaging control interface a motion control interface a lighting control interface and a lens control interface . The motion control interface includes a position control element and a speed acceleration control element . However it should be appreciated that in various exemplary embodiments such elements may be merged and or indistinguishable. The lighting control interface includes lighting control elements which control for example the selection power on off switch and strobe pulse timing if applicable for the various corresponding light sources of the machine vision inspection system such as the light sources and .

The memory includes an image file memory portion a workpiece program memory portion that may include one or more part programs or the like and a video tool portion . The video tool portion includes tool portion and other similar tool portions not shown which determine the GUI image processing operation etc. for each of the corresponding tools. The video tool portion also includes a region of interest generator that supports automatic semi automatic and or manual operations that define various ROIs that are operable in various video tools included in the video tool portion .

In particular in various embodiments according to this invention the video tool portion includes the autofocus tools portion which provides various operations and features related to multi region autofocus operations as described in greater detail below. In one embodiment the autofocus tools portion may include an autofocus mode control a multi region autofocus tool and an individual autofocus tool . Briefly the individual autofocus tool performs operations associated with a single autofocus ROI and may operate similarly to known autofocus tools. The multi region autofocus tool performs operations associated with a multi region set of ROIs as disclosed herein and may be configured and operated more efficiently than previously known autofocus tools. The autofocus mode control performs operations as disclosed herein to determine which of the autofocus tools that is the multi region autofocus tool or the individual autofocus tool or tool modes is activated.

It should be appreciated that alternative configurations are possible for the autofocus tools portion . For example the multi region autofocus tool and the individual autofocus tool may include mode control functions such that a separate mode control portion may be omitted. Alternatively the autofocus tools portion may provide one or more generic autofocus tool elements and the mode control portion may provide operations that govern the user interface and interrelationships of the generic autofocus tool elements in a manner the depends on whether multi region autofocus tool behavior or individual autofocus tool behavior is desired. In such a case the circuits routines or applications that provide the operations of the multi region autofocus tool and or the individual autofocus tool may be merged and or indistinguishable. More generally this invention may be implemented in any now known or later developed form that is operable in conjunction with the machine vision inspection system to provide the features disclosed herein in relation to the multi region autofocus operations.

In general the memory portion stores data usable to operate the vision system components portion to capture or acquire an image of the workpiece such that the acquired image of the workpiece has desired image characteristics. The memory portion further stores data usable to operate the machine vision inspection system to perform various inspection and measurement operations on the acquired images either manually or automatically and to output the results through the input output interface . The memory portion also contains data defining a graphical user interface operable through the input output interface .

The signal lines or busses and of the stage light the coaxial light and the surface light respectively are all connected to the input output interface . The signal line from the camera system and the signal line from the controllable motor are connected to the input output interface . In addition to carrying image data the signal line may carry a signal from the controller that initiates image acquisition.

One or more display devices and one or more input devices can also be connected to the input output interface . The display devices and input devices can be used to display a user interface which may include various graphical user interface GUI features that are usable to perform inspection operations and or to create and or modify part programs to view the images captured by the camera system and or to directly control the vision system components portion . In a fully automated system having a predefined part program or workpiece program the display devices and or the input devices may be omitted.

In various exemplary embodiments when a user utilizes the machine vision inspection system to create a workpiece image acquisition program for the workpiece the user generates workpiece program instructions either by explicitly coding the instructions automatically semi automatically or manually using a workpiece programming language or by generating the instructions by moving the machine vision inspection system through an image acquisition training sequence setting light levels and the like such that the workpiece program instructions capture the training sequence. This process is repeated for multiple images in a set of images that are to be captured. These instructions when executed will cause the machine vision inspection system to manipulate the workpiece stage and or the camera system at certain speed s such that a particular portion of the workpiece is within the field of view of the camera system and at a desired focus state for each of a set of images to be acquired.

Once a set of workpiece image acquisition instructions are defined the control system executes the instructions and commands the camera system to capture one or more images of the workpiece according to the instructions. The control system will then under control of the controller input the captured image s through the input output interface and store the captured image s in the memory . The controller may also display the captured images on the display device .

The control system portion is further usable to recall captured and stored workpiece inspection images to inspect and analyze workpiece features in such workpiece inspection images and to store and or output the inspection results. These analysis and inspection methods are typically embodied in various video tools included in the video tool portion of the memory including the autofocus tools and . Many exemplary tools are included in commercially available machine vision inspection systems such as the QUICK VISION series of vision systems and the associated QVPAK software discussed above. After the image inspection analysis operations using one or more of these video tools are completed the control system outputs the results of each analysis inspection operation to the input output interface for outputting to various display devices such as a video display printer and the like. The control system may also store the results of each inspection operation in the memory .

In operation an exemplary tool mode referred to as a multi region autofocus tool mode herein may be activated when the tool type icon and or the multi region autofocus tool mode icon on a video tool bar is selected as described below with reference to . A multi region autofocus tool indicator cursor as shown in may then appear on the displayed FOV . The multi region autofocus tool indicator cursor may include a multi region symbol associated with a cursor and or a conventional cursor which may appear as a cross hair or the like at a cursor point. The cursor point may provide coordinates that are used by the multi region autofocus tool to the define the parameters of the member ROIs of the multi region set of autofocus ROIs as described in greater detail below. In general for the various tools shown and described herein a multi region autofocus tool indicator cursor may continue to appear in a display at a cursor point throughout various operations described herein even if it is omitted from a figure in order to more clearly illustrate other features of the figure.

Throughout this disclosure an ROI and its corresponding user interface ROI indicating box may be referred to interchangeably. For example the element marked in may be referred to as the ROI and or as the ROI indicating box and the meaning in each instance will be clear based on context.

Unless otherwise indicated by description or context throughout this disclosure placing a point may generally comprise the user entering the coordinates of a desired point to be used by a multi region autofocus tool for determining one or more autofocus tool parameters e.g. the location and size of an autofocus ROI . In exemplary embodiments the user may generally move an input device such as a mouse joystick trackball or the like to move the indicator cursor around on a display of a workpiece feature such as the surfaces and . When the user has positioned the cursor at a desired position the user may then click an input device button or press enter on a keyboard or the like in order to place a point at the desired position. Placing a point may anchor a tool parameter indicator at the position of the placed point as described below.

The term parameter indicators is used herein to refer to the graphical features of the user interface of an autofocus tool or an autofocus tool GUI that correspond to the current user determined or machine determined or derived or default tool parameters. For example for the ROI the parameter indicators shown in may include the upper end lower end and sides of the ROI indicator box . At various times the cursor display may be merged with or indistinguishable from various parameter indicators of the autofocus tool GUI. This might alternatively be described or implemented as using the cursor as a parameter indicator in the GUI at various times or as the cursor representation changing to indicate various parameters or as the various parameter indicators following the cursor. All of these descriptions may fall within the scope of this invention if they serve to implement the various features and operations of the invention outlined herein.

In various embodiments it is not necessary that each corresponding surface area is in focus while defining the various member ROIs . However in some embodiments the user interface may include a feature that allows a user to indicate that at least one of the ROIs is in focus at the time that it is defined and the corresponding Z height may then automatically be used in establishing the Z height search range that is used for performing the multi region autofocus operations described further below. For example the Z height corresponding to a focused ROI may be used as the middle of a Z height search range that is determined based on a current optical configuration of the machine. In some embodiments if different Z height positions are used when various member ROIs are defined then in some embodiments the multi region autofocus tool may automatically assume that the different Z heights are each useful focus heights and the Z height search range may be automatically defined e.g. by a default procedure such that each of the different Z height positions is included within the Z height search range.

After all parameters of the multi region autofocus tool are set to the satisfaction of the user the tool may be run to automatically teach or train the tool and or to provide manual inspection results. The user may then accept the training results and continue to other operations or reject the training results further modify the tool parameters and retrain the tool until satisfactory results are achieved. When results are satisfactory the ROI parameters of the members of the multi region set and associated trained tool parameters for the set may be recorded in a part program according to known methods.

In various embodiments if the creation of a multi region set is interrupted by the user selecting an incompatible tool or an ROI not included in the a multi region set or the like then when the multi region autofocus mode is resumed new ROIs may be added to the same multi region set by default. In various embodiments a multi region set can be closed or finished by running or training the multi region autofocus tool for that multi region set. Subsequently new ROI s created in the multi region autofocus mode will form a new multi region set. However if the user then selects a member of the closed multi region set then additional ROIs may subsequently be added to that set until it is again closed by running or training.

The tabbed portion may also allow the user to influence the determination of the Z height search range that is used for autofocus operations for the multi region set. As previously outlined multi region autofocus tool operations may provide high efficiency and throughput by acquiring a single shared set of images distributed along a Z height search range that includes the respective Z coordinates also referred to as Z heights associated with the respective ROIs of a multi region set. The set of images may be analyzed in each of the member ROIs to determine their respective Z heights for example based on analyzing their respective focus curves according to known methods. In one method the shared set of workpiece images is analyzed to estimate a respective best focus Z height for each respective member ROI by determining a respective focus curve for each respective member ROI of the first multi region set of autofocus ROIs based on the shared set of workpiece images. Then each respective best focus Z height is determined based on the corresponding respective focus curve. For example a respective best focus Z height may be an interpolated Z height corresponding to the peak of a respective focus curve. The respective focus curve may be a curve fit to a respective set of focus metric data points determined for a respective ROI in each image of the shared set of images. Various techniques usable in conjunction with this invention for the acquisition of such a set of images and the determination and analysis of focus curves are taught in U.S. Pat. No. 6 542 180 which is hereby incorporated herein by reference in its entirety. The shared set of images may be acquired during continuous motion over the Z height search range. In the embodiment shown in the user may accept and or select that a default search range be determined and used or that the search range be based on a nominal or range midpoint value entered by the user or that the search range be based on maximum and minimum values entered by the user.

In one embodiment the nominal and or maximum and minimum values entered by the user are values specific to the currently selected member ROI. For example the nominal value may be the expected Z height value for the selected ROI and the maximum and minimum values may correspond to the ends of its fabrication tolerance range. In such an embodiment the multi region autofocus tool operates to analyze the set of such values corresponding to the set of member ROIs and to determine a search range such that it includes all the values in the set.

In another embodiment the nominal and or maximum and minimum values entered by the user are global values that are applied to the entire multi region set. In such an embodiment a value may be altered for all members of a multi region set whenever it is altered for one of the members. For example the nominal value may be an average or approximate Z height value expected for the member ROIs and or the maximum and minimum values may define a search range that the user expects will include all the respective Z heights of the member ROIs.

In various embodiments the multi region autofocus tool may determine a default search range based on operations during manual mode and or learn mode set up of the tool. In various embodiments the default search range may be determined based on the Z height position s used while graphically defining a multi region set of autofocus ROIs. In such embodiments it may be preferred that at least one of the ROIs is in focus when defining the ROIs graphically as outlined above. The corresponding Z height may then be used in establishing the default Z height search range e.g. as its midpoint . In one embodiment if different Z height positions are used when various member ROIs are defined the multi region autofocus tool may assume that the different Z heights are each useful focus heights and the default Z height search range may be automatically defined such that each of the different Z height positions is included within the search range.

In any case above where the search range is not completely defined by user input multi region autofocus tool operations may determine the Z height search range based on the current machine optical configuration e.g. the current depth of field or magnification and or workpiece information e.g. expected surface height variations due to fixturing or fabrication variations or the like in order to provide an efficient search range that also includes enough range to allow for robust operation with reasonable variations in the ROI Z heights during measurement and or part program execution.

For all the tabbed portions the Defaults button at the bottom restores the entries on the tabbed portions and to their default values the OK button accepts the current parameters and closes the autofocus parameter dialog box and the Cancel button returns all parameters to their state before the current editing sequence began and closes the dialog box .

It should be appreciated that although the individual autofocus ROI is shown not to overlap with any of the multi region member ROIs in the example shown in more generally in various embodiments any autofocus ROI defined in any mode may overlap any other ROI and the various features described previously may be unchanged.

In the previously described embodiment the multi region autofocus tool type may be provided by activating a combination of an autofocus video tool type button or icon and a multi region autofocus tool mode button or icon. The individual autofocus tool type may be provided by activating an autofocus video tool type button or icon without activating the multi region autofocus tool mode button or icon. However in various other embodiments a multi region autofocus tool type may be provided by activating a first single button that provides the multi region autofocus tool type directly and the individual autofocus tool type may be provided by activating a second single button that provides individual autofocus tool type directly. That is no mode button would be required.

In the embodiment shown in for each individual autofocus ROI the related autofocus tool parameters comprise location parameters and basic autofocus parameters . The features of the parameters and user interfaces corresponding to the elements and may be analogous to those of the elements and respectively. The individual autofocus tool mode also includes an individual autofocus tool editing mode interface and operations which may operate in a manner analogous to the multi region editing element . Other individual autofocus parameters edit mode features and or user interfaces may be implemented based on the known individual autofocus tools used in commercially available systems if desired.

The field of view window includes an exemplary multi region set of ROIs superimposed upon the workpiece image including a member ROI A that has been selected by a user for editing as previously described. In various embodiments when the user selects a multi region autofocus ROI for editing the user interface may automatically display an autofocus parameter dialog box such as the previously described parameter dialog box as shown in or an analogous dialog box if an individual autofocus ROI is selected.

While exemplary user interface features and sequences of operations have been outlined when describing various exemplary embodiments of autofocus tools with reference to it will be appreciated that in other exemplary embodiments certain operations may be performed in other sequences and or one or more of the described operating features or GUI features may be omitted and the other inventive aspects of the methods and GUI s disclosed herein may still provide substantial benefits. Thus while the preferred embodiment of the invention has been illustrated and described it will be appreciated that various changes can be made therein without departing from the spirit and scope of the invention.

