---

title: Method and apparatus for partial memory power shutoff
abstract: A method for managing host system power consumption is provided. The host system includes host memory and external memory. The method initiates with providing a processor in communication with a memory chip over a bus. The memory chip is external memory. Then, a usage measurement of the external memory is determined. If the usage measurement is below a threshold value, the method includes copying data from the memory chip to the host memory and terminating power to the memory chip. In one embodiment, the power is terminated to at least one bank of memory in the memory chip. In another embodiment, an amount of reduction of the external memory can be determined rather than a usage measurement. In yet another embodiment, an address map is reconfigured in order to maintain a contiguous configuration. A graphical user interface and a memory chip are provided also.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07590815&OS=07590815&RS=07590815
owner: NVIDIA Corporation
number: 07590815
owner_city: Santa Clara
owner_country: US
publication_date: 20060405
---
This patent application is a Continuation of co pending commonly owned patent application Ser. No. 10 232 504 filed on Aug. 30 2002 entitled METHOD AND APPARATUS FOR PARTIAL MEMORY POWER SHUTOFF by Abraham B. de Waal which is incorporated herein by reference.

This invention relates generally to power management and more particularly to a method and apparatus to reduce the power consumption of portable devices to increase battery life by turning off power to at least a subset of memory associated with the portable devices.

Portable electronic devices rely on batteries to provide the necessary power for the operation of the device. Consumers using the portable devices want to be able to use the devices for longer time periods in between having to recharge the batteries. As such there is a continual effort to increase battery performance and to perform the operations in more energy efficient ways as the applications performed by the devices become more sophisticated and in some cases require more power. For example some portable devices are configured to go into a sleep mode when they are inactive after certain time periods such as laptop computers. Additionally the clock speed can be driven down during these sleep modes to further reduce power consumption.

However the power saving modes currently in use are active modes. That is the power saving modes do not actually shut the component off. Instead the power saving modes put the component into a sleep mode. Although the sleep modes may reduce the power used the devices are still active in the sleep mode. Accordingly the devices are still consuming power at a reduced consumption rate.

As a result there is a need to solve the problems of the prior art to provide a method and apparatus for reducing the power consumption of battery operated computer electronic devices so that that battery life can be extended by terminating power to certain components.

Broadly speaking the present invention fills these needs by providing a method and apparatus for extending the battery life through the management of power consumption. It should be appreciated that the present invention can be implemented in numerous ways including as a process a system or a device. Several inventive embodiments of the present invention are described below.

In one aspect of the invention a method for managing host system power consumption is provided. The host system includes host memory and external memory. The method initiates with providing a processor in communication with a memory chip over a bus wherein the memory chip is external memory. Then a usage measurement of the external memory is determined. If the usage measurement is below a threshold value the method includes copying data from the memory chip to the host memory and terminating power to the memory chip. In one embodiment the power is terminated to at least one bank of memory in the memory chip. In another embodiment an amount of reduction of the external memory can be determined rather than a usage measurement being determined. In yet another embodiment an address map is reconfigured in order to maintain a contiguous configuration. In still yet another embodiment the threshold value can be set by the operating system.

In another aspect of the invention a method for managing host system power consumption is provided. The method initiates with providing a processor in communication with a first memory chip over a first bus and a second memory chip over a second bus the first and second memory chips being external memory. Then a usage measurement of the external memory is determined. If the usage measurement is below a threshold value the method includes copying data stored in the first memory chip to the second memory chip and terminating power to the first memory chip and the first bus. In one embodiment the power is terminated to at least one bank of memory in the memory chip. In another embodiment an amount of reduction of the external memory can be determined rather than a usage measurement being determined. In yet another embodiment an address map is reconfigured in order to maintain a contiguous configuration. In still yet another embodiment the threshold value can be set by the operating system.

In yet another aspect of the invention a method for managing host system power consumption is provided. The host system includes host memory. The method initiates with providing a processor in communication with a graphics processing unit GPU . The GPU includes memory external to the host system. The GPU memory includes at least one memory chip. Then a usage measurement of the external memory is determined. If the usage measurement is below a threshold value the method includes copying data from the at least one memory chip to the host memory remapping resource pointers in the GPU memory to point to the host memory and terminating power to the at least one memory chip. In one embodiment the power is terminated to at least one bank of memory in the memory chip. In another embodiment an amount of reduction of the external memory can be determined rather than a usage measurement being determined. In yet another embodiment an address map is reconfigured in order to maintain a contiguous configuration. In still yet another embodiment the threshold value can be set by the operating system.

In still yet another aspect of the invention a method for powering down a portion of memory of a host system is provided. The host system includes an operating system and the memory includes at least one memory chip. The method initiates with requesting an amount of the memory where the request causes the amount of the memory to become unused by the operating system. Then a translational look aside buffer is remapped so that at least some of the requested amount of memory is located in the memory chip. Next power to the memory chip is terminated.

In another aspect of the invention a graphical user interface GUI rendered by a computer system is provided. The GUI includes a user interface for selecting a power mode of the computer system. The user interface includes computer code for triggering the selection of the power mode wherein the user interface allows a user to choose between battery life and functionality. In one embodiment the user interface allows a user to choose between battery life and amount of active semiconductor memory. In another embodiment the user interface allows a user to choose between battery life and use of features in a graphics renderer.

In yet another aspect of the invention a memory chip is provided. The memory chip includes a memory core and peripheral circuitry. The peripheral circuitry is configured to remain in an on state when power to the memory core is terminated to enable signal integrity for the memory chip when the memory chip is one of a plurality of memory chips on a bus. In one embodiment passive signal integrity solutions such as termination resistors are provided.

Other aspects and advantages of the invention will become apparent from the following detailed description taken in conjunction with the accompanying drawings illustrating by way of example the principles of the invention.

An invention is described for an apparatus and method for reducing power consumption of a battery operated device. It will be obvious however to one skilled in the art that the present invention may be practiced without some or all of these specific details. In other instances well known process operations have not been described in detail in order not to unnecessarily obscure the present invention.

The embodiments of the present invention provide a method and apparatus that terminates power to a device or a subset of the components of a device to reduce power consumption without sacrificing performance. In one embodiment power to a subset of memory is turned off. Prior to turning off the power the data contained within the memory is copied into memory remaining powered. In one embodiment the memory can be associated with a graphics processing unit GPU and the data within the memory to be turned off can be copied to a central processing unit CPU in communication with the GPU. Thus resource tables containing resource pointers inside the GPU can be used to remap resources stored in graphics memory to CPU memory. In another embodiment the memory core of a memory chip is turned off while part of the peripheral circuits of the memory remain powered to enable the shutdown of a subset of memory chips on a bus without impacting the performance of the remaining powered memory chips on the bus.

Still referring to external memory chips and can be powered off in one embodiment of the invention. For example in response to detecting memory not being used the power being supplied to memory chip can be turned off. More particularly where each memory chip is a 32 megabyte MB memory chip the system can detect that 32 MB or less of the memory is being used therefore power to one of the memory chips can be turned off. In essence a switch is placed prior to either of memory chips or which terminates the power. It should be appreciated that the power to memory chip is powered off completely and the memory chip does not go into a sleep mode in this embodiment. Of course prior to turning off the power any data within memory chip is copied to memory . That is the data is backed up into main memory of device . Since the graphics memory is considered volatile the operating system OS is configured to not rely on any memory being present after a resolution change of a screen. Thus if the memory chip is powered down at that time i.e. after the resolution change then it is not necessary to back up the data to the main memory in one embodiment.

Referring the the copying of the data from memory chips and to the system memory requires that resources in GPU be updated accordingly. In turn pointers to the data must be changed so that the operating system is informed as to where the data resides. For example resource pointer identifies the location of the data and is updated to reflect the transfer of the data to memory from memory chip or memory chip . As is generally known the operating system looks to the graphics engine i.e. GPU to determine where data is located. Therefore by updating the appropriate resource pointer the operating system can locate the data which is copied into memory . It will be apparent to one skilled in the art that the resources stored in graphics memory include draw surfaces textures cached fonts video overlays etc. Alternatively an algorithm that does not require the use of resource pointer can be used here. Thus the operating system or a driver will manage the movement of resources.

It should be appreciated that the present invention can be expanded for use with the cache memory such as the L1 or L2 cache memory associated with CPU . For example L1 cache memory associated with CPU can be powered down if it is not necessary for an application being executed by the CPU. Similarly L2 cache memory can be powered down based on the application being executed by CPU . In one embodiment parts of the L1 or L2 cache are powered down rather than all of the L1 or L2 cache. As discusses in more detail with reference to a graphical user interface GUI is configured to enable a user the ability to define the power management level i.e. power mode. That is the user can determine an operating mode where certain functionality is turned off and not just put to sleep.

Still referring to as bandwidth is important in graphics processors multiple buses are used to increase memory bandwidth. However due to the multiple buses the addresses are interleaved between the separate memories. For example turning off one of two memory chips results in every other address being invalid i.e. not contiguous. Accordingly where the power for memory chips through of is turned off not only does the data from memory chips through have to be copied so as not to be lost but the geometry of address map must be reconfigured so that the memory is contiguous. Therefore address map must be reconfigured such that the fifth 16 bytes which were previously mapped to memory chip are remapped to point to memory if the contents of memory chip are copied into memory chip . It should be appreciated that where the power is turned off to memory chips through the data from memory chips through can be copied to memory chips through respectively. Alternatively the data can be copied to the main memory of a CPU in communication with GPU as discussed with reference to or B. In yet another embodiment a portion of the data can be copied to main memory and the remaining portion of the data can be copied into memory chips through . Additionally some of the data from memory chips through may be copied into main memory even though these chips remain active. Accordingly the geometry of address map must be reconfigured to represent the configuration resulting from turning off the power of to a memory chip or a set of memory chips. It should be appreciated that address map is not limited to a programmable table. In one embodiment address map can be an algorithmic function. For example odd multiples of 8 are mapped onto bus and even multiples of 8 are mapped onto bus . Thus the reorganization of the data involves moving the data so that the new algorithm produces a contiguous memory when one bus is turned off.

It should be appreciated that reserved region does not have to be contiguous. Of course prior to terminating the power to memory device the data inside memory device is copied to one or more of the other memory devices and . Then the 1 2 MB range corresponding to memory device is reserved in the CPU memory so that the CPU and the OS will proceed without using any memory within the range of the memory device to which power is terminated. In one embodiment since each of the memory devices through share a common bus the peripheral circuitry of chip is left powered as discussed with reference to . As mentioned above a passive integrity solution such as termination resistors can be used in this embodiment. While illustrates a single memory chip being powered down it should be appreciated that multiple memory chips can be shutdown. Alternatively a partial memory shutdown of a memory chip such as a dynamic random access memory DRAM chip can be accomplished where there are multiple banks of memory in the chip. Here power to one or more of the multiple banks of the memory chip can be terminated.

Still referring to it should be appreciated that memory devices through are reconfigured to reserve a complete memory chip to be shut down. In one embodiment after logical reserve region has been allocated TLB is run through or searched to find entries that map to active chips i.e. and since the operating system provided a fragmented memory region. For each of the entries that map to the active chips another TLB entry that is outside of reserve region and that points to the inactive chip i.e. chip is found. Then the values are swapped and the data moved such that logical region now has one additional page that points to the inactive chip i.e. chip . Once all of the relevant sections of TLB has been worked through as described above chip can be powered off.

If the usage measurement is below a threshold value then the method proceeds to operation where data from the memory device i.e. memory chip or memory bank within a memory chip is copied to a location that will remain powered. The data can be copied to host memory or another memory chip. For example where the external memory includes 2 32 MB memory chips and the threshold value is 32 MB if the usage measurement is below 32 MB then the data from one of the memory chips is copied to another location. As mentioned above the data can be copied to another memory chip or host memory. The method then advances to operation where power to the memory device is terminated. In one embodiment the memory device does not remain in an active state such as being put to sleep as the power is terminated here. It should be appreciated that power to a bank of memory in a memory chip can be terminated here. If the usage measurement is not below a threshold value in operation then the method will recheck the usage measurement and proceed as described above. It should be appreciated that a time delay can be built into rechecking the usage measurement. One skilled in the art will appreciate that some operating systems can force the system to meet the threshold value. Accordingly the usage measurement can be set in this embodiment rather than being determined as described above.

In summary the embodiments described above allow for reducing the consumption of power by portable electronic devices. In turn the battery life is extended. In one embodiment the power to unnecessary memory devices is terminated to reduce the power consumption. The address configuration is remapped in order to allow for the termination of power to a memory device without interruption to the system operation. The embodiments described above are also relevant to a bank of memory within a memory chip. With respect to a bank of memory power is terminated to at least one bank of memory after the address configuration is remapped.

With the above embodiments in mind it should be understood that the invention may employ various computer implemented operations involving data stored in computer systems. These operations are those requiring physical manipulation of physical quantities. Usually though not necessarily these quantities take the form of electrical or magnetic signals capable of being stored transferred combined compared and otherwise manipulated. Further the manipulations performed are often referred to in terms such as producing identifying determining or comparing.

Any of the operations described herein that form part of the invention are useful machine operations. The invention also relates to a device or an apparatus for performing these operations. The apparatus may be specially constructed for the required purposes or it may be a general purpose computer selectively activated or configured by a computer program stored in the computer. In particular various general purpose machines may be used with computer programs written in accordance with the teachings herein or it may be more convenient to construct a more specialized apparatus to perform the required operations.

The invention can also be embodied as computer readable code on a computer readable medium. The computer readable medium is any data storage device that can store data which can be thereafter be read by a computer system. Examples of the computer readable medium include hard drives network attached storage NAS read only memory random access memory CD ROMs CD Rs CD RWs magnetic tapes and other optical and non optical data storage devices. The computer readable medium can also be distributed over a network coupled computer systems so that the computer readable code is stored and executed in a distributed fashion.

Although the foregoing invention has been described in some detail for purposes of clarity of understanding it will be apparent that certain changes and modifications may be practiced within the scope of the appended claims. Accordingly the present embodiments are to be considered as illustrative and not restrictive and the invention is not to be limited to the details given herein but may be modified within the scope and equivalents of the appended claims. It should be appreciated that the claims do not imply any particular order of steps or operations unless explicitly stated that an ordering exists.

