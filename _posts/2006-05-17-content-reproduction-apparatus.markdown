---

title: Content reproduction apparatus
abstract: In conventional technology, when a program which operates in synchronization with reproduction of video and audio instructs a trick play of video and audio such as fast-forward and rewind, the trick play of the video and audio continues even after the program is terminated. This makes it impossible to cancel a redundant trick play which continues for an interval of time which is not expected by the program. In the present invention, a program which instructs a trick play of video and audio is retained, and when the program is terminated, it is determined whether or not the program has instructed the trick play, and if that program has instructed the trick play, the trick play of the video and audio is cancelled. As a result, it is possible to cancel such a redundant trick play which would otherwise continue for some interval of time which is not expected by the program.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07962001&OS=07962001&RS=07962001
owner: Panasonic Corporation
number: 07962001
owner_city: Osaka
owner_country: JP
publication_date: 20060517
---
This application claims the benefit of U.S. Provisional Application No. 60 681 974 filed May 15 2005 the contents of which are herein incorporated by reference in its entirety.

The present invention relates to a recording and reproduction apparatus that is a content reproduction apparatus which accumulates contents and reproduces the accumulated contents. In particular the present invention relates to a setup for receiving a broadcast wave including content made up of video and audio as well as data such as a program that are multiplexed into the broadcast wave in synchronization with each other and transmitted and for accumulating the video audio and data as well as a setup for executing trick play such as fast forward and rewind of the content while maintaining synchronization between the video and audio and the data such as a program.

Various contents are included in a broadcast wave sent from a broadcast station. Aside from video and audio used in a normal TV show there are cases where data is included in the contents. There are several methods for sending the data which can be roughly divided into a method of sending the data chronologically and a method of repeatedly sending the data per set interval. In the former method of sending the data chronologically for example data that continues over the course of time is sent in sequential order. This method is suitable for sending large amounts of data over a long period of time but there is a drawback in that data that could not be received at the timing of the sending cannot be received again. On the other hand in the latter method of repeatedly sending the data at a set interval the same data is repeatedly sent any number of times during a fixed period. This method has an advantage in that during the period when the same data is being sent it is acceptable to receive any one of the repeatedly sent pieces of data and thus the timing of receiving is not limited. Data broadcast represented by BML and file sending through DSM CC data carousel are examples of this method. It is unknown particularly in broadcast when a recipient will select a channel and commence reception. In the method of sending the data chronologically when the start of reception falls behind the timing of the sending and thus acquisition of the data the data cannot be re acquired. Therefore when sending data such as an application program along with video and audio in the broadcast wave the method of repeatedly sending the data per set interval is favorable.

At present specifications for receiving a broadcast wave that includes video audio and an application program and for executing the application program in synchronization with video and audio as in the above method have been developed and are in operation. It is possible to receive the sent application program load the application program into a terminal and realize various extra functions by executing the application program rather than simply viewing the video and audio. This method for sending the application program and loading the application program into the terminal is also called downloading . For example a specification called Digital Video Broadcasting Multimedia Home Platform DVB MHP ETSIES201812 v1.1.1 2003 12 has been developed in Europe and operations according to this specification have already commenced. In addition Open Cable Application Platform OCAP OC SP OCAP1.0 114 050119 specification which provides the same framework in the cable broadcast environment is being developed in the United States and actually operations are set to commence. In these specifications the application program is written in the lava language. Various Application Programming Interfaces APIs for tuning graphics display and the like are provided in the terminal and the lava application program can control those functions by calling the APIs.

In addition in North America the OCAP DVROC SP OCAP DVR I01 040524 specification which is aimed at adding a function for recording and reproducing the contents in the OCAP specification is being developed. With this specification the video audio and the Java application program executed in synchronization with each other which are sent as a cable television broadcast are recorded as a content and furthermore are reproduced in the same manner as when the recorded content is directly reproduced from the broadcast wave. The application program is reproduced in synchronization with the video and audio in the same manner as direct reproduction from the broadcast wave.

Moreover with OCAP DVR trick play of the contents is realized by recording broadcast contents on a high speed random accessible storage medium such as a hard disk a semiconductor memory and the like. Here the trick play refers to functions for reproducing the contents at an arbitrary speed from an arbitrary position and so on such as fast forward rewind slow motion pause skip and the like. With OCAP DVR the application program loaded into the terminal from the broadcast wave can control the recording and trick play of the content. In other words APIs for recording and trick play are provided in the terminal and the Java application program controls each function by calling those APIs.

Typically control information for synchronization is in advance multiplexed with a broadcast wave in order to execute an application program in synchronization with video and audio. The application programs are executed and terminated one by one in accordance with the synchronization control information. Therefore it is possible to switch to a suitable application program to be executed for a particular scene of video and audio. By the way in the case where trick play of content recorded by a terminal is performed according to OCAP DVR or the like it is necessary to switch appropriately between application programs depending on a type of the trick play. For example in the case where video changes to another by fast forward an application program associated with the video in synchronization thereto also changes to another in accordance with the reproduction speed. In addition in the case of skip an application program which is for example synchronized with the reproduction start position in the video after the skip is executed.

By the way in the case of fast forward a terminal may be unable to switch and execute an application program in accordance with its own fast forward speed. For example it takes time to start up an application program so that the startup timing of the next application program is lost during the startup of the previous one. In the case of skip play an application program which is synchronized with any timing up to a reproduction start position after the skip is not reproduced but only an application program which is synchronized with the reproduction start time is executed. Here there is a problem in the case where the executed application program uses the result of the previously executed application program.

In order to solve this problem Japanese Translation of PCT International Application 2003 513555 provides a setup for notifying an application program about control information of an application program which has not been detected during trick play such as skip or the like because of the execution of the trick play. With this notification it becomes possible to take a desired action even if application programs are executed in the order different from the primary order.

According to the invention disclosed in Japanese Translation of PCT International Application 2003 513555 it is possible to discover that a particular application program has not been detected so that a desired action can be taken.

However since Japanese Translation of PCT International Application 2003 513555 only notifies of the control information of the application program which has not been detected during trick play there remains a problem in the following case. For example it is assumed that an application program executes trick play of fast forward of content including the application program itself. In the case where the execution period of the application program set in the synchronization control information has passed because the content is reproduced by fast forward at a higher speed than the normal speed the application program is forced to be terminated. Here even if the forcibly terminated application program is actually terminated the current trick play of fast forward continues. However it is not always going to be possible to take an approach of terminating the trick play of fast forward when the application program is forcibly terminated. This is because the current trick play of fast forward may not be the trick play executed by that forcibly terminated application program. In other words in order to solve this problem it is necessary to determine whether or not that application program is identical to the application program which instructed the trick play when the application program is terminated and to execute the processing such as continuation and termination of the trick play depending on the situation when the application program which instructed the trick play is terminated.

A content reproduction apparatus of the present invention includes a content reproduction unit that reproduces a recorded content a program execution unit that starts and terminates a program a content reproduction speed change unit that changes a reproduction speed of the recorded content based on an instruction from the program a trick play instructing program identification unit that identifies a program which has instructed the content reproduction speed change unit to change the reproduction speed of the content a terminated program identification unit that identifies a terminated program out of programs to be executed by the program execution unit a trick play instructing program determination unit that determines whether or not the program which is identified by the trick play instructing program identification unit as a program which has instructed the change in the reproduction speed of the content is the terminated program identified by the terminated program identification unit and a trick play instructing program termination processing unit that changes the reproduction speed of the content to a normal reproduction speed when the trick play instructing program determination unit determines that the program which has instructed the change in the reproduction speed of the content is the terminated program.

Accordingly it is possible to determine whether or not an arbitrary program is a program which changed a reproduction speed of a recorded broadcast wave and to change the reproduction speed of the recorded broadcast wave when the program is terminated. Therefore it is possible to prevent the recorded broadcast wave from continuing to be reproduced at the reproduction speed instructed by the already terminated program.

Furthermore the above mentioned content includes video audio a program and synchronization information for synchronizing the video the audio and the program with one another and the program included in the content may be executed by the program execution unit based on the synchronization information.

The above mentioned content reproduction apparatus further includes a program reception unit that receives the program and the program received by the program reception unit may be executed by the program execution unit.

The above mentioned program execution unit may start and terminate the program with reference to the synchronization information included in the content.

The above mentioned synchronization information includes a trick play compliant flag that indicates whether or not the program should be forced to terminate and the program execution unit may start and terminate the program based on the trick play compliant flag in the synchronization information included in the content.

The above mentioned program execution unit may further force the program to terminate when an abnormality occurs during the execution of the program.

Accordingly it is possible to terminate a program if any abnormality has occurred. Therefore it is possible to reduce damage to software and hardware when there is a change in the reproduction speed.

Furthermore the above mentioned program execution unit may refer to the synchronization information included in the content only when the reproduction speed of the content is slow. For example the program execution unit refers to the synchronization information included in the content only when the reproduction speed of the content is equal to or less than the normal reproduction speed.

Note that the present invention can be implemented not only as the above mentioned content reproduction apparatus but also as a content reproduction method a program for the method and a storage medium for storing the program.

As further information about technical background to this application the disclosure of U.S. Provisional Application No. 60 681 974 filed May 18 2005 including specification drawings and claims is incorporated herein by reference in its entirety.

The first invention is a recording and reproduction apparatus which records a broadcast wave and reproduces the recorded broadcast wave and the apparatus includes a program information holding unit for holding information which identifies a program for changing a reproduction speed of the recorded broadcast wave a program determination unit for determining whether or not an arbitrary program is identical to the program and a program termination processing unit for changing the reproduction speed of the broadcast wave when the program is terminated.

According to the above first invention it is possible to determine whether or not an arbitrary program is identical to a program which changed a reproduction speed of a recorded broadcast wave and to change the reproduction speed of the recorded broadcast wave when the program is terminated. Therefore it is possible to prevent the recorded broadcast wave from continuing to be reproduced at the reproduction speed instructed by the already terminated program.

The second invention is the invention which is dependent on the first invention in which the program is terminated in the case where the program does not comply with a change in the reproduction speed of the broadcast wave during reproduction of the broadcast wave.

According to the above second invention it is possible to terminate a program which does not comply with a change in a reproduction speed of a recorded broadcast wave. Therefore it is possible to avoid any unexpected behavior of the program when there is a change in the reproduction speed.

The third invention is the invention which is dependent on the first invention in which the program is terminated in the case where a specified position in the broadcast wave has been reproduced during reproduction of the broadcast wave.

According to the above third invention it is possible to terminate a program at a specified position in a recorded broadcast wave. Therefore it is possible to execute the program only within a fixed interval of time when there is a change in the reproduction speed.

The fourth invention is the invention which is dependent on the first invention in which the program is terminated in the case where one of the following has occurred during reproduction of the broadcast wave an abnormality in the program an abnormality in a system in which the program operates and a lack of resources for causing the program to operate.

According to the above fourth invention it is possible to terminate a program if any abnormality has occurred. Therefore it is possible to reduce damage to software and hardware when there is a change in the reproduction speed.

The fifth invention is the invention which is dependent on one of the second third and fourth inventions in which when the program is terminated the program termination processing unit reproduces the broadcast wave at a normal speed.

According to the above fifth invention it is possible to set normal speed reproduction of a recorded broadcast wave when a program which changed a reproduction speed of the broadcast wave is terminated. Therefore it is possible to set normal speed reproduction without any involvement of a user in an interval of time in which execution of the program is not expected.

The sixth invention is the invention which is dependent on one of the second third and fourth inventions in which when the program is terminated the program termination processing unit temporarily stops the broadcast wave.

According to the above sixth invention it is possible to temporarily stop reproduction of a recorded broadcast wave when a program which changed a reproduction speed of the broadcast wave is terminated. Therefore it is possible to temporarily stop reproduction without any involvement of a user in an interval of time in which execution of the program is not expected.

The seventh invention is the invention which is dependent on the third invention in which the program is terminated in the case where a specified position in the broadcast wave is reproduced during reproduction of the broadcast wave at a normal speed.

According to the above seventh invention it is possible to terminate a program at a specified position in a recorded broadcast wave during normal speed reproduction. Therefore it is possible to execute the program only within a fixed interval of time during normal speed reproduction.

The eighth invention is the invention which is dependent on the seventh invention in which the program is terminated in the case where the broadcast wave is temporarily stopped within a specified range of the broadcast wave.

According to the above eighth invention it is possible to terminate a program if the broadcast wave is temporarily stopped within a specified range of the recorded broadcast wave. Therefore it is possible to execute the program only within a fixed interval of time during the temporary stop.

The ninth invention is the invention which is dependent on the eighth invention in which the program is terminated in the case where a specified position in the broadcast wave is reproduced during reproduction of the broadcast wave at the less speed than a normal speed namely a speed ranging from a 0 times speed to 1 times speed.

According to the above ninth invention it is possible to terminate a program at a specified position in a recorded broadcast wave during reproduction at a speed ranging from 0 times speed to 1 times speed. Therefore it is possible to execute the program only within a fixed interval of time during reproduction at a speed ranging from 0 times speed to 1 times speed.

The tenth invention is a recording and reproduction apparatus which records a broadcast wave and reproduces the recorded broadcast wave and the apparatus includes a program information holding unit for holding information which identifies a program for changing a reproduction speed of the recorded broadcast wave a program determination unit for determining whether or not an arbitrary program is identical to the program and a program termination processing unit for performing predetermined processing when the program is terminated.

According to the above tenth invention it is possible to determine whether or not an arbitrary program is identical to a program which changed a reproduction speed of a recorded broadcast wave and to perform predetermined processing when the program is terminated. Therefore it is possible to perform consistent processing when the program which changed the reproduction speed is terminated.

The eleventh invention is the invention which is dependent on the tenth invention in which the program is terminated in the case where the program does not comply with a change in the reproduction speed of the broadcast wave during reproduction of the broadcast wave.

According to the above eleventh invention it is possible to terminate a program which does not comply with a change in a reproduction speed of a recorded broadcast wave. Therefore it is possible to avoid any unexpected behavior of the program when there is a change in the reproduction speed.

The twelfth invention is the invention which is dependent on the tenth invention in which the program is terminated in the case where a specified position in the broadcast wave is reproduced during reproduction of the broadcast wave.

According to the above twelfth invention it is possible to terminate a program at a specified position in a recorded broadcast wave. Therefore it is possible to execute the program only within a fixed interval of time when there is a change in the reproduction speed.

The thirteenth invention is the invention which is dependent on the tenth invention in which the program is terminated in the case where one of the following has occurred during reproduction of the broadcast wave an abnormality in the program an abnormality in a system in which the program operates and a lack of resources for causing the program to operate.

According to the above thirteenth invention it is possible to terminate a program if any abnormality has occurred. Therefore it is possible to reduce damage to software and hardware when there is a change in the reproduction speed.

The fourteenth invention is the invention which is dependent on one of the eleventh twelfth and thirteenth inventions in which when the program is terminated the program termination processing unit performs processing registered by another program.

According to the above fourteenth invention it is possible to perform processing registered by another program when a program which changed a reproduction speed is terminated Therefore it is possible to replace the processing to be performed when the program which changed the reproduction speed is terminated with another program.

The fifteenth invention is the invention which is dependent on one of the eleventh twelfth and thirteenth inventions in which when the program is terminated the program termination processing unit passes statuses before and after the termination of the program to the predetermined processing and performs the predetermined processing.

According to the above fifteenth invention it is possible to pass the statuses before and after termination of a program which changed a reproduction speed to predetermined processing and to perform the predetermined processing. Therefore it is possible to perform the processing depending on the statuses before and after the termination of the program.

The sixteenth invention is the invention which is dependent on the fifteenth invention in which the statuses before and after the termination of the program which are passed to the predetermined processing to be performed by the program termination processing unit when the program is terminated include information identifying the terminated program.

According to the above sixteenth invention it is possible to pass information which identifies a terminated program which changed a reproduction speed to predetermined processing when the program is terminated and to perform the predetermined processing. Therefore it is possible to perform the processing depending on the information which identifies the terminated program.

The seventeenth invention is the invention which is dependent on the fifteenth invention in which the statuses before and after the termination of the program which are passed to the predetermined processing to be performed by the program termination processing unit when the program is terminated include a reproduction speed of the broadcast wave immediately before the termination.

According to the above seventeenth invention it is possible to pass to predetermined processing a reproduction speed of a broadcast wave immediately before termination of a program which changed a reproduction speed when the program is terminated and to perform the predetermined processing. Therefore it is possible to perform the processing depending on the reproduction speed of the broadcast wave immediately before the termination.

The eighteenth invention is the invention which is dependent on the fifteenth invention in which the statuses before and after the termination of the program which are passed to the predetermined processing to be performed by the program termination processing unit when the program is terminated include a reproduction position in the broadcast wave at the time of the termination.

According to the above eighteenth invention it is possible to pass to predetermined processing a reproduction position in a broadcast wave at the time of termination of a program which changed a reproduction speed when the program is terminated and to perform the predetermined processing. Therefore it is possible to perform the processing depending on the reproduction position in the broadcast wave at the time of the termination.

The nineteenth invention is a recording and reproduction apparatus which records a broadcast wave and reproduces the recorded broadcast wave and the apparatus includes a program information holding unit for holding information which identifies a program for changing a reproduction speed of the recorded broadcast wave a program determination unit for determining whether or not an arbitrary program is identical to the program and a program termination processing unit for switching from the broadcast wave to be reproduced to another broadcast wave when the program is terminated.

According to the above nineteenth invention it is possible to determine whether or not an arbitrary program is identical to a program which changed a reproduction speed of a recorded broadcast wave and to switch from the broadcast wave to be reproduced to another broadcast wave at the time of termination of the program. Therefore it is possible to stop continuous reproduction of the recorded broadcast wave at the reproduction speed instructed by the already terminated program and to start reproduction of an alternative broadcast wave.

The twentieth invention is the invention which is dependent on the nineteenth invention in which the program is terminated in the case where the program does not comply with a change in the reproduction speed of the broadcast wave during reproduction of the broadcast wave.

According to the above twentieth invention it is possible to terminate a program which does not comply with a change in a reproduction speed of a recorded broadcast wave. Therefore it is possible to avoid any unexpected behavior of the program when there is a change in the reproduction speed.

The twenty first invention is the invention which is dependent on the nineteenth invention in which the program is terminated in the case where a specified position in the broadcast wave is reproduced during reproduction of the broadcast wave.

According to the above twenty first invention it is possible to terminate a program at a specified position in a recorded broadcast wave. Therefore it is possible to execute the program only within a fixed interval of time when there is a change in the reproduction speed.

The twenty second invention is the invention which is dependent on the nineteenth invention in which the program is terminated in the case where one of the following has occurred during reproduction of the broadcast wave an abnormality in the program an abnormality in a system in which the program operates and a lack of resources for causing the program to operate.

According to the above twenty second invention it is possible to terminate a program if any abnormality has occurred. Therefore it is possible to reduce damage to software and hardware when there is a change in the reproduction speed.

The twenty third invention is the invention which is dependent on one of the twentieth twenty first and twenty second inventions in which when the program is terminated the program termination processing unit switches from the broadcast wave to be reproduced to a broadcast wave which is currently being broadcasted.

According to the above twenty third invention it is possible to switch to a broadcast wave to be reproduced which is currently being broadcasted at the time of termination of a program which changed a reproduction speed. Therefore it is possible to stop reproduction of the recorded broadcast wave in an interval of time in which execution of the program is not expected and to continue reproduction of the broadcast wave which is currently being broadcasted.

According to the content reproduction apparatus and the recording and reproduction method of the present invention when an arbitrary application program is terminated it is determined whether or not that application program has changed the reproduction speed of content which is currently being reproduced and prescribed processing such as reset of the reproduction speed of the content is executed based on the determination result or reproduction of alternative content is started. This prevents the continued reproduction of the content at an unintended speed that is not a normal speed in spite of the termination of the program which has changed the reproduction speed of the content. In addition this prevents the reproduction of the recorded content at a reproduction speed which has been changed inappropriately. Therefore it is possible to reduce the high load access to a semiconductor memory or the like represented by a hard disk a Blu ray Disc BD a Digital Versatile Disc DVD a Secure Digital SD memory card and the like and to reduce the deterioration of such storage medium.

Hereafter an apparatus and a method according to the first embodiment of the present invention are described with reference to the drawings. The present invention is aimed at recording and reproduction of sent and received contents with an arbitrary medium however in the present embodiment a cable television broadcast system is described as an example. In the cable television broadcast system the broadcast recording and reproduction apparatus content reproduction apparatus is generally called a terminal apparatus.

The broadcast station side system sends information such as video audio data for data broadcast in a broadcast signal to a plurality of terminal apparatuses. The broadcast signal is sent using a frequency within a frequency band set by the operational regulations of the broadcast system the laws of a region country in which the broadcast system is operated and so on.

With the cable system in the present embodiment the frequency band used in broadcast signal transmission is divided for each of data details and transmission directions inbound outbound and assigned thereto. is a chart indicating one example of the division of the frequency band. The frequency band is roughly divided into two types Out Of Band abbr OOB and In Band. 5 MHz to 130 MHz is assigned as OOB and is mainly used in inbound outbound data exchange between the broadcast station side system and the terminal apparatus A the terminal apparatus B and the terminal apparatus C. 130 MHz to 864 MHz is assigned as In Band and is mainly used in an outbound only broadcast channel that includes video audio. QPSK modulation method is used with OOB and QAM64 or QAM256 modulation method is used with In Band. Modulation method technology is generally known and of little concern to the present invention and therefore detailed descriptions are omitted.

The broadcast station side system uses the frequency bands described above to send an appropriate broadcast signal to the terminal apparatuses and therefore has a QPSK modulation unit a QAM modulation unit and so on. In addition the broadcast station side system has a QPSK demodulator for receiving data from the terminal apparatuses. Moreover the broadcast station side system can be thought of as having various devices related to the modulation unit and the demodulation unit. However the present invention relates mainly to the terminal apparatuses and therefore detailed descriptions are omitted.

Meanwhile the terminal apparatuses A B and C each have a QAM demodulation unit and a QPSK demodulation unit in order to receive and reproduce a broadcast signal from the broadcast station side system . In addition each terminal apparatus has a QSPK modulation unit in order to send its unique data to the broadcast station system side . In the present invention the terminal apparatuses are broadcast recording and reproduction apparatuses and detailed configurations are described later.

The broadcast station side system modulates an MPEG 2 transport stream and transmits the stream within the broadcast signal. A terminal apparatus receives the broadcast signal demodulates and reproduces the MPEG 2 transport stream and extracts necessary information from the stream and uses it. In order to describe a device function and connection structure present in the terminal apparatus the structure of the MPEG 2 transport stream is first described in a simple manner.

TS packets that have identical PIDs hold identical types of information. Therefore the terminal apparatus reproduces video and audio and reproduces data such as TV show organization information by receiving multiplexed TS packets and extracting per PID the information that the TS packet holds. In the TS packet and the TS packet each carry information regarding the video and the TS packet and the TS packet each carry information regarding the data .

Video and audio are represented by a format called a Packetized Elementary Stream PES packet. The PES packet includes video information or audio information of certain hours of a day and by receiving the PES packet the broadcast recording and reproduction apparatus can output the video and audio information contained in that PES packet to a screen and a speaker. The broadcast station transmits the PES packets without pause and therefore it is possible for the broadcast recording and reproduction apparatus to continuously reproduce the video and audio without pause. When the PES packet is actually transmitted the PES packet is divided and stored in the payloads of a plurality of TS packets in the case where the PES packet has a size larger than the payload of one TS packet.

On the other hand information such as the TV show organization information and data used for data broadcast is expressed using a format called MPEG 2 section. When the MPEG 2 section is actually transmitted the MPEG 2 section is divided and stored in the payloads of a plurality of TS packets in the case where the MPEG 2 section has a size larger than the payload of one TS packet. shows an example of division when the MPEG 2 section is carried. As an MPEG 2 section is too large to be stored and transmitted in a payload of a single TS packet the MPEG 2 section is divided into a section division A a section division B and a section division C and is carried in three TS packets to which have identical PIDs.

The PES format does not exist in the case of the MPEG 2 section. For that reason the elementary stream ES is a concatenation of the payloads of TS packets identified by identical PIDs within the MPEG 2 transport stream. For example in the TS packets to in which the MPEG 2 section is divided and carried all are identified by the PIDs of 200. It can be said that these are the ESs which carry the MPEG 2 section .

A concept called a program further exists in the MPEG 2 transport stream. The program is expressed as a collection of ESs and is used in the case where handling a plurality of ESs all together is desirable. When the program is used it is possible to handle video audio as well as accompanying data broadcast data all together For example in the case of simultaneously handling the video audio to be reproduced by grouping the video ES and the audio ES as a program the broadcast recording and reproduction apparatus should simultaneously reproduce these two ESs as one TV show.

To express the program two tables called a Program Map Table PMT and a Program Association Table PAT are used in MPEG 2. Detailed descriptions can be found in the specifications of ISO IEC 13818 1 MPEG 2 Systems . The PMT and the PAT are described hereafter in simple terms.

The PMT is a table as many of which are included in the MPEG 2 transport stream as the number of programs The PMT is configured as an MPEG 2 section and has a table id of 2. The PMT holds a program number used in identifying the program and additional information of the program as well as information regarding ESs belonging to the program. An example of the PMT is given in shows program numbers. The program numbers are assigned uniquely to programs in the same transport stream and are used in identifying the PMTs. Rows to express information regarding individual ESs. A column shows types of ESs in which video audio data and so on are specified. A column shows the PIDs of the TS packets that make up each ES. A column shows additional information regarding the ESs. For example the ES shown in the row is an audio ES and is carried in TS packets with PIDs of 5011.

The PAT is a table of which only one is present in the MPEG 2 transport stream. The PAT is configured as an MPEG 2 section has a table id of 0 and is carried in a TS packet with a PID of 0. The PAT holds a transport stream id used in identification of the MPEG 2 transport stream and information regarding all PMTs that represent programs existing in the MPEG 2 transport stream. An example of the PAT is given in is a transport stream id. The transport stream id is used in identifying the MPEG 2 transport stream. Rows to express information regarding the programs. A column shows the program numbers. A column shows the PIDs of the TS packets which carry the PMTs that correspond to respective programs. For example the PMT of the program shown in the row has a program number of 101 and the corresponding PMT is carried in the TS packet with a PID of 501.

In the case where the terminal apparatus reproduces a certain program the terminal apparatus uses the PAT and the PMT and identifies the video and audio that make up the program and reproduces that video and audio. For example in regards to the MPEG 2 transport stream that carries the PAT in and the PMT in the following procedure is followed in the case where the video and audio belonging to the program with a program number of 101 are reproduced. First a PAT transmitted as an MPEG 2 section with a table id of 0 is acquired from a TS packet with a PID of 0 . The PAT is searched to find a program with the program number 101 and the row is obtained. From the row the PID 501 of the TS packet which carries the PMT of the program with a program number 101 is obtained. Next the PMT carried as the MPEG 2 section with a table id of 2 is acquired from the TS packet with the PID of 501 . A row which is audio ES information and a row which is video ES information are obtained from the PMT. A PID 5011 of the TS packet which carries the audio ES is obtained from the row . In addition a PID 5012 of the TS packet which carries the audio ES is obtained from the row . Next an audio PES packet is acquired from the TS packet with a PID 5011 and a video PES packet is acquired from the TS packet with a PID of 5012 . Through this it is possible to obtain the video and audio PES packets to be reproduced and the video and audio carried in these packets can be reproduced.

Note that there are cases where the MPEG 2 transport stream is scrambled. This is a setup called conditional access system. For example by scrambling the PES packets which carry certain video and audio only specified viewers who can descramble them are able to view that video and audio. In order to descramble and view the video and audio a viewer must descramble them using a device called a descrambler. For example in an OCAP compatible terminal apparatus a card form adapter with an internal descrambler is used. A cable television operator distributes an adapter set to be able to descramble a specified program to each viewer and the viewer inserts that adapter into the terminal apparatus. Upon doing so the adapter descrambles the specified program based on descrambling information such as a descrambling key and contract information of each contract holder. A method of descrambling a method of obtaining a descrambling key and the like depend on the adapter and have no influence on the implementation of the present invention.

Thus far simple descriptions regarding the MPEG 2 specifications have been given and hereafter detailed definitions of terminology are given. In the present invention two types of the term program exist. One is a program which appears in the MPEG 2 specifications and the other is a program referring to an assemblage of code executed by a CPU. As the former is synonymous with the term service used in the operation regulations hereafter to avoid confusion the former is called service and the latter is called simply program . Furthermore concerning the latter a program particularly written in the Java language is called a Java program .

Description has been given regarding several kinds of general information specified in the MPEG 2 specifications according to the present invention. Hereafter the broadcast recording and reproduction terminal used in the present embodiment is described in detail.

The tuner is a device which demodulates a broadcast signal modulated and transmitted from the broadcast station side system in accordance with tuning information such as a frequency and the like specified by the CPU . Here tuning information is information in which a frequency a modulation method and the like can be specified. An MPEG 2 transport stream obtained as a result of demodulation by the tuner is sent to the TS decoder via the adapter with a descrambling function.

The TS decoder is a device which has a function to segregate PES packets and MPEG 2 sections which comply with specified conditions from the MPEG 2 transport stream based on a PID a section filter condition and so on prescribed by the CPU . In the case where a broadcast is received and a service is reproduced without recording the MPEG 2 transport stream which the adapter outputs is inputted to the TS decoder . On the other hand in the case of reproducing a service recorded in the secondary storage unit the MPEG 2 transport stream which the secondary storage unit outputs is inputted to the TS decoder . Which input to receive is controlled by the CPU .

The PES packets of the video and audio which the TS decoder segregated are outputted to the AV decoder . In addition the MPEG 2 section segregated by the TS decoder is transferred to the primary storage unit through Direct Memory Access DMA and is used by a program executed by the CPU .

The AV decoder is a device with a function to decode the encoded video ES and audio ES. The AV decoder fetches the ES from the PES packet that carries the audio and video information transferred from the TS decoder and decodes the ES. An audio signal and a video signal obtained through the decoding performed by the AV decoder are outputted to the speaker and the display at the time of service reproduction but are outputted to the AV encoder at the time of service recording. Which output route to take is controlled by the CPU according to an instruction from a user.

The CPU executes a program that operates in the broadcast recording and reproduction apparatus. The CPU executes a program contained in the ROM . Or the CPU executes a program downloaded from a broadcast signal or a network and held in the primary storage unit . Or the CPU executes a program downloaded from a broadcast signal or a network and held in the secondary storage unit . The tuner TS decoder AV decoder speaker display secondary storage unit primary storage unit ROM input unit adapter AV encoder and multiplexer are controlled in accordance with the instructions of the executed program. In addition the CPU is capable of controlling the adapter through communication not only with devices present within the terminal apparatus but with the devices within the adapter .

The secondary storage unit is a memory apparatus the memory of which is not deleted even if the power supply to the device is interrupted. The secondary storage unit is configured of a device where information is not deleted even when the power to the terminal apparatus is turned off for example a nonvolatile memory such as a FLASH ROM a Hard Disk Drive HDD a rewritable media such as a CD R and a DVD R. The secondary storage unit saves information based on an instruction from the CPU .

The primary storage unit is a device which has a function for temporarily saving information in accordance with an instruction from the CPU a DMA transfer capable device and so on and is configured of a RAM or the like.

The ROM is a non rewritable memory device and to be more specific is configured of a ROM a CD ROM a DVD and the like. The program which the CPU executes is stored in the ROM .

The input unit is to be more specific configured of a front panel or a remote control receiver and accepts an input from the user. is one example of the case where the input unit is configured of the front panel. A front panel has seven buttons an up cursor button a down cursor button a left cursor button a right cursor button an OK button a cancel button an EPG button and a mode switch button . When the user presses a button an identifier of the pressed button is notified to the CPU .

The adapter is a device for descrambling a scrambled MPEG 2 transport stream carried in the In band frequency range and includes one or more descramblers. The MPEG 2 transport stream outputted by the tuner is inputted into the adapter and descrambling is carried out on the TS packet that has the PID specified by the CPU . The adapter outputs the descrambled MPEG 2 transport stream to the TS decoder .

Furthermore the adapter also carries out format conversion of data sent in an OOB frequency range. Information that is sent in OOB is modulated in the QPSK modulation format. Regarding outbound transmission the QPSK demodulator demodulates the outbound signal sent from the broadcast station side system and inputs a generated bit stream into the adapter . The adapter extracts information specified by the CPU from among various information included in the bit stream converts the information to a format that can be interpreted by a program that operates in the CPU and provides this to the CPU . On the other hand regarding inbound transmission the CPU inputs information to be sent to the broadcast station side system into the adapter . The adapter converts the information inputted from the CPU to a format that can be interpreted by the broadcast station side system and inputs this to the QPSK modulator . The QPSK modulator QPSK modulates the information inputted from the adapter and sends this to the broadcast station side system .

A CableCARD formerly called a Point of Deployment POD used in the United States cable system can be given as a specific example of the adapter .

The AV encoder encodes the audio signal decoded by the AV decoder into audio in the MPEG audio format and encodes the video signal into video in the MPEG video format. The AV encoder outputs the encoded video and audio to the multiplexer .

The multiplexer is a device with a function to multiplex video and audio inputted from the AV encoder into the MPEG 2 transport stream.

An operation in which the broadcast recording and reproduction apparatus described above records a service contained in a broadcast wave into the secondary storage unit and an operation in which the broadcast recording and reproduction apparatus consecutively reads out the service from the secondary storage unit and reproduces it are hereafter described in detail.

First the operation in which the service contained in the broadcast wave is recorded into the secondary storage unit is described.

First the tuner performs tuning on the broadcast wave in accordance with tuning information specified by the CPU . Here tuning information is information in which a frequency a modulation method and the like can be specified. The tuner demodulates the broadcast wave and inputs the MPEG 2 transport stream into the adapter .

The descrambler which is included in the adapter descrambles the MPEG 2 transport stream based on conditional access information for each viewer. The descrambled MPEG 2 transport stream is inputted into the TS decoder.

Two types of devices that process the MPEG 2 transport stream are present within the TS decoder the PID filter and the section filter .

The PID filter extracts from the inputted MPEG 2 transport stream a TS packet that has a PID specified by the CPU and then extracts a PES packet and an MPEG 2 section present in that payload. For example when the MPEG 2 transport stream in is inputted in the case where the CPU has instructed PID filtering which extracts the TS packet with a PID 100 packets and are extracted then concatenated and thus a PES packet of a video is reconfigured. Or when the MPEG 2 transport stream in is inputted in the case where the CPU has instructed PID filtering which extracts the TS packet with a PID 200 packets and are extracted then concatenated and thus an MPEG 2 section of data is reconfigured.

The section filter extracts the MPEG 2 section which conforms to a section filter condition specified by the CPU from among the inputted MPEG 2 sections and DMA transfers this MPEG 2 section to the primary storage unit . For example it is assumed that the CPU specifies for the section filter PID filtering which extracts the TS packet with a PID 200 and section filtering which extracts a section with a table id of 64. As mentioned earlier after the MPEG 2 section of the data is reconfigured the section filter extracts only the section with a table id of 64 from among those MPEG 2 sections and DMA transfers this to the primary storage unit .

A video PES packet and an audio PES packet extracted by the TS decoder are inputted into the AV decoder .

The AV decoder decodes the video PES packet so as to convert it into the video and inputs this into the AV encoder . The AV decoder also decodes the audio PES packet so as to convert it into the audio and inputs this into the AV encoder .

The AV encoder converts the video into MPEG video and inputs this into the multiplexer . The AV encoder also converts the audio into MPEG audio and inputs this into the multiplexer .

The multiplexer multiplexes the MPEG video and MPEG audio inputted form the AV encoder into the MPEG 2 section inputted from the primary storage unit and thus generates an MPEG 2 transport stream. The generated MPEG 2 transport stream is recorded into the recording area .

The recording area is made up of the whole or a part of the secondary storage unit or another recording area and stores the MPEG 2 transport stream that makes up a service.

Next the operation is described in which the service is consecutively read out from the secondary storage unit and reproduced.

The MPEG 2 transport stream recorded in the recording area in the procedure described in is inputted into the TS decoder .

Then a video PES and an audio PES that have the PIDs specified by the CPU are extracted by the PID filter within the TS decoder . The extracted PES packets are inputted into the AV decoder . Or the MPEG 2 section that has the PID and table id specified by the CPU is extracted by the PID filter and the section filter within the TS decoder . The extracted MPEG 2 section is DMA transferred to the primary storage unit .

The video PES and the audio PES inputted into the AV decoder are decoded and outputted as an audio signal and a video signal. After that the audio signal and the video signal are inputted into the display and the speaker thus reproducing the audio and the video.

Thus far an example of a hardware configuration regarding the present invention has been described. Hereafter a main function of the present invention which is control of recording and control of trick play of a service via a Java program is described.

Recording of the service in the present invention refers to recording video audio a Java program synchronization information of the Java program and so on that are contained in the service into a recording medium such as a hard disk a Blu ray Disc BD a Digital Versatile Disc DVD and a Secure Digital SD memory card. Reproduction of the service refers to reproduction and execution of the video audio and Java program recorded in the recording medium based on the synchronization information. A reproduction result of a recorded service is required to be almost equivalent to a result of directly reproducing the service upon receiving a broadcast wave.

The OS is an Operating System Linux Windows and the like are examples. The OS is made up of a kernel for executing other sub programs such as the EPG and the Java VM and a library which the sub programs use to control the constituent elements of the terminal apparatus . The kernel is publicly known technology and therefore detailed description is omitted.

The library provides for example a tuning function for controlling the tuner. The library accepts from another sub program tuning information in which a frequency a modulation method and the like can be specified and supplies this to the tuner . The tuner performs demodulation processing based on the provided tuning information and can pass the demodulated MPEG 2 transport stream to the TS decoder . As a result other sub programs can control the tuner through the library

Also the library provides channel information for uniquely identifying a channel. An example of the channel information is shown in . The channel information is sent using an OOB or an In band frequency range is converted into a chart format by the adapter and is stored in a temporary memory unit which can be accessed by the library. A column shows channel identifiers and is equivalent to for example source IDs as defined by SCTE65 Service Information Delivered Out Of Band For Digital Cable Television. A column shows channel names and is equivalent to source name and the like from the same SCTE65 standard. A column shows tuning information that is information in which a frequency a transfer rate a modulation method and the like can be specified and is given to the tuner . A column shows program numbers for identifying the PMTs. For example a row is a group of service information including a channel identifier of 1 a channel name of channel 1 a frequency of 150 MHz . . . in the tuning information and a program number of 101 .

The JavaVM is a Java virtual machine that sequentially analyzes and executes programs written in the Java language. Programs written in the Java language are compiled of intermediate code which does not depend on the hardware called bytecode. The Java virtual machine is an interpreter which executes this bytecode. The Java VM executes the Java library that is written in the Java language. Details of the Java language and Java VM are explained in publications such as Java Language Specification ISBN 0 201 63451 1 and Java Virtual Machine Specification ISBN 0 201 63451 X and so on. In addition it is possible to call or be called by other sub programs not written in the Java language through a Java Native Interface JNI . Details regarding the INI can be found in the book Java Native Interface and so on.

The Java library is a library written in the Java language and which is called by the Java program in order to control functions of the broadcast recording and reproduction apparatus. However there are situations where a sub program written in non Java language such as the library of the OS is used as necessary. The Java program can use a function provided by the Java library by calling a Java Application Programming Interface API held by the Java library .

A Tuner is a Java library for controlling the In band receiving tuner in the broadcast recording and reproduction terminal. When the Java program passes tuning information to the tuner the tuner uses that information to call a tuning function of the library and as a result it is possible to control an operation of the In band receiving tuner of the broadcast recording and reproduction terminal. Here tuning information is information in which a frequency a modulation method and the like can be specified.

An SF is a lava library for controlling a function of the PID filter and the section filter of the broadcast recording and reproduction terminal. When the lava program passes filter conditions such as a PID table id and the like to the SF the SF uses a function of the library and the like based on those conditions so as to control the PID filter and the section filter acquires an MPEG 2 section that fulfills desired filter conditions and passes the MPEG 2 section to the Java program that set the filter conditions.

A DSM CC is a lava library for accessing a file system of a DSM CC object carousel. The DSM CC object carousel is included in the MPEG 2 section acquired by the SF . The DSM CC is defined by the ISO IEC 13818 6 standard and is a mechanism for using the MPEG 2 section so as to carry an arbitrary file. By using this it is possible to send a file from a broadcast station to a terminal. A detailed method for implementing the DSM CC is of no relation to the present invention and therefore details are omitted.

An AM is an application manager that provides a function for managing the execution and termination of the Java application contained in the service. The AM extracts a Java program multiplexed with a specified channel of a specified MPEG 2 transport stream and causes the execution or termination of that extracted lava program in accordance with separately multiplexed synchronization information. A Java class file of the Java program is multiplexed into the MPEG 2 transport stream in the aforementioned DSM CC format. In addition the synchronization information of the lava program is multiplexed into the MPEG 2 transport stream in a format called AIT. AIT is an acronym of Application Information Table as defined in Section 10 of the DVB MHP specification ETSITS 101812 DVB MHP specification V1.0.2 and is an MPEG 2 section with a table id of 0 74 .

An internal configuration of the AM is shown in . The AM is configured of an AIT monitoring unit and an application status managing unit .

The AIT monitoring unit monitors AIT update status using an MPEG 2 transport stream and a channel identifier as inputs. First the IMF searches for channel information in the library using a specified channel identifier as a key and finds the program number. Next using the SF and the like a PAT is acquired from the MPEG 2 transport stream. Then the PID of a PMT that corresponds to the obtained program number is obtained from information of the PMT. Once again using the SF the actual PMT is acquired. The acquired PMT is in a format as shown in and has written the PID of an elementary stream that has data as a stream type and AIT as supplemental information Furthermore when the PID and table id 0 74 of the AIT now obtained as the filter conditions are given to the SF the actual AIT is obtained.

Rows and are a group of the information of the Java programs. The Java program defined in the row is a group including a Java program identifier 301 control information autostart a DSM CC identifier 1 and a program name a TopXlet . Similarly the Java program defined in the row is a group including a Java program identifier 302 control information present a DSM CC identifier 1 and a program name a GameXlet . Here the three Java programs defined by the rows and have the identical DSM CC identifiers. This indicates that three Java programs are included in one file system encoded in the DSM CC format. Here four types of information are prescribed for the Java program but in reality more types of information are defined. Details can be found in the DVB MHP specifications.

The application status management unit analyzes the details of the updated AIT and manages the execution status of the Java program. The application status management unit finds out a Java program with autostart within the AIT and extracts the corresponding DSM CC identifier and Java program name. Referring to the AM extracts the Java program from the row and acquires the DSM CC identifier of 1 and the Java program name of a TopXiet . Next the AM uses the DSM CC identifier acquired from the AIT so as to acquire from the PMT the PID of the TS packet storing the Java program in the DSM CC format. Specifically the PID of the elementary stream with a conforming DSM CC identifier in the supplementary information and which has a stream type of data is acquired from the PMT. At this time assuming that the DSM CC identifier is 1 and the PMT is as in the elementary stream of the row conforms to them and the PID 5014 is fetched.

The AM prescribes to the SF the section filter conditions and the PID of the TS packet which sends the MPEG 2 section embedded with data in the DSM CC format. Here the PID 5014 is given. As a result the AM can collect the necessary DSM CC MPEG 2 sections. The AM reconstitutes the file system from the collected MPEG 2 sections in accordance with the DSM CC format and saves the file system into the primary storage unit . Fetching data such as a file system from a TS packet in an MPEG 2 transport stream and saving the data into a storage means such as the primary storage unit and the secondary storage unit is hereafter called downloading.

Next from among the downloaded file systems in the primary storage unit the AM passes the lava program to be executed to the Java VM . Here when the name of the Java program to be executed is A TopXlet the file a TopXlet.class in which .class is added to the end of the Java program name is the file to be executed. is a directory and file name division and referring to the file is the Java program which should be executed. Next the AM passes the file to the JavaVM and the file is executed as a Java program on the JavaVM.

Every time receiving an AIT with a new AIT version the AM analyzes the AIT and changes the execution status of the Java program. Here in the case where kill is specified in the control information the AM terminates the Java program and notifies the trick play instructing program determination unit of the Java program identifier of the terminated Java program.

The JMF handles control of reproduction of the video and audio contained in the service. To be more specific the JMF inputs the video ES and audio ES multiplexed on the specified channel of the specified MPEG 2 transport stream into the AV decoder for reproduction. In the case where the service is reproduced directly from the received broadcast wave it is instructed to reproduce the MPEG 2 transport stream outputted from the adapter . On the other hand in the case where the service which has been stored once in the secondary storage unit is reproduced it is instructed to reproduce the MPEG 2 transport stream outputted from the recording area in the secondary storage unit .

First the JMF searches for channel information in the library with a specified channel identifier as a key and acquires the program number. Next using the SF and the like a PAT is acquired from the MPEG 2 transport stream. Then the PID of the PMT that corresponds to the acquired program number is obtained from the information of the PMT. Once again using the SF the actual PMT is acquired. The acquired PMT is in a format as shown in and has written the PIDs of elementary streams that have video and audio as the stream types. When the JMF sets these PIDs to the PID filter of the TS decoder the video ES and audio ES multiplexed with these PIDs are reproduced through the AV decoder as shown in or .

Here in the case where the JMF receives as an input an MPEG 2 transport stream which has already been recorded in the secondary storage unit the JMF can change the reproduction speed of video and audio by changing the reading speed and reading position in the MPEG 2 transport stream from a storage area of the secondary storage unit . Thus trick play such as fast forward and skip becomes possible. For example if an MPEG 2 transport stream is read out at the double speed of the normal speed video and audio are also reproduced at the double speed. In addition if an MPEG 2 transport stream is read out while skipping only a specific interval of time video and audio are reproduced while skipping it. By using the function of the library the JMF controls the secondary storage unit and changes the reading speed and reading position in an MPEG 2 transport stream. Since the method for performing such trick play smoothly and in a high level is out of the scope of the present invention the description thereof is omitted.

In order for a Java program to instruct trick play the MF provides an API such as setRate float factor to the Java program. When 1.0 is set for a parameter factor normal speed reproduction is performed and when 2.0 is set trick play at the double speed is performed. Furthermore in the case where a Java program instructs trick play through an API the JMF notifies the trick play instructing program information holding unit of the Java program identifier identifying that Java program.

Having a channel identifier start time and end time as inputs the recording manager records the service into the secondary storage unit only for the period of time between the specified start time and end time of the service. For example if the EPG specifies the channel identifier start time and end time the recording manager stands by until the start time. After that it starts recording the specified service when the start time is reached and it stops recording when the end time is reached. Details are described below.

At the recording start time the recording manager first secures within the secondary storage unit a recording area for recording the MPEG 2 transport stream from the start time to the end time specified in the secondary storage unit . A media identifier is supplied to the secured recording area. Next using a channel identifier as a key the recording manager obtains tuning information that corresponds to that channel identifier from the channel information held in the library . After that when it gives the tuning information to the Tuner the Tuner starts tuning. Here tuning information is information in which a frequency a modulation method and the like can be specified. Then as shown in the MPEG 2 transport stream is inputted into the TS decoder via the adapter .

Meanwhile using the SF the recording manager acquires the PAT from the MPEG 2 transport stream obtained through the tuning. Furthermore it searches the library to find out the program number corresponding to the specified channel identifier and searches the PAT to find out the PID of the PMT corresponding to the obtained program number. After that using the SF it acquires the actual PMT so as to obtain all the PIDs of the ESs which make up the specified channel. The recording manager sets the obtained PIDs to the PID filter of the TS decoder. The recording manager further sets the output destination of each hardware configuration element via the library in accordance with the operation of recording the service included in the broadcast wave into the secondary storage unit . Then in accordance with the flow explained in all ESs that make up a desired channel are recorded into the recording area that has been secured.

After that when the specified end time is reached the recording manager stops the tuning process of the Tuner and causes the writing of the MPEG 2 transport stream into the recording area to end. In addition a record information management table as shown in is created as management information of the MPEG 2 transport stream which has been recorded earlier.

The service manager manages reproduction of the service within the MPEG 2 transport stream that has been recorded into the secondary storage unit or the service within the MPEG 2 transport stream inputted from the adapter .

Hereafter an operation in the case of managing reproduction of the service contained within the MPEG 2 transport stream which has been recorded in the secondary storage unit is described. This is equivalent to reproduction of an already recorded service. In this case the service manager has the record identifier as an input. The service already recorded in the secondary storage unit and identified by that record identifier is to be reproduced.

First referring to the record information management table created by the recording manager the service manager obtains the channel identifier and the media identifier of the service to be reproduced with the specified record identifier. Then through the library the service manager instructs the secondary storage unit to output to the TS decoder the MPEG 2 transport stream identified by the obtained media identifier. It also sets the output destination of each hardware configuration element via the library so that the data flows through the path shown in . After that the secondary storage unit is provided to the JMF as the location of the MPEG 2 transport stream and the channel identifier of the service to be reproduced is provided. Then through the operation described above the JMFstarts reproduction of the audio and video multiplexed into the MPEG 2 transport stream outputted from the secondary storage unit . After that the secondary storage unit is also provided to the AM as the location of the MPEG2 transport stream and the channel identifier of the service to be reproduced is provided. Then in accordance with the AIT multiplexed into the MPEG 2 transport stream outputted from the secondary storage unit the AM starts execution and termination of the Java program multiplexed into the MPEG 2 transport stream outputted from the secondary storage unit . After that reproduction of the above mentioned service is continued until the end of the MPEG 2 transport stream outputted from the secondary storage unit .

On the other hand the case of managing reproduction of the service within the MPEG 2 transport stream inputted from the adapter is described hereafter. This is equivalent to reproducing the service directly from the broadcast wave. In this case the service manager has the channel identifier of the service to be reproduced as an input.

Through the library the service manager instructs the MPEG 2 transport stream outputted from the adapter of to be outputted to the TS decoder . It also sets the output destination of each hardware configuration element via the library so that the data flows through the path shown in . After that the adapter is provided to the JMF as the location of the MPEG 2 transport stream and the channel identifier of the service to be reproduced is provided. Then through the operation described above the JMF starts reproduction of the audio and video multiplexed within the MPEG 2 transport stream outputted from the adapter . Furthermore the adapter is also provided to the AM as the location of the MPEG 2 transport stream and the channel identifier of the service to be reproduced is provided. Then in accordance with the AIT multiplexed into the MPEG 2 transport stream outputted from the adapter the AM commences execution and termination of the Java program multiplexed into the MPEG 2 transport stream outputted from the secondary storage unit . After that reproduction of the service is continued until the end of the MPEG 2 transport stream outputted from the secondary storage unit .

The trick play manager monitors the execution status of an application of a service which is currently being reproduced and monitors and controls the state of the trick play.

The trick play instructing program information holding unit stores a Java program identifier of a Java program which instructed trick play notified from the JMF

In the case where a Java program identifier of a terminated Java program is notified from the AM the trick play instructing program determination unit judges whether or not the notified Java program identifier is identical to the Java program identifier of the Java program which instructed the trick play stored in the trick play instructing program information holding unit . Since the fact that these Java program identifiers are identical is equivalent to that a program which instructed the current trick play for the service through the JMF has been terminated the trick play instructing determination unit instructs the trick play instructing program termination processing unit to perform prescribed processing.

The trick play instructing program termination processing unit cancels the trick play for the service which is currently under the trick play. In other words 1.0 is set as a parameter factor so that the setRate float factor API of the JMF is called to reproduce the service at a normal speed.

The EPG is an Electric Program Guide and is a function which causes a user to choose a TV show to be recorded and reproduced. Normal reproduction through receiving a broadcast wave is out of the scope of the present invention and thus description is omitted.

In the case of recording the TV show the EPG displays a list of broadcasted TV shows and causes the user to choose a desired TV show. is an example of a screen display for causing selection of a TV show to be recorded. A time and channels and are displayed in a grid and it is possible to check the TV shows of each recordable channel at each time. It is possible for the user to move a focus within the screen using top bottom right and left cursor buttons to which are included in the input unit of the terminal apparatus . Furthermore when an OK button is pushed the TV show which is currently highlighted is selected to be recorded. The EPG acquires the channel identifier of the TV show from the library and when the TV show to be recorded is selected by the user notifies the channel identifier start time and end time of the TV show to the recording manager . Based on that information the service manager records the TV show into the secondary storage unit .

On the other hand in the case of reproducing an already recorded TV show the EPG displays a list of the already recorded TV shows and causes the user to choose a desired TV show. is an example of a screen display for causing selection of an already recorded TV show. All TV shows stored in the secondary storage unit at that point in time are listed. It is possible for the user to move a focus within the screen using the top and bottom cursor buttons and which are included in the input unit of the terminal apparatus . Furthermore when the OK button is pushed the TV show which is currently highlighted is selected to be reproduced. The EPG acquires the record identifier of the TV show from the recording manager and when the TV show to be reproduced is selected by the user it notifies the service manager of the record identifier of that TV show. Based on that information the service manager reads out the TV show from the secondary storage unit and reproduces it.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. It is assumed that the Java program specified with the control information of autostart in AIT is found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the updated AIT has not been detected in S the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setRate for storing it. After that the process returns to S again.

Here again assuming that the updated AIT has been detected in S the process goes to S. It is assumed that in the updated AIT the control information of kill has been specified to the Java program which has been executed in S. Then the process goes to S where the AM terminates that Java program. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . If they are identical the process goes to S and the trick play instructing program termination processing unit specifies factor 1.0 and calls setRate . By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed.

As described above according to the first embodiment in the case where a Java program is terminated after instructing trick play of a service the trick play of the service is automatically cancelled and returns to normal speed reproduction.

Note that it is also possible in the present embodiment to temporarily stop a service when setRate float factor API of the JMF is called if the trick play instructing program termination processing unit changes the configuration for setting 0.0 as a parameter factor instead of 1.0.

Hereafter an apparatus and a method according to the second embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the second embodiment are same as those in the first embodiment of the present invention to are used therefor. As the constituent elements in this diagram have the same functions as in the first embodiment descriptions are not repeated.

The software configuration of the second embodiment is same as that shown in and . As the constituent elements other than the trick play manager are same as those in the software configuration of the first embodiment descriptions are not repeated. As various data formats used in the second embodiment are same as shown in to in the first embodiment descriptions are not repeated.

Since the trick play instructing program information holding unit and the trick play instructing program determination unit are same as those of the first embodiment descriptions are not repeated.

The termination processing handler registration privilege determination unit determines whether or not an identified Java program has a privilege to register a termination processing handler. When receiving a Java program identifier as an input it checks whether or not the Java program has a permission to register a termination processing handler and outputs the result.

Here the privilege to register the termination processing handler can be set with for example MonitorAppPermission and the like in the OCAP specifications. This is a method in which a permission description file is also stored in a directory where a Java program is stored and the Java program has a list of privileges permitted for the permission description file. For example an application name is written in a file of ocap. application name. perm in a format like a Java program identified by the application name can have a privilege to register a termination processing handler

The termination processing handler registration unit provides a function for allowing the Java program having the termination processing handler registration privilege to register an arbitrary Java program code as a termination processing handler A Java program code is an instance of an arbitrarily defined Java class and using this it is possible to write desired processing in Java language. The termination processing handler registration unit provides a Java API of registerHandler Handler h . When this API is called with an instance of an arbitrary Java class as a parameter h the termination processing handler registration unit inputs the Java program identifier of the Java program into the termination processing handler registration privilege determination unit so as to inquire whether or not the Java program has a termination processing handler registration privilege. If the Java program has the termination processing handler registration privilege the termination processing hander registration unit internally stores the termination processing handler h instance as a termination processing handler.

The trick play instructing program termination processing unit executes the instance of the Java class stored in the termination processing handler registration unit . As for the execution of an instance a Java language code written in the instance is executed as in the execution of a Java program. There is no limit to the code details and arbitrary program code can be written.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AM starts detecting an AIT in S.

In the second embodiment it is assumed that the AIT of the version shown in and the AIT of the version shown in are multiplexed into the MPEG 2 transport stream. Each element in these diagrams has the same meaning as described in the first embodiment.

It is assumed here that the AIT of the version is newly detected Yes is chosen so that the process goes to S. In S Java program identifiers and are found as Java programs specified with control information of autostart in AIT. Therefore regarding these Java programs the process goes to S where the Java programs are executed. After that the process returns to S.

Here in the case where the AIT updated is not detected in S the process goes to S. It is assumed here that the Java program with the Java program identifier has its own termination processing handler h. It is assumed that in that termination processing handler setRate 1.0 is written as a Java language code for returning trick play to the normal speed. Then the Java program with the Java program identifier calls registerHandler h so as to register the handler h in the termination processing handler registration unit. Note that it is assumed that the Java program with the Java program identifier has a privilege of registering a termination processing handler. Then the process goes to S. Meanwhile since the Java program with the Java program identifier does not have a termination processing handler it goes to S without registering the termination processing handler.

It is assumed that the Java program with the Java program identifier specified factor 2.0 and called setrate that is instructed trick play in S. Then the process goes to S. Meanwhile the Java program with the Java program identifier goes to S without instructing trick play. In S the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which called setrate for storing it. After that the process returns to S again.

Assuming here that the AIT of the version shown in has been detected in S the process goes to S. In the updated AIT of the version autostart is specified for the Java program with the Java program identifier executed in S. Since the Java program with the Java program identifier has already been executed the process goes to S where the execution thereof continues. On the other hand it is assumed that the control information of kill is specified to the Java program with the Java program identifier . Regarding the Java program with the Java program identifier the process goes to S where this program is terminated. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . In this case since both identifiers are and identical the process goes to S where the trick play instructing program termination processing unit invokes the termination processing handler h of the Java program identifier registered in the termination processing handler registration unit . More specifically it calls the Java language code of setRate 1.0 written in the termination processing handler h. By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed.

As described above according to the second embodiment it is possible to execute a separately registered termination processing handler when a Java program is terminated after the Java program instructs trick play of a service so as to execute arbitrary Java language code.

Hereafter an apparatus and a method according to the third embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the third embodiment are same as those in the first embodiment of the present invention to are used therefor As the constituent elements in this diagram have the same functions as in the first embodiment descriptions are not repeated.

The software configuration of the third embodiment is same as that shown in . As the constituent elements other than the AM are same as those in the software configuration of the first embodiment descriptions are not repeated. As various data formats used in the third embodiment are same as shown in to in the first embodiment descriptions are not repeated.

The AM has a function of ignoring an update of an AIT in accordance with the current reproduction speed in addition to the functions of the first embodiment. shows a configuration diagram of the AM in the third embodiment. Since the AIT monitoring unit and the application status management unit are same as the AIT monitoring unit and the application status management unit in the first embodiment descriptions are not repeated. However the present embodiment is different from the first embodiment in that an AIT update by a version upgrade is executed only when the AIT update allowing unit allows the update. To be more specific when the AIT monitoring unit detects a version upgrade of an AIT it requests the AIT update allowing unit to determine whether or not to analyze the version upgraded AIT.

Only in the case where the speed of the trick play which is currently effective for the service is within the range of 0.0

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that the Java program specified with the control information of autostart in the AIT is found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the updated AIT has not been detected in S the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 2.0 and therefore the update of the AIT is not allowed. Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The control returns to S again.

Unless the further updated AIT is detected in S the process goes to S. It is assumed that the Java program specified factor 0.5 and called setRate that is instructed trick play in S. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT has been detected in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 0.5 and therefore the update of the AIT is allowed. In response to this the AIT monitoring unit starts analyzing the AIT which was detected this time. In other words Yes is chosen so that the process goes to S.

In S it is assumed that in the updated AIT the control information of kill has been specified to the Java program which was first executed in S. Then the process goes to S where the AM terminates that Java program. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . Since they are identical this time the process goes to S and the trick play instructing program termination processing unit specifies factor 1.0 and calls setRate . By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed.

As described above according to the third embodiment the analysis of the AIT is executed only in the case of the range of 0.0

Note that it is also possible in the present embodiment to temporarily stop a service when setrate float factor API of the JMF is called if the trick play instructing program termination processing unit changes the configuration for setting 0.0 as a parameter factor instead of 1.0.

Hereafter an apparatus and a method according to the fourth embodiment of the present invention are described with reference to the drawings

Since the hardware configuration and the like used in the fourth embodiment are same as those in the third embodiment of the present invention to are used therefor. As the constituent elements in these diagrams have the same functions as in the third embodiment descriptions are not repeated.

The software configuration of the fourth embodiment is same as that shown in and . As the constituent elements except for the trick play manager are same as those in the software configuration of the third embodiment and the trick play manager is identical to that of the second embodiment descriptions are not repeated. As various data formats used in the fourth embodiment are same as shown in to in the first embodiment descriptions are not repeated.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

In the fourth embodiment it is assumed that the AIT of the version shown in the AIT of the version shown in and the AIT of the version shown in are multiplexed into the MPEG 2 transport stream. Each element in these diagrams has the same meaning as described in the first embodiment.

Assuming here that the AIT of the version was detected Yes is chosen and the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S.

In S Java program identifiers and are found as Java programs specified with control information of autostart in AIT. Therefore regarding these Java programs the process goes to S where the lava programs are executed. After that the process returns to S.

Here in the case where a newly updated AIT is not detected in S the process goes to S. It is assumed here that the Java program with the Java program identifier has its own termination processing handler h. It is assumed that in that termination processing handler setRate 1.0 is written as Java language code for returning trick play to the normal speed. Then the Java program with the Java program identifier calls registerHandler h so as to register the handler h in the termination processing handler registration unit. Note that it is assumed that the Java program with the Java program identifier has a privilege of registering a termination processing handler. Then the process goes to S. Meanwhile since the Java program with the Java program identifier does not have a termination processing handler it goes to S without registering the termination processing handler.

It is assumed that the Java program with the Java program identifier specified factor 2.0 and called setrate that is instructed trick play in S. Then the process goes to S. Meanwhile the Java program with the Java program identifier goes to S without instructing trick play. In S the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT of the version was detected in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 2.0 and therefore the update of the AIT is not allowed Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The process returns to S again.

Unless the further updated AIT is detected in S the process goes to S. It is assumed that the Java program with the Java program identifier specified factor 0.5 and called setRate that is instructed trick play of the speed of half the normal speed in S. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setrate for storing it. After that the process returns to S again

Here assuming that the updated AIT of the version was detected in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 0.5 and therefore the update of the AIT is allowed. In response to this the AIT monitoring unit starts analyzing the AIT which was detected this time. In other words Yes is chosen so that the process goes to S.

In the updated AIT of the version autostart is specified to the Java program with the Java program identifier executed in S. Since the Java program with the Java program identifier has already been executed the process goes to S where the execution thereof continues. On the other hand it is assumed that the control information of kill is specified to the Java program with the Java program identifier . Regarding the lava program with the Java program identifier the process goes to S where this program is terminated. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S.

In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . In this case since both identifiers are and identical the process goes to S where the trick play instructing program termination processing unit invokes the termination processing handler h of the Java program identifier registered in the termination processing handler registration unit . More specifically it calls the Java language code of setRate 1.0 written in the termination processing handler h. By doing so the reproduction of the service which has been reproduced in trick play mode returns to the normal reproduction speed.

As described above according to the fourth embodiment the analysis of the AIT is executed only in the case of the range of 0.0

Hereafter an apparatus and a method according to the fifth embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the fifth embodiment are same as those in the first embodiment of the present invention to are used therefor. As the constituent elements in this diagram have the same functions as in the first embodiment descriptions are not repeated.

The software configuration of the fifth embodiment is same as that shown in . As the constituent elements other than the AM are identical to those in the software configuration of the first embodiment descriptions are not repeated. As various data formats used in the fifth embodiment are same as shown in to in the first embodiment descriptions are not repeated.

The AM has the configuration shown in . Since the constituent elements other than the AIT update allowing unit and the AIT monitoring unit are same as those of the third embodiment descriptions are not repeated.

The AIT update allowing unit has the same function as in the third embodiment but it is assumed that it allows the update of the AIT only in the case of reproduction speed 1.0.

The AIT monitoring unit not only detects version upgrades of an AIT all the time but also starts section filtering in accordance with an instruction from the after mentioned trick play instructing program termination processing unit and detects the up to date AIT which can be obtained at the time of the section filtering.

The application status change instruction unit provides a function for allowing a Java program to change the status of itself and another Java program. For example it is possible for a Java program to forcibly terminate the execution of another Java program. The application status change instruction unit provides an AIT for allowing a Java program to terminate an arbitrary Java program. For example when a Java program identifier is specified the application status change instruction unit provides a Java program with an instance of a proxy class AppProxy for controlling the status of the Java program corresponding to that Java program identifier. AppProxy has methods such as start for starting the execution of the Java program stop for forcibly terminating the execution and the like.

If a Java program calls these methods it is possible to start and terminate the execution of a Java program corresponding to AppProxy. For example when stop is called the application status change instruction unit performs on the Java program corresponding to AppProxy the same processing as in the case where the control information of kill is specified in AIT. To be more specific the application status change instruction unit terminates the Java program and then notifies the trick play instructing program determination unit of the Java program identifier of the lava program which has been terminated.

The trick play instructing program termination processing unit cancels the trick play for the service which is currently under the trick play and then forces detection of an AIT. In other words 1.0 is set as a parameter factor so that the setRate floatfactor API of the JMF is called to reproduce the service at the normal speed. After that the trick play instructing program termination processing unit instructs the AIT monitoring unit to detect the up to date AIT which can be obtained at that time.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the IMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that the Java program specified with the control information of autostart in AIT is found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the AIT updated in S is not detected the process goes to S. Now assuming that AppProxy.stop was not called in S the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setrate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setrate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 2.0 and therefore the update of the AIT is not allowed. Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The control returns to S again.

Unless the further updated AIT is detected in S the process goes to S. Here it is assumed that in S the Java program specified its own Java program identifier to obtain an AppProxy instance and called its stop method. Then the process goes to S where the application status change instruction unit operates so as to cause the AM to terminate the Java program. Furthermore the AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . Since they are identical this time the process goes to S and the trick play instructing program termination processing unit specifies factor 1.0 and calls setRate .

By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed. Furthermore the trick play instructing program termination processing unit instructs the AIT monitoring unit to start detecting an AIT Therefore the process returns to S again where the Java program is executed or terminated based on the detected AIT. Since the reproduction speed is 1.0 at this point in time the analysis of the AIT which is detected subsequently is allowed in S.

As described above according to the fifth embodiment the analysis of the AIT is executed only in the case of the reproduction speed 1.0. And in the case where a Java program is terminated in accordance with control information of an AIT after instructing trick play of a service the trick play of the service is automatically cancelled returns to normal speed reproduction and the analysis of the up to date AIT at that point in time is executed.

Hereafter an apparatus and a method according to the sixth embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the sixth embodiment are same as those in the first embodiment of the present invention to are used here again. As the constituent elements in this diagram have the same functions as in the first embodiment descriptions are not repeated.

The software configurations of the sixth embodiment are same as those shown in and . As the constituent elements other than the AM and the trick play manager are same as those in the software configuration of the fifth embodiment descriptions are not repeated. As various data formats used in the sixth embodiment are same as shown in to in the first embodiment descriptions are not repeated.

The AM has the configuration shown in . Since the constituent elements other than the application status management unit are same as those of the fifth embodiment descriptions are not repeated.

In addition to performing the same functions as in the fifth embodiment the application status management unit forces termination of a Java program as in the case where the control information of kill is specified in AIT for example in the case where the Java program does not work due to lack of resources such as a memory and the like or in the case where something abnormal occurs in a system function required for operating the Java program and the system can not keep executing that Java program or in the case where the Java program itself is abnormally terminated because of an error or something abnormal which occurs therein or the like. In any case the application status management unit notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that the Java program specified with the control information of autostart in AIT is found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the updated AIT has not been detected in S the process goes to S. Now in S assuming that nothing abnormal causing termination of the Java program occurred the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 2.0 and therefore the update of the AIT is not allowed. Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The process returns to S again.

Unless the further updated AIT is detected in S the process goes to S. Here it is assumed in S that the Java program fell into an abnormal state in which it has to be terminated because of its own error. Then the process goes to S where the application status management unit terminates the Java program. Furthermore the application status management unit notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . Since they are identical this time the process goes to S and the trick play instructing program termination processing unit specifies factor 1.0 and calls setrate .

By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed. Furthermore the AIT monitoring unit is instructed to start detecting an AIT. Therefore the process returns to S again where the Java program is executed or terminated based on the detected AIT. Since the reproduction speed is 1.0 at this point in time the analysis of the AIT which is detected subsequently is allowed in S.

As described above according to the sixth embodiment the analysis of the AIT is executed only in the case of the reproduction speed 1.0. And in the case where a Java program is abnormally terminated after instructing trick play of a service the trick play of the service is automatically cancelled returns to normal speed reproduction and the analysis of the up to date AIT at that point in time is executed.

Note that it is also possible to configure the function of the trick play instructing program termination processing unit so that it can temporarily stop reproduction of a service which is in the trick play mode by specifying the trick play speed of 0.0 for the service and then detecting an AIT forcibly instead of by canceling the trick play of the service which is now in the trick play mode and then detecting the AIT forcibly. In other words 0.0 is set as a parameter factor so that the setrat floatfactor API of the JMF is called to temporarily stop the reproduction of the service. After that the AIT monitoring unit is instructed to detect the up to date AIT which can be obtained at that time.

Hereafter an apparatus and a method according to the seventh embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the seventh embodiment are same as those in the first embodiment of the present invention to are used here again. As the constituent elements in this diagram have the same functions as in the first embodiment descriptions are not repeated.

The software configurations of the seventh embodiment are same as those shown in and . As the constituent elements other than the trick play manager are same as those in the software configuration of the sixth embodiment descriptions are not repeated. As various data formats used in the seventh embodiment are same as shown in to in the first embodiment descriptions are not repeated.

The trick play manager has a configuration shown in . Since the trick play instructing program determination unit and the trick play instructing program information holding unit are same as those of the sixth embodiment descriptions are not repeated.

The trick play instructing program termination processing unit specifies a record identifier to the service manager so as to cause it to start reproducing a new service. The record identifier to be specified is obtained from the after mentioned alternative record identifier registration unit . At the same time the reproduction speed of the service is set to be a normal speed by calling setRate 1.0 using the JMF

The alternative record identifier registration unit causes a Java program to input a record identifier. Reproduction of an running service is terminated when the Java program is terminated and reproduction of a new service identified by this record identifier starts. The alternative record identifier registration unit provides the Java program with a registerRecordID int recordID method as an API. When the Java program sets a record identifier as recordID and calls this method the alternative record identifier registration unit stores the record identifier. This record identifier is given to the trick play instructing program termination processing unit .

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. No lava program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that the Java program specified with the control information of autostart in AIT is found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the updated AIT has not been detected in S the process goes to S. Now in S assuming that nothing abnormal causing termination of the lava program occurred the process goes to S. It is assumed that in S the lava program called a method of registerRecordID RecordID for identifying an alternative record identifier using the alternative record identifier registration unit . Then the process goes to S where the alternative record identifier registration unit stores that record identifier.

Next it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the lava program which has called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not the update of the AIT is allowed but the current reproduction speed is 2.0 and therefore the update of the AIT is not allowed. Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The control returns to S again.

Unless the further updated AIT is detected in S the process goes to S. Here it is assumed in S that the Java program fell into an abnormal state in which it has to be terminated because of its own error. Then the process goes to S where the application status management unit terminates the Java program. Furthermore the application status management unit notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AN has a Java program identifier identical to that stored in the trick play instructing program information holding unit . Since they are identical this time the process goes to S where the trick play instructing program termination processing unit specifies the alternative record identifier obtained from the alternative record identifier registration unit to the service manager so as to cause it to start reproducing a new service. At the same time the trick play instructing program termination processing unit specifies factor 1.0 and calls setrate .

By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed. In other words the reproduction of the service identified by the alternative service record identifier starts at the normal speed. Furthermore the AIT monitoring unit is instructed to start detecting an AIT. Therefore the process returns to S again where the Java program is executed or terminated based on the detected AIT. Since the reproduction speed is 1.0 at this point in time the analysis of the AIT which is detected subsequently is allowed in S.

As described above according to the seventh embodiment the analysis of the AIT is executed only in the case of the reproduction speed 1.0. And in the case where a Java program is terminated in accordance with control information of an AIT after instructing trick play of a service reproduction of a separately identified alternative service is started while trick play of the service is automatically cancelled and returns to normal speed reproduction and the analysis of the up to date AIT at that point in time is executed.

Note that it is also possible to configure the function of the trick play instructing program termination processing unit so that it can temporarily stop reproduction of a service which is in the trick play mode by specifying the trick play speed of 0.0 for the service and then detecting an AIT forcibly instead of by canceling the trick play of the service which is now in the trick play mode and then detecting the AIT forcibly. In other words 0.0 is set as a parameter factor so that the setRat floatfactor API of the JMF is called to temporarily stop the reproduction of the service. After that the AIT monitoring unit is instructed to detect the up to date AIT which can be obtained at that time.

Hereafter an apparatus and a method according to the eighth embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the eighth embodiment are same as those in the first embodiment of the present invention to are used here again. As the constituent elements in these diagrams have the same functions as in the first embodiment descriptions are not repeated.

As various data formats used in the eighth embodiment are same as shown in and in the first embodiment as well as shown in and which are additionally used in the eighth embodiment. Since descriptions of and are same as in the first embodiment such descriptions are not repeated. and show AITs in which a trick play compliant flag is added to the AIT shown in . The trick play compliant flag is a flag specifying whether the Java program is to be executed or not during the trick play of the service. To be more specific a Java program in which the trick play compliant flag indicates true is executed even during the trick play of the service. On the other hand a Java program in which the trick play compliant flag indicates false is forcibly terminated immediately after the trick play of the service starts.

The software configuration of the eighth embodiment is same as that shown in and . In as the constituent elements other than the JMF the AM and the trick play manager are same as those in the software configuration of the first embodiment descriptions are not repeated.

In addition to the operations described in the first embodiment the JMF notifies the application status management unit of the AM that trick play has been started when setRate float factor of the value other than factor 1.0 is called.

In addition to the operations described in the first embodiment the application status management unit in the AM performs the following operations. When the IMF notifies the application status management unit that trick play has been started the application status management unit examines the trick play compliant flag written in the AIT regarding the running Java program. If the value of the trick play compliant flag of the running Java program is true the JMF continues the execution of the Java program. If the value of the trick play compliant flag of the running Java program is false the JMF terminates the Java program immediately and further notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated In other words the JMF performs the same operations as in the case where the control information kill is specified to that Java program.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

Assuming here that an AIT shown in was detected Yes is chosen and the process goes to S. It is assumed that a Java program with a Java program identifier 301 specified with the control information of autostart in AIT was found in S. In that case the process goes to S where the Java program with the Java program identifier 301 is executed. After that the process goes to S. Here since the running Java program is the Java program with the Java program identifier 301 only the trick play compliant flag thereof is read. As the flag indicates true in this case the process returns to S.

In S an updated AIT is not detected because the AIT shown in is still being received and the process goes to S.

Next it is assumed that the Java program with the Java program identifier 301 specified factor 2.0 and called setRate that is instructed trick play in S. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier 301 of the Java program which called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT shown in was detected in S the process goes to S. In the AIT shown in autostart is specified as the control information of the Java program with the Java program identifier 301 and therefore the process goes to S. However nothing is done there because the execution of the Java program with the Java program identifier 301 has already been started and the process goes to S.

In S it is confirmed that the value of the trick play compliant flag specified in the running Java program with the Java program identifier 301 is false with reference to the AIT shown in . Then the process goes to S where the Java program is terminated and the Java program identifier 301 is notified to the trick play instructing program determination unit. Then the trick play instructing program determination unit compares the value of the Java program identifier stored in the trick play instructing program information holding unit with the value of the notified identifier of the terminated Java program. Both values are and identical and therefore the process goes to S. In S the speed for reading the MPEG 2 transport stream from the secondary storage unit is changed to 1.0. In other words the service is reproduced at the normal speed.

As described above according to the eighth embodiment in the case where a Java program is terminated in accordance with the change of a trick play compliant flag in AIT after instructing trick play of a service the trick play of the service is automatically cancelled and returns to normal speed reproduction.

Note that it is also possible to configure the function of the trick play instructing program termination processing unit so that it can temporarily stop reproduction of a service which is now being reproduced in trick play mode by specifying the trick play speed of 0.0 for the service and then calling setRate float factor API of the JMF instead of by canceling the trick play of the service which is now being reproduced in trick play mode.

Hereafter an apparatus and a method according to the ninth embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the ninth embodiment are same as those in the first embodiment of the present invention to are used here again. As the constituent elements in these diagrams have the same functions as in the first embodiment descriptions are not repeated.

Various data formats used in the ninth embodiment are same as shown in and in the eighth embodiment. Because these are the same ones as described in the eighth embodiment descriptions are not repeated.

The software configuration of the ninth embodiment is same as that shown in and . As the constituent elements shown in are same as those in the software configuration of the eighth embodiment descriptions are not repeated. As the constituent elements shown in are same as those in the software configuration of the second embodiment descriptions are not repeated.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

Assuming here that an AIT shown in was detected Yes is chosen and the process goes to S. It is assumed that a Java program with a Java program identifier 301 specified with the control information of autostart in AIT was found in S. In that case the process goes to S where the Java program with the Java program identifier 301 is executed. After that the process goes to S. Here since the running Java program is the Java program with the Java program identifier 301 only the trick play compliant flag thereof is read. As the flag indicates true in this case the process returns to S.

In S an updated AIT is not detected because the AIT shown in is still being received and the process goes to S.

It is assumed here in S that the Java program with the Java program identifier has its own termination processing handler h. It is assumed that in that termination processing handler setRate 1.0 is written as Java language code for returning trick play to a normal speed. Then the Java program with the Java program identifier calls registerHandler h so as to register the handler h in the termination processing handler registration unit. Note that it is assumed that the Java program with the Java program identifier has a privilege of registering a termination processing handler. Then the process goes to S.

Next it is assumed that the Java program with the Java program identifier 301 specified factor 2.0 and called setRate that is instructed trick play in S. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier 301 of the Java program which called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT shown in was detected in S the process goes to S In the AIT shown in autostart is specified as the control information of the Java program with the Java program identifier 301 and therefore the process goes to S. However nothing is done there because the execution of the Java program with the Java program identifier 301 has already been started and the process goes to S.

In S it is confirmed that the value of the trick play compliant flag specified in the running Java program with the Java program identifier 301 is false with reference to the AIT shown in . Then the process goes to S where the Java program is terminated and the Java program identifier 301 is notified to the trick play instructing program determination unit. Then the trick play instructing program determination unit compares the value of the Java program identifier stored in the trick play instructing program information holding unit with the value of the notified identifier of the terminated Java program. Both values are and identical and therefore the process goes to S.

In the trick play instructing program termination processing unit invokes the termination processing handler h of the Java program identifier registered in the termination processing handler registration unit . More specifically it calls the Java language code of setrate 1.0 written in the termination processing handler h. By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed.

As described above according to the ninth embodiment it is possible to execute a separately registered termination processing handler when a Java program is terminated in accordance with a change in a trick play compliant flag in AIT after the Java program instructs trick play of a service so as to execute arbitrary Java language code.

Hereafter an apparatus and a method according to the tenth embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the tenth embodiment are same as those in the first embodiment of the present invention to are used here again. As the constituent elements in these diagrams have the same functions as in the first embodiment descriptions are not repeated.

Since descriptions of and are same as in the first embodiment such descriptions are not repeated. shows an AIT in which a trick play control flag is added to the AIT shown in . The trick play control flag is a flag specifying whether a lava program is to be started up or terminated in accordance with the control information of an AIT during trick play of a service. To be more specific a Java program in which the trick play control flag indicates true is started up or terminated in accordance with a change in the control information even during trick play of a service. On the other hand a Java program in which the trick play control flag indicates false ignores a change in the control information as is the case with the fifth embodiment after the trick play of the service starts.

The software configuration of the tenth embodiment is same as that shown in . As the constituent elements other than the AM are same as those in the software configuration of the First embodiment descriptions are not repeated.

The AM has a function of ignoring an update of an AIT in accordance with the current reproduction speed and the trick play control flag in addition to the functions of the first embodiment. shows a configuration diagram of the AM in the tenth embodiment. Since the AIT monitoring unit and the application status management unit are same as the AIT monitoring unit and the application status management unit in the third embodiment descriptions are not repeated. In addition they are same as in the third embodiment in that an update of an AIT by a version upgrade is allowed only in the case where the ATT update allowing unit allows to do so but different from the third embodiment in the conditions for allowing such update of an AIT by a version upgrade.

The AIT update allowing unit allows the analysis of a new updated AIT in the case where a trick play speed which is currently effective to a service is 1.0 or in the case where the trick play speed is a value other than 1.0 and the value of a trick play control flag is true . When requested to determine whether or not to allow the analysis of the AIT the AIT update allowing unit inquires of the JMF about the current reproduction speed. The IMF sends back the trick play speed set in setRate .

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

It is assumed here that an updated AIT of a new version is detected Yes is chosen so that the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that a Java program specified control information of autostart and a trick play control flag of false was found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the AIT updated in S was not detected the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setrate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not to allow the update of the AIT but the current reproduction speed is 2.0 and the value of the trick play control flag written in the AIT is false and therefore the update of the AIT is not allowed. Therefore even if the control information of kill is written in the updated AIT for the running Java program the Java program is not terminated and continued to be executed. The control returns to S again.

Assuming that an updated AIT of a new version was detected in S when the reading speed of the MPEG 2 transport stream is a normal speed Yes is chosen so that the process goes to S. No Java program is now being executed and no trick play is specified. Since the reproduction speed is 1.0 the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S. It is assumed that a Java program specified control information of autostart and a trick play control flag of true was found in S. In that case the process goes to S to execute the Java program. After that the process returns to S.

Here in the case where the AIT updated in S was not detected the process goes to S. It is judged in S whether the Java program instructed trick play or not. Now it is assumed that the Java program specified factor 2.0 and called setRate in S that is instructed trick play. Then the process goes to S where the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which has called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT was detected again in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not to allow the update of the AIT but the current reproduction speed is 2.0 and the value of the trick play control flag is true and therefore the update of the AIT is allowed. In response to this the AIT monitoring unit starts analyzing the AIT which was detected this time. In other words Yes is chosen so that the process goes to S.

In S it is assumed that in the updated AIT the control information of kill has been specified for the Java program which was first executed in S. Then the process goes to S where the AN terminates that Java program. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S. In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . Since they are identical this time the process goes to S and the trick play instructing program termination processing unit specifies factor 1.0 and calls setRate . By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed.

As described above according to the tenth embodiment the analysis of the AIT is executed only in the case where the reproduction speed is 1.0 or in the case where the reproduction speed is a value other than 1.0 and the value of the trick play control flag is true . And in the case where a Java program is terminated in accordance with control information of an AIT after instructing trick play of a service the trick play of the service is automatically cancelled and returns to normal speed reproduction.

Note that it is also possible in the present embodiment to temporarily stop a service when setrate float factor API of the JMF is called if the trick play instructing program termination processing unit changes the configuration for setting 0.0 as a parameter factor instead of 1.0.

Hereafter an apparatus and a method according to the eleventh embodiment of the present invention are described with reference to the drawings.

Since the hardware configuration and the like used in the eleventh embodiment are same as those in the tenth embodiment of the present invention to are used here again. As the constituent elements in these diagrams have the same functions as in the tenth embodiment descriptions are not repeated.

The software configuration of the eleventh embodiment is same as that shown in and . As the constituent elements other than the trick play manager are same as those in the software configuration of the tenth embodiment and the trick play manager is same as that in the second embodiment descriptions are not repeated. As various data formats used in the eleventh embodiment are same as shown in and in the first embodiment as well as shown in in the tenth embodiment descriptions are not repeated.

A typical operation in the present embodiment having the above explained configuration is described below using a flowchart.

First it is assumed that a user instructs the EPG to reproduce a service within an MPEG 2 transport stream. Then in S the service manager is given an instruction to reproduce the service within the MPEG 2 transport stream recorded in the secondary storage unit and the record identifier identifying that service.

Since the service manager instructs the JMF to reproduce video and audio within the MPEG 2 transport stream recorded in the secondary storage unit the video and audio are reproduced in S.

In addition since the service manager instructs the AM to detect an AIT within the MPEG 2 transport stream recorded in the secondary storage unit the AIT monitoring unit of the AM starts detecting an AIT in S.

In the eleventh embodiment it is assumed that the AIT of the version shown in the AIT of the version shown in and the AIT of the version shown in are multiplexed into the MPEG 2 transport stream. Each element in these diagrams has the same meaning as described in the tenth embodiment.

Assuming here that the AIT of the version was detected Yes is chosen and the process goes to S. No Java program is now being executed and no trick play is specified. Therefore the reproduction speed is 1.0 and the AIT allowing unit allows the update of the AIT. In response to this the AIT monitoring unit starts analyzing the AIT. In other words Yes is chosen so that the process goes to S.

In S Java program identifiers and are found as Java programs specified with control information of autastart in AIT. Therefore regarding these Java programs the process goes to S where the Java programs are executed. After that the process returns to S.

Here in the case where the AIT newly updated in S is not detected the process goes to S. It is assumed here that the Java program with the Java program identifier has its own termination processing handler h. It is assumed that in that termination processing handler setRate 1.0 is written as Java language code for returning trick play to a standard speed. Then the Java program with the Java program identifier calls registerHandler h so as to register the handler h in the termination processing handler registration unit. Note that it is assumed that the Java program with the Java program identifier has a privilege of registering a termination processing handier. Then the process goes to S. Meanwhile since the Java program with the Java program identifier does not have a termination processing handler it goes to S without registering the termination processing handler.

It is assumed that the Java program with the Java program identifier specified factor 2.0 and called setrate that is instructed trick play in S. Then the process goes to S. Meanwhile the Java program with the Java program identifier goes to S without instructing trick play. In S the JMF controls the secondary storage unit to set the speed for reading the MPEG 2 transport stream at the double speed of the normal one. At the same time the JMF notifies the trick play instructing program information holding unit of the Java program identifier of the Java program which called setRate for storing it. After that the process returns to S again.

Here assuming that the updated AIT of the version was detected in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not to allow the update of the AIT. As the current reproduction speed is 2.0 and the trick play control flags corresponding to the Java program identifiers and are false and true respectively the update of the AIT is allowed only for the Java program of the Java program identifier . The control information of kill is written in the updated AIT for the Java program with the Java program identifier . Therefore regarding this Java program with the Java program identifier the process goes to S where the AM terminates this Java program. The AM notifies the trick play instructing program determination unit of the Java program identifier of the Java program which has been terminated and the process goes to S.

In S the trick play instructing program determination unit determines whether or not the Java program which has been terminated by the AM has a Java program identifier identical to that stored in the trick play instructing program information holding unit . In this case since both identifiers are and identical the process goes to S where the trick play instructing program termination processing unit invokes the termination processing handler h of the Java program identifier registered in the termination processing handler registration unit . More specifically it calls the Java language code of setRate 1.0 written in the termination processing handler h. By doing so the reproduction of the service which has been in the trick play mode returns to the normal reproduction speed. After that the control returns to S again.

Here assuming that the updated AIT of the version was detected in S the process goes to S. The AIT monitoring unit inquires of the AIT allowing unit whether or not to allow the update of the AIT but the current reproduction speed is 1.0 and therefore the update of the AIT is allowed. In response to this the AIT monitoring unit starts analyzing the AIT which was detected this time. In other words Yes is chosen so that the process goes to S.

In the updated AIT of the version kill is specified for the Java program with the Java program identifier executed in S. Therefore the AM terminates the Java program with the Java program identifier .

As described above according to the eleventh embodiment the analysis of the AIT is executed only in the case where the reproduction speed is 1.0 or in the case where the reproduction speed is a value other than 1.0 and the value of the trick play control flag is true . In addition it is possible to execute a separately registered termination processing handler when a Java program is terminated after the Java program instructs trick play of a service so as to execute arbitrary Java language code.

Hereafter an apparatus and a method according to the twelfth embodiment of the present invention are described with reference to the drawings.

The twelfth embodiment provides another hardware configuration for implementing the above described first to eleventh embodiments. The hardware configuration and the like used in the twelfth embodiment are shown in and .

In the case of a file system recorded within an MPEG 2 transport stream in a DSM CC file system format the section conversion unit converts this file system into a file system format unique to the recording area which is in turn unique to the terminal and records the file system into the recording area .

In addition in the case of an AIT the section conversion unit converts the AIT to an expanded record information management table format as shown in and records the AIT into the recording area . The record information management table shown in is an expanded version of the record information management table shown in and as the items identified by the same reference numbers in both tables have the same meaning as those in the record information management table shown in descriptions are omitted.

Each of rows and shows record information for one service. Each of the rows and has a record identifier a channel identifier a program number a service record start time a service record end time a media identifier and a reference to an AIT information management table. The AIT information management table has a media time and an AIT version corresponding thereto. The media time is a time that is a time of reproduction of the corresponding MPEG 2 transport stream and shows a position in the corresponding MPEG 2 transport stream.

An AIT version number corresponds to an AIT version in . For example record information of a service that has a record identifier of 001 has a media identifier of TS002 and at the media time of 00 00 00 in the referred AIT information management table the corresponding AIT version is 1 . In the same manner the AIT version corresponding to the media time of 00 05 00 is 2 and the AIT version corresponding to the media time of 00 20 00 is 3 . At the time of reproduction of the service that has a channel identifier of 001 referring to the record information management table the MPEG 2 transport stream that is multiplexed with the video and audio identified by the media identifier of TS002 is reproduced in addition referring to the AIT information management table when the media time reaches 00 00 00 control for starting up or terminating the Java program is performed in accordance with the AIT with an AIT version of 1 .

In a similar manner the control for starting up or terminating the Java program is performed in accordance with the AIT with an AIT version of 2 when the media time reaches 00 05 00 and in accordance with the AIT with an AIT version number of 3 when the media time reaches 00 20 00 respectively. The actual AIT is converted as a binary file in private section format into the file system format unique to the recording area which is in turn unique to the terminal and is recorded into the recording area . The recorded file is given a unique file name by which it can be uniquely identified and which is recorded in the record information management table as an AIT file name .

In an actual broadcast wave AITs with the same AIT version are repeatedly transmitted any number of times but in the present embodiment by detecting a change in the received AIT version only the first AIT that is updated at that point in time is recorded into the recording area .

The hardware configuration of differs from that in in that the section recorded into the recording area is read into the primary storage through the section readout unit without going through the TS decoder. The section readout unit searches for the media time that corresponds to the present reproduction time of the MPEG 2 transport stream read out from the recording area and reads out from a file the AIT and DSM CC file system corresponding to that media time and passes these to the AIT monitoring unit . In other words the AIT monitoring unit shown in and the like does not refer to a filtering result of the TS decoder but rather obtains an AIT binary file and a DSM CC file system from the section readout unit .

Here the case where the service corresponding to the channel identifier of 001 is reproduced from the recording area based on the AIT shown in and the record information management table shown in is shown as an example.

When the service corresponding to the channel identifier of 001 is identified as a service to be reproduced video and audio belonging to the service as well as a Java program belonging to the service are respectively reproduced and started up.

In the case where the media time at which reproduction starts is not specified reproduction starts at the media time of 00 00 00 . To be more specific as video and audio an MPEG 2 transport stream having a media identifier of TS002 corresponding to a record identifier of 001 is reproduced from the media time of 00 00 00 . Referring to the ATI information management table the AIT version corresponding to the media time of 00 00 00 is 1 and therefore an AIT of the AIT version of 1 is read out from the AIT file. Based on the details of the AIT a Java program corresponding to a program name of the control information of autostart is started up.

Next reproduction of the service is continued and when the position at which the MPEG 2 transport stream corresponding to the media identifier of TS002 is being reproduced reaches a media time of 00 05 00 a Java program corresponding to a program name of the control information of autostart is started up based on the AIT of the AIT version of 2 because the AIT version corresponding to the media time of 00 05 00 is 2 referring to the AIT information management table and a Java program corresponding to a program name of the control information of destroy or kill is terminated. Here referring to as a program name of the control information of destroy is b MusicXlet and a program name of the control information of kill is z StudyXlet Java programs corresponding to these program names are terminated if they are being executed at the media time of 00 05 00 .

Next reproduction of the service is continued and when the position at which the MPEG 2 transport stream corresponding to the media identifier of TS002 is being reproduced reaches a media time of 00 20 00 a Java program corresponding to a program name of the control information of autostart is started up based on the AIT of the AIT version of 3 because the AIT version corresponding to the media time of 00 20 00 is 3 referring to the AIT information management table and a Java program corresponding to a program name of the control information of destroy or kill is terminated.

According to the twelfth embodiment as described above it is possible to reproduce a service by combining video and audio multiplexed by a multiplexer with a DSM CC file system and an AIT file separately recorded in another format according to the first to eleventh embodiments. Accordingly a DSM CC file system and an AIT which have been transmitted repeatedly in broadcast need to be recorded only once when they are updated and therefore it is possible to reduce consumption of storage capacity of a recording area.

Some of the embodiments described above indicate the implementation examples of the present invention but other embodiments can be implemented as long as the objects of the present invention are achieved.

In the embodiments a configuration for a cable system has been shown but the present invention can be applied independent of the type of a broadcast system. For example the present invention can easily be applied to a satellite system a ground wave system or a TV show distribution system that uses an IP network. In addition as the present invention has no direct relationship with the differences between respective broadcast systems the present invention can be applied to an arbitrary transmission medium regardless of the broadcast system. The present invention is also applicable regardless of whether the system is a wired or wireless system.

It is not necessary for the AV decoder to decode video and audio at the same time. The present invention can be implemented even if the AV decoder is configured as separate video and audio decoders. In addition the AV decoder may have a decoding function for data such as closed captioning and the like without any interference. The audio signal and video signal decoded by the AV decoder may be scrambled at any stage up until being stored in the recording area .

In the embodiments an example is given in which an adapter that controls conditional access system has been introduced but the adapter is not always necessary for the implementation of the present invention. The adapter may be of any format and a configuration without the adapter is also possible. In such a case in the MPEG 2 transport stream from the tuner is inputted directly into the TS decoder. The present invention is applicable in such a case as well. In addition descrambling the MPEG 2 transport stream by the adapter does not necessarily have to be carried out before the TS decoder. A configuration in which the adapter is in an arbitrary position and is used to descramble the MPEG 2 transport stream is easily implementable and the present invention is applicable in such a case as well.

Regarding an encoding format into which the AV encoder encodes the audio and video signal an arbitrary format is acceptable. The present invention is applicable regardless of the encoding format.

A multiplexing format of the multiplexer may also be an arbitrary format. The present invention is applicable regardless of the multiplexing format.

The display and the speaker may be contained within the broadcast recording and reproduction apparatus or an external display and speaker may be connected to the broadcast recording and reproduction apparatus. The present invention is applicable regardless of the location and number of the display and speaker.

The present invention can be implemented even if the CPU itself is a system which performs multiple processes the processes being all or some of TS decoding AV decoding AV encoding and multiplexing.

As a format for recording the service the MPEG 2 transport stream can also be recorded directly into the recording area after being outputted from the tuner without going through the TS decoder or the format of the MPEG 2 transport stream from the tuner can be converted by installing a translator that converts the format of the MPEG 2 transport stream and recorded into the recording area. The present invention can be implemented regardless of the service recording method.

Some of the Java virtual machines translate the bytecode into an executable form which can be interpreted by the CPU and pass the resultant to the CPU which executes it the present invention is applicable in such a case as well.

The above embodiments describe a method for implementation regarding the AIT in which the transport stream is obtained from In band however the method for referring to the Java program which the AM shall execute does not solely depend on the AIT. In OCAP which is assumed to be used by the United States cable system an XAIT which has registered reference information of an application program in the OOB denoted in is used. In addition methods such as starting a program pre recorded in the ROM starting a program downloaded and recorded in the secondary storage unit and so on can be considered.

Although only some exemplary embodiments of this invention have been described in detail above those skilled in the art will readily appreciate that many modifications are possible in the exemplary embodiments without materially departing from the novel teachings and advantages of this invention. Accordingly all such modifications are intended to be included within the scope of this invention.

According to the recording and reproduction apparatus and the recording and reproduction method according to the present invention it is possible to hold a program that instructed trick play of video and audio to determine whether or not a program is identical to the program that instructed the trick play when the program is terminated and if it is identical to the program that instructed the trick play to cancel the trick play of the video and audio so as to cancel redundant trick play in a time interval unexpected by the program. Therefore it is highly possible that the present invention is used in the consumer electronics industry particularly involving broadcast recording and reproduction apparatuses. For example the present invention is applicable to a cable STB digital TV and the like. Furthermore the present invention is also applicable in devices with a broadcast receiving function such as for example a cellular phone device and the like.

