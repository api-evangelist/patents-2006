---

title: System and method for the secure enrollment of devices with a clearinghouse server for internet telephony and multimedia communications
abstract: Enrolling devices with a clearinghouse server for Internet telephony and multimedia communications. Enrollment can be the process of taking a network device (such as a router, gateway, gatekeeper, etc.) and exchanging encrypted information with the clearinghouse server, so that later communications with that device can be secured. The enrollment is done with levels of security and verification that ensures the devices and clearinghouse server is legitimate.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07398551&OS=07398551&RS=07398551
owner: TransNexus, Inc.
number: 07398551
owner_city: Atlanta
owner_country: US
publication_date: 20060814
---
This application is a continuation of and claims priority to application Ser. No. 09 747 365 filed Dec. 22 2000 now U.S. Pat. No. 7 203 956 entitled System and Method for Secure Enrollment of Devices with a Clearinghouse Server for Internet Telephony and Multimedia Communications the entire contents of which are incorporated by reference.

The present invention is generally directed to telephony and multimedia communications carried by a distributed computer network such as the global Internet. More specifically the present invention relates to the secure enrollment of devices with a clearinghouse server so that communication can be routed between an originating device and a terminating device via the Internet.

Telecommunications networks are experiencing a drastic technology shift from a circuit switched architecture such as the current voice phone network to a packet switched architecture such as the global Internet . Worldwide the capacity of deployed packet switched networks is doubling every year while circuit switched capacity is only increasing at an annual rate of around 6 . In many developed regions packet switched capacity already exceeds circuit switched capacity. Recognizing this trend telecommunications providers have begun to optimize their networks for the technology that is expected to dominate future growth packet switching. As they deploy packet switched technology these providers must still support traditional circuit switched applications such as voice and facsimile. Instead of operating parallel network infrastructures however clearinghouse service providers seek to support those applications over a packet switched network. This approach offers several advantages greater efficiency through the use of a single common network infrastructure lower cost through a reliance on packet switching equipment and better support of innovative new services through an open architecture.

As circuit switched applications move to a packet switched network service providers need a way to identify systems on the packet switched network that are associated with addresses typically telephone numbers common to the circuit switched world. Providers must also have a means to authorize communications and to ensure that unauthorized communications do not consume bandwidth. For example the provisioning of a physical circuit switched connection between two providers typically serves as authorization for the providers to share traffic. In a packet switched environment however communicating parties need not share a physical connection and some other means of authorizing traffic is required. Finally providers must have a reliable way to collect information from packet switched devices to account for customer usage e.g. for billing .

There remains a need in the art for a convenient centralized application to provide authorization or enrollment for circuit switched applications in a packet switched network environment. Enrollment is the process of taking a device and exchanging sufficient cryptographic information with the clearinghouse server so that later communications with that device can be secured.

The conventional art does not provide an effective secure way to enroll a device with a clearinghouse server. In particular the identity of the clearinghouse server is verified by a telephone call. This verification has many drawbacks. Telephone calls are not automated and require contact with people. As people have certain work hours and cannot be relied upon to always be available the telephone call verification is impractical and time consuming. In addition as packet switched architecture becomes more and more popular this problem will become more pronounced.

The present invention provides for the secure enrollment of a device for operation with a clearinghouse server also described as a clearinghouse enrollment server so that telephony and multimedia communications can be routed between an originating device and a terminating device via the Internet. The enrollment process is typically completed by a network device such as a router gateway gatekeeper etc. and the clearinghouse server. This source device and the clearinghouse server can exchange encrypted information so that later communications with that device can be secured. Once this verification process is finished the device can have a public key certificate that is valid for a certain length of time such as one year . Once this length of time has passed however the certificate can expire and the device must re enroll. The enrollment process can also provide the device with a certificate authority s CA public key certificate. The device can use the CA s certificate to authenticate subsequent communications from other clearinghouse servers.

To enroll the device can tell the clearinghouse server its public key. Then the device can prove that it possesses the private key that corresponds to the public key. This can be done by taking information provided by the clearinghouse enrollment server and having the device encrypt it with the private key. The device can then send this information to the clearinghouse enrollment server. If the clearinghouse enrollment server can then decrypt the information the clearinghouse enrollment server can verify that the device possesses the private key.

When the device tells the clearinghouse enrollment server its public key a security issue arises. If an illegitimate user successfully intercepts redirects or captures the public key when it is sent to the clearinghouse enrollment server the illegitimate user could take the place of the legitimate clearinghouse server. The illegitimate user could then be able to decrypt the encrypted message that the device sends and would seem to be a legitimate clearinghouse enrollment server. Thus the identity of the clearinghouse enrollment server must be verified.

Rather than using the conventional telephone call to verify the clearinghouse enrollment server s identity the present invention can rely on the Web infrastructure to securely identify the clearinghouse enrollment server. The present invention does this by having the device pre configured with a third party CA certificate. The clearinghouse enrollment server obtains a public key certificate under the authority of this CA certificate and it provides that certificate along with proof of possession of the corresponding private key in the initial communications with the device.

In view of the foregoing it will be appreciated that the present invention provides a method for secure enrollment of a device with services of a clearinghouse enrollment server to supporting communications carried by an Internet telephony system. A device can initiate a request to enroll for the services of the clearinghouse enrollment server. In turn the identity of the clearinghouse enrollment server is verified a communication exchange between the device and the clearinghouse enrollment server. This exchange is supported by use of a security infrastructure comprising the Secure Sockets Layer SSL and a public key infrastructure. In response to verifying the identity of the clearinghouse enrollment server enrollment of the device is completed at the clearinghouse enrollment server to all the device to access the communication services of the Internet telephony network.

More specifically the present invention provides a for secure enrollment of a device with services of a clearinghouse server for an Internet telephony system. In response to obtaining an identity of the clearinghouse server the device issues a CA certificate request to the clearinghouse server using that obtained identity. In response to the CA certificate request the clearinghouse server transmits a CA certificate to the device. The device next determines whether the clearinghouse is a valid and secure service provider by verifying the CA certificate. Responsive to verification of the CA certificate the device generates a combination of a private key and a public key and issues to the clearinghouse server a request for enrollment comprising the public key. In turn the clearinghouse server generates a public key certificate and transmits the public key certificate to the device. This enables the device to securely verify the identity of the clearinghouse server and to complete device enrollment at the clearinghouse server.

These and other aspects of the present invention will be shown in the attached drawing set and following detailed description.

The present invention provides a clearinghouse solution for routing multi media communications including telephony calls between a source device and a destination device via a distributed computer network such as the global Internet. The present invention also authorizes the completion of a communication from a source device to a destination device and collects usage related information for the completed communication. The clearinghouse server constructed in accordance with the inventive concept can identify one or more available destination devices available to accept a communication from an authorized source device based upon the source of that communication. An exemplary embodiment of the clearinghouse server can operate in either a WINDOWS or SOLARIS operating system environment in support of Web based communications in a distributed computer network.

Turning now to the drawings in which like reference numbers identify like elements of exemplary embodiments of the present invention is a functional block diagram illustrating a representative operating environment for an exemplary embodiment of the present invention. A communication system comprises one or more originating devices such as gateways one or more terminating devices such as gateways device operators and for each of the two devices a clearinghouse server and a third party server each coupled to an Internet Protocol IP network . Although illustrates an operating environment including only a single originating gateway and a single terminating gateway those skilled in the art will appreciate that the operating environment of the communication system can include multiple originating gateways and terminating gateways. For purposes of this document an originating gateway will be referred to as a source device and a terminating gateway will be referred to as a terminating device. The IP network represents a distributing computer network and can be implemented by the global Internet a wide area network WAN or an enterprise wide local area network LAN .

To initiate a communication supported by the communication system a calling party sends an outgoing call having a called telephone number to the source device . For this representative example the calling party has an established a relationship with the source device such as a subscription to call origination services provided by that source device. To be an authorized user of the clearinghouse services provided by the clearinghouse server the gateway operators or can enroll source device and destination device for operation with the clearinghouse server . The enrollment process involves the exchange of information between the gateway operators or the clearinghouse server and the third party server . not affiliated with either the operators or clearinghouse server . This enrollment process is the subject of the present invention. Following the enrollment process the source device sends an authorization request message to the clearinghouse server via the IP network to request the completion of the outgoing call with an available designation device . The authorization request typically comprises the called telephone number otherwise described as the dialed number a call identifier to uniquely identify the outgoing call and for certain applications the telephone number for the calling party and payment authorization such as a calling card number and a personal identification number PIN .

If the clearinghouse server determines that the source device is an authorized user of clearinghouse services the clearinghouse server can identify one or more destination devices for handling the outgoing call. The source device can use the information provided by the clearinghouse server in the authorization response to contact a selected destination device and to complete the incoming call via the IP network . In turn the selected destination device can communicate the outgoing call to a called party typically via the Public Switched Telephone Network PSTN . In this manner the outgoing call is connected between the calling party and the called party by a combination of a distributed computer network and the PSTN.

The platform of the clearinghouse server is provided by the operating system which is preferably implemented by Microsoft Corporation s WINDOWS 2000 or Sun Microsystem s SOLARIS operating systems. Although the WINDOWS and the UNIX platforms represent preferred platforms it will be appreciated that the inventive concept of a clearinghouse server can be supported by other operating systems and is not limited to those described herein. The operating system communicates with the Web server .

The Web server supports Web based communications with client computers in a Web enabled computing environment including the source devices illustrated in . The XML parser can accept messages from the clearinghouse engine and convert those messages to XML format for communication via the Web server . The XML parser also can extract information from an XML message received by the Web server and supply the extracted information to the clearinghouse engine . The Web server also communicates with the user interface via application programming interfaces APIs . The Web server is preferably implemented by an XITAMI server available from iMatix Corporation sprl of Antwerpen Belgium.

The clearinghouse engine supports the processing of clearinghouse transactions and communicates with the operating system the Web server and the user interface . APIs can be used to access functions supported by the clearinghouse engine . The clearinghouse engine also can access configuration files maintained by the configuration database in support of clearinghouse transactions. The configuration files typically contain descriptive information identifying characteristics of enrolled source devices and clearinghouse transaction records including transaction identifiers assigned to transactions by the clearinghouse server .

The user interface provides a mechanism for a user such as an assistant administrator to input information about the clearinghouse environment including details about enrolled source devices and destination devices. The user interface also can present the user with information related to clearinghouse transaction records stored by the clearinghouse server .

Referring again to the present invention provides a system and method for the secure enrollment of a device for operation with a clearinghouse server . Enrollment is the process of taking a network device such as a router gateway gatekeeper etc. and exchanging encrypted information with the clearinghouse server so that later communications with that device can be secured. There are several types of devices including originating devices and terminating devices . As the process of enrollment is described all devices will be referred to as originating or source devices . This is not meant to limit the applicable devices to only source devices but is meant to illustrate that any type of device can be used. Once this process is finished the device should have a certificate that is valid for a certain length of time such as one year . Once this length of time has passed the certificate will expire and the device must re enroll.

This invention works for any type of service or device that requires secured communications. This includes devices under the direct control of human users like a personal computer or a IP based telephone and those that are automated and not under the direct control of human users.

In light of the discussion of public keys and private keys a general discussion of an exemplary encryption environment may prove beneficial for understanding the present invention. Encryption is the process of encoding data to prevent unauthorized access especially during transmission. Encryption is usually based on one or more keys or codes that are essential for decoding or returning the data to readable form. An encryption key is a sequence of data that is used to encrypt other data and that consequently must be used for the data s decryption. Decryption is the process of restoring encrypted data to its original form.

Public key encryption is a process that uses a pair of keys for encryption a private secret key and a public key. The private key can encrypt messages and can create a unique electronic number called a digital signature that can be read by anyone possessing the corresponding public key. The private key can also be used to decrypt messages encrypted with the public key. The public key can be used for encrypting messages to be sent to the user and for decrypting the user s digital signature.

A certification authority CA is an organization that assigns digital certificates. A CA may be an external issuing company such as VeriSign or an internal company authority that has installed its own certificate server such as a Microsoft Certificate Server for issuing and verifying certificates. A CA is responsible for verifying the identity of a party and if that identity is accepted digitally signing that party s public key certificate. Other parties that possess and trust the CA s public key can then verify the applicant s identity merely by verifying the CA s signature of the public key certificate.

A CA certificate sometimes called a digital certificate is a user identity card for cyberspace. Issued by a CA a CA certificate is an electronic credential that demonstrates that a user or site is trusted for the purpose of security and computer authentication.

The enrollment process begins when the device generates a public private key pair. It then establishes a secure communication channel with the clearinghouse enrollment server using the Secure Sockets Layer SSL protocol. The SSL exchange provides the device with a public key certificate for the enrollment server. That certificate is digitally signed by the third party certificate authority who therefore vouchsafes for the enrollment server s identity.

Once the secure communications path is established the enrollment server sends the device CA certificates of a potentially different certificate authority. Certificates certified by this additional CA will be used in subsequent communications with the clearinghouse. The additional CA may be the same CA as is authenticating the enrollment server but it need not be so. By permitting them to differ the present invention allows for different public key infrastructures for enrollment and for operational clearinghouse communications e.g. routing telephone calls .

After receiving the CA certificate the device then sends the enrollment server the previously generated public key. The enrollment server receives this public key and either immediately or at a later time e.g. after an administrator has verified that the customer intended to enroll the device in question the enrollment server issues the device a certificate containing the device s public key.

All messages sent to the clearinghouse enrollment server are carried in HTTP version 1.1 POST messages. All replies are returned in responses to the POST. Each POST request contains a series of ASCII variable value pairs encoded as given in RFC 1738. Any response also consists of variable value pairs. The following Table 1 lists the variables that can be included in a message. Note that non alphanumeric characters are encoded as a and their corresponding two hexadecimal digits as specified in RFC 1738. 

If the enrollment request is pending further approval then the enrollment server is only required to send the status of the certificate request. It may send a nonce along with the response but this value is not guaranteed. The response should look like the representative example shown in Table 5 

In step commands are issued at the source device to complete an enrollment request for transmission to the clearinghouse server. These commands are typically device dependent and often require support by an administrator to select the appropriate enrollment instructions. Representative enrollment request tasks completed by the source device for step are shown in the logical flow chart diagram of .

Turning briefly to the source device obtains the identity of the clearinghouse server in step . The identity is typically an IP address or a DNS name for the clearinghouse server. In step the source device obtains a certificate authority CA certificate from the clearinghouse server based upon an initial contact with the identified clearinghouse server via the IP network. In decision step an inquiry is conducted to determine if the CA certificate can be verified as a certificate issued by a trusted device. For example the verification task in decision step can be completed by an administrator of the source device contacting a representative of the services offered by the clearinghouse server to verify the CA certificate. If the CA certificate can not be verified in decision step the NO branch is followed to step and the enrollment request process is terminated at the source device. Based on a positive response however the YES branch is followed from decision step to step . In step the source device generates a public private key pair and sends an enrollment request with the public key to the clearinghouse server via the IP network. Upon device enrollment a configuration record or file for that device is constructed for storage in the configuration database accessible by the clearinghouse server.

Returning now to the source device sends an enrollment request via the IP network to the clearinghouse server in step . Responsive to the enrollment request the clearinghouse server creates a public key certificate and sends that certificate to the source device via the IP network. This public key can be used by the source device to initiate secure communications with the clearinghouse server. In step the clearinghouse server obtains device information and builds a configuration file for the source device. The configuration file is maintained at the configuration database and is accessible by the clearinghouse server. A representative configuration file is shown in Table 7.

Each line in a configuration file other than comments or blank lines contains a single configuration item. The first word on the line identifies that item. The possible values for this word are listed below in Table 8.

The same configuration item may be included multiple times in this file. In such cases the clearinghouse server s behavior depends on the specific item. In most cases later occurrences of an item will override an earlier value. For example if multiple license lines are included in the file only the last line will actually be used by the server. In the case of group device and route multiple occurrences define additional groups devices or routes. Note however that it is not possible to define multiple groups with the same name multiple devices with the same name or multiple routes with the same group and called number. If the configuration file attempts to define duplicates the server will generate an error when attempting to read and parse the file.

The content following the license keyword should be a software license key enclosed in double quotation marks. If this parameter is absent from the file or if the included license key is invalid the underlying software supporting operations of the clearinghouse server will revert to a trial version. New software license keys may be obtained from a licensor of the clearinghouse server software. They can either be added to the configuration file manually or imported into the server through the user interface. Imported license keys are stored in configuration backups. Unlike other configuration items old values of the license key are kept in the configuration file allowing a straightforward reversion to an earlier license by deleting the newest license keys as well as problem diagnosis and auditing.

The content following the crypto keyword should be cryptographic parameters for the clearinghouse server enclosed in double quotation marks. If this parameter is absent the clearinghouse server will automatically generate new cryptographic parameters. If this occurs though all enrolled devices will have to re enroll with the server to refresh their cryptographic knowledge.

The content following the enroll keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present device enrollment will be disabled.

The content following the routing keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present call routing will be disabled.

The content following the call details records cdrs keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present CDR collection will be disabled.

The content following the ssl keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate.

The content following the group keyword should be the name of the group. If the name consists of more than one word the entire name should be enclosed in double quotation marks.

The content following the device keyword should be the DNS name of the device the name of the group to which the device belongs enclosed in quotation marks if the name is more than one word the word enabled or disabled without the quotation marks and optionally the word enrolled also without quotation marks .

The content following the route keyword should be the name of the group to which the route applies enclosed in quotation marks if the name is more than one word the called number prefix for the routes enclosed in quotation marks if the number includes spaces and then a series of one or more device weight pairs where device is the DNS name of the destination device and weight is the weighting factor for that device.

It should be understood that the foregoing relates only to illustrative embodiments of the present invention and numerous changes may be made therein without departing from the spirit and scope of the invention as defined by the following claims.

