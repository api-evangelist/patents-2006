---

title: Loop detection in a communications network
abstract: A first node includes ports and a controller to receive a test packet at a first one of the ports. The first node determines whether the received test packet has a destination address that matches one or more predefined addresses associated with a second node. Presence of a loop in a communications network in which the first and second nodes are located is indicated in response to detecting receipt of the test packet containing the matching destination address.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08107382&OS=08107382&RS=08107382
owner: Avaya Holdings Limited
number: 08107382
owner_city: Basking Ridge
owner_country: US
publication_date: 20060331
---
In many enterprises e.g. companies governmental organizations educational or research organizations and so forth communications networks are implemented to enable the transport of information among users and devices. Examples of such networks include local area networks LANs wide area networks the Internet and so forth.

Communications networks typically include switching nodes such as Ethernet switches that are able to receive packets read the target address of each received packet and forward each packet to the appropriate port associated with the target network segment. A switching node or more simply a switch provides switching at the physical and data link layers of the OSI open systems interconnection reference model. Switching at layers and of the OSI reference model involves a combination of switches and routers with the routers making network and transport level decisions relative to establishment of a network path.

To reduce the likelihood of failures of communications networks communications networks often use failure management schemes that are able to overcome points of failure within the communications networks. The failure management schemes allow re routing around points of failure in the communications networks. In layer this can be accomplished by building a loop free topology such as by using techniques described in IEEE Institute of Electrical and Electronics Engineers 802.1D or other techniques.

However in some communications networks with failure management schemes loops can occur where a loop results from a combination of one or more network paths and any nodes in those one or more network paths that cause one network node to be connected back to itself through the combination of one or more network paths and any nodes in those one or more network paths . The presence of loops may cause various issues in communications networks including flooding of the networks with multicast or broadcast packets.

In general according to an embodiment a method comprises transmitting from a logical switch made up of at least two switching nodes a test packet to a communications network and detecting receipt of the test packet by at least one of the switching nodes in the logical switch. Presence of a loop in the communications network is indicated in response to detecting receipt of the test packet by the at least one switching node.

Other or alternative features will become apparent from the following description drawings and from the claims.

The aggregation switches and can be considered central switches for switching between or among edge switches or end stations. The aggregation switches and are connected by an inter switch trunk IST which includes one or more parallel point to point links. The aggregation switches and utilize the inter switch trunk to share information so that the pair of aggregation switches may operate as a single logical switch. The aggregation switches in the pair are considered peers of each other.

The arrangement is provided for the purpose of example. In other embodiments aggregation switch pairs that provide a single logical switch are not implemented. Also the distinction between aggregation and edge switches can be omitted with the network having multiple switches of the same type. Also there may be other network nodes that are part of the communications network that are not depicted in .

According to some implementations the architecture of is a split multilink trunking SMLT architecture such as the SMLT architecture provided by Nortel Networks Limited. The SMLT architecture provides a failure management scheme in which re routing around points of failure in the communications network can be accomplished. A multilink trunk MLT is a communications channel having multiple parallel point to point communications links that connect two switches where the multilink trunk aggregates multiple ports of the switches so that the ports logically behave as a single port with aggregated bandwidth. A standard describing MLT is the IEEE Institute of Electrical and Electronics Engineers 802.3ad standard.

In the example of a split multilink trunk SMLT is used which is basically a multilink trunk that is split between a pair of aggregation switches in the example of aggregation switches and . The SMLT connects the aggregation switches to the edge switch . The edge switch is unaware that the MLT is split at the aggregation switch pair side. Further details regarding SMLT can be found in U.S. Publication No. 2003 0097470 entitled System Device and Method for Improving Communication Network Reliability Using Trunk Splitting filed on Apr. 28 2002 by Roger Lapuh et al.

In other embodiments other types of network architectures can be used. Moreover switching nodes or more simply switches are intended to cover either layer switches or layers and or routers.

As depicted in there is a possibility that a loop is present in the communication network . If proper connections were made in the communications network among the various network nodes during network setup then the loop should not be present. However during communications network setup service personnel may make improper connections that result in the presence of the loop or even multiple loops . As depicted in the loop includes three network path segments A B and C. The presence of a loop may cause failures or other problems to occur in the communications network such as flooding of broadcast or multicast packets in which a large number of packets are communicated in the loop that can overwhelm network nodes in the communications network .

In accordance with some embodiments at least some of the network nodes of the communications network are capable of determining whether the loop or more than one loop is present in the communications network . Loop detection is accomplished by a network node such as the switching node sending a test packet out onto the communications network where the destination address specified in the test packet is the address of the switching node that transmitted the test packet. After transmitting the test packet the switching node is able to detect receipt of the test packet at the switching node . In some embodiments the test packet is sent from a first port of the switching node and received at a second port of the switching node . In other embodiments the test packet can be transmitted and received at the same port. Receipt of the test packet transmitted by the same switching node means that a loop is present in the communications network. In response to detection of the loop an action is taken to remove the loop such as by disabling one or more ports of the switching node .

In another scenario a test packet transmitted by a first switching node in an aggregation switch pair e.g. switching node is received by a second switching node e.g. switching node in the aggregation switch pair. Because the two switching nodes and are considered a single logical switch in the embodiment this test packet path test packet sent and received by different switching nodes of the same switch pair is also indicative of presence of a loop. In this scenario the presence of loop segments B and C is not even required to result in a loop condition. Normally if the edge switch is properly configured a packet received by one port of the edge switch from an aggregation switch pair will not be transmitted by the edge switch through another port of the edge switch back to the same aggregation switch pair. However if the edge switch is improperly configured incorrect configuration or lost configuration then routing of a packet received from an aggregation switch pair back to the aggregation switch pair may occur.

An example of a mis configuration at the edge switch that can cause this behavior includes lost configuration at the edge switch such that the ports of the edge switch connected to the aggregation switch pair are no longer configured as MLT ports. Since plural MLT ports at the edge switch to the aggregation switch port behave as a single logical port the edge switch will not forward a received packet back out over the logical port at which the packet was received. However if the MLT configuration is lost such that the plural ports between the edge switch and the aggregation switch port are no longer MLT ports then the plural ports will become distinct ports. Because the ports are distinct ports the edge switch may route a packet received at one of the ports to another one of the ports which will cause the packet to be returned to the same aggregation switch pair that transmitted the packet.

The destination address field specifies the address of the destination to which the test packet is to be sent while the source address field contains the address of the sender. According to some embodiments both the destination address field and the source address field identify the same switching node the node that transmitted the test packet . In some implementations the destination address field can be the address of the transmitting switching node plus a multicast bit that is set to indicate that the test packet is being multicast so that the test packet can be sent through multiple switching nodes within the same virtual local area network VLAN . A VLAN refers to a virtual network of devices that are actually located on different physical LAN segments but which devices can communicate with each other as if the devices were on the same physical LAN segment. In embodiments in which multiple VLANs are implemented in the communications network a test packet can traverse through network nodes within the same VLAN but the test packet is not forwarded to other VLAN s . Note however in other embodiments VLANs are not implemented in the communications network .

The protocol ID field identifies that SLPP is being used and thus the packet is an SLPP PDU a test packet . More generally the field contains information that provides an indicator that the packet is a test packet. The payload field contains several subfields including a subfield to indicate a version of SLPP that is used and subfields to indicate the identifier of the VLAN in which the transmitting network node is located if VLANs are implemented in the communications network .

The fields provided in the SLPP PDU depicted in are for purposes of example. In different embodiments other fields can be contained in a test packet sent from a network node for detecting loops in a communications network. Also if VLAN is not implemented then the payload field would not include VLAN identifier subfields.

The SLPP module has a timer for timing when test packets are to be transmitted. The intervals at which test packets are sent can correspond to a specific period such as one test packet every few seconds minutes or other periods or the intervals between transmission of test packets can vary or be triggered by some specified event. Test packets are sent by a test packet transmitter which generates each test packet that is sent by the processing module through the I O circuitry and ports to the communications network. Upon each occurrence of expiration of the timer test packets can be sent to all VLANs in a transmit list through respective ports . The transmit list is basically a list of VLANs to which test packets are to be sent upon expiration of the timer or other specified event .

In some implementations sending test packets to selected VLANs rather than to ports allows for enhanced scalability while maintaining flexibility in detecting loops on any particular VLAN. Since each port can have many assigned VLANs sending test packets to selected ports can result in large numbers of test packets sent from a switching node which can affect scalability of the processing components e.g. CPUS in the processing module. By sending test packets to VLANs rather than to ports in some implementations the loop detection technique is made to be more lightweight in other words less burden is placed on the processing capacity of a switching node .

The SLPP module also includes a test packet receiver to receive test packets which have been received at a port or plural ports of the network node and forwarded through the I O circuitry and processing module to the SLPP module . A test packet detector detects receipt of such a test packet by the test packet receiver . The test packet detector and test packet receiver will also determine which port s to disable based on detection of a loop or plural loops .

The configurations of the SLPP module can be specified in a SLPP configurations database which is stored in a storage of the network node. The SLPP configurations database can be updated or set by a user interface console through an interface e.g. application programming interface or API of the SLPP module . The user interface console can be part of the network node or can be located remotely from the network node of . A user through the user interface console is able to specify various configurations associated with the SLPP module such as the interval s for the timer the port at which the test packet transmitter is to transmit a test packet for each particular VLAN the port at which the test packet receiver is to receive a test packet for each particular VLAN the transmit list of VLANs an SLPP receiving port table that contains counts of received test packets at each port that would cause port disabling and other configurations. The SLPP receiving port table in the SLPP configurations database specifies for each port how many test packets have to be received prior to disabling the respective port due to loop detection. In some cases it is desirable not to disable a port in response to a single occurrence of receipt of a test packet since the receipt of the test packet may have been due to a temporary network condition that may have gone away so that port disabling is not needed.

It is noted that shows an example arrangement of components in a network node that is able to perform loop detection. In other embodiments other arrangements of a network node for performing loop detection can be provided. More generally the SLPP module performs loop detection and effecting of action in response to loop detection. For SLPP modules implemented on peer switches in an aggregation switch pair the SLPP modules have the following further capabilities exchange addresses of the peer switches with each other so that one switch in the switch pair can detect a loop condition in response to receipt of a test packet transmitted by the other switch in the switch pair disable a port e.g. an SMLT port in response to a request from a peer SLPP module to remove the loop condition in response to loop detection based on receipt of a test packet by the peer SLPP module and notify the peer switch to disable a port at the peer switch.

The arrangement of is generally a square configuration where presence of an improperly connected network segment A causes a loop to be present in the communications network. In the arrangement of each of the aggregation switches and can include an SLPP module such as that shown in for detecting the presence of a loop in the communications network.

As mentioned above in other embodiments the presence of improper network segments such as segments B and C in segment A in and segment in is not needed for a loop to be present in a communications network. A loop can be caused by improperly configured switches such as edge switches. An improperly configured switch such as an edge switch in which ports to an aggregation switch pair have not been configured as MLT ports will cause a test packet received from one aggregation switch pair to be returned to the same aggregation switch pair.

According to some embodiments in each of the network arrangements in which loop detection is provided a spanning tree protocol STP is not implemented. STP is a link management protocol that provides path redundancy while preventing undesirable loops in a network. Use of SLPP packets according to some embodiments thus enables loop detection that may occur due to STP not being implemented. In other embodiments use of SLPP packets for loop detection can also be used in communications networks where STP is implemented.

In response to a receive event the SLPP module determines at if a test packet having a destination address matching the address of either the transmitting node or a peer of the transmitting node has been received. If the received test packet does not have a matching destination address then the SLPP module returns to wait for the next event. However if the received test packet has a matching address then the SLPP module indicates at presence of a loop in the communications network. In addition the SLPP module either by itself or in connection with some other module either software module or hardware module effects at an action in response to the detected loop. One action that can be taken is to disable the port at which the test packet containing the matching address was received. In one embodiment if the received port is a non MLT port then that port is disabled. On the other hand if the received port is an MLT port that is a member of a group of other MLT ports then the entire group of MLT ports will be disabled. As indicated above a group of MLT ports are considered a single logical port. Similarly if the received port is a member of a group of SMLT ports then the entire group of SMLT ports will be disabled. Also the SLPP module will notify the peer switch to disable the SMLT port s at the peer switch. The action effected at can also include creating or adding to a log or other record to indicate which port s has have been disabled. In addition debugging information can be written into the log or other record such as information pertaining to the port at which a test packet was received an identifier of the VLAN from which the test packet was received and an identifier of the sender from which the test packet was received.

In embodiments in which VLANs are implemented the SLPP module is able to further determine whether a loop exists in one VLAN or whether a loop exists in multiple VLANs. The SLPP module is able to retrieve the VLAN identifier information such as from the payload field of the received SLPP PDU depicted in to determine the VLAN to which the SLPP PDU was sent. The SLPP module is also able to determine which VLAN the SLPP module received the SLPP PDU from. Based on a comparison of the VLAN identifier in the SLPP PDU and the identifier of the VLAN from the SLPP PDU was received the SLPP module or a user can determine whether the loop is in one VLAN or in more than one VLAN. In other words if the VLAN identifier in the payload field of the SLPP PDU is the same as the identifier of the VLAN from which the SLPP PDU was received then the loop is considered to be in the same VLAN. On the other hand if the VLAN identifier in the payload field of the SLPP PDU is different from the identifier of the VLAN from which the SLPP PDU was received then the loop is considered to be in multiple VLANs. Both conditions are error conditions that have to be addressed by disabling one or more ports.

As noted above disabling of ports is in response to a user configurable number of detections of test packets that contain a destination address matching the address of the transmitting node or the address of the peer of the transmitting node. The SLPP module keeps track of the number of test packets containing matching destination addresses that have been received at a particular port and compares that number to the count number specified in the SLPP receiving port table in the SLPP configurations database . If an adequate number of test packets containing matching addresses have been received at that particular port then disabling of that port and all other associated ports can be effected. Note that if the received port is an SMLT port then the counts of the number of received test packets containing matching addresses of SMLT ports of both peer nodes are combined.

In some embodiments a limit can also be set such as in the SLPP configurations database of to indicate that only a certain number of ports of a particular network node can be disabled within some predefined period of time. This avoids a situation where too many or even all of the ports of a particular network node are disabled due to receipt of test packets such that the network node is completely isolated.

Instructions of various software modules e.g. SLPP module of are loaded for execution on corresponding processors e.g. processing module . Processors include microprocessors microcontrollers processor modules or subsystems including one or more microprocessors or microcontrollers or other control or computing devices. As used here a controller refers to hardware software or a combination thereof. A controller can refer to a single component or to plural components whether software or hardware .

Data and instructions of the software are stored in respective storage devices e.g. storage of which are implemented as one or more machine readable or computer readable storage media. The storage media include different forms of memory including semiconductor memory devices such as dynamic or static random access memories DRAMs or SRAMs erasable and programmable read only memories EPROMs electrically erasable and programmable read only memories EEPROMs and flash memories magnetic disks such as fixed floppy and removable disks other magnetic media including tape and optical media such as compact disks CDs or digital video disks DVDs .

While some embodiments have been disclosed with respect to a limited number of embodiments those skilled in the art will appreciate numerous modifications and variations there from. It is intended that the appended claims cover such modifications and variations as fall within the true spirit and scope of the invention.

