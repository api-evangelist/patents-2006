---

title: Method and apparatus for memory address generation using dynamic stream descriptors
abstract: Memory addresses for a data stream are generated by a stream parameter generator that calculates a set of stream parameters for each of a number of memory access patterns and a regional address generator that calculates a sequence of addresses of a memory access pattern from a corresponding set of stream parameters. The stream parameters, which may include START_ADDRESS, STRIDE, SKIP and SPAN values for example, are updated in accordance with an update( ) function. The update( ) function, which may be defined by a user, defines how stream parameters change from one memory access pattern to the next. In one application, the update( ) function describes how the position, shape and/or size of a region of interest in an image changes or is expected to change.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07634633&OS=07634633&RS=07634633
owner: Motorola, Inc.
number: 07634633
owner_city: Schaumburg
owner_country: US
publication_date: 20061130
---
The present invention relates generally to data processing systems and in particular to memory address generation in data processing systems.

Data processing applications that process streaming data such as image processing and computer vision applications demand high bandwidth from memory in order to sustain the high computation workload. Stream descriptors are a set of parameters can be used to describe the shape and location of data elements in a memory so that a stream processor can prefetch stage and align data. Stream descriptors can be used to control the action of hardware elements that are configured specifically for computing memory addresses. This reduces the computation load on the processor.

Stream descriptors have been used in partitioned vector processing to describe memory access patterns that exhibit harmonic patterns only. A stream descriptor is represented as a parameter vector START ADDRESS STRIDE SPAN SKIP SPAN SKIP TYPE where 

Compilers have been disclosed with the ability to manipulate the stream descriptors so as to enable memory transfer optimizations. Data prefetching at different levels of the memory hierarchy makes data movement more efficient. A stream loader is also described that can insert executable code that evaluates stream descriptor values when they are loaded into the streaming data interface. However there are no methods to describe the dynamic patterns of the memory access. The parameters for the DMA or streaming data interface calculate relative addressing based on a fixed pattern i.e. using the previous address and then add subtract a constant value skip or stride . Furthermore this restriction limits performance because of its inability to describe more complex patterns.

Existing stream descriptors are not flexible enough to describe certain memory access patterns since data shape and location can change dynamically during program execution. Overall system performance becomes limited if the stream descriptor value is static.

Skilled artisans will appreciate that elements in the figures are illustrated for simplicity and clarity and have not necessarily been drawn to scale. For example the dimensions of some of the elements in the figures may be exaggerated relative to other elements to help to improve understanding of embodiments of the present invention.

Before describing in detail embodiments that are in accordance with the present invention it should be observed that the embodiments reside primarily in combinations of methods and apparatus components related to memory access for data processors. Accordingly the apparatus components and methods have been represented where appropriate by conventional symbols in the drawings showing only those specific details that are pertinent to understanding the embodiments of the present invention so as not to obscure the disclosure with details that will be readily apparent to those of ordinary skill in the art having the benefit of the description herein.

In this document relational terms such as first and second top and bottom and the like may be used solely to distinguish one entity or action from another entity or action without necessarily requiring or implying any actual such relationship or order between such entities or actions. The terms comprises comprising or any other variation thereof are intended to cover a non exclusive inclusion such that a process method article or apparatus that comprises a list of elements does not include only those elements but may include other elements not expressly listed or inherent to such process method article or apparatus. An element proceeded by comprises . . . a does not without more constraints preclude the existence of additional identical elements in the process method article or apparatus that comprises the element.

It will be appreciated that embodiments of the invention described herein may be comprised of one or more conventional processors and unique stored program instructions that control the one or more processors to implement in conjunction with certain non processor circuits some most or all of the functions of memory access for streaming data processors described herein. The non processor circuits may include but are not limited to signal drivers clock circuits power source circuits sensors and user input devices. As such these functions may be interpreted as a method to perform memory access. Alternatively some or all functions could be implemented by a state machine that has no stored program instructions or in one or more application specific integrated circuits ASICs in which each function or some combinations of certain of the functions are implemented as custom logic. Of course a combination of the two approaches could be used. Thus methods and means for these functions have been described herein. Further it is expected that one of ordinary skill notwithstanding possibly significant effort and many design choices motivated by for example available time current technology and economic considerations when guided by the concepts and principles disclosed herein will be readily capable of generating such software instructions and programs and ICs with minimal experimentation.

The present invention relates to a method and apparatus for accessing data elements in a memory during execution of a program of instructions for processing data. In accordance with one aspect of the invention the size shape and or location can change dynamically during program execution. In one embodiment the apparatus is controllable in software using an application programming interface API .

More complex patterns may be accessed by using additional SPAN and SKIP values. SKIP and STRIDE can have negative values but SPAN is always positive. In some embodiments a stream descriptor may be represented with different parameter vector such as TYPE or START ADDRESS . In yet another embodiment the parameter vector such as STRIDE SPAN and SKIP are constants to represent a static shape in memory e.g. STRIDE 1 SPAN 1 SKIP 1 .

A further example is shown in . In this example a video sequence contains an image frame with ROI an image frame with ROI and an image frame with ROT . The ROT has been translated to the right and downwards from one frame to the next. In accordance with an embodiment of the invention it is recognized that the motion of the ROI can be described by a function such as a parametric function. The stream descriptors for each ROI are the same except that the starting address SA is updated from one frame to the next. If the change in position is known the change in starting address can be determined. Thus a new stream descriptor a new set of stream parameters can be computed for each new ROI. This computation may be performed by a stream parameter generator for example.

A further example is shown in . In this example a video sequence contains an image frame with ROI an image frame with ROI and an image frame with ROI . In this example starting address SA remains constant but size of the ROI changes from one frame to the next. This may be caused for example by a video camera moving closer to an observed object of interest. Again this results in different memory access patterns based on the speed of camera movement relative to the observed object. The stream descriptor for successive regions of interest may be obtained by updating the values of the SPAN SKIP and COUNT parameters.

A further example is shown in . In this example an image contains regions of interest and . The regions are determined by the position of a feature of the image.

In accordance with an embodiment of the invention the address of the memory location to be accessed by a stream processor is calculated from the previous current address and a set of stream descriptor values. Further one or more of the stream descriptor values themselves are calculated from previous stream descriptor values. Thus one or more of the stream descriptor values is a dynamic value which changes during processing of a data stream.

The calculation may be performed by arithmetic units in a memory access circuit. An arithmetic unit may be used for each stream descriptor parameter that changes value.

Referring again to the region of interest ROI may be described as a 2 dimensional tile using stream descriptors e.g. SA STRIDE SPAN SKIP TYPE etc. described earlier . This defines a stream record which represents a data structure that has shape. In one embodiment of the invention an application user interface API is provided. The programmer of an application may use an update function that defines how the starting address SA moves in subsequent image frames. This defines the movement of the stream record and instructs the direct memory access DMA or streaming data interface to fetch the next record in the new location. The parameters for the update function can be used to define when the stream descriptors are updated with a change in starting address or a change in any of the stream descriptor parameters.

The memory address generator also includes a stream parameter generator that is operable to generate new stream parameters using the previous or initial stream parameters and a set of update parameters stored in registers for example . The stream parameter generator can also detect predefined sequences of stream parameters to determine which set of update parameters should be applied. In such an embodiment the stream parameter generator monitors a sequence of stream descriptor updates and decides when to update each stream parameter automatically using a finite state machine. The update of stream parameters may take place automatically without any intervention by host processor . The stream parameter generator can optionally generate an interrupt signal to the host processor upon completion of the generation of certain stream parameters for the multiple regions of interest.

The regional address generator is operated for each new memory access within a region of interest whereas the stream parameter generator is only operated when the focus of attention changes from one region of interest to the next.

The set of update parameters may include for example an offset value to be added to the starting address SA of a current region to obtain the starting address of the next region of interest. The set of update parameters may also include changes in other stream descriptor values such as the SKIP STRIDE and SPAN.

A signal link may be used to enable the regional address generator to signal the stream parameter generator that a region has been fully accessed and that new stream parameters are required.

The memory address generator and in particular the stream parameter generator may be implemented using configurable hardware. Thus a programmer may specify a variety of updates functions which are compiled and processed and used to configure the stream parameter generator to perform the specified function.

Since the stream parameters may change from one region of interest to the next they are termed dynamic stream parameters. The set of stream parameters together with the associated update function is termed a dynamic stream descriptor.

In one embodiment an address generation unit can be configured automatically by obtaining a set of stream parameters that describe data locations of the target data together with a set of update parameters that describe the change of the set of stream descriptors and then generating a representative arithmetic unit based on the set of stream parameters and update parameters.

The regional address generator is operated for each new memory access within a region of interest whereas the stream parameter generator is only operated when the focus of attention changes from one region of interest to the next.

In the example shown in the regional address generator includes three adders and . Adder is operable to update the starting address SA of a current region stored in register by adding an offset value D SA stored in register . Similarly adder is operable to update the SPAN value stored in register by adding an offset value D SPAN stored in register and adder is operable to update the COUNT value stored in register by adding an offset value D COUNT stored in register . In this example the values of the other stream parameters stored in registers are not updated dynamically and are passed unchanged to the regional address generator . The register values may be initialized by a host processor. In other embodiments different sets of stream parameters values may be stored in a table and selected dynamically without intervention from a host processor .

In the simplified embodiment shown in multiplexers control when the updates are added to the stream parameters. The multiplexers are controlled by the signal from the regional address generator to select whether a registers value D SPAN D SA or D COUNT or a zero value is supplied to an adder.

An example update function corresponding to is given below. The function has parameters DX and DY that defines the relative movement of a region of interest ROI in a two dimensional array. Parameters X and Y that define the upper left corner of the ROI. The function may also define how DX and DY are to be applied e.g. added or subtracted . Initially X and Y are set to the upper left corner of the ROI. The update function corresponds to linear motion of the ROI and change of shape of the region of interest. In this example the region grows by 2 data values in width and is sheared. The corresponding COUNT grows by 10 because 5 rows of data are processed in this example. A check against boundary values Xmin and Ymax is included to ensure the region remains with the array.

The logic circuit for checking that the region of interest is still within the frame is not shown in but the implementation of similar logic circuits is well known to those of ordinary skill in the art. Furthermore the update function may have parameters which describes the condition in which the stream parameter generator may generate an interrupt signal for the host processor .

Processing applications can include the use of the update function to model and track object movements in digital video data. This is useful in computer vision applications for example in which the object location and movement are usually predictable. The use of dynamic stream descriptors allows a programmer to define the object behavior and provide deterministic memory access patterns for the memory subsystem.

For example in an automotive imaging application movement of road signs and vehicles may be deterministic because of the way the camera views the road scene. Movement of the object once determined in the scene can be defined and tied to memory access using an update function. If certain objects once identified such as road markings or vehicles do not follow predictive motions the algorithm typically enters a warning phase. In such a phase the algorithm searches the entire scene again which resets the update function and other stream descriptors. The example embodiment shows the update function as applied to SA but it could be applied to other stream descriptors such as COUNT for example to indicate the change in size of the ROI or stream record. The update function can describe the change in multiple stream descriptor parameters at the same time and even allow complex interaction between those elements. Referring again to the feature may be for example an edge of the roadway wherein the automotive image application inspects the curvature and road conditions. The application can speculatively define the update function for different predictions of object movements.

In yet another example in a image distorted by a wide angle or fisheye lens the update function can define the movement of the bounding box for the next processing stage. This is equivalent to a sliding window in which the direction of movement is not linear but curved according to the level of lens distortion. Referring again to the feature may be for example a physical straight line that is curved when viewed through a wide angle or fisheye lens and wherein the image processing application inspects the line edges for object detection and distortion correction. The application can optionally preset the update function based on lens parameters such as field of view and focal length.

The use of dynamic stream descriptors provides a method for describing the changing shape and location of data and a method to improve memory performance with streaming data. Furthermore it extends stream processing to other applications because it can describe the behavior of the algorithm better. Performance is improved because less processor intervention is needed to manipulate stream descriptors. Furthermore the approach enables DMA engines or memory controllers to move data efficiently and reduces bus and memory traffic allowing more bandwidth in the memory hierarchy for computation rather than data movement .

The present invention can be used with components in memory subsystems such as memory controllers to improve their performance.

Without dynamic stream descriptors an application would have to reset the stream descriptors every time there is a change in the size shape or position of the region of interest ROI . For example for each stream record a new stream descriptor needs to be loaded by the processor. Resetting stream descriptor when a ROI changes is a time consuming operation and can reduce the potential benefits of hardware accelerators.

In the foregoing specification specific embodiments of the present invention have been described. However one of ordinary skill in the art appreciates that various modifications and changes can be made without departing from the scope of the present invention as set forth in the claims below. Accordingly the specification and figures are to be regarded in an illustrative rather than a restrictive sense and all such modifications are intended to be included within the scope of present invention. The benefits advantages solutions to problems and any element s that may cause any benefit advantage or solution to occur or become more pronounced are not to be construed as a critical required or essential features or elements of any or all the claims. The invention is defined solely by the appended claims including any amendments made during the pendency of this application and all equivalents of those claims as issued.

