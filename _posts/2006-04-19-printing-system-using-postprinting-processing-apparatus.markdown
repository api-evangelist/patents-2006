---

title: Printing system using post-printing processing apparatus
abstract: This invention relates to an image forming apparatus having ability information of an available finisher, including a detection unit which detects the stop state of post-processing by the first finisher, a search unit which, when the detection unit detects the stop of the first finisher, searches a finisher that can alternatively perform processing to be executed by the first finisher based on the ability information, and a generation unit which generates post-processing setting information for the second finisher found by the search unit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07777907&OS=07777907&RS=07777907
owner: Canon Kabushiki Kaisha
number: 07777907
owner_city: Tokyo
owner_country: JP
publication_date: 20060419
---
The present invention relates to a printing system configured by connecting e.g. a post printing processing apparatus and an image forming apparatus e.g. a digital copying machine . More particularly the present invention relates to an image forming apparatus which is integrated with a post processing unit and can substitute another post printing processing apparatus for the post processing unit and a printing system including the image forming apparatus.

A finisher means a post printing processing apparatus and is also called a post press process apparatus or simply a post processing apparatus. The finisher executes various processes such as bookbinding cutting stapling punching and collating. Some finishers have multiple functions while others have single functions.

Feature information of an apparatus is information representing the specifications of the apparatus describes the features e.g. functions of the apparatus and is also called property information. Feature information of the finisher contains information representing the functions of the apparatus and the feeding order and direction of paper sheets. In the following embodiments feature information is synonymous with ability information.

Printing attributes are information for specifying how to print and contain designation of double single face printing designation of face up face down the number of print copies the paper size and the layout. In the following embodiments the printing attributes are synonymous with printing setting information. The printing attributes can be changed by the user within the range of functions of a printing apparatus from a user interface window provided by an application program or printer driver.

Conventionally POD Print On Demand and VP Variable Printing are popular as a technique of executing printing processing using XML data. According to the POD or VP technique printing contents and printing instructions to a printing apparatus and its peripheral device are described by XML data or the like. For example according to patent reference 1 contents are described by XML data and instruction contents such as the character size and the number of print copies are described in a style sheet. By changing the style sheet desired books can be created under various and different conditions.

XML is sometimes used for post printing processing. When post printing processing for a printed product is done using a finisher a finisher in line finisher connected in line to an image forming apparatus is often utilized as far as the finisher has a necessary function. In this case the user makes printing settings including post processing settings by a computer or the like via a user interface provided by a printer driver or the like. The computer creates a printing job described in PDL Page Description Language or the like on the basis of the printing settings and at the same time generates job control information containing post processing settings. The job control information is described by e.g. JDF Job Definition Format which is defined using XML. The printing apparatus performs post processing for a printed product in accordance with the job control information while executing the received printing job and printing see e.g. patent reference 2 .

As a conventional technique using a finisher apparatus connected to another image forming apparatus a distributed finishing process technique using a plurality of finisher apparatuses is popular. According to the distributed finishing process technique an apparatus for performing post processing is selected by the user from finisher apparatuses connected on a network and then a printing job is executed see e.g. patent reference 3 .

However if post processing by an in line finisher stops the printing job stops and no printed product after the post processing can be output until the in line finisher recovers to resume the post processing. For example when stapling is done in post processing and staples run out the post processing stops until the finisher is replenished again with staples. Post processing stops even if another available finisher near line finisher is connected to a network to which a client computer and printing apparatus are connected.

Patent reference 3 describes a method of increasing the efficiency of post processing by selecting a finisher apparatus in advance by the user and instructing the selected finisher apparatus to execute post processing. However the finisher apparatus which performs post processing must be set before the start of printing processing. When post printing processing by an in line finisher stops as described above no other finisher can be requested to take over the post processing. In the prior art therefore if processing of a printing job stops due to generation of an error in a finisher after the processing of the printing job starts the schedule may be greatly delayed. For example when information on a device to perform processing the processing time and a job to be processed is scheduled in advance on the basis of the delivery date set by the customer an error in the finisher greatly upsets the schedule. As a result not only is the printing job delayed in process but a subsequent printing job is also delayed failing to meet the delivery date set by the customer.

The present invention has been made in consideration of the above situation and has as its object to provide an image forming apparatus capable of when a finisher post processing apparatus connected in line to a printing apparatus image forming apparatus becomes unavailable reassigning post processing to another finisher and a control method therefor.

In order to achieve the above object the present invention comprises the following arrangement. An image forming apparatus having ability information of an available finisher comprises a detection unit which detects a stop state of post processing by a first finisher a search unit which when the detection unit detects a stop of the first finisher searches a finisher that can alternatively perform processing to be executed by the first finisher based on the ability information and a generation unit which generates post processing setting information for a second finisher found by the search unit.

An image forming apparatus having ability information of an available finisher comprises a detection unit which detects a state in which a printing job cannot be achieved by a designated printing setting a search unit which when the detection unit detects the state in which the printing job cannot be achieved searches for a finisher having a post processing function to be substituted for the printing setting and a generation unit which generates post processing setting information for the finisher found by the search unit.

According to an embodiment of the invention even when no finisher can be used another finisher can be substituted for it. Since this substitution is performed by the image forming apparatus no burden of substitution is imposed on a client which issues a printing request.

According to another embodiment of the invention even when no function associated with image formation can be used the function of a finisher can be substituted for it. Since this substitution is done by the image forming apparatus no burden of substitution is imposed on a client which issues a printing request.

Other features and advantages of the present invention will be apparent from the following description taken in conjunction with the accompanying drawings in which like reference characters designate the same or similar parts throughout the figures thereof.

The first embodiment will describe a printing job and job control information to staple each copy. In stapling processing it is generally set to staple paper at one of the four corners or at two portions along one of the four sides. When an in line finisher having the stapling function is mounted in an image forming apparatus it is generally set to perform stapling using the in line finisher. If staples in the in line finisher run out during a printing job a conventional image forming apparatus stops the job and does not resume it until the in line finisher is replenished with staples. Alternatively the printing job must be canceled and another image forming apparatus must be instructed to perform printing including stapling again.

To the contrary an image forming apparatus according to the first embodiment that is connected to a near line finisher via a network or the like searches for a near line finisher having a function alternative to an in line finisher. If an alternative near line finisher exists the image forming apparatus deletes designation of stapling by the in line finisher from the job control information and changes settings so as to execute only printing by the image forming apparatus. The image forming apparatus transmits to the near line finisher job control information containing staple setting which is originally to be performed by the in line finisher of the image forming apparatus. The image forming apparatus causes the near line finisher to perform stapling processing instead of the in line finisher. Hence even if staples run out processing of the printing job does not stop and can continue. A printing system according to the first embodiment will be explained.

The finisher system can connect one or a plurality of finishers and and a controller to a network and control them. Devices connected to the network can communicate with each other via the network. The printer comprises an image scanner and is a multi functional apparatus having not only a printing function but also scan copy facsimile communication and filing functions. Thus the printer is also called an MFP Multi Functional Printer . The client PC is an information processing apparatus has a function of controlling a printer and is also called a printing control apparatus when attention is paid to the printer control function.

An in line finisher off line finisher and near line finisher will be explained in terms of the finisher control method.

An in line finisher is a finisher whose processing contents to be performed are set from an image forming apparatus. The contents of processing to be performed by the in line finisher are designated by post processing setting information. An off line finisher is a finisher which does not have any means for communicating with an external apparatus offline . The contents of processing to be performed by the off line finisher are set in the finisher. A near line finisher comprises a means for communicating with an external apparatus such as an image forming apparatus. The contents of processing to be performed by the finisher can be input from its operation unit and also input as e.g. a job ticket from another device such as a host computer via a network.

The features of each finisher will be described in terms of the convey path paper path of a printout product. These features are general ones and are described for easy understanding of the present invention so the present invention is not limited to the following description. The in line finisher is physically connected to an image forming apparatus to define one paper convey path. In general paper printed out from the image forming apparatus is quickly sent to the in line finisher via the convey path paper path . In general the off line finisher is not physically connected to the image forming apparatus. Paper printed out from the image forming apparatus is temporarily stacked on a truck tray belt conveyor or the like and then set at the input portion of the finisher. As for the near line finisher similar to the off line finisher printed paper is generally temporarily stacked and then set at the input portion of the near line finisher.

As described above the image forming apparatus can set in and near line finishers so as to use their functions. Finisher profiles to be described later which describe the functions of the finishers are held in the image forming apparatus and the profile information is transmitted to the computer so as to set functions for use on the basis of the profile information. The setting operation is done by the computer which reads out a profile. The image forming apparatus acquires the finisher profile by saving in the image forming apparatus the profiles of all types of finishers which may be connected in shipping the image forming apparatus. When there is a finisher which is newly supported by the image forming apparatus after shipping the image forming apparatus the image forming apparatus acquires profile information in the finisher after the new finisher is connected to the network. Further when no profile information is held in a finisher or profile information is updated by changing or adding a function after installation the profile information can be acquired from the Web page of the finisher manufacturer or the like. Hence even if no finisher profile is held in shipping the profile can be acquired in use. Note that profile information is information which describes the functional feature of a corresponding apparatus and can also be called ability information or feature information.

The image forming apparatus holds the finisher profile acquired by the above method in a common DB unit . Then the acquired finisher profile is registered in the image forming apparatus so that the profile can be used from another device such as a printer driver. Details of registration will be described in the following chapter . After the end of registration another device can utilize the finisher profile registered in the image forming apparatus via the NIC unit. Note that the network in is an IP network and a connected device supports the IP.

The processing unit comprises an HDD controller which interfaces an HDD device a keyboard controller which interfaces a keyboard and a communication I F serving as an interface with the network at the physical level and link level.

The display device in this example a CRT which displays graphic information and the like for the operator is connected to the processing unit via the graphic adaptor . Further the keyboard and the hard disk drive HDD device serving as a large capacity storage device which stores programs and data are connected to the processing unit via controllers respectively.

The HDD saves program files e.g. an operating system application and printer driver and data files e.g. printer driver setting information and profile information . The printer driver setting information saves values representing the current settings of a printer available by the computer . The profile information saves the profile of an available peripheral device in the first embodiment profile information of a printer in line finisher near line finisher and the like. The profile information is information representing the features of a device such as the function of the device. More specifically the profile information represents the functions e.g. bookbinding function and cutting function and capabilities of in and near line finishers. For example as for the bookbinding function the profile shows capabilities e.g. the bindable position and size the load weight and the interval between staples accompanying the bookbinding function. As for the cutting function the profile shows capabilities e.g. the cuttable paper size maximum and minimum and thickness accompanying the cutting function.

The MPU executes a device driver application program and the like including the operating system and printer driver program. These programs sometimes display on the display UI windows for requesting the operator to intervene in processing for example set parameters or designate execution. The printer driver is prepared in accordance with the model of printer including an MFP . The printer driver provides the operating system with information on the functions and configurations of a printer and the like and executes processing for implementing a function unique to the printer model.

Finishers are classified into various types by their functions. The first embodiment employs a bookbinding apparatus with the saddle stitch function as an example of an in line finisher a cutting apparatus as an example of an off line finisher and a perfect binding apparatus as an example of a near line finisher.

The controller comprises a processor which has both a control program execution function and peripheral device control function and controls the whole finisher a system bus which connects building components in the controller a ROM which stores a control program executed by the processor various data and the like and a RAM which saves a job ticket and the like. Profile information is saved in a ROM or the storage device such as a hard disk and in this example saved in the hard disk. The profile information is read or written in advance by the image forming apparatus to allow the image forming apparatus to use the near line finisher.

The printer driver is formed from a user I F driver which displays a user I F and saves settings and a graphic driver which converts a printing rendering instruction issued from the application via the OS into a code interpretable by the image forming apparatus. The user I F driver displays printing setting dialogs and property sheets shown in when the application permits the user via the OS to set printing.

Note that the setting save area for the printer driver is ensured in a save area managed by the OS . Printing attributes set by the user via the user I F driver are saved in the printer driver setting save area. The profile information on available devices such as the MFP printer is also saved. The user I F driver graphic driver and application program can access the printer driver setting save area via the OS to read printing attributes set by the user.

The client computer is connected by connecting a communication I F on the client computer side and a communication I F on the printer side via a communication medium such as a network. The client computer is also similarly connected to another network device such as a finisher. The graphic driver can transmit printing data to the image forming apparatus via the OS and can also acquire the configuration information and status of the image forming apparatus and the like via the OS .

In the first embodiment a finisher profile finisher profile information is described in the XML format. Finishers vary in type such as a bookbinding apparatus cutting apparatus and folding apparatus and the functions of respective types are different from each other. Information greatly changes upon e.g. adding a new function. In order to properly cope with various functions and changes the profile is described using XML in a tag format. As a matter of course the profile can be described in any format as far as addition of a new function and the like can be adaptively described.

For example the Booklet tag of the bookbinding apparatus in defines type names saddle stitching fold flat stitching corner stitching half fold flat stitching fold and corner stitching fold . The Medium tag defines medium types Plain and Fine and medium weights 60 kg as a minimum value and 120 kg as a maximum value. The StapleSpaceInterval tag defines that the staple interval cannot be adjusted False and the interval is 100 mm.

In the Cutting tag describes that the maximum input dimensions MaxInputDimensions are 360 mm in breadth and length X Y . Also the Cutting tag describes that the maximum output dimensions MaxOutputDimensions are 310 mm in breadth and length X Y the minimum output dimensions MinOutputDimensions are 80 mm in breadth X and 150 mm in length Y . The Cutting tag describes that the maximum thickness MaxThickness is 70 mm.

In this way finisher profile information defines the type of function the manufacturer name the model name and the performance e.g. dimensions and binding position of each function. The profile information is saved in e.g. the storage device of the finisher and read out and collected by the image forming apparatus.

In step S the job control unit recognizes the IP address of a near line finisher that is input by the user and holds the IP address in the image forming apparatus. In step S the job control unit displays a list of finishers connectable to the image forming apparatus. Since this list is stored in advance in the image forming apparatus the job control unit can display the list by referring to a storage unit which holds the list. The user is prompted to select a finisher corresponding to the IP address input in S from a list of the manufacturers and models of near line finishers and designate a corresponding profile. In step S the job control unit outputs a display window for prompting the user to confirm whether the designation in S is correct. If the user inputs confirmation representing that the designation is correct the flow advances to step S. In S the job control unit requests profile information of the finisher at the address input in S and receives and saves the profile information. The finisher corresponding to the saved finisher profile is added to the finisher management table . The changed finisher management table is stored in a secondary storage device or nonvolatile memory. As another example when an ID representing a manufacturer and model can be acquired from a near line finisher the job control unit issues an ID acquisition request to an IP address after the user inputs the IP address. Then the job control unit acquires the ID from the near line finisher acquires a finisher corresponding to the ID as a connected finisher and can rewrite the finisher management table. The finisher profile is requested of the finisher at the input IP address and acquired. The IP address and profile information are saved in association with each other.

Procedures when a registered near line finisher is connected to the image forming apparatus will be explained with reference to the flowchart of . A near line finisher to be connected is Finisher Y available from XYZ. The user installs a new near line finisher and connects it to the image forming apparatus via a communication medium. The procedures in are executed by the finisher profile control unit i.e. the processor.

In step S the finisher profile control unit displays a user interface for the purpose of a connection operation by the user. In this window the user performs a connection operation. In step S the finisher profile control unit recognizes the connection operation by the user and changes the connection state of the connected finisher into connected true in the finisher management table . This operation will be explained with reference to . show operation windows in step S.

A method step S of of updating the finisher management table by the image forming apparatus will be explained. Since the user connects and registers Finisher Y available from XYZ in the finisher connection setting window of the image forming apparatus updates the finisher management table . shows the finisher management table after this update. The finisher profile control unit sequentially recognizes the above described settings made by the user in the window of and the connection state of Finisher Y in 6 is changed into true as shown in a column of .

By the above procedures connection registration of the finisher in the image forming apparatus is completed. In the first embodiment connection of a near line finisher is set by the user on the operation panel of the image forming apparatus after the finisher is connected. However connection can also be registered by another method as far as the finisher management table can be updated. For example since the image forming apparatus and near line finisher are connected via a communication medium the protocol in connection is defined. The image forming apparatus and near line finisher communicate with each other on the basis of this protocol and the image forming apparatus automatically registers connection of the near line finisher.

The image forming apparatus further executes steps of transmitting a finisher profile acquisition request to a connected near line finisher and receiving a finisher profile transmitted by the near line finisher in response to the request. The received finisher profile is saved in the finisher profile save area . The name of the received finisher profile is registered in the finisher profile name of the finisher management table . The address of the finisher is registered in association with the finisher profile.

As for an in line finisher its finisher profile is initially stored in the image forming apparatus. If the in line finisher is actually connected a signal representing that the in line finisher is connected is input to the job control unit . This signal functions as a trigger and for example a flag representing that the in line finisher is connected is set. In other words according to the first embodiment an operation representing that an in line finisher is registered or connected is not necessary for an in line finisher.

Procedures of acquiring the finisher profiles of in and near line finishers by the printer driver from the image forming apparatus and saving the finisher profiles will be explained.

In the configuration of the storage area is a storage area profile save area in the OS where a finisher profile acquired by the printer driver from the image forming apparatus is saved. The printer driver acquires a finisher profile from the image forming apparatus via the API Application Programming Interface of the OS and saves the acquired finisher profile in the profile save area . In order to request and transmit a finisher profile a communication medium is used between the communication I F on the host computer side and the communication I F on the image forming apparatus side. Note that the protocol used for communication is not particularly designated as far as acquisition of a finisher profile can be requested from the printer driver and the entity of the finisher profile can be transmitted. A method of acquiring a finisher profile by the printer driver from the image forming apparatus will be explained with reference to a flowchart. is a flowchart showing this procedure. Processing in is executed for example when the computer is powered on when the user designates printing processing or in accordance with an explicit instruction by the user. Note that steps in to be processed by the driver are processed by the MPU in the host computer and steps to be processed by the image forming apparatus are processed by the job control unit .

In step S the printer driver requests the image forming apparatus to acquire the profile of a finisher which is connected to the image forming apparatus and registered. In response to the acquisition request from the printer driver the image forming apparatus transmits a finisher profile to the saved printer driver.

Upon reception of the request in step S the image forming apparatus MFP in sequentially browses from the top the finisher management table held in the common database unit of the image forming apparatus and confirms the connection state of each finisher. shows a finisher management table held in the image forming apparatus. In step S the image forming apparatus confirms the connection state of Finisher A on a row of identification number 1. The image forming apparatus confirms that the connection state of the finisher is false in the finisher management table of . In step S the image forming apparatus determines the condition of the connection state. Since the connection state of Finisher A subjected to condition determination processing is false the image forming apparatus advances to step S. In step S the image forming apparatus determines whether all finishers held in the finisher management table have been confirmed. If the image forming apparatus determines in S that all finishers in the finisher management table have not been confirmed the flow returns to step S. This step is similarly repeated for finishers Finisher B Finisher C and Binder ABC held in the finisher management table.

In step S the image forming apparatus confirms the connection state of Finisher X serving as the next entry. After the image forming apparatus confirms that the connection state of Finisher X is true the flow advances to step S after condition determination in step S. In step S the image forming apparatus transmits to the printer driver the finisher profile of a corresponding finisher i.e. finisher of interest Finisher X at this time in the finisher management table . For this purpose the image forming apparatus reads a corresponding finisher profile name finisher x of xyz.xml because Finisher X is targeted in this step from the finisher management table . The image forming apparatus extracts a file of this file name from a finisher profile save area and transmits the file to the printer driver S . In step S the image forming apparatus determines whether all finishers described in the finisher management table have been confirmed. If all finishers have not been confirmed the flow returns to step S. The connection state of the next Finisher Y is also true so the image forming apparatus executes the same processing as that for Finisher X . In step S the image forming apparatus reads the profile name finisher y of xyz.xml of Finisher Y in process. The image forming apparatus extracts the finisher profile of Finisher Y from the finisher profile save area and transmits the finisher profile to the printer driver S . The image forming apparatus repeats this step for all finishers registered in the finisher management table. After the image forming apparatus confirms the final finisher in the finisher management table it transmits to the printer driver in step S information representing that all finishers have been confirmed. Then the processes S to S in the flowchart which should be executed by the image forming apparatus end.

The printer driver receives a response from the image forming apparatus S and determines whether the response contents represent end S . If the printer driver determines in S that the response contents do not represent end the data received in S from the image forming apparatus is a finisher profile and is saved in the profile save area S . In this way the printer driver acquires the finisher profile of a connected near line finisher from the image forming apparatus .

Note that the profile of an in line finisher can be acquired similarly to a near line finisher. Since in line finishers connectable to the image forming apparatus are limited the profiles of all in line finishers may also be saved in advance in the image forming apparatus . In this case an activation flag or the like is associated with the profile of an actually connected in line finisher and the connection is presented. In processing for finisher setting or the like an activated in line finisher is an available finisher.

On the GUIs of the user can perform an operation to set desired setting parameters printout processing condition data . In accordance with input printing setting information the printer driver generates from designated data such as an image printing data corresponding to a transmission destination also called an output destination such as a printer. The generated printing data is transmitted by the operating system to the destination device via a network or the like.

In a window is a printer driver window. Among setting items in the printer driver window a transmission destination selection box is used to select a target output destination. The user can select a desired output destination device of the system via the selection box displayed in the window.

A page setting field is used to select an output page from a job. In the field it is set which page is output out of images created by application software running on the client computer. The user can select a page to be printed out by a device such as the image forming apparatus of the system via the page setting field displayed in the window. The user can print all pages or specific pages without printing all pages.

A copy count setting box is used to designate the number of output copies of a job to be printed out by the image forming apparatus of the system. The cursor is moved to the position of the box and an arrow arrow of the scrollbar shown in is clicked to increment decrement the number of copies. A property button is used to make detailed settings of a transmission destination device selected in the transmission destination selection box . In response to the button input by the user the printer driver controls to display various detailed windows shown in on the computer display.

If the user clicks an OK button after making desired settings via various operation windows in printing can start in accordance with settings desired by the user. In order to cancel the processing the user clicks a cancel button . In response to this the control unit cancels printing and ends display of the window .

This window has sheets page setting finishing paper feeding and print quality and tabs for selecting the respective sheets. The user clicks these tabs with the operation unit e.g. pointing device not shown of the client computer and can make settings of various detailed different printout conditions such as settings associated with page setting settings associated with finishing settings associated with paper feeding and settings associated with print quality .

When the finishing tab is selected by a key operation by the user and the printer driver i.e. control unit holds a plurality of finisher profiles one of finishers is selected. In the first embodiment when an in line finisher is connected to the image forming apparatus it is preferentially selected. When only near line finishers are connected the user may select a finisher for use. After a finisher is selected an operation window as shown in a sheet of is displayed on the display unit in accordance with profile information of the selected finisher.

The window in is used to set setting information unique to a device selected by the user in the operation window of from devices of the system for example settings for sheet processing including setting of finishing e.g. setting of stapling processing that of sorting processing that of punch processing that of punching processing and that of bookbinding processing . In addition a plurality of setting fields can be arranged which allow the user to execute various detailed settings such as setting of which of single or double face printing is executed and setting of finer adjustment associated with image processing for changing parameters such as the color tint by a printer. These setting fields permit the user to make various detailed settings as described above. For example with settings in this display example an image forming apparatus which is selected by the user in the operation window of is caused to print a target job in accordance with a double face printing mode set by the client via the setting box of the operation window of . Moreover the image forming apparatus is controlled to execute double face printing processing based on long edge binding setting in the double face printing mode set via a setting box . When the user operates a restore defaults button in the operation window of it is controlled to restore detailed printing settings in the operation window of to default values.

Although not shown the print quality tab similarly makes it possible to select the resolution halftone setting and the like.

Reference numeral denotes an OK button. When the button is clicked designated property settings are validated and the window returns to the window of . Reference numeral denotes a cancel button. If the button is clicked designated property settings in the setting window of are invalidated and the window returns to the window of .

Of printing processing conditions including various detailed settings output conditions desired by the client are set via the various printing setting windows of . Then the client computer sends a job output request the printing condition data of the job and image data of the job. By this processing an image forming apparatus selected by the client can be controlled to output data selected by the client in accordance with output settings made by the client.

Note that items displayed on the finishing sheet after a finisher is selected are displayed on the basis of the printer profile of the image forming apparatus itself and a finisher profile selected from finisher profiles acquired from the image forming apparatus by the procedures of . More specifically the finishing sheet in shows items corresponding to the functions of a selected finisher e.g. in line finisher . These items are given predetermined default values. For example when the finisher profile in is held a designate staple position button on the user interface of is activated. When the designate staple position button is clicked by the operator a selection menu field for selecting the binding method is displayed. In this menu field six binding methods defined in the BookletType tab in the profile of are provided as selection candidates. The cutting size and the like contained in the profile of can be set by clicking e.g. a details of finishing button in and displaying the size after cutting.

The flow of setting printing attributes by the user on the printer driver and printing out will be explained with reference to the flowchart of and the user interface windows of . The example in assumes a case wherein printing settings are changed by the user before the start of printing. Note that processing in is performed by the MPU in the host computer.

The user uses an application to create data to be printed and executes an operation to call the printer driver in order to print the data. The printer driver recognizes the processing executed by the user and recognizes that the printer driver is called step S . If the printer driver recognizes that the property button in is clicked it displays detailed setting windows in order to prompt the user to make settings for printing processing step S .

In order to set finishing processing for the data to be processed the printer driver displays a detailed setting window in response to a click of the details of finishing button or the like. If an arbitrary finisher is selected in the details of finishing setting window from supported finishers which are held as information in the RAM or the like by the printer driver the printer driver displays a setting window corresponding to a finishing function provided by the finisher step S . Since the functions of finishers supported by the printer driver are held the printer driver recognizes the selected finisher and implements the processing in S by referring to finisher ability information corresponding to the finisher. The printer driver recognizes a function selected in the setting window which is displayed in S and corresponds to the finisher function S . More specifically the printer driver temporarily holds the selected finisher function in the RAM or the like.

The printer driver repeats the above processing until it recognizes that settings are completed step S . If the printer driver recognizes that settings are completed and the OK button in is clicked it executes printing processing step S . In printing processing the printer driver outputs to the image forming apparatus information e.g. job control information and rendering instruction contents of a printing job necessary in printing step S . More specifically finisher ability information selected in S and the like are held in the RAM . In executing the processing in S the printer driver reads out necessary information by referring to the RAM and can transmit job control information which reflects the selected ability information.

Note that the printer driver outputs job control information to a near line finisher when the selected finisher is a near line one and an in line finisher when the selected finisher is an in line one.

For example in the staple setting user interface according to the first embodiment a staple setting button window a check box and the designate staple position button in are displayed regardless of whether a selected finisher is an in or near line finisher of the image forming apparatus. Before a printing job is transmitted to the image forming apparatus which of the in and near line finishers is to perform processing must be determined. However the determination rule in staple setting is simple If an in line finisher has a set function it is preferentially selected and if it does not have the set function one of near line finishers is selected in terms of the processing speed processing cost and the like. Note that it is desirable to display a window which alerts the user when it is selected to perform stapling processing by a near line finisher. An example of this window will be omitted. After the above settings are made it is set to perform stapling processing by the in line finisher of the image forming apparatus. A printing job and job control information are transmitted to the image forming apparatus. The job control information may be contained in the printing job and then transmitted.

In this manner job control information describes the procedures of post printing processing post press processing which is to be performed by an apparatus at the destination of the job control information and is transmitted to the destination. The procedures are parameters which are set to designate details of the operation of a finisher. For example the procedures are parameters which define the staple position and interval the number of pages to be stapled the number of pages to be bound the number of copies the cutting size and the like. The finisher saves parameters specified by the tag of job control information in a predetermined memory area corresponding to the tag and executes post processing in accordance with the parameter values. Alternatively job control information may be directly saved to read necessary parameters using a tag as a key.

For example job control information is described in accordance with finishing processing settings set in the user interface window of the printer driver particularly the finishing sheet shown in . If saddle stitching is designated on the user interface the tag in is described. This also applies to other post printing processing settings and these settings are described in accordance with the JDF definition. For this purpose a correspondence table is prepared which describes the correspondence between tags described in profile information the identifiers of setting items and tags described in job control information and can be referred to by the printer driver. Fields settable by the user are displayed on the user interface in accordance with tags contained in the profile information. After settings are completed tags corresponding to the set items identifiers of items are added to job control information forming the job control information. The attribute value of each tag is transmitted to a finisher read and set as an operation parameter. This is merely an example and any method can be adopted as far as set parameters and tags can be associated with each other.

When a printing job is transmitted to the image forming apparatus image information is processed in the image forming apparatus and printed. At the same time job control information is processed in the image forming apparatus and collated with finisher profiles held in the image forming apparatus. The image forming apparatus determines a finisher for use and the type of finishing processing to be executed by the finisher. In the first embodiment job control information for an in line finisher describes a setting of performing stapling processing at one upper right portion. The image forming apparatus analyzes the job control information and writes a value which is described as e.g. a tag attribute as a parameter for setting finisher operation corresponding to the tag. The value is not always directly written but may be converted into a value complying with the finisher. Thereafter a printing job is processed in accordance with the setting to execute post printing processing.

A case wherein the finisher cannot continue processing before or while a printing job is processed for example a case wherein staples run out in the first embodiment will be considered. In general a warning no staple is displayed for the user and processing stops until the finisher is replenished with staples. To the contrary if the image forming apparatus according to the first embodiment detects that a finisher designated by job control information cannot perform designated post processing it searches all finisher profiles of the image forming apparatus for a finisher profile having an alternative functional description tag i.e. the same functional description tag as the functional description tag of the designated post processing. For example when the designated post processing is stapling the image forming apparatus searches for a finisher profile having the same functional description as a functional description staple in the profile of an in line finisher. First the image forming apparatus searches available finisher profiles for a finisher profile having the functional description staple i.e. the staple tag. Then when a plurality of profiles are detected the image forming apparatus selects one of them in terms of the provided function processing time processing cost and the like. For example throughputs described in the finisher profiles are compared to select a finisher profile having the highest throughput. A finisher corresponding to the selected finisher profile serves as an alternative finisher. If only one candidate is detected it serves as an alternative finisher. If no candidate is detected the image forming apparatus notifies the user of interruption of post processing and waits until the interruption is canceled similar to the prior art.

After determining an alternative finisher the image forming apparatus generates new job control information by changing the finisher processing function designated in job control information from the processing function of the in line finisher to that of the alternative finisher near line finisher in this example and reassigning post processing settings to the alternative finisher. The image forming apparatus notifies the host which has issued the printing instruction that the processing is reassigned. Further the image forming apparatus notifies the host to perform post processing by the alternative finisher for a product printed out from the image forming apparatus. In this specification it is described to generate new job control information by reassigning post processing settings to an alternative finisher. However the present invention is not limited to this and incorporates a change of job control information.

The control unit of the image forming apparatus detects that an error occurs in a finisher before or while a printing job is processed S . A detailed description of processing in step S will be omitted because this processing is based on the same method as a method of detecting shortage of paper sheets or the absence of staples which is generally executed in a conventional image forming apparatus. For example a signal representing that staples run out is input from an in line finisher to the job control unit via the printer .

The control unit of the image forming apparatus searches the profiles of near line finishers for a finisher capable of alternatively performing finisher processing of the printing job S . More specifically profiles representing the functions of near line finishers connected to the image forming apparatus are held in the internal storage unit of the image forming apparatus and the control unit of the image forming apparatus can search for an alternative finisher. At this time the control unit searches for the profile of a near line finisher having a functional description tag of designated post processing as described above.

If the control unit of the image forming apparatus determines from the search in S that an alternative near line finisher exists YES in S it determines whether the near line finisher determined to be the alternative is available S . As an example of the determination method in S the control unit of the image forming apparatus inquires of the near line finisher determined in S to be the alternative whether the finisher is available at present. The control unit of the image forming apparatus may receive the current use status from the near line finisher at a predetermined interval. Also a finisher which is true in the connection column of the finisher management table can be determined to be available. If the schedule of a finisher is managed by a personal computer finisher controller or the like an available finisher can be found out by referring to the schedule.

If the control unit of the image forming apparatus determines in S that the near line finisher determined to be the alternative is available YES in S it generates job control information for the near line finisher determined to be the alternative S . More specifically the control unit of the image forming apparatus stores in the storage unit job control information received from an external apparatus e.g. host computer . In order to cause the near line finisher determined to be the alternative to perform post processing which should be performed by the in line finisher but cannot be done due to an error the control unit of the image forming apparatus generates from the stored job control information job control information for causing the near line finisher to execute alternative processing. In addition to newly generating job control information as described above job control information held in the storage unit may be rewritten. For example job control information received from an external apparatus by the control unit of the image forming apparatus contains information perform stapling processing at an upper right portion of the page using the in line finisher of the image forming apparatus . However when no stapling processing can be executed owing to an error of the stapling function of the image forming apparatus the control unit of the image forming apparatus generates or changes job control information perform stapling processing at an upper right portion of the page using near line finisher A in order to alternatively perform stapling processing by near line finisher A having the same stapling function. At the same time the control unit of the image forming apparatus deletes the staple setting from the job control information of the in line finisher and changes the settings of the in line finisher.

The control unit of the image forming apparatus transmits the job control information generated in S to the near line finisher determined to be thealternative under a predetermined condition S . More specifically the control unit of the image forming apparatus holds in the internal storage unit of the image forming apparatus the job control information newly generated or changed in S and transmits the job control information held in the storage unit in response to a job control information request from the near line finisher. Also job control information may be held in the storage unit together with identification information e.g. job ID and job control information corresponding to a job ID input by the user to the near line finisher may be transmitted to the near line finisher. The job ID is transmitted to the client computer together with a notification that the finisher is substituted. The computer displays the job ID to notify the operator of it. The job ID may be displayed on the operation panel of the image forming apparatus. Details of the operation of an alternative finisher will be explained with reference to .

If the control unit of the image forming apparatus determines in step S that the selected finisher is unavailable it determines whether another candidate finisher exists. If no other candidate finisher exists the printing job stops without substituting any near line finisher for the in line finisher. If another candidate exists the flow is repeated from step S.

By the processing in even if an error is detected in the in line finisher of the image forming apparatus a near line finisher capable of alternatively performing finishing processing is searched for and job control information is generated for the near line finisher and transmitted. The near line finisher determined to be the alternative can take over finishing processing requested by an external apparatus. The processing can proceed without being interrupted even if an error occurs in the finishing apparatus which should originally perform the processing.

In the image forming apparatus even if staples run out printing is completed because no stapling processing is done. The stapling processing is performed by an alternative finisher which will be described below and the user can obtain a desired output.

In this example the control unit of the finisher waits for a job ID input by the user step S . The control unit of the finisher determines whether the job ID has been input S . As the method of inputting a job ID by the user the job ID may be directly input to the operation unit of the finisher or a recording medium which records identification information of the job ID may be loaded into the loading unit of the finisher.

If the control unit of the finisher recognizes the job ID input by the user it requests job control information corresponding to the job ID of the image forming apparatus and acquires the job control information step S . If no job ID is input the control unit keeps waiting for input of the job ID. Note that job control information which is acquired in S and corresponds to the job ID is saved in the storage unit of the finisher.

The control unit of the finisher sets parameters e.g. paper width which have conventionally been set manually by the operator on the basis of an output manual and are necessary for post printing processing S . More specifically the acquired job control information is held in the storage unit of the finisher and the control unit of the finisher can analyze the contents of the job control information and set the parameters by referring to the storage unit.

In order to prompt the user to confirm the parameters set in S the control unit of the finisher displays the setting information parameter information and determines whether the information is incorrect or correct S . For example the control unit of the finisher executes the determination processing in S by displaying the set contents analyzed in S on the display unit of the finisher or the like and recognizing an input representing whether the user authenticates the set contents.

If it is determined in S that the settings are correct the flow advances to step S and the control unit of the finisher executes finishing processing on the basis of the contents set in S. If it is determined in S that the settings are incorrect the control unit of the finisher prompts the user to perform manual setting in order to correct incorrect contents S . The control unit of the finisher executes finishing processing on the basis of the set contents S . When a plurality of finishers are connected the same processing is repeated for the next finisher.

For post processing which cannot be achieved by a selected finisher the image forming apparatus according to the first embodiment can select another available finisher and cause it to alternatively perform the post processing. Interruption of an entire printing job by interruption of post processing can be prevented to increase the productivity. In addition the availability of the finisher can be increased.

In the first embodiment a near line finisher is substituted for an in line finisher. Instead of this a near line finisher can be selected first and its post processing can be alternatively performed by another near line finisher. Also a near line finisher can be selected first and its post processing can be alternatively performed by an in line finisher. Post processing may be executed by combining a plurality of near line finishers.

In an image forming apparatus according to the second embodiment finishers having compatible functions alternatively perform post processing. In addition a predetermined function or a combination of functions which provides the same result is detected and the function to be referred to as an alternative function can be substituted for the original function. The configurations of the apparatuses and system are the same as those in the first embodiment. As will be described below an alternative function is specified and a finisher profile having the specified post processing function is searched for in accordance with the procedures in to generate job control information. Hence a feature of the second embodiment is to specify an alternative function which will be explained with reference to .

Assume that the image forming apparatus runs out of A4 paper sheets while processing a printing job to print on an A4 paper sheet. A general image forming apparatus stops the job when paper sheets run out and does not resume the printing job unless the image forming apparatus is replenished with paper sheets. Alternatively the image forming apparatus must cancel the printing job and instruct another image forming apparatus to print on an A4 paper sheet again. However an image forming apparatus in which a finisher profile having the cutting function is registered can continue the printing job without stopping it. This method will be described in detail.

If A4 paper sheets run out in an image forming apparatus which processes job control information that designates printing on an A4 paper sheet the image forming apparatus searches all finisher profiles held in it for a near line finisher having a function of cutting an A3 paper sheet into two. If the image forming apparatus can detect the near line finisher it sets execution of printing processing on an A3 paper sheet. Further the image forming apparatus generates or changes job control information of contents for setting processing of cutting an A3 paper sheet into two and transmits the job control information to the detected near line finisher.

Before outputting a printed product the image forming apparatus must change the printing image which will be explained with reference to . In order to obtain an output by A4 double face printing an A4 image of one page is generally imposed on one face of an A4 paper sheet and such A4 images are printed on the double faces. That is a printing job schematically shown in is transmitted to the image forming apparatus. In this case the image forming apparatus outputs an output product .

However when the image forming apparatus runs out of A4 paper sheets and prints on A3 paper sheets an A3 paper sheet is regarded as two successive A4 paper sheets A4 images of two pages are imposed on one face of an A3 paper sheet and such A4 images are printed on the double faces. The resultant A3 paper sheet is cut into two obtaining outputs by A4 double face printing. To combine output products in two stacks after cutting into one stack one stack is piled on the other. In this case if pages are laid out so as to arrange paper sheets in the order of pages output products need not be sorted. For this purpose the image forming apparatus renders printing data again so as to rearrange pages and omit sorting as shown in . At this time the image forming apparatus performs RIP Raster Image Processing again for A4 printing data corresponding to received data and job control information and generates A3 size printing data corresponding to a printing job . As an example of generating A3 printing data the image forming apparatus generates from PDL data for A4 intermediate data which sets the resolution coordinate positions and the like for A3. By expanding the A3 intermediate data the image forming apparatus can generate A3 printing data bitmap data . The image forming apparatus may paste A4 printing data of two planes having undergone RIP for A3 and print the data.

A printed product in output from the image forming apparatus is set in the near line finisher. The near line finisher cuts an A3 paper sheet into A4 paper sheets in accordance with the job control information transmitted from the image forming apparatus. The printed product is cut into cut paper sheets . A stack A of the cut paper sheets is piled on a stack B obtaining an output product identical to the output product .

More specifically when a control unit detects that A4 paper sheets run out before or while a printing job containing designation of A4 double face printing is processed it detects whether A3 paper sheets exist. If A3 paper sheets exist the control unit searches the finisher profiles of available finishers for a profile which describes a function of cutting an A3 size paper sheet at the center. The description format is defined by JDF and the control unit only determines whether the finisher profile contains a defined tag and attribute. If a corresponding profile is detected the control unit generates or changes job control information to be transmitted to the finisher. The control unit describes in the job control information the setting of cutting an A3 size paper sheet at the center. The control unit changes the page layout of pages to be subsequently printed into a layout as represented by the job in and then prints the pages. More specifically letting Ps odd number be a printing start page and Pe be the final page a page Ps 2i 2 is laid out on the left side of the obverse and a page Pe Ps 4 4 2 2i 1 is laid out on the right side. Note that represents a calculation of obtaining the integer part of a quotient and i is a number representing the order of an A3 paper sheet. For example i 1 for the first paper sheet. On the reverse a page Ps 2i 1 is laid out on the right side when the paper sheet is reversed and a page Pe Ps 4 4 2 2i is laid out on the left side. If a page of a corresponding page number does not exist a corresponding plane is left blank.

In the above manner pages are rearranged and rendered and output products are cut by the near line finisher to implement A4 double face printing.

According to the second embodiment when the image forming apparatus detects that a printing job cannot be achieved by a designated printing setting it searches for a finisher having a post processing function to be substituted for the printing setting and generates post processing setting information for the searched finisher. By this processing an output result identical to that of an original printing job can be attained. For example a printing job having the setting of A4 double face printing can be alternatively executed by A3 2in1 printing and post cutting processing. Post processing may also be executed by combining a plurality of near line finishers. In the second embodiment if a state in which a printing job cannot be achieved by a designated printing setting is detected the paper type for use is changed to execute printing processing and a printed result is processed using an available finisher. As a result an output result identical to an expected output result can be obtained.

A case will be examined wherein when A3 paper sheets are to be bound by saddle stitching to obtain an A4 booklet the saddle stitch function of an image forming apparatus breaks down and the processing path cannot be used. In a general image forming apparatus if the function fails a printing job stops and cannot be resumed until the function recovers. Alternatively the printing job must be canceled and another image forming apparatus must be instructed to perform printing again. However an image forming apparatus having the profile of a near line finisher can continue the printing job without stopping it. This method will be described in detail.

The method will be explained with reference to . In order to obtain an A4 booklet output shown in images of two A4 pages are imposed on one face of an A3 paper sheet and such images are printed on the two faces of the A3 paper sheet as represented by an image . Note that a number represented by page number of reverse is a number when viewed from the obverse. That is the 15th page is imposed on the back side of the 16th page. A product represented by the image must undergo saddle stitch processing by an in line finisher.

When an in line finisher connected to the image forming apparatus breaks down and cannot perform saddle stitch processing all finisher profiles held in the image forming apparatus are searched for an alternative means. Even if a near line finisher which does not have the saddle stitch function but has the folding cutting and bookbinding functions can be detected a product identical to an expected final product which is bound and output can sometimes be obtained though the processing time may be prolonged and the processing cost may rise. In this case the saddle stitch function of the in line finisher is replaced with the folding cutting and bookbinding functions of the near line finisher.

Further RIP is executed again so as to change an A3 size image as represented by the image into an image in and impose A4 size pages on eight planes of an A1 size sheet. The direction of pages coincides with the order of page numbers. The resultant image is printed. After the image forming apparatus obtains an A1 size output product having undergone eight plane imposition the output product is set in the near line finisher having the folding cutting and bookbinding functions and processing can continue. As the folding order valley fold is done at valley 1 mountain fold at mountain 1 and valley fold at valley 2 . Paper is folded from right to left and from bottom to top in . As a matter of course paper can be folded in several ways and the imposition order changes depending on the folding method. Thus reimposition is performed in accordance with a folding method represented by the folding function of the profile. The page layout of one A1 size sheet is stored in advance e.g. the layout in . After one A1 size sheet is processed an offset value of 16 is added to each of page numbers to be laid out and then pages are laid out. For example for the second sheet 16 is added to each of page numbers in the layout .

Consequently half fold bookbinding printing can be alternatively achieved by 16 plane imposition folding cutting and bookbinding.

As described above when any error occurs in a given finisher and no finishing processing can be executed another finisher alternatively provides the function of the abnormal finisher to continue processing without stopping the printing job. When the finisher is changed the image forming apparatus can perform RIP again for printing data to change the output image as needed.

Note that the second and third embodiments limit substitutable functions but another function can be made substitutable. Such functions may be permanently determined by a program. Further the image forming apparatus may save a table which makes substitutable functions and substituted functions or combinations of them correspond to each other and an imposition method to be executed by the image forming apparatus after substitution. In this case alternative functions can be more widely flexibly implemented. It is also possible to alternatively execute post processing by a combination of near line finishers.

A method of specifying an alternative finisher when a near line finisher is substituted for a target function will be exemplified. As ability information of a cutting apparatus serving as a near line finisher it is described that the cutting apparatus has a paper size change function. More specifically it is described that Am size e.g. A3 size paper is cut into An size e.g. A4 size paper the cutting function of B paper is also described and the cutting function of an arbitrary size is also described but these are irrespective of the embodiment . If no A4 paper exists near line finishers having functions associated with the paper size are searched for a cutting apparatus. If the cutting apparatus is detected its ability information is checked to determine that A4 paper can be obtained by cutting A3 paper into two. Hence if no A4 paper exists a near line finisher having the paper size change function is searched for and an alternative function of cutting A3 paper into A4 paper is determined. This method is an example of specifying an alternative finisher.

The present invention may be applied to a system including a plurality of devices e.g. a host computer interface device reader and printer or an apparatus including a single device e.g. a copying machine or facsimile apparatus . The object of the present invention is achieved even by supplying a storage medium or recording medium which records software program codes to implement the functions of the above described embodiments to the system or apparatus and causing the computer or CPU or MPU of the system or apparatus to read out and execute the program codes stored in the storage medium. In this case the program codes read out from the storage medium implement the functions of the above described embodiments by themselves and the program codes and the storage medium which stores the program codes constitute the present invention.

The functions of the above described embodiments are implemented not only when the readout program codes are executed by the computer but also when the operating system OS or the like running on the computer performs part or all of actual processing on the basis of the instructions of the program codes. The functions of the above described embodiments are also implemented when the program codes read out from the storage medium are written in the memory of a function expansion card inserted into the computer or a function expansion unit connected to the computer and the CPU of the function expansion card or function expansion unit performs part or all of actual processing on the basis of the instructions of the program codes.

According to the above described embodiments and modifications the printer driver can generate and transmit job control information for even a near line finisher for use similar to the printer. A finisher can be set without manually setting the finisher by the user. Thus the productivity of the post printing processing step can be increased and any setting error can be prevented. The near line finisher itself has profile information and the client computer collects the profile information directly or via the printer. This can save the labor of inputting information on a newly connected near line finisher.

Since job control information issued from the printer driver is transferred to a near line finisher via the printer the printer driver need neither particularly generate nor transmit job control information for the near line finisher. Programming work of the printer driver can be simplified which contributes to reduction of the code amount and a decrease in program errors.

When a plurality of finishers are available a finisher designated on the basis of priority can be preferentially adopted. By changing the priority the user can designate a finisher for use.

By preferentially using an in line finisher convey work of a printed product from a printing apparatus to a post processing apparatus can be reduced which contributes to savings in labor and an increase in productivity.

As many apparently widely different embodiments of the present invention can be made without departing from the spirit and scope thereof it is to be understood that the invention is not limited to the specific embodiments thereof except as defined in the appended claims.

This application claims the benefit of Japanese Patent Application No. 2005 128618 filed on Apr. 26 2005 which is hereby incorporated by reference herein in its entirely.

