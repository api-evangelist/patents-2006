---

title: Method and devices for installing packet filters in a data transmission
abstract: A method is described for associating a data packet (DP) with a packet bearer (PB) in a user equipment (UE) of a communication network. The data packet is sent in a data flow from an application function of the user equipment, the packet bearer (PB) is established with the user equipment to transmit the data packet (DP) over the communication network towards a further entity, and the user equipment is adapted to establish different packet bearers. The method comprises the steps of identifying the flow with the data packet in a control entity of the communication network, determining the packet bearer for association with said flow from the different packet bearers in a policy function of the control entity, determining a routing level identification of the further entity, instructing the user equipment to install a packet filter based on the routing level identification, wherein the packet filter associates data packets comprising the routing level identification of the further entity with the determined packet bearer, providing the routing level identification to the application function, including the routing level identification into the data packet, and forwarding the data packet (DP) on the determined packet bearer (PB). A corresponding network, control entity, monitoring entity and computer program are also described.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07907524&OS=07907524&RS=07907524
owner: Telefonaktiebolaget L M Ericsson (Publ)
number: 07907524
owner_city: Stockholm
owner_country: SE
publication_date: 20060205
---
The present invention relates to a method for associating a data packet with a packet bearer in a user equipment of a communication network. Devices and software programs embodying the invention are also described.

In many cases data packets need to be sent over a communication network between a user equipment and a further entity. Transmissions can be performed both in downlink and uplink direction and the further entity is often another user equipment e.g. in a telephone call. The further entity may also be a service entity like a server which may send different packet flows for sound and video to the user equipment e.g. in a streaming session while the user equipment may also send packets to the further entity. The further entity can either be part of the communication network or it is able to exchange data packets with the network.

The communication network can be a fixed or a mobile network. More than one network can be involved in the transmission e.g. if the user equipment is located in a mobile network which is interfacing directly or via intermediate networks to a fixed network in which the further entity is located. Customary mobile networks comprise a core network with core network nodes e.g. general packet radio service support nodes GSN like a serving general packet radio service support node SGSN or a gateway general packet radio service support node GGSN . The core network nodes allow the exchange of data with external networks such as the Internet or mobile or fixed networks of other operators. Furthermore customary mobile networks comprise one or more access networks with access network nodes for controlling the radio transmission to user equipment commonly designated e.g. as base station controllers radio network controllers RNC Node B or base transceiver stations. Other implementations of the nodes and networks are possible for example an enhanced GSN and an enhanced RNC which perform different parts of the SGSN functionality and thus allow omitting an SGSN.

An operator may offer services to the subscribers that generate different types of packet traffic which are all transmitted over the communication network. Depending on the type of packet traffic the requirements for the transmission differ significantly. For example voice transmission requires low delay and jitter while a limited amount of errors can be acceptable. Streaming sessions using packet buffers typically allow higher delays and jitter and the receiver can generally also correct or hide errors. File transfer can often be performed as best effort traffic but normally requires error free data. In addition operators may choose to offer different qualities of service QoS depending on the user subscription i.e. they may choose to perform user differentiation. Accordingly the provision of a defined quality of service is an important concept in the control of data traffic as described for example in technical specification 3GPP 23.107 V 6.3.0. of the 3Generation Partnership Project Quality of Service QoS concept and architecture .

Different contexts define the quality of service relating to a data transmission involving nodes of a communication network and the user equipment. The user equipment and a core network node negotiate a PDP Packet Data Protocol context which specifies parameters for the transmission of data packets to and from the user equipment over a 3GPP bearer. Further contexts can be set up for bearers relating to different links between the further entity and the user equipment e.g. a context for the radio bearer between an access node and the user equipment which specifies the transmission parameters on the radio link. Packet flows between the further entity and the user equipment are then mapped to bearers associated with these contexts and forwarded accordingly.

Current 3GPP standards define a mechanism to map downlink data to a packet bearer. For this purpose the bearer is associated with a PDP context. The PDP context is the granularity with which QoS can be provided i.e. different PDP contexts can provide a different QoS. The mapping of packets onto PDP contexts is done in an edge node of the communication network e.g. in the GGSN using downlink Traffic Flow Templates TFT . A TFT is a packet filter which defines rules that uniquely map incoming data packets onto a PDP context. The downlink TFT is part of the PDP context definition and can be configured to operate on a number of different parameters. For example the IP source address of a data packet or the Type of Service field ToS in the IP header can be used to map packets onto a PDP context. The Session Management SM protocol is used to manage PDP Contexts.

In the uplink the user equipment requires information how to map data packets from an application to a bearer with the associated context. However this functionality is not in the scope of the current 3GPP standards. Instead it is defined proprietarily and can differ between vendors of user equipment. In one implementation the user equipment has several PDP context templates each with a different associated QoS. A connection manager provides a mapping for each application to one of the PDP context templates. The mapping is a static configuration which creates a binding in the connection manager and which is signaled to the user equipment e.g. by an SMS. Typically the user performs the configuration by visiting the web site of an operator and entering the phone model he is using and which application he wants to configure e.g. WAP or MMS. Upon initiation of a session e.g. when making a call the application communicates to the connection manager through a proprietary API Application Programming Interface . The connection manager associates the data packets from the application with the configured PDP context and if required sets up the context. Correspondingly there is a static binding between application and PDP context template. The identifiers and formats used in the configuration can be specific for each vendor.

As a result the existing methods for associating data packets with a bearer are inflexible and do not allow dynamic changes of the configuration. A further problem is that application development is both access specific and vendor specific i.e. applications must be written for a specific access e.g. 3GPP and a particular vendor of user equipment because the QoS API in the above binding mechanism may differ for both vendor and access.

Furthermore user equipment according to 3GPP specifications may consist of two entities a terminal equipment TE and a mobile terminal MT which are logically and optionally also physically distinct. Applications are executed in the terminal equipment and data packets are exchanged over the mobile terminal with the mobile network. In the state of the art an interface between TE and MT would be required over which it is possible to convey the bearer requirements of the application. As the binding of application and context is vendor specific in present user equipment different interfaces would be required. If the terminal equipment is for example a personal computer and the mobile terminal is a mobile network card the computer may need to support different interfaces for different card vendors leading to high complexity and cost.

With this background it is an object of the present invention to propose a simple and flexible method for associating data packets with a bearer in a user equipment of a communication network.

According to the invention the method described in claim is performed. Furthermore the invention is embodied in a communication network a control entity a monitoring entity and a computer program as described in the other independent claims. Advantageous embodiments are described in the dependent claims.

The proposed method associates a data packet with a packet bearer in a user equipment of a communication network. The data packet is sent in a data flow from an application function of the user equipment. Although the flow may comprise only a single data packet typically a plurality of data packets is sent in the flow. The packet bearer is established with the user equipment to transmit the data packet over the communication network towards a further entity for example to another user equipment or to a server.

The establishment of the bearer can be triggered by the user equipment or by another entity in the communication network. The establishment can be performed at different times in relation to the other steps of the method as will be described below. The user equipment is adapted to establish different packet bearers. For example the bearers may differ in the provided quality of service. Optionally the user equipment may keep more than one bearer established simultaneously.

The method identifies the flow with the data packet in a control entity of the communication network. A policy function of the control entity determines the packet bearer for association with said flow from the different packet bearers. Preferably the control entity is provided with operator policy rules to determine the selection of the determined bearers out of the different bearers which the user equipment is adapted to establish. In a UMTS Universal Mobile Telecommunication System network the control entity can be for example a GSN or a PCRF Policy and Charging Rules Function .

A routing level identification of the further entity is determined. This determination can be performed in the control entity or in another entity of the network which forwards the routing level identification to the control entity. The routing level identification enables the forwarding of data packets to the further entity. The routing level identification can be part of and used in the identification of the flow.

The user equipment is instructed to install a packet filter based on the routing level identification. The packet filter associates data packets comprising the routing level identification of the further entity with the determined packet bearer. The routing level identification is provided to the application function for example in a signaling message originating from the further entity. The routing level identification is included into the data packet. Accordingly the data packet is forwarded by the packet filter on the determined packet bearer.

The proposed method allows a simple and flexible association of data packets to packet bearers which does not require a prior configuration of the association and can be established before at or after the initiation of a data session. The proposed method provides a controlled way for the communication network i.e. the operator of the network for mapping data packets onto bearers in the uplink from the user equipment to a further entity and thus to provide differentiation between services and between users. The network can allow or forbid the mapping of selected flows to bearers in the user equipment by the policy function controlling the filter installation. For this purpose the operator may specify policy rules. In addition the method enables access agnostic application development i.e. applications can be developed independently of the access network to which the user equipment is connected because only ubiquitous socket API functions are used. This simplifies the development of applications making the development less expensive. The routing level identification can be set by the application through the socket API. The method does not introduce new dedicated signals to install the uplink packet filter but reuses existing procedures for this purpose and can accordingly easily be implemented in existing communication networks.

Communication networks typically comprise a plurality of entities. In a preferable embodiment the control entity receives the determined routing level identification from a monitoring entity and instructs the user equipment to install the packet filter. The monitoring entity and the control entity may be implemented as parts of a single device or in different devices. The monitoring entity can for example monitor a signaling for session establishment between the user equipment and the further entity or data packets sent during an established session between the user equipment and the further entity. As the signaling for installing the filter and for session initiation have different receiving entities in the user equipment and will generally also be performed using different signaling protocols it is often not suitable to have a single entity for monitoring the session level messages and instructing the filter installation.

In an advantageous embodiment of the proposed method an establishment of a communication session is initiated between the user equipment and the further entity by an initiation message. The initiation message comprises a session level identification of the further entity e.g. in the format of a telephone number a uniform resource locator URL or an e mail address or any other session level identification. A monitoring entity is adapted to monitor messages sent between the user equipment and the further entity for establishing the session. The monitoring entity stores information related to the communication session. For example the monitoring entity can be a call state control function storing a state for initiated sessions. The monitoring entity may be associated with an entity for performing an address resolution of the session level identification for forwarding the initiation message to the further entity. The initiation message is forwarded towards the further entity using the session level identification. The monitoring entity then waits for a reply message related to the establishment of the communication session and determines the routing level identification of the further entity from the reply message. It is possible to receive several reply messages and the routing level identification can be determined from one or several reply messages. The reply message is forwarded to the user equipment and the session establishment is completed. This embodiment allows a simple implementation to obtain the required information and to determine the identification of the flow especially for the originating side of the session.

In an alternative embodiment of the proposed method an establishment of a communication session between the further entity and the user equipment is initiated by an initiation message comprising a routing level identification of the further entity and a session level identification of the user equipment. A monitoring entity is adapted to receive the initiation message and to determine the routing level identification of the further entity from the initiation message. The initiation message is then forwarded towards the user equipment using the session level identification and the session establishment is completed. This embodiment allows a simple implementation to obtain the required information and to determine the identification of the flow especially for the terminating side of the session.

In a further embodiment initial data packets sent by the user equipment on a first bearer are inspected for example in the control entity or in a monitoring entity. The first bearer can be for example a default bearer or it can be established according to one of the preceding embodiments described. The flow for association is identified from the inspected data packets e.g. due to information in the packet header the packet content or other parameters of the data packets. Then a second packet bearer is determined for association with said flow. The second bearer can then be established for the flow a filter can be installed to associate the flow with an existing second bearer or parameters of an existing bearer e.g. the first bearer may be modified for this purpose.

In an advantageous embodiment the setup of the packet bearer is initiated by a request from a node in the communication network. This allows an improved control of the network operator over the transmission by the user equipment.

Preferably the packet bearers differ in at least one associated item from a group comprising a quality of service a charging tariff and an access point to which the packet is forwarded. Accordingly the bearers can provide a different quality of service or may be charged differently or both and can be selected accordingly.

Typically the user equipment comprises an executing unit for executing the application function and a transmission unit for sending the data packet on the associated packet bearer. In many cases the executing unit and the transmission unit are embodied in the same device for example in a mobile phone. The units can be logically distinct i.e. they may have a specified interface like for example a mobile terminal and a terminal equipment according to 3GPP specifications. It is also possible that the user equipment comprises physically distinct devices e.g. the transmission unit may be a UMTS card or a mobile phone while the executing unit is part of another device connectable to the transmission unit for example a computer or a television set with a wired or wireless connection to the transmission unit.

In a preferable embodiment the data packet is an internet protocol IP data packet. This allows an easy implementation of the method in existing networks. Session initiation signaling can be performed using a session protocol which is based on the IP protocol. Suitable protocols are for example the session initiation protocol SIP or the real time streaming protocol RTSP . Both can be used in conjunction with the session description protocol SDP .

The routing level identification of the further entity preferably comprises a destination address and or destination port number for example an IP address and an IP port number.

The packet bearer can be established at different times before or during the described method. Often it is suitable to establish the bearer simultaneously with the filter installation. In another embodiment the bearer is set up before installing the packet filter. It is also possible to establish the bearer prior to establishment of a communication session in which the data packets are sent. In these cases the packet filter can be installed in a modification procedure of the packet bearer. This embodiment is advantageous if the time required for bearer establishment is long compared to the time for filter installation.

In a preferable embodiment the packet filter associates the data packet with the packet bearer based on at least one further parameter. In this way a finer granularity of the mapping between data packets and bearer may be achieved e.g. to transmit packets with different quality of service or different charging. For example the packet filter may evaluate further fields in the packet header e.g. the source address the source port number further header fields like a differentiated services code point DSCP the protocol identification or any combination of such parameters.

An advantageous communication network is adapted to perform any embodiment of the method as described above.

A preferable control entity is adapted for a communication network with a user equipment. An application function of the user equipment is adapted to send a data packet in a data flow and a packet bearer can be established with the user equipment to transmit the data packet over the communication network towards a further entity. The user equipment is adapted to establish different packet bearers.

The control entity comprises an input unit adapted to receive the flow with the data packet or information related to the flow. Accordingly the control entity may be either part of the flow path or it may receive information related to the flow e.g. source and destination from another entity in the network. A processing unit of the control entity comprises an identification function adapted to identify the flow. A policy function is adapted to determine the packet bearer for association with said flow from the different packet bearers e.g. according to rules specified by the operator of the network. As an example the operator may specify that packets from a specific source or destination are forwarded on a bearer with specific parameters.

Furthermore the processing unit is adapted to determine a routing level identification of the further entity with a determination function. Typically the processing unit determines the routing level identification from a message received from a further entity in the network. An output unit is adapted to instruct the user equipment to install a packet filter based on the routing level identification the packet filter associating data packets comprising the routing level identification of the further entity with the determined packet bearer. The input and output unit may be embodied in a common input output unit. It is also possible that the control entity instructs further nodes to perform the signaling.

An advantageous monitoring entity is adapted for use in a communication network with a user equipment. An application function of the user equipment is adapted to send a data packet in a data flow. The packet bearer is established with the user equipment to transmit the data packet over the communication network towards a further entity and the user equipment is adapted to establish different packet bearers. The monitoring entity comprises an input unit adapted to receive an initiation message comprising a session level identification of the further entity the initiation message initiating an establishment of a communication session between the user equipment and the further entity. Preferably the monitoring entity is also adapted to receive a reply message to the initiation message.

A processing unit of the monitoring entity is adapted to monitor the messages and to determine a routing level identification of the further entity from the initiation message or from the reply message. An output unit adapted to forward the initiation message towards the further entity using the session level identification and to forward the reply message to the user equipment. The monitoring entity is further adapted to forward the determined routing level identification to a control entity for instructing the user equipment to install a packet filter based on the routing level identification wherein the packet filter associates data packets comprising the routing level identification of the further entity with the determined packet bearer.

An advantageous monitoring entity comprises a memory for storing an information related to the communication session

The invention can also be embodied in a software program comprising code for performing the steps of the method relating to the device in which the program is executed. It is preferably executed in a control entity.

An advantageous program for associating a data packet with a packet bearer in a user equipment is adapted for a communication network in which the data packet is sent in a data flow from an application function of the user equipment. The packet bearer is established with the user equipment to transmit the data packet over the communication network towards a further entity. The user equipment is adapted to establish different packet bearers a routing level identification is provided to the application function and the routing level identification is included into the data packet. The latter steps may be performed during or after execution of the program.

The program comprises program code for identifying the flow with the data packet in a control entity of the communication network. It determines the packet bearer for association with said flow from the different packet bearers. It determines also the routing level identification of the further entity optionally from information received from another entity in the communication network. The program initiates an instruction to the user equipment to install a packet filter based on the routing level identification wherein the packet filter associates data packets comprising the routing level identification of the further entity with the determined packet bearer. The program according to the invention is for example stored on a data carrier or loadable into a processing unit of a user equipment or a control device e.g. as a sequence of signals.

The control entity the monitoring entity and the software program can be adapted to any embodiment of the method described above.

The foregoing and other objects features and advantages of the present invention will become more apparent in the following detailed description of preferred embodiments as illustrated in the accompanying drawings.

The TE MT local bearer service forwards the data packets within the user equipment between the terminal equipment TE and the mobile terminal MT . Accordingly terminal equipment TE and the mobile terminal MT may be part of a single device or may be embodied in different devices utilizing communication via the TE MT local bearer service. The data packets are received or sent over a radio link with the radio access network RAN of the mobile network. The External Bearer Service is provided by another network which can also be a UMTS Universal Mobile Telephony System network i.e. a network according to 3GPP specifications another mobile network or a fixed network like a fixed communication system such as the Internet. The external bearer forwards data packets between the further entity AF and an edge node CN GW of the core network of the mobile network.

The core network comprises also a core network node CN which controls the forwarding of packets between core network and radio access network RAN . Edge node CN GW and core network node CN can be the same node. The data packet traffic through the mobile network is sent over a Radio Access Bearer Service between mobile terminal MT and core network node CN and over a Core Network Bearer Service between Gateway node CN GW and core network node CN . These Services are in turn provided by a Radio Bearer Service on the radio link between user equipment and radio access network RAN a RAN Access Bearer Service between radio access network RAN and core network node CN and a Backbone Bearer Service within the core network. Ultimately all services depend on different physical bearer services on the respective links i.e. typically a plurality of contexts and services relate to individual links in a transmission.

The set up of the PDP context can for example be initiated by a corresponding request RQ from the user equipment to the SGSN. It is also possible that the network e.g. the GGSN requests the set up of the PDP context PDP for example by a message to the user equipment which then initiates the sending of a request RQ to activate a PDP context.

The PDP context comprises attributes which define the quality of service for the packet transmission. The establishment of a radio bearer RB is typically included in the establishment of a PDP context. For that purpose the SGSN SGSN sends a request for establishment of a radio bearer RB to an access node in the example an RNC RNC . The transmission of the data packets on the radio link to the user equipment is for example performed by a node B NB which is controlled by the RNC using radio resource control signaling . It is also possible to integrate the functionality of the node B and the RNC in a single node. The SGSN sends also a request to an edge node of the core network here a GGSN GGSN for the establishment of a core network bearer. The configuration of the different nodes can be performed from an operation support system OSS over signaling links SIG .

The GGSN comprises down link packet filters DL PF which map packet flows generated by different services onto the bearers. To indicate the association of packet filters and bearers both are indicated by broken lines for bearer A while bearer B and the associated filters are indicated in continuous lines. A packet flow is a group of data packets with the same source destination and protocol. For example an IP flow consists of data packets with the same source address source port destination address destination port and protocol identification.

In the example a first service Srv generates two application flows and a second service Srv generates one application flow which are mapped onto the bearers by the down link packet filters DL PF . The data packets originating from the services require different bearers and are accordingly also indicated in broken and continuous lines corresponding to the bearer to which they are forwarded by the down link packet filters DL PF .

Two application functions App App are executed in the user equipment UE which consists of a personal computer as executing unit EU and a mobile phone as transmission unit TU . The first application function App generates two data packet flows each with characteristics which demand different treatment in the network. This is again indicated by broken and continuous outlines corresponding to the outlines of the bearer which shall be used. Also the data packets DP DP are indicated in continuous and broken lines corresponding to the respective bearer. Examples of applications which generate a plurality of packet flows are multimedia and presence applications which combine e.g. a voice over IP service with other services such as video chat whiteboard and file sharing. A second application function App generates only a single data packet flow.

The proposed method provides a mechanism for a mapping between the data packet flows and the bearers. Although the example describes a split user equipment with distinct devices the method is also applicable if the applications are executed on a device comprising both the executing unit and the transmission unit.

The executing unit marks the data packets of the different application flows with the destination for which they are intended. In the example this is achieved by the network instructing the executing unit to mark the different application flows with a particular combination of a destination IP address and destination port number through application layer signaling using e.g. SIP SDP. Generally the functionality of signaling a routing level identification may be part of any session level protocol.

UL Packet Filters UL PF are established in the transmission unit and provide a mapping of the packets onto the different bearers to which the filters are associated. In the proposed solution this is achieved by the network installing filters as a part of the session management protocol procedures e.g. the PDP context setup or modification. The filters use the routing level identification e.g. the combination of destination IP address and port number for the mapping of packets onto the bearers. It is possible that other parameters are checked in addition by the packet filters. For example further filtering can be based on the source address the source port number a differentiated services code point DSCP the protocol identification further fields in the IP header or any combination of such parameters. This enables a finer granularity of the mapping.

Using the uplink filters the network can control the association of an uplink data packet with one of multiple packet bearers in a user equipment of a communication network wherein the uplink data packet originates from an application function and the packet bearer is established between the user equipment and the network infrastructure. The method identifies a flow of uplink data packets that is subject to control and determines the packet bearer to be associated with said flow of uplink packets. This determination is performed in the network. The routing level identification of said flow of uplink data packets is also identified in the network. The association of the routing level identification with the determined packet bearer is provided to the user equipment. The uplink data packet is associated with the determined packet bearer in the user equipment based on the association provided from the network.

The steps of identifying a flow subject to control and determining the packet bearer can be based on operator policy rules. A preferable routing level identification is the IP flow 5 tuple or a subset of the IP flow 5 tuple in particular the destination IP address and destination port number. The identification of the flow of uplink data packets and the related routing level identification is preferably based on analyzing flow descriptions. included in session level signaling messages sent between the application function and the receiving application entity e.g. based on protocols using SDP like SIP or RTSP. The routing level identification can be included in a session level signaling message destined to said application function in the form of the destination IP address and port number to be used in uplink data packets from the application function. The provision of the association of routing level identification with a packet bearer can be done at the establishment of the packet bearer. Alternatively the provision can be done for a packet bearer that has been established previously.

In all examples both the user equipment and the further entity are a user equipment of a 3GPP communication system i.e. the session is set up between an originating and a terminating mobile user equipment both connected to a 3GPP network. In many other cases at least one of them will be in another type of network e.g. in a fixed network. The originating and terminating network may be connected by one or more intermediate networks forwarding the signaling between the networks as indicated by a rectangle. Aspects of the signaling sequence may be changed e.g. according to future standardization of the messages.

SIP SDP signaling is used to instruct the user equipments here IMS IP Multimedia Subsystem Clients how to mark the data packets. Concerning the designation of information elements in the messages shown addresses and port numbers are designated from the point of view of the respective side i.e. the source src of the A side is the destination dst of the B side and vice versa.

Both user equipments comprise a mobile terminal MT A MT B and a terminal equipment TE A TE B . The signaling sequences do not require signals between the mobile terminal and the terminal equipment. Accordingly they are applicable even if no control interface between these two entities exists.

A GPRS Support Node GSN A GSN B for example a gateway GSN is the edge node of the mobile core network in the examples. SIP signaling is forwarded and inspected by a node designated as IMS Core A IMS Core B as monitoring entity. In a typical 3GPP network this can be the P CSCF Proxy Call State Control Function . Policies e.g. for admission control and charging rules defined by the operator are enforced by a Policy and Charging Rules Function PCRF A PCRF B as control entity.

In the example of the packet bearer for carrying the data packets of the initiated session with the associated PDP context has been established prior to session initiation. The corresponding signaling is accordingly not shown. The following signaling messages of the diagram are described in detail 

Finally an acknowledgement for the successful set up of the session is sent between the involved user equipments.

In summary on the A side an uplink packet filter is installed using the PDP context modification procedure once the destination IP address and port are known i.e. after receiving the SIP 200 OK message including this information from the B side. On the B side the uplink filter can be installed with the PDP context modification procedure directly since the destination IP address and port are known from the SIP INVITE message. The RAB modify signals to the RAN in steps 4 and 8 are only relevant if resource reservation is required. If resource reservation is not used in the RAN the RAB modify signals can be omitted from the signaling. A variety of associations are possible for the packet filter which can be used for example to map packets onto bearers with different QoS characteristics. In addition the packets can be mapped to different APNs or charged differently. Combinations are also possible.

The above method can also be used for other access networks apart from the 3GPP network in the above example because the application layer signaling protocol is access agnostic. Only the signaling used for the installation of the uplink packet filter needs to be adapted to the different access network. One main advantage of the method is that applications executed in the user equipment do not need to support specific procedures on the API to handle the quality of service. Any communication to lower layers is made through a standard socket API. This simplifies application development significantly.

In summary on the A side the bearer is setup using an SNRPCA procedure before the parameters required for installing the uplink packet filter are available. Since the destination IP address and port to be used at the B side are not known until after receiving this information from the B side the uplink filter is updated later in the sequence using a PDP context modification procedure. On the B side the bearer is setup and the uplink packet filter is installed during this procedure since IP address and port are known from the SIP INVITE message.

In this example on both the A side and B side the uplink filter is installed together with the setup of the bearer using a network requested PDP context activation. Correspondingly the setup of a bearer on the A side is delayed until the reception of the information about the destination IP address and port number from the B side.

The example of shows a signaling sequence in which the filter of a pre established bearer is modified for content upload. As in the preceding examples the user equipment comprises a terminal equipment TE and a mobile terminal MT and the data transmission is performed via a GSN and controlled by a PCRF. Before the start of the illustrated sequence a packet bearer has been established between the network and the user equipment.

Initially the user is browsing e.g. visiting sites on a WWW server. Data packets transmitted during the browsing are mapped to a bearer with default QoS. The user activates an upload of a file from the user equipment to an upload server e.g. to a webblog server. The file upload is started with the default QoS but the data packets correspond to a new flow. A control entity in the network e.g. the GSN or another node in the operator s network detects the new flow e.g. by identifying that it is directed to a specific URL or IP address. According to the subscription of the user a rule is activated in the control entity that determines that an uplink flow to the specific URL or IP address should be mapped to a higher QoS.

The control entity then initiates an update of the uplink packet filter in the user equipment. In the example shown this a done using PDP Modify procedure. Alternatively the PDP modify could be replaced with a procedure for setting up an additional PDP context e.g. an SNRPCA sequence. In both cases the upload continues preferably in parallel using the default QoS. When the filter in the user equipment is updated the upload continues on a bearer with a higher QoS. This ensures priority over other traffic from the user equipment and other entities in the network.

A control entity according to the invention is shown in . It initiates the association of a data packet with a packet bearer in a user equipment of the communication network in which the packet bearer is adapted to transmit the data packet to a further entity. The control entity comprises an input unit IUC to receive information INF related to the flow for the data packet. A processing unit PUC is adapted to identify the flow in an identification function IF . For example the identification function IF can evaluate the message INF for this purpose. A policy function PF is adapted to determine the packet bearer for association with said flow from the different packet bearers available to the user equipment. Preferably the control device comprises a memory with operator defined rules OR as basis for the determination. A determination function DRI determines a routing level identification of the further entity. The determination function DRI can for example also evaluate the information message INF or another message comprising this information.

An output unit OUC is adapted to instruct the user equipment to install a packet filter based on the routing level identification the packet filter associating data packets comprising the routing level identification of the further entity with the determined packet bearer. The instruction is preferably performed by an instruction message IM to the user equipment.

A processing unit PUM is adapted to monitor the messages in a monitoring function MF and to determine a routing level identification of the further entity from the initiation message INV or from the reply message REP . An output unit OUM is adapted to forward the initiation message towards the further entity using the session level identification and if required to forward the reply message REP to the user equipment.

The monitoring entity is further adapted to forward the determined routing level identification to a control entity for instructing the user equipment to install a packet filter based on the routing level identification. For this purpose a notification NOT can be sent via the output unit OUM to the control entity.

Preferably the monitoring entity comprises a memory MEM for storing an information related to the communication session. The information allows especially associating initiation message INV and reply message REP with each other and the session.

The units and functions of the control entity and the monitoring entity can be embodied as electronic or optical circuitry or as software executed in such circuitry. The input and output units of both devices may be integrated in a common I O unit.

The above embodiments admirably achieve the objects of the invention. However it will be appreciated that departures can be made by those skilled in the art without departing from the scope of the invention which is limited only by the claims.

