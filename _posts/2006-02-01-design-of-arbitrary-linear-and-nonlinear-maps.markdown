---

title: Design of arbitrary linear and non-linear maps
abstract: Various software mapping aspects are provided. They include, but are not limited to, providing linear map to non-linear map conversion or transformation (and vice versa) in a symmetric fashion, so that data in one map upon conversion is symmetric in another map with respect to the former map. One way this is accomplished is by the use of dual-triangles that are mapped into the former and latter map, by having, in one exemplary aspect, the same vertices in both maps. Additional features, such as selection regions for regions to be converted or not converted are used. Furthermore, dual-triangle subdivision or aggregation techniques can be used to provide a desired mapping scenario. Finally, APIs are presented that allow developers and users of such mapping technology to implement the various aspects disclosed herein.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07649534&OS=07649534&RS=07649534
owner: Microsoft Corporation
number: 07649534
owner_city: Redmond
owner_country: US
publication_date: 20060201
---
The present application is related to application Ser. No. 11 217 638 filed Aug. 31 2005 entitled LOCATION SIGNPOSTING AND ORIENTATION and to application Ser. No. 10 998 081 filed Nov. 26 2004 entitled LOCATION AWARE MOBILE DEVICE SOFTWARE DEVELOPMENT. 

The present subject matter relates to the field of computing and more particularly to software mapping.

Maps that do not have a linear mapping to real world space latitude longitude and altitude or other measurements in the physical world are very common and useful but can be difficult to use with generic software systems. Examples of such non linear maps include subway maps ski maps industrial diagrams and infrastructure diagrams e.g. maps of power grids telecommunications grids and wide area transportation maps .

On such irregularly spaced non linear maps spaces get compressed stretched rotated and otherwise distorted. The nature of these distortions also often varies within the map itself with different regions of the map being distorted in different ways. For instance one region may be stretched another may be compressed and still another region may be rotated or a combination thereof and so on.

Because these non linear maps present an irregular representation of physical space they are able to convey a great deal of useful information in a small display. However it is difficult to display real world location data on top of non linear maps because the mapping from latitude longitude and altitude or other physical world coordinate systems to a position on such irregularly spaced maps is complex and irregular. At least two key difficulties arise 1 the ability to map real world locations onto the irregularly spaced maps 2 the ability to map points on the irregularly spaced maps into physical world coordinates.

Certain techniques can be used for extrapolating the location of map points on top of non linear irregularly spaced maps. Typically these techniques work by attempting to extrapolate location data from nearby points but this can be complex time consuming and error prone particularly in systems where the map s data is irregularly spaced. Thus it would be advantageous to provide other techniques that allow users to make the design time and run timeuse of non linear mapping techniques that are fast simple and accessible to moderately skilled programmers and other individuals who are not experts in map design complex math or cartography.

Techniques are provided that allow for the designing and using of arbitrary maps whether these maps may be linear or non linear. By way of example and not limitation a first map image and a second map image may be provided. In addition a plurality of dual triangles may be mapped onto the first map image and the second map image where the plurality of dual triangles have the same vertices in the second map image as in the first map image yet these maps may be completely different. For instance the first map image may be a linear street map and the second map image may be a non linear subway map. Because any points that are converted from the first map image to the second map image or vice versa are converted symmetrically such points will end up in the appropriate relation to the vertices of the dual triangles.

In another aspect at least one of the plurality of dual triangles can be selected into a region to be converted from the first map image to the second map image. Such regions may help users and developers to hone in on best information conveying maps or portions thereof . Alternatively such regions may also be used to exclude maps or portions thereof so that such regions are not be converted. In yet another aspect the plurality of dual triangles may also be subdivided into more sub triangles or aggregated into more comprehensive triangles. Various other aspects are disclosed herein.

Thus it should be noted that this Summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter nor is it intended to be used as an aid in determining the scope of the claimed subject matter.

In one aspect of the presently disclosed subject matter illustrates the ability of switching back and forth between linear and non linear maps. depicts the desirability of users to switch between linear maps e.g. street maps and non linear maps e.g. subway or transport maps . By shifting between different maps users can quickly determine the distance direction and mode of transport to arrive at a desired location or to meet other individuals or for still other purposes.

For example a non linear subway map may depict two people as points on the map the first point being Bob and the second point being Julie where Julie has a signpost pointing to her. Bob and Julie may want to meet at some point and the way to accomplish this may be by taking a subway or a tube . If Bob wants to meet Julie he can take the appropriate train by examining the non linear subway map . Once he s above ground he may want to switch to a linear map .

In general terms a user of such a non linear map may want to switch to a linear map depicting physical landmarks in linear proportionality to each other because such linear representation may be more intuitive in certain contexts. Thus in the linear map Bob and Julie are again depicted but this time their location is shown on a linear scale as opposed to a non linear scale in the previous map .

Users such as Bob may want to switch back to a non linear map after a while even if the non linear map has changed over time. Thus in Bob can switch from the linear map discussed above to a new non linear map . In this non linear map Julie is depicted as a point and Bob is depicted as a signpost. Now the relationship between Bob and Julie may be non linear vis vis any physical landmarks where it might have been linear in the previous map .

This type of switching back and forth between linear and non linear maps can be done indefinitely. And importantly such switching may be done without any distortions as to the actual location of Bob and Julie on the linear and non linear maps. As will be shown in more detail below the present aspect of the disclosed subject matter overcomes distortions of points placed on maps that result from the eventual aggregation of errors associated with each switch between a linear and non linear map and vice versa.

In another aspect disclosed herein illustrates that the spatial relationship between points mapped onto linear map may differ from the spatial relationship between points mapped onto a non linear map. Specifically in on the linear street map Bob left side appears below Julie right side yet on the non linear irregular subway map Bob appears above Julie . Such kinds of shifts in relative display position are common as one moves between linear and non linear maps. One reason as mentioned above already is that the non linear map may have various regions of its map stretched rotated compressed and so on.

Thus eventhough Bob and Julie may be at the exact same locations in the linear map as the non linear map their positions relative to each other and relative to the maps may differ. For instance in Julie is located near Charing Cross both in the linear map and the non linear map. Bob likewise is located near Green Park on both maps and . Yet their positions vis vis each other as mentioned above change between the two maps and . Moreover even if their positions don t change vis vis each other they can change in going from one map to the other due to map distortion especially in the non linear case .

Of course as illustrates the spatial relationship between points mapped onto a linear map may at times be the same or similar as the spatial relationship between points mapped onto a non linear map. For example in Bob has practically the same orientation vis vis Julie in the linear map as the non linear map . Moreover the distance between Bob and Julie is practically the same in both maps and . Thus it appears that the conversion from the linear map to the non linear map or vice versa caused practically no distortion. However practically speaking this may be more of an exception than the rule and in a substantial number of such conversions orientations distances etc. between mapped points on different maps will differ and hence the ability of the presently disclosed subject matter to cope with such situations.

This particular non linear map shows the London Underground Tube map. To illustrate the non linear nature of this map it is instructive to focus on a couple of stations illustrated therein. For example Oxford Circus is shown as is Tottenham Court Road Weston Street and Goodge Street the first three of these four stations define a triangle between them. From it appears as if Goodge Street is a lot closer to Tottenham Court Road than it is to Warren Street . However in a linear setting such as a typical street map Goodge Street is about half way between Tottenham Court Road and Warren Street . And this is merely a trivial and simple example since other kinds of distortions could be involved between linear and non linear maps or between linear maps and other kinds of linear maps or between non linear maps and other kinds of non linear maps as has been discussed already above. Furthermore those of skill in the art will readily appreciate the different kinds of distortions that can occur when mapping points or data from one map onto another map.

For instance T has its vertices between Russell Square Holborn and Chancery Lane. T has its vertices between Holborn Chancery Lane and Mansion House and so on. Also it should be noted that even though T and T happen to be contiguous they don t have to be as can be seen in T is sharing a vertex with T and T namely Holborn but it is not contiguous as neither are T T and T . These six exemplary triangles define the regions that are to be converted from a non linear map to a linear map shown in . Their particular shapes will be contorted by the transformation and hence so will the data in those triangles.

Now turning to it illustrates how the same six triangles depicted in would map onto a linear map and how the shape of these triangles can differ from the shape of the same triangles that were mapped onto a non linear map thus suggesting how map space gets distorted in a non linear context. This distortion is clear in terms of the shapes of triangles T T T T T and T shown in as compared to the same triangles T T T T T and T shown in . Since these six triangles get distorted so do the corresponding points and data within them. One of the many advantages of the presently disclosed subject matter is that it can appropriately map such points and data from one set of triangles in a non linear map space to another corresponding set of triangles in a linear map space and vice versa .

In a manner of speaking these six triangles have a dual nature in that they can be mapped into a linear space and a non linear space even though their relative shape may differ in each space context. However in one aspect of the presently disclosed subject matter what remains the same in both contexts is the vertices of the triangles. Thus as already mentioned triangle T in may have the same three vertices as triangle T in FIG. and the same may hold true for all the other remaining triangles in .

Next illustrates a full set of triangles that have been mapped onto a non linear map where this map is shown without the triangles in . The six triangles discussed with reference to are depicted along side this full set of triangles where the full set of triangles forms a mapping of non linear space to linear space. For instance a typical non linear map is divided into some set of triangles as exemplified by triangles and referenced in dashed lines for readability purposes and the now familiar triangles T T T T T and T discussed with reference to .

The set of mapping triangles exemplified by triangles and may have their vertices set at known locations such as a Tube stations of the London Underground. The level of granularity of the vertices will be context and design dependent. For instance triangles may be set every other tube stop or several vertices between any two tube stops may be used. Thus the size and number of the triangles depicted in is merely exemplary and not limiting. Other kinds of triangles could be used as those of skill in the art will readily appreciate.

For example illustrates how triangular regions configured for conversion may be subdivided at various levels of granularity to provide more accurate results. In the non linear map on the left one triangle is defined between Oxford Circus Regent s Park and Warren Street. In the non linear map on the right this triangle is twice subdivided once into three triangles and then again into nine triangles. Triangles and are representative of the nine triangles which are contained within the original triangle . As mentioned subdivision is only one option the opposite can occur that is triangles may also be combined to define larger triangles.

The triangular mapping considered so far in one aspect can be one from a Cartesian X Y plane of the non linear map onto any real world coordinates such as latitude and longitude including altitude if a third coordinate Z is included in the Cartesian space . For instance if the conversion is from a linear map to a non linear one Global Positioning System GPS coordinates can be used to construct a non linear map either a two dimensional flat map a three dimensional spatial map a four dimensional spatial map with a temporal component dimension and so on .

Of course various conversion techniques could be implemented here where for example a set of linear based triangles containing N triangles is converted to a non linear setting but where only half as many N 2 triangles were mapped on the non linear map. Or vice versa where twice as many triangles are mapped on the non linear map by using various interpolation techniques. The number of triangles used in happens to be the same as the number of triangles used in but this does not have to be the case. Using the same vertices in both linear and non linear setting naturally leads to the same number of triangles but this is merely one exemplary and non limiting aspect.

In another interesting aspect of the presently disclosed subject matter illustrates how a set of regions can be used to specify the boundaries of a mapping from a linear map to a non linear map and by analogy vice versa. Specifically shows a set of coarse bounding regions that a user developer or map designer can specify that the non liner or irregular subway tube map of should be applicable for. By being able to represent these regions on a normal linear street map the developer or map designer is given a good visual understanding of the geographic area covered by the non linear map. Notably these coarse bounding regions need not cover all the areas defined by triangles the map s designer can choose only the areas best covered by the non linear map.

Thus in on the linear map a developer may select several regions R R R R R R and R . These regions may together cover the relevant portion of the subway that the developer or user may want to focus on. As the regions are illustrated in they cover the highlighted triangles discussed in the previous figures T T T T T and T . These regions also cover other triangles that may represent areas of interest for the developer or the user of this subject matter. There is really no limit on the number of regions that may be used or the size of those regions. Moreover although the regions as shown are contiguous the don t have to be. The user or developer of this technology may simply select an area of interest to be converted into another map. Notably in a linear map is shown with selected regions because this kind of setup allows a person to have a more intuitive feel for what information is important. However if users or developers are more familiar with a non linear setup alternative similar regions can be selected on a non linear map to be then converted into a linear map. For instance one might imagine subway workers and employees using a subway map with selected relevant regions to then see how such a subway map corresponds to a real world linear street map.

Aspects of a Technique for Conversion of a Linear to Non Linear Mapping and b Non Linear to Linear Mapping

Next displays in a mathematical diagram a technique for converting linear mapping to non linear mapping and vice versa. For example in a triangle Triangle is drawn in a non linear mapping domain. This triangle has vertices A B and C. These vertices can be the same in the non linear domain as they are in the linear domain. For instance A can be a subway stop such as Warren Street in B can be another subway stop such as Oxford Circus and C can be a third subway stop such as Tottenham Court Road. Each of these subway stops or in the context of triangles vertices can be exactly the same whether the map is linear or non linear.

In order to convert Triangle to Triangle which persists in a linear domain with latitude longitude and altitude coordinates as opposed to the X and Y coordinates designated for the non linear domain several steps may be taken. If for example a point P is to be mapped from a non linear map to a linear map in Triangle a first step may be the drawing of a vector from some vertex of Triangle to P in Triangle . As illustrates vector VAP is drawn from A to P. In the software context vector VAP is computed from A to P.

Once this vector is computed in a second step it is extrapolated to a side opposite of the aforementioned vertex. Thus another vector is computed V AP. This vector will then intersect the side of Triangle between vertices C and B. Next in a third step a ratio is computed of the two vectors VAP to V AP. Following this step in a fourth step a proportion or percentage is computed of the length of side CP to BP where P is the point of intersection of the aforementioned side. This then provides enough information to map point P into Triangle which as mentioned persists in a linear domain.

In order to place P in the proper location vis vis points A B and C which define Triangle the following steps may be taken first in step 5 to continue the progression of steps 1 4 considered so far the proportion of the computed length of sides CP to BP is used to compute P which now stands for the point of intersection between vertices B and C this proportion was computed in step 4 . Once P is computed the results computed in step can be used in step 6.

In step 6 using the newly computed P and the ratio of VAP to V AP a newly computed vector VAP can be computed. Once this vector is computed all that is left to do in step 7 is the computation P based on the results obtained from VAP and from the location of A. After the computation in step 7 is obtained P is found. And this location of P in Triangle represents where this point should be vis vis vertices A B and C. This process naturally can be used to go back to P in Triangle based on where P is located in Triangle . Thus this process works not only for conversions from non linear maps to linear maps but also from linear maps to non linear maps. Put another way it is symmetric.

One major benefit of this kind of symmetry is that conversion between linear and non linear maps can occur an infinite amount of times without causing any distortion as to the location of points P and P which as mentioned in above was a major shortcoming of any previous mapping techniques.

Thus in contrast to illustrates a non linear map where the horizontal lines are wavy because the round trip conversion produces an error due to the non symmetric nature of the conversion algorithm. in fact represents a zoomed in version of and shows in great detail the kind of round trip error that is produced. Thus again the horizontal lines are wavy. When the first leg of the round trip conversion starts there is some X and Y value for a particular point on the non linear map . Upon the result of the round trip conversion it can be clearly seen that the Start point is in a different place than the Result point. In other words the X and Y coordinates at the Start are different from the X and Y coordinates at the Result and this is an error since the X and Y coordinates should be the same at the Start and at the Result. As mentioned the conversion technique discussed with reference to avoids creating this error.

A triangle ABC is defined in the image with vertex A corresponding to Oxford Circus as shown in vertex B corresponding to Regent s Park and vertex C corresponding to Warren Street. As can be seen around the edges of triangle ABC the error is zero because the edges are black however in the middle of triangle ABC the error is greatest given the white shading. These errors appear because the conversion technique depicted in the image is non symmetrical. If a symmetrical technique were to be used such as the one discussed with reference to the entire image would appear black since no errors would be produced.

Next illustrates the notion that some areas don t have to be or haven t been converted from a linear map to a non linear map or vice versa by showing specific regions that are highlighted as non converted. For example the map in gives a developer or map designer visual feedback indicating which regions have not yet have triangles defined for them and hence do not support X Y to latitude longitude and altitude transformations . These yet to be defined areas are highlighted below using blue rectangles. Some of them may be areas that the developer or map designer has forgotten to specify triangles for e.g. middle upper right Russell Square and some lower right specify areas that the developer or map developer has decided will not be supported on this map.

Various classes can be used to implement the above discussed aspects of the presently disclosed subject matter. For example a NonLinearMapInfo class can be used to perform the following functionalities 1 Use the coarse grained bounding areas described above to determine whether the non liner map it represents is appropriate for the map locations that need to be displayed and 2 when appropriate loads the NonLinearMapView class and points it to the dual triangle data and the map image.

The NonLinearMapView class in turn may provide the following functionalities 1 contain a LocationTriangleManager class that manages all the triangles in the map 2 contain the non linear map image or the capability of rendering one as needed . The above referred to class of LocationTriangleManager may perform the following functionalities 1 maintain a sorted list of LocationTriangles for use in X Y to Lat Long Alt coordinates 2 select the correct LocationTriangle for a given X Y or Lat Long point 3 provide the capability of performing X Y Lat Long and Lat Long X Y transformations 4 provide the capability of computing the error distortion in any given triangle or any given point where both average and maximum distortion are computed 5 provide the capability of splitting triangles into sub triangles using a variety of different heuristics 6 provide the capability of loading and saving sets of LocationTriangle data.

Such data may be associated with a LocationTriangle class that 1 holds data for two triangles 1 a triangle on the surface of the X Y image of the non linear map and a triangle in physical real world space i.e. latitude longitude and altitude 2 provides the capability of quickly determining if a point is contained in the either triangle 3 provides the capability of translating points inside it between the non linear map X Y and real world coordinate systems. Of course this class and the three other classes discussed herein are merely exemplary and not limiting.

In one exemplary implementation in consistent with the subject matter discussed with reference to a block diagram illustrates one way of designing and using arbitrary maps whether such maps are linear or non linear. The blocks to are self explanatory especially in light of . They present a general implementation that could be used in any system such as a computing system or more specifically a software mapping system.

With this system moderately skilled programmers and other non experts for example working with map images can apply and or use them in the following manner 1 import existing non linear and irregularly spaced map images into the system 2 quickly annotate the non linear map s images with real world physical location data using for instance a combination of other maps to help guide their mapping process 3 design a set of triangle shapes on map surfaces that connect known points and define boundary conditions inside which translations between real world coordinates and points on the non linear map can take place 4 project these triangles and location points onto a variety of maps to audit the area covered by the non linear map and its user annotations 5 audit the non linear map annotations to determine areas of unacceptable error distortions that need to be corrected 6 guide and aid developers or map designers in correcting and minimizing these distortions 7 allowing developers or map designers to view the areas covered by the defined triangles on a physical world map and to choose coarse bounding regions that define the physical world areas well covered by the non linear map alternatively default bounding regions can be automatically chosen to assist the user in this process 8 use these maps at run time in arbitrary software applications that utilize the maps simultaneously conveying to users map data on both linear e.g. street maps and non linear surfaces e.g. subway maps and 9 construct these maps at design time in contrast to run time .

Thus per the discussion above in one aspect of the presently disclosed subject matter any useful non linear or irregularly shaped map image can be broken down into a series of dual triangles. Each dual triangle specifies an X and Y area on the non linear map and a parallel real world area having latitude and longitude coordinates hence the name dual triangle . Transformations or conversions with controllable error magnitudes can be done between linear and non linear maps in both directions. A rich design surface capable of showing the map data in several different projections may be useful in doing this.

In this aspect then an arbitrary number of sub triangles can be defined to lower translation or conversion error as may be needed. Many heuristics are possible for automating this triangle refinement process. Moreover the specification of coarse bounding areas for maps may allow for quick determination whether any individual map is suitable to display a set of map coordinate information.

This system of dual triangles and related points can be persisted in a text or binary file for use at run time. For flexibility purposes a text representation such as XML may be useful. Alternatively for compactness and performance purposes a binary representation may be useful. At both design time and run time specified classes can be used to efficiently manage the use of all these dual triangles for coordinate mapping. Thus it is possible to a manager module to be optimized to allow for efficient access to commonly used triangles.

Put in other words this system provides a mechanism for non experts to quickly and with predictable accuracy to annotate arbitrary non linear and irregularly spaced maps allowing for the projection of location based data onto these maps in software applications. This is useful for all kinds of software applications and particularly useful for mobile devices used by individuals in real world environments in need of these maps.

To this end a map design surface such as the one illustrated in supported by an application programming interface API can be used to allow developers to easily work with a wide variety of linear and non linear maps. Non expert developers or other designers can be given any easy programming and graphical interface not limited to the one illustrated in FIG. to define these dual triangle systems and to use them to project location data onto map image s . illustrates that users or developers can Draw triangles Plot empty areas Label all triangle Points Calculate error s in triangle s and so on. These options are merely exemplary and other aspects discussed herein can easily be incorporated into such design surfaces as those of skill in the art will readily appreciate.

Notably an important question when dealing with sets of maps some linear some irregular is which is the best map to display to meet users needs. Several maps may be applicable given some set of data. It may be important for an application to be able to choose the maps that can show the data most accurately and efficiently. Unlike linearly spaced maps the region of effective display may not be defined by a simple rectangle or circle. For this a high performance and flexible mechanism may be provided for designating the real world regions for which a given irregularly or non linearly spaced map is best suited for. The presently disclosed subject matter may provide both a design time and run time mechanisms for this.

Thus in another aspect a display surface may be provided that allows a non expert developer or map designer to visually see understand and modify the sets of triangles that will govern the X Y to latitude and longitude transformations or conversions for a given map. This design surface may allow for simultaneous display of the sets of mapping triangles on both the non linear map and the other map representations such as linear street maps. The result may be flexible and useful in allowing for the rapid use of non linear maps in software applications by the mapping framework described herein.

Furthermore a system may be provided for the detection of error distortions and overlapping mapping triangles. Since a triangle set describes a bounded transformation or conversion between X Y and latitude longitude spaces with its own internal distortions having two sets of significantly overlapping triangles would potentially introduce conflicting X Y to latitude longitude mappings. It may be important to be able to detect this situation at design time when the triangles defining map transformations are being designated. Further when an unacceptable magnitude of error exists in a transformation this error should be detectable and fixable at design time by non experts the actual rate of acceptable error will vary from application to application . This system then may provide this detection. The developer or map designer may also be shown a visual representation of the distortions that exist inside map triangles between X Y to latitude longitude transformations and latitude longitude to X Y mappings thus allowing for the developer or map designer to take corrective action. Such corrective action may comprise of defining additional more fine grained mapping triangles as may be required .

Lastly while the present disclosure has been described in connection with the preferred aspects as illustrated in the various figures it is understood that other similar aspects may be used or modifications and additions may be made to the described aspects for performing the same function of the present disclosure without deviating therefrom. For example in various aspects of the disclosure a visual identity mechanism was disclosed. However other equivalent mechanisms to these described aspects are also contemplated by the teachings herein. Therefore the present disclosure should not be limited to any single aspect but rather construed in breadth and scope in accordance with the appended claims.

