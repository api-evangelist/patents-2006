---

title: Network access protection
abstract: A method is provided for use in a computer system including a client and a health registration authority. The health registration authority is configured to accept requests for assertions, and the client has a health state described by at least one health claim. The method may include an act of including an indication of the at least one health claim of the client in a request for an assertion. A second method is provided for use in a computer system comprising a client, an assertion authority, and a plurality of health policies. The method can include an act of including an indication of at least one health policy that the health claim of the client satisfies in an assertion.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07793096&OS=07793096&RS=07793096
owner: Microsoft Corporation
number: 07793096
owner_city: Redmond
owner_country: US
publication_date: 20060331
---
In computer networks clients servers and peers commonly employ user and machine authentication schemes to determine the identity of network entities or resources requesting an action e.g. such as access to a part of the network . Such information can in turn be used as input in making authorization decisions based on the identity of the network entity and or user requesting the action. Therefore authentication schemes can provide a mechanism by which the identity of network entities and or users may be used in decision making processes such as authorization processes.

Conventional authentication schemes do not incorporate health considerations of resources and entities. As such although such authentication schemes can protect computer systems from intrusion by unidentified and unauthorized entities these schemes do not provide any protection against the spread of infectious agents from unhealthy entities. The inventors have appreciated that it may be beneficial to enable health awareness in existing systems in a manner that produces a minimal degree of disruption to pre existing software and protocols.

The inventors have further appreciated that an approach to health enabling such existing systems can involve augmenting an authentication system to consider the health of a resource and or user. In various embodiments an application s pre existing capabilities for handling assertions e.g. certificates such as X. 509 certificates can be utilized to implicitly verify the health of an entity as part of an authentication process. In some embodiments an indication of health claims associated with a client can be included in a request for an assertion. Furthermore an indication of one or more health policies that the client satisfies based on the health claims may be included in an assertion. In some embodiments such an indication may be included in an extended key usage extension and or a policy extension field of an assertion.

Although conventional authentication schemes incorporate identity information such conventional schemes do not take into consideration the health of the network entity from which a request originates also referred to as the requestor. However the health of the requestor can be an important factor to consider due to the possibility of infectious agents e.g. viruses worms etc. residing on the requestor. In particular when an infected requestor communicates with other resources in the network the infectious agent might spread to the other resources and hence infect the entire network.

As an example consider how infectious diseases spread in the physical world and how a single infected individual can ultimately result in millions of infections. To avoid such a situation infected individuals can be isolated or quarantined from healthy individuals thereby limiting the spread of the disease. These same techniques can be applied to computer networks thereby limiting the spread of infectious agents from an unhealthy network resource to healthy network resources.

As previously noted the consideration of the health of network resources can be used to limit the spread of infectious agents originating from unhealthy network resources. The inventors have appreciated that it may be beneficial to enable health awareness in existing network systems in a manner that produces a minimal degree of disruption to pre existing software and protocols.

In considering how to incorporate support for health awareness into an existing network system any extensibility options and design assumptions built into the network system can provide a framework around which health awareness can be integrated. A common design assumption in network systems having authentication systems is that authentication concepts are abstracted into one or more modules responsible for providing an answer regarding whether a session should be allowed.

The inventors have appreciated that an approach to health enabling such existing network systems can involve augmenting such authentication systems to consider the health of a resource and or user in addition to identity. Authentication systems can use statements referred to as assertions also referred to as claims and or tickets to encode information regarding a resource and or user. In some embodiments an assertion may be a certificate e.g. a binding between a private key and one or more attributes but it should be understood that the invention is not limited in this respect. Specific examples of assertions include but are not limited to X.509 certificates and XrML licensees.

In various embodiments an application s pre existing capabilities for handling assertions can be utilized to implicitly verify the health of an entity as part of an authentication process. In one embodiment such an approach can be implemented with X.509 based authentication schemes. Compliance with health policies can be represented in assertions so that a pre existing authentication system can utilize health policy compliance information and therefore health enablement of pre existing systems can be achieved with only minimal modifications. As a result the ability to health enable pre existing systems with little to no code modifications can greatly facilitate the adoption of health aware systems.

In accordance with various embodiments a method is provided whereby an assertion issuer can express which health policies a principal identified in the assertion was verified to conform with. In some embodiments the assertion is a X.509 certificate. The X.509 certificate policies extension field can be overloaded to express which health policies the principal was found to conform to. Therefore the X.509 certificate can serve as both an authentication certificate and a health certificate.

In various embodiments presented a network may include various components such as routers gateways hubs network load balancers etc. and can allow network resources to communicate via wired and or wireless connections. When interacting with one another over the network one or more of the resources may act as clients servers or peers with respect to other resources. Therefore various embodiments of the invention may be practiced on clients servers peers or combinations thereof even though specific examples contained herein may not refer to all of these types of network resources or may refer to specific types of such resources.

The client can be a computer that may be attempting to obtain an assertion which may then be used when accessing one or more resources not shown in network . In some embodiments the client may send a request for an assertion to the health registration authority . In various embodiments an up to date assertion that has not expired i.e. been in existence for more than a certain time period and that reflects the current health state of the client can be maintained by the client so that the assertion is available for use. The up to date assertion that is maintained by the client may be accessed by an assertion enabled network protocol and used when attempting to access network resources that demand an assertion. In other embodiments the health registration authority and or other resources on the network may monitor attempts by clients to access resources that are configured to accept and verify an assertion prior to granting access to clients. Upon detecting that a client is attempting to access such a resource and that the client does not have an associated assertion the health registration authority and or other resources on the network may initiate a process to obtain an assertion for the client.

The health registration authority HRA may be a network entity responsible for validating statements of health and approving the issuance of assertions. In particular the HRA may communicate with the policy server and the assertion authority to validate a client s statements of health and approve the issuance of an assertion for the client.

The policy server PS may be a network entity responsible for verifying whether the statements of health associated with the client satisfy one or more of the network health policies. Network health policies are policies that clients and other network resources should conform to. Network health policies can include a specification that a client is running a supported operating system version that operating system patches are installed that all required software is executing that a specified anti virus service is running that a real time anti virus protection feature is enabled that a virus signature database is up to date that a local firewall is executing and or that the firewall is configured in accordance with network policy. These are some examples of network health policies and any other health policy may be defined as desired as the invention is not limited so.

The assertion authority AA may be a network entity responsible for issuing an assertion. The AA need not necessarily be health aware that is aware of the health state of the client and may generate an assertion having health claims encoded within specific attributes of the assertion based on a request provided by the HRA . As such the AA need not necessarily be modified to support health awareness and may enable such support using pre existing processes for generating assertions.

Process can include act where a client may generate one or more claims about its health state i.e. health claims also referred to as a statement of health SoH . The SoH can include an indication of which operating system version is installed on the client which operating system patches are installed the software executing on the client the anti virus service running on the client the enabled anti virus protection features the last update of the virus signature database whether a local firewall is executing and or the configuration of the firewall. These are just some examples of health claims that may be included in the SoH and any other health claims may be included in the SoH as desired as the invention is not limited so.

In act the client may generate an assertion request e.g. a request for an X.509 certificate bundle the SoH together with the assertion request and send the assertion request and the SoH to HRA . In some embodiments the assertion request and SoH are sent to the HRA via a protocol referred to as a health certificate enrollment protocol HCEP as shall be described further below.

In act HRA receives the client s assertion request and SoH. In act HRA then sends the client s claims about its health state to the PS to determine which if any network health policies the client conforms with.

In act the PS receives the claims about the client s health state from HRA . The PS can then validate the claims against each of the health policies to determine which health policies the client conforms with act . For each health policy that the client is found to conform with a corresponding policy identifier is added to a response that can be sent back to the HRA act 

Once HRA receives the response from the PS act HRA then proceeds to determines whether one or more health policies are satisfied based on the response from the PS act . If no health policies are satisfied by the health state of the client then HRA can proceed to deny the client s request for example by sending a message to the client indicating that the assertion request is denied act .

If at least one health policy is met for each of the health policies that the health state of the client is found to conform with an indication can be encoded in an assertion request that can be sent to the assertion authority act . In one embodiment identifiers indicating which health policies the client conforms with may be encoded in an extended key usage extension in an assertion request and or in any policy extension field or in any other suitable manner. If the identity of the client is known the assertion request that is forwarded to the AA can also include an indication of the identity of the client but this need not necessarily be so as may be the case for an anonymous assertion.

AA can receive the assertion request from HRA act and in response generate and send back an assertion e.g. a X.509 certificate to HRA act . Since AA need not necessarily be health aware AA may generate the assertion containing encoded conforming health policy information without any awareness of the meaning of the encoded health information. For example if the health policies information is encoded in the policies extension field in an assertion request AA can generate the assertion without necessarily deciphering the meaning of the encoded health policies information. As such AA may function as it regularly would when processing an assertion request without any encoded health policies information. Therefore the AA need not necessarily be modified to enable health awareness. Furthermore the assertion generated by AA can have the same format as an assertion without explicit health policy fields and yet still serve to convey health information due to the encoded health policy information for example health information encoded in the policies extension field of the assertion.

HRA can receive the assertion from the AA act and can send the assertion to client act . Client can receive the assertion from HRA act and can deposit the assertion into a system store act . The system store can store assertions for the client such that when an assertion aware application e.g. an X.509 aware application attempts to find an assertion for example to verify the identity and or health of the client the aforementioned assertion can be selected.

The abovementioned system and process allows an operator who is managing a server or application requiring a client s health information to state that a client have an assertion that satisfies desired health policies. Therefore the method enables the server or application to request that a client is healthy according to the desired health policies before allowing authentication thereby facilitating network access protection.

It should be appreciated that the components of the abovementioned health aware system can be implemented in a number of various implementations. For example as previously mentioned the system can be implemented at a network and or application level as the invention is not limited in this respect. Specific implementations of the components shall be presented below but it should be understood that various modifications are possible.

SHAs and can make determinations and declarations i.e. SoH about one or more aspects of the client s health. For example one of the SHAs may determine what antivirus signatures are installed another one of the SHAs may determine whether an antivirus security program is running and yet another one of the SHAs may determine what operating system updates are installed. It should be appreciated that these are merely examples of some types of SHAs and that the invention is not limited to just the above mentioned examples. Furthermore it should also be appreciated that third parties can supply SHAs so that any desired statement of health about the client can be generated. In the embodiment illustrated in the SHAs and are not part of the quarantine service but rather can communicate to the quarantine server via suitable communication methods. For example the SHAs and can use COM APIs to communicate with the quarantine service although other communication techniques could alternatively or additionally be used to achieve the communication.

Quarantine service can include a quarantine agent that can aggregate and maintain health statements collected from SHAs and . In the embodiment of the quarantine agent can also include a SHA application programming interface API that can be responsible for allowing access to the SHAs and .

SHA API can enable the SHAs and to trigger a re evaluation of the client s overall health. The SHA API can also provide a mechanism for the quarantine agent to query a specific SHA or for an evaluation of the client s health based on that specific SHA s health evaluation query e.g. antivirus running firewall running updated operating system etc. .

Quarantine agent can also include one or more quarantine enforcement clients QECs and that can facilitate enforcement of access to specific health aware applications and or communication protocols and . Examples of protocols can include DHCP RRAS IPSEC and 802.1x. Different types of resources and protocols may each have an associated QEC that is responsible for facilitating enforcement for access to that specific resource or protocol. QECs and need not necessarily reside within the quarantine agent and can execute out of process thereby facilitating the incorporation of third party QECs and protocols such as QEC and protocol . QECs and can be accessed via a QEC API which can function in a manner similar to SHA API and therefore can allow for the query and notification of any state change.

The quarantine agent can also include a health certificate enrollment agent HCEA which can communicate with a health key and certificate management service HKCMS . In other embodiments the HCEA can reside external to the quarantine agent as the invention is not limited in this respect. In the embodiment illustrated in the quarantine service includes the HKCMS but it should be appreciated that other arrangements are possible. For instance the HKCMS can be part of the HCEA and therefore may have the same level of access privileges as the HCEA. In contrast in the illustrated embodiment by not incorporating the HKCMS within the HCEA each component can be assigned a minimum level of access privileges which can in turn provide enhanced security.

The HCEA can communicate with the HKCMS so as to generate keys e.g. asymmetric or symmetric keys to be associated with a certificate request sign the certificate request delete certificates that may no longer be valid e.g. as a result of no subscription or certificate expiration install any issued certificate and or associate any meta data with the certificate. Potential situations where a certificate may be expired can include instances where the health state of the client for which the certificate was acquired has changed for example as in when a formerly activated firewall is disabled. In the illustrated embodiment of the HCEA can communicate with the HKCMS via a certificate enrollment process .

As previously mentioned HRA may be a component responsible for validating the client s SoH e.g. sent via HCEA and approving the issuance of a health certificate. The HRA can perform the functions of a registration authority and therefore HRA may be responsible for the validation of a certificate request and a SoH supplied by the client and for ensuring that the SoH conforms with health policies before forwarding the request to the AA for processing.

When a certificate request is received by HRA the HRA can validate the request via a combination of internal processing and or communication with PS . If the request is found to be valid and the client s health satisfies at least one health policy the certificate request may be forwarded to the AA to be processed and an issued certificate may be returned to the client for later use.

Specifically when a certificate request is received by HRA the HRA may determine whether the client meets some base policies before proceeding with the certificate issuance process. A base policy may be that the certificate request was signed by a private key associated with a public key that is represented in the certificate request. Another base policy may be that the request was authenticated the name in the certificate request matches that of the principal that was authenticated and if this and the other base policies are satisfied the name should be included in the resulting certificate. Another base policy may be that the HRA s authentication policy is being honored wherein the authentication policy may be that when the request contains the name of the client the HRA verifies that the name of the requestor was authenticated to be the same principal e.g. by the Internet Information Service . If not the request may still be processed but a certificate may instead be issued as an anonymous certificate rather than an authenticated certificate.

Another base policy may be that the HRA s cryptographic policy is honored. Specifically the HRA s cryptographic policy may include that the certificate request contains a public key for an allowed asymmetric key algorithm e.g. RSA DSA etc. have a key length between the minimum and maximum allowed key lengths for that algorithm have keys generated with an allowed cryptographic service provider if a cryptographic service provider is used in the embodiment and or have a signature generated using an allowed algorithm.

Once the HRA has validated the abovementioned aspects of the certificate request the HRA may create a new certificate request and copy the desired and validated attributes from the incoming request into the newly created request e.g. machine name public key etc. . Such a process can prevent a client from being able to use the HRA as a channel to receive a certificate containing arbitrary non validated extensions in the certificate.

Before submitting the request to the AA for processing the HRA may also verify with the PS that the SoH supplied by the client satisfy one or more health policies. When PS indicates that the client is conformant with at least one health policy a certificate request may be forwarded to the AA for processing.

When the HRA receives a certificate back from the AA HRA may also determine if the issued certificate is approaching expiration as defined by HRA policy. If so an event log warning may be created by HRA . After the abovementioned processing the issued certificate may be forwarded to the client .

HCEP may include the generation and transmission to the HRA of a certificate request as a PKCS 10 message as defined by the Public Key Cryptography Standards devised and published by RSA laboratories in California including elements which the HRA may use to validate certificate requests act .

The request may be sent via HTTP and in some embodiments may not be cached hence the request may be labeled as such. The request may be a PKCS 10 message that may be encoded for size reasons for example using Distinguished Encoding Rules or another other suitable encoding rules. The PKCS 10 message may be used as a health certificate request message and may be formatted to include a subject field containing the client s requested distinguished name a public key information field containing a signature that includes information about the public key being certified and attribute fields that contain a collection of attributes that provide additional information about the subject of the certificate.

Requests can include a number of attributes which may not be authenticated and may be placed as HTTP header values. Examples include the version of the HCEP protocol being used and a unique identifier used by the HCEA to determine which transaction a HCEP request is associated with.

The request s attributes for which authentication is desired may be represented as custom PKCS 9 attributes. Such attributes can include the client s SoH an indication of a cryptographic service provider CSP used to generate the key pair in embodiments where a CSP is used a key container for the CSP that contains the corresponding private key and a keyspec i.e. slot in the key container for the corresponding private key. The request may also include a PKCS 9 extension request indication if the client may be requesting that extensions be included in the resulting certificate. The final request may be signed using the private key corresponding to the public key represented in the public key information field of the request.

HCEP may include a response act from the HRA which in the success case may be a standard Type Length Value TLV including a PKCS 7 message that contains the certificate. Meta data associated with the health certification of the client can be included as attributes of the certificate. One such meta data may include an encoded e.g. BASE64 indication of which health policies the principal identified in the certificate was verified to conform with. In this way health state information about the client may be stored in a certificate which may not necessarily have been designed to store health related information.

As should be appreciated from the foregoing there are numerous aspects of the present invention described herein that can be used independently of one another including the aspects that relate to including health related information in a request for an assertion and a resulting assertion enabling health awareness for applications and resources and enabling communication between a client and a HRA.

However it should also be appreciated that in some embodiments all of the above described features can be used together or any combination or subset of the features described above can be employed together in a particular implementation as the aspects of the present invention are not limited in this respect

The above described embodiments of the present invention can be implemented in any of numerous ways. For example the embodiments may be implemented using hardware software or a combination thereof. When implemented in software the software code can be executed on any suitable processor or collection of processors whether provided in a single computer or distributed among multiple computers. It should be appreciated that any component or collection of components that perform the functions described above can be generically considered as one or more controllers that control the above discussed functions. The one or more controllers can be implemented in numerous ways such as with dedicated hardware or with general purpose hardware e.g. one or more processors that is programmed using microcode or software to perform the functions recited above.

It should be appreciated that the various methods outlined herein may be coded as software that is executable on one or more processors that employ any one of a variety of operating systems or platforms. Additionally such software may be written using any of a number of suitable programming languages and or conventional programming or scripting tools and also may be compiled as executable machine language code. In this respect it should be appreciated that one embodiment of the invention is directed to a computer readable medium or multiple computer readable media e.g. a computer memory one or more floppy disks compact disks optical disks magnetic tapes etc. encoded with one or more programs that when executed on one or more computers or other processors perform methods that implement the various embodiments of the invention discussed above. The computer readable medium or media can be transportable such that the program or programs stored thereon can be loaded onto one or more different computers or other processors to implement various aspects of the present invention as discussed above.

It should be understood that the term program is used herein in a generic sense to refer to any type of computer code or set of instructions that can be employed to program a computer or other processor to implement various aspects of the present invention as discussed above. Additionally it should be appreciated that according to one aspect of this embodiment one or more computer programs that when executed perform methods of the present invention need not reside on a single computer or processor but may be distributed in a modular fashion amongst a number of different computers or processors to implement various aspects of the present invention.

Various aspects of the present invention may be used alone in combination or in a variety of arrangements not specifically discussed in the embodiments described in the foregoing and the aspects of the present invention described herein are not limited in their application to the details and arrangements of components set forth in the foregoing description or illustrated in the drawings. The aspects of the invention are capable of other embodiments and of being practiced or of being carried out in various ways. Various aspects of the present invention may be implemented in connection with any type of network cluster or configuration. No limitations are placed on the network implementation.

Also the phraseology and terminology used herein is for the purpose of description and should not be regarded as limiting. The use of including comprising or having containing involving and variations thereof herein is meant to encompass the items listed thereafter and equivalent thereof as well as additional items.

