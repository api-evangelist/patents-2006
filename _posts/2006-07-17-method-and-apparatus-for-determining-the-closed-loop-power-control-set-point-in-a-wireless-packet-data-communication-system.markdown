---

title: Method and apparatus for determining the closed loop power control set point in a wireless packet data communication system
abstract: According to one aspect of the invention, a method for determining a power control set point is provided. In one embodiment, the power control set point is determined based on one or more factors including a first factor corresponding to a pilot bit error rate, a second factor corresponding to a normalized signal variance, and a third factor corresponding to an average number of fingers in lock.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07835695&OS=07835695&RS=07835695
owner: Qualcomm Incorporated
number: 07835695
owner_city: San Diego
owner_country: US
publication_date: 20060717
---
The present Application for Patent is a Continuation of patent application Ser. No. 10 651 834 filed Aug. 28 2003 now U.S. Pat. No. 7 088 957 which is a Continuation of patent application Ser. No. 09 370 081 filed Aug. 6 1999 now U.S. Pat. No. 6 633 552 issued on Oct. 14 2003 and assigned to the assignee hereof and hereby expressly incorporated by reference herein.

The present invention relates to communications. More particularly the present invention relates to a novel and improved method and apparatus for controlling transmission energy in a wireless communication system.

The use of code division multiple access CDMA modulation techniques is one of several techniques for facilitating communications in which a large number of system users are present. Other multiple access communication system techniques such as time division multiple access TDMA and frequency division multiple access FDMA are known in the art. However the spread spectrum modulation technique of CDMA has significant advantages over these modulation techniques for multiple access communication systems. The use of CDMA techniques in a multiple access communication system is disclosed in U.S. Pat. No. 4 901 307 entitled SPREAD SPECTRUM MULTIPLE ACCESS COMMUNICATION SYSTEM USING SATELLITE OR TERRESTRIAL REPEATERS assigned to the assignee of the present invention of which the disclosure thereof is incorporated by reference herein. The use of CDMA techniques in a multiple access communication system is further disclosed in U.S. Pat. No. 5 103 459 entitled SYSTEM AND METHOD FOR GENERATING SIGNAL WAVEFORMS IN A CDMA CELLULAR TELEPHONE SYSTEM assigned to the assignee of the present invention of which the disclosure thereof is incorporated by reference herein.

CDMA by its inherent nature of being a wideband signal offers a form of frequency diversity by spreading the signal energy over a wide bandwidth. Therefore frequency selective fading affects only a small part of the CDMA signal bandwidth. Space or path diversity is obtained by providing multiple signal paths through simultaneous links from a mobile user through two or more cell sites. Furthermore path diversity may be obtained by exploiting the multipath environment through spread spectrum processing by allowing a signal arriving with different propagation delays to be received and processed separately. Examples of path diversity are illustrated in U.S. Pat. No. 5 101 501 entitled METHOD AND SYSTEM FOR PROVIDING A SOFT HANDOFF IN COMMUNICATIONS IN A CDMA CELLULAR TELEPHONE SYSTEM and U.S. Pat. No. 5 109 390 entitled DIVERSITY RECEIVER IN A CDMA CELLULAR TELEPHONE SYSTEM both assigned to the assignee of the present invention and incorporated by reference herein.

A method for transmission of speech in digital communication systems that offers particular advantages in increasing capacity while maintaining high quality of perceived speech is by the use of variable rate speech encoding. The method and apparatus of a particularly useful variable rate speech encoder is described in detail in U.S. Pat. No. 5 414 796 entitled VARIABLE RATE VOCODER assigned to the assignee of the present invention and incorporated by reference herein.

The use of a variable rate speech encoder provides for data frames of maximum speech data capacity when said speech encoding is providing speech data at a maximum rate. When a variable rate speech coder is providing speech data at a less that maximum rate there is excess capacity in the transmission frames. A method for transmitting additional data in transmission frames of a fixed predetermined size wherein the source of the data for the data frames is providing the data at a variable rate is described in detail in U.S. Pat. No. 5 504 773 entitled METHOD AND APPARATUS FOR THE FORMATTING OF DATA FOR TRANSMISSION assigned to the assignee of the present invention of which the disclosure thereof is incorporated by reference herein. In the above mentioned patent application a method and apparatus is disclosed for combining data of differing types from different sources in a data frame for transmission.

In frames containing less data than a predetermined capacity power consumption may be lessened by transmission gating a transmission amplifier such that only parts of the frame containing data are transmitted. Furthermore message collisions in a communication system may be reduced if the data is placed into frames in accordance with a predetermined pseudorandom process. A method and apparatus for gating the transmission and for positioning the data in the frames is disclosed in U.S. Pat. No. 5 659 569 entitled DATA BURST RANDOMIZER assigned to the assignee of the present invention of which the disclosure thereof is incorporated by reference herein.

A useful method of power control of a mobile in a communication system is to monitor the power of the received signal from the mobile station at a base station. The base station in response to the monitored power level transmits power control bits to the mobile station at regular intervals. A method and apparatus for controlling transmission power in this fashion is disclosed in U.S. Pat. No. 5 056 109 entitled METHOD AND APPARATUS FOR CONTROLLING TRANSMISSION POWER IN A CDMA CELLULAR MOBILE TELEPHONE SYSTEM assigned to the assignee of the present invention of which the disclosure thereof is incorporated by reference herein.

In a communication system that provides data using a QPSK modulation format information regarding the transmitted data signal can be obtained by taking the cross product of the I and Q components of the QPSK signal with the estimate of the communications channel. By knowing the relative phases of the two components one can determine roughly the velocity of the mobile station in relation to the base station. A description of a circuit for determining the cross product of the I and Q components with the channel estimate in a QPSK modulation communication system is disclosed in U.S. Pat. No. 5 506 865 entitled PILOT CARRIER DOT PRODUCT CIRCUIT assigned to the assignee of the present invention the disclosure of which is incorporated by reference herein.

There has been an increasing demand for wireless communications systems to be able to transmit digital information at high rates. One method for sending high rate digital data from a remote station to a central base station is to allow the remote station to send the data using spread spectrum techniques of CDMA. One method that is proposed is to allow the remote station to transmit its information using a small set of orthogonal channels this method is described in detail in U.S. Pat. No. 6 396 804 entitled HIGH DATA RATE CDMA WIRELESS COMMUNICATION SYSTEM assigned to the assignee of the present invention and incorporated by reference herein.

The reordered symbols are provided to decoded . The decoded symbols are then optionally provided to a cyclic redundancy check CRC bit check element . CRC check element locally generates a set of CRC bits from the decoded data and compares those locally generated bits with the estimated received CRC bits. CRC check element provides a signal indicative of the checking of the CRC bits to control processor . In addition decoder may provide other quality metrics such as Yamamoto metric or symbol error rate to control processor . In response control processor outputs either the decoded frame of data or a signal indicative of the erasure of a frame.

In any communication system there is a nominal performance rate. In conventional systems the performance is determined based upon the frame error rate of the received signal. The frame error rate depends on the average received signal to noise ratio of the received signal or other quality metric related to the received signal. When the frame error rate is less than the target frame error rate the power control set point is decreased. Conversely when the frame error rate is greater than the target frame error rate the set point is increased. In one method for adjusting the signal to noise ratio threshold the set point is increased by a relatively large amount for example 1 dB whenever a frame erasure is detected. Conversely the signal to nose ratio threshold is decreased by 0.01 dB whenever a frame is properly decoded. Control processor provides the set point to comparator COMP . In a pilot assisted coherent communication system the signal to noise ratio is estimated based on the pilot signal. An exemplary method for estimating the signal to noise ratio based on the pilot signal is disclosed in U.S. Pat. No. 5 903 554 filed Sep. 27 1996 entitled METHOD AND APPARATUS FOR MEASURING LINK QUALITY IN A SPREAD SPECTRUM COMMUNICATION SYSTEM assigned to the assignee of the present invention and incorporated by reference herein.

The demodulated signal from demodulator is provided to signal to noise ratio calculator SNR CALC . Signal to noise ratio calculator computes the signal energy based on the energy of the demodulated symbols. In addition a signal indicative of the received in band energy is provided to signal to noise ratio calculator . Signal to noise ratio calculator generates an estimate of the signal to noise ratio of the received signal and provides this estimate to comparator .

In comparator the estimated signal to noise ratio is compared with the power control loop set point provided by control processor . A signal indicative of the result of the comparison is provided to power control bit generator . If the estimated SNR is less than the set point then power control bit generator provides a message requesting that the transmitting device increase the energy of its transmissions. If the estimated SNR is greater than the set point then power control bit generator provides a message requesting that the transmitting device decrease the energy of its transmissions.

The power control message which is a single bit message requesting the transmitting device to increase or decrease its transmission energy by a predetermined amount is provided to puncturing element . Puncturing element receives modulated traffic data from traffic modulator and punctures the power control message into the traffic data in a predetermined fashion. The traffic data including the power control data is then upconverted filtered and amplified for transmission to the transmitting device. In response the power control messages the transmitting device not shown increases or decreases the energy of its transmissions in a predetermined fashion.

The present invention is a novel and improved method and apparatus for performing closed loop power control. A method of implementing reverse link outer loop using only pilot signal is described. Such a method is especially useful when the data signals are only present in short burst such that packet or frame error rates PER or FER cannot be estimated accurately. Moreover since this method provides a mechanism for accurate set point adjustment even without a PER FER estimate it can also be used to improve the accuracy of outer loop performance when such estimate becomes available. The present invention estimates a pilot bit error rate PBER where each pilot bit consists of a number pilot chips distributed over a frame. In addition it estimates the normalized variance of the signal energy or C I for each packet. In addition in the preferred embodiment the average number of fingers that are in lock is also used to determine the power control set point.

The present invention describes a method of determining the set point of a closed loop power control system. In the exemplary embodiment the present invention is applied to a packet data transmission system. In packet data transmission systems data is transmitted in bursts and a significant period of time may elapse between the burst transmissions. In the exemplary embodiment a pilot signal is transmitted even when no packet data is being transmitted. The exemplary embodiment of the present invention is discussed in terms of a system optimized for packet data transmission in a wireless communication system as described in detail in copending U.S. Pat. No. 6 574 211 filed Nov. 3 1997 and entitled METHOD AND APPARATUS FOR HIGHER RATE PACKET DATA TRANSMISSIONMETHOD AND APPARATUS FOR HIGHER RATE PACKET DATA TRANSMISSION which is assigned to the assignee of the present invention and incorporated by reference herein. The present invention may also be extended to other proposed systems that are planned to carry packet data transmissions such as the Telecommunications Industry Association proposal to the International Telecommunications Union ITU entitled The cdma2000 ITU R RTT Candidate Submission and the European Telecommunications Standard Institute proposal to the International Telecommunications Union ITU entitled The ETSI UMTS Terrestrial Radio Access UTRA ITU R RTT Candidate Submission .

The present invention is especially useful when the data signals are transmitted in short bursts so that packet or frame error rates PER or FER cannot be estimated accurately. Such cases are quite common in a wireless packet data system such as described in the aforementioned U.S. Pat. No. 6 574 211. Moreover since the present invention provides a mechanism for accurate set point adjustment even without PER FER estimate it can also be used to improve the accuracy of outer loop performance when such estimate becomes available.

The present invention describes setting the power control set point based on a pilot bit error rate PBER where each pilot bit consists of a number of pilot chips distributed over a frame. In a preferred embodiment of the present invention the set point is determined additionally in accordance with a normalized variance of the signal energy or signal to noise interference per slot for each packet and additionally employs the number of fingers in lock to determine the set point. By employing these two additional factors the set point can be determined to provide a good indication of PER FER almost independent of the channel characteristics e.g. different Doppler spectrum. Thus it is possible to determine the closed loop power control set point T based on these factors.

In the exemplary embodiment there are 2048 chips in each slot organized as 32 groups with 64 chips each. The first 64 chips zero th group is the reverse rate indicator RRI . The rest of the even groups consists of the pilot signal and the odd groups are multiplexed control bits. Only the pilot signal groups are used in the set point determination method of the present invention. Two quantities generated from the pilot signal that are used by the outer loop are pilot bit error rate PBER and the normalized variance of the pilot energy.

Referring to a method of determining the power control set point on the received pilot signal is illustrated. In block the pilot bit error rate PBER is computed. In the exemplary embodiment the pilot channel is modulated by spreading each symbol of the all zeroes symbol sequence using a four chip Walsh 0 sequence and pseudonoise PN sequence. One skilled in the art will readily appreciate that the present invention is equally applicable to other pilot channel structures. The first step in computing the pilot bit error rate is to despread the received samples. In the exemplary embodiment the received samples are despread in accordance with a 4 chip Walsh 0 sequence and the PN sequence to provide 240 despread pilot samples in each slot.

The despread pilot samples are delayed and demodulated by the channel estimate. In the exemplary embodiment the pilot signal is transmitted on the in phase component of a QPSK modulated signal. In the exemplary embodiment the real parts of the corresponding demodulated pilot samples of all the slots in a frame are combined to form 240 estimates of the pilot symbols. In the exemplary embodiment the pilot symbols are the all zeroes sequence represented by a positive amplitude value. Conversely one value symbols are represented with negative amplitudes. At the end of each frame these samples are compared to zero. If any estimate is less than zero a pilot bit error is declared. By adjusting the power control set point to make the frame error rate equal to 1 the number of average bit error per a frame is given in Table 1 for the case of two antennas with one path per antenna. Thus in the simplest case the pilot bit error rate can be used to derive the set point by having knowledge of the motion of the transmitter relative to the receiver.

In step the normalized signal variance is calculated. While the PBER is related to the frame error rate it is also a function of vehicle speeds and other channel characteristics. An improved embodiment of the present invention describes a method for compensating for the effect of vehicle speed by using the normalized variance of the received signal power or C I as described below.

In the exemplary embodiment the closed loop power control commands are transmitted 600 times per second i.e. a power command is generated every slot. In the exemplary embodiment the normalized signal power variance is defined as 

Referring to Table 1 below it can be observed that the pilot bit error rate and the normalized signal variance have different trends with respect to vehicle speed. Thus it is possible to construct a linear combination of these two quantities PBER which is nearly a constant independent of vehicle speeds as shown in Table 1.

In the block the number of fingers in lock is computed. In the process of RAKE reception the signal strength of each demodulated finger is computed. The signal strength must be in excess of a threshold value in order for it to be soft combined by the RAKE receiver. When the signal strength is sufficient that it is worthy of being soft combined the finger is said to be in lock . In the improved embodiment the impact of multiple fingers is compensated for by making the set point a function of the average number of fingers that are in lock N . In the exemplary embodiment a determination as to whether a finger is in lock is conducted for each slot. In the exemplary embodiment the average number of fingers in lock is computed by summing the number of fingers in lock for each slot in the frame and dividing by the number of slots in a frame.

In block the set point is calculated. The first step in calculating the set point is to generate a metric that is a function of the three factors described above. In the improved embodiment the following metric described above is modified by the addition of a term that is a linear function of N the number of fingers works quite well. 1 1 1 4 where in the exemplary embodiment where n is the metric for the current nth frame PBER n 1 is the pilot bit error rate for the previous n 1 st frame and n 1 is the pilot variance for the previous n 1 st frame N n 1 is the number of fingers in lock in the previous frame and and are scaling constants equal to 4 and 0.9 respectively.

From Table 1 the outer loop threshold is set to be 6.75 for of 4.0. The outer loop threshold can be improved by accumulating statistics regarding the frame error rate. An error for the current frame is calculated according to the equation 6.75. 5 The set point for the current frame is modified according to the equation 1 6 where in the exemplary embodiment is approximately 0.02.

In each of metric calculators pilot demodulator PILOT DEMOD demodulates the received pilot symbol stream to provide estimates of the received pilot symbols and provides those demodulated pilot symbols to finger combiner . In each of metric calculators pilot energy calculators compute the energy of received pilot symbols and provide the measured energies to finger combiner . In addition in each of metric calculators lock detectors determine whether the finger corresponding to the metric calculator is in lock. Diversity reception in a CDMA communication system is well known in the art and is described in detail in aforementioned U.S. Pat. No. 5 109 390.

Finger combiner sums the demodulated pilot symbol energies from each of pilot demodulators sums the pilot symbol energies from each of pilot energy calculators and sums the number of fingers determined to be in lock to provide the number of fingers in lock value N.

The combined pilot symbols are provided to optional sampler . Sampler decimates the demodulated pilot symbols stream and provides the decimated stream to error detector . Because the values of the transmitted symbols are known to the receiver detecting errors comprises comparing the received pilot symbol estimates decimated or intact to the expected pilot symbol sequence. In the exemplary embodiment the pilot symbols are the all zeroes sequence which are in represented as a positive amplitudes. Thus whenever the demodulated pilot symbol has a negative amplitude a pilot bit error is declared by error detector . The number of detected pilot bit errors PBER is provided to set point calculator .

The combined pilot symbol energies p n are provided to pilot variance calculator which computes the normalized signal variance n as described in equations 1 3 above and provides the result to set point calculator .

Each of metric calculators provides a signal indicative as to whether the finger to which the metric calculator is assigned is in lock during that slot. Finger combiner sums the number of slots for which each of the fingers is in lock and divides by the number of slots in a frame to provide the average number of fingers in lock N. Finger combiner provides a signal indicative the value Nto set point calculator .

In the preferred embodiment set point calculator determines the set point T in accordance with equations 4 6 above. Set point calculator provides the set point T to comparator . Receiver provides the base band samples to signal to noise ratio calculator . A large number of methods are known in the art to estimate the signal to noise ratio. A simple method for estimating the noise energy is to assume all in band energy is noise. Receiver typically includes an automatic gain control not shown device and the in band energy can typically be estimated based on the scaling of the received signal by the automatic gain control device. The signal energy can be estimated based on the energy of the demodulated traffic symbols. A number of methods for estimating the signal to noise ratio are disclosed in U.S. Pat. No. 5 903 554 filed Sep. 27 1996 and entitled METHOD AND APPARATUS FOR MEASURING LINK QUALITY IN A SPREAD SPECTRUM COMMUNICATION SYSTEM which is assigned to the assignee of the present invention and incorporated by reference herein.

The estimated signal to noise ratio is provided to comparator . In comparator the estimated signal to noise ratio is compared to the threshold value T . The power control command requesting that the transmitter either increase or decrease its transmission energy is determined in accordance with this comparison. The result of the comparison is provided to power control bit generator PCB GEN . If the estimated signal to noise energy exceeds the threshold T then power control bit generator provides a message requesting that the remote station reduce its transmission energy. Conversely if the estimated signal to noise energy is less than the threshold T then power control bit generator provides a message requesting that the remote station increase its transmission energy. One skilled in the art will understand that the present invention although described in terms of reverse link power control can be extended to forward link power control.

The power control command from power control bit generator is provided to multiplexer . In the exemplary embodiment the power control commands are time multiplexed with the pilot signal and traffic data as described in the aforementioned U.S. Pat. No. 6 574 211. One skilled in the art will appreciate that although illustrated in a system in which the power control commands are time multiplexed into the transmitted frames of data the present invention is equally applicable to communication systems in which the power control bits are punctured into the transmitted signals such as in the cdma2000or WCDMA proposed systems.

The multiplexed frames of data is modulated by modulator . In the exemplary embodiment the modulation is a spread spectrum communication signal.

The modulated symbols are then provided to transmitter TMTR . Transmitter up converts amplifies and filters the signal for transmission.

Turning now to an expanded functional block diagram of metric calculators is shown. As previously described receiver RCVR downconverts the received reverse link RF signals to a baseband frequency producing I and Q baseband signals. In the exemplary embodiment the received signal is complex PN spread using an in phase PNsequence and a quadrature phase PNsequence by methods that are well known in the art and are described in detail in the aforementioned U.S. Pat. No. 6 396 804. Despreaders and respectively despread the I and Q signals using the PNsequence. Similarly despreaders and respectively despread the Q and I signals using the PNsequence. The outputs of despreaders and are combined in combiner . The output of despreader is subtracted from the output of despreader in combiner .

The respective outputs of combiners and are summed over one Walsh symbol by accumulators and . The outputs of accumulators and are provided to delay elements and respectively. Delay elements and are provided in order to equalize the additional delay that the filtered pilot signal experiences as a result of the filtering operating performed by pilot filters and . The respective outputs of combiners and are also summed over one Walsh symbol by accumulators and . The respective outputs of accumulators and are then applied to pilot filters and . Pilot filters and generate an estimation of the channel conditions by determining the estimated gain and phase of the pilot signal data. The output of pilot filter is then multiplied by the output of delay element in multiplier . Similarly the output of pilot filter is multiplied by the output of delay element in multiplier . The output of multiplier is then summed with the output of multiplier in combiner to produce the demodulated pilot symbols.

In addition the output of pilot filters and are provided to decimator . In the exemplary embodiment pilot filters and are moving average filters that average the amplitudes of the received pilot symbols over a slot duration. Decimator samples the outputs of pilot filters and at slot boundaries to provide the average symbols amplitudes for each slot in the frame.

The average symbol amplitudes averaged over each slot in the frame are provided to energy calculator I Q . Energy calculator sums the squares the amplitudes of the samples from pilot filters and and provides the resultant energy values to accumulator ACC . Accumulator accumulates the energy of the slot over a frame duration and outputs the accumulated frame energy to set point calculator . In addition the average slot energy values from energy calculator are provided to low pass filter LPF . In the exemplary embodiment low pass filter computes the average pilot symbol energy over multiple slots and provides this value to comparator . Comparator compares the average pilot symbol energy to a threshold value and based on this comparison determines whether the finger is in lock. Comparator outputs the result of the comparison to finger combiner . It will be understood by one skilled in the art that there are many variations on the method presented herein for determining whether a finger is in lock and that the method present is for illustrative purposes.

In the exemplary embodiment low pass filter is a single pole IIR averaging filter that computes the average symbol energy n of the combined pilot symbol energy over multiple frame duration. In the exemplary embodiment the average symbol energy is computed in accordance with equation 2 above. The average symbol energy n is provided to squaring element which computes the square of the average symbol energy and provides the value to a first input of summer .

Squaring element squares the amplitudes of the combined symbol energies and provides the squared amplitude values to low pass filter LPF . Low pass filter is an single pole IIR filter that computes the average of the squared energy values over the frame s duration . The output from low pass filter is provided to a second summing input of summer . Summer computes the sum of the square of the average symbol energy and the average of the squared symbol energies and provides that sum to the numerator input of divider . Low pass filter also provides the average of the squared energies to the denominator input of diving element . Dividing element divides the sum from summer by the average of the squared energies from low pass filter . The result of the division is provided to square root element which calculates the square root of the division performed by dividing element . In the exemplary embodiment the square root operation is performed by means of a table look up. It will be understood by one skilled in the art that other methods of determining the square root value are known and can be applied to the present invention without departing from the application s scope.

The previous description of the preferred embodiments is provided to enable any person skilled in the art to make or use the present invention. The various modifications to these embodiments will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other embodiments without the use of the inventive faculty. Thus the present invention is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

