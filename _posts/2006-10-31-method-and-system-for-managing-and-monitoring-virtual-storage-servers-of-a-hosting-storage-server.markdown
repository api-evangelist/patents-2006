---

title: Method and system for managing and monitoring virtual storage servers of a hosting storage server
abstract: A storage management application is provided to manage and monitor virtual storage servers in a hosting storage server. In addition, in order to facilitate virtual storage server management and monitoring, a virtual storage server administrator role is provided. The role is allowed to access details of the virtual storage server assigned to the role, but not the details of the hosting server and other virtual servers.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07970851&OS=07970851&RS=07970851
owner: NetApp, Inc.
number: 07970851
owner_city: Sunnyvale
owner_country: US
publication_date: 20061031
---
At least one embodiment of the present invention pertains to storage systems and more particularly to managing and monitoring storage systems.

Various forms of network based storage systems are known today. These forms include network attached storage NAS storage area networks SANs and others. Network storage systems are commonly used for a variety of purposes such as providing multiple users with access to shared data backing up critical data e.g. by data mirroring etc.

A network based storage system typically includes at least one storage server which is a processing system configured to store and retrieve data on behalf of one or more client processing systems clients . In the context of NAS a storage server may be a file server which is sometimes called a filer . A filer operates on behalf of one or more clients to store and manage shared files. The files may be stored in a storage subsystem that includes one or more arrays of mass storage devices such as magnetic or optical disks or tapes by using RAID Redundant Array of Inexpensive Disks . Hence the mass storage devices in each array may be organized into one or more separate RAID groups.

In a SAN context a storage server provides clients with block level access to stored data rather than file level access. Some storage servers are capable of providing clients with both file level access and block level access such as certain Filers made by Network Appliance Inc. NetApp of Sunnyvale Calif.

Multiple instances of virtual storage servers may be created on a physical storage server. A virtual storage server is a functional and logical partitioning of network and storage resources of the physical storage server. Each virtual storage server is maintained and executed independent of other virtual storage servers on the same physical storage server. Storage server resources such as units of storage and network addresses of network interfaces may be grouped partitioned and or assigned to virtual storage server or servers in the physical storage server. Yet common storage server resources such as a storage operating system may be shared among the virtual storage servers. From a client s perspective a virtual storage server includes all essential aspects of a physical storage server such as a network front end to communicate with the client a back end to access and manage stored data etc. A physical storage server on which one or more virtual storage servers are created may also be called a hosting storage server or host storage server. For the purposes of illustration a physical storage server may also simply be referred as a storage server.

In storage servers data is stored in logical containers called volumes which may be identical with or subsets of aggregates. An aggregate is a logical container for a pool of storage combining one or more physical mass storage devices e.g. disks or parts thereof into a single logical storage object which contains or provides storage for one or more other logical data sets at a higher level of abstraction e.g. volumes . A volume is a set of stored data associated with a collection of mass storage devices such as disks which obtains its storage from i.e. is contained within and may be coextensive with an aggregate and which is managed as an independent administrative unit such as a complete file system. A sub volume is a subset of a volume such as a directory and all files under the directory a file etc. A file system is an independently managed self contained hierarchal set of data units e.g. files blocks or Logical Unit Numbers . Although a volume or file system as those terms are used herein may store data in the form of files that is not necessarily the case. That is a volume or file system may store data in the form of other units such as blocks or Logical Unit Numbers LUNs .

Each virtual storage server is allocated dedicated and distinct units of storage resources such as volumes or sub volumes and network addresses such as Internet protocol addresses. Each virtual storage server is also allowed shared access to the common file system on behalf of its client system.

A storage server may be managed by one or more network storage administrators also called administrative users or simply administrators who are responsible for configuring provisioning and monitoring the storage server scheduling backups troubleshooting problems with the storage server performing software upgrades etc. These management tasks can be accomplished by the administrator using a separate management console on the network which is a computer system that runs storage management software application specifically designed to manage a distributed storage infrastructure. An example of such storage management software is DataFabric Manager DFM made by NetApp.

Prior art network storage management software manages monitors only the physical level of a storage server. This limits the usefulness of the management software for architectures that employ virtual storage servers.

The present invention includes a method and system for managing and monitoring virtual storage servers of a hosting storage server. The method includes the step of in a network storage manager managing a storage server which is configured to provide data access services to a set of clients. The network storage manager is operatively coupled to the storage server via an interconnect a network for example. The method further includes the step of in the network storage manager monitoring a virtual storage server that is hosted in the storage server.

Other aspects of the invention will be apparent from the accompanying figures and from the detailed description which follows.

A method and system for managing and monitoring virtual storage servers of a hosting storage server are described. References in this specification to an embodiment one embodiment or the like mean that the particular feature structure or characteristic being described is included in at least one embodiment of the present invention. Occurrences of such phrases in this specification do not necessarily all refer to the same embodiment.

One embodiment of the present invention discloses a storage management application that provides the functionality of managing and monitoring virtual storage servers in a hosting storage server. In another embodiment of the present invention in order to facilitate virtual storage server management and monitoring a virtual storage server administrator role is provided. The role is allowed to access details of the virtual storage server assigned to the role but not the details of the hosting server and other virtual servers.

Each of the clients may be for example a conventional personal computer PC server class computer workstation or the like. Each storage server may be for example a file server used in a NAS mode a filer a block based storage server such as used in a storage area network SAN or other type of storage server. In a NAS implementation the interconnect may be essentially any type of computer network such as a local area network LAN a wide area network WAN metropolitan area network MAN or the Internet and may implement the Internet Protocol IP . In a SAN implementation the interconnect may be for example a Fibre Channel switching fabric which implements the Fibre Channel Protocol FCP .

The mass storage devices in each storage subsystem may be for example conventional magnetic disks optical disks such as CD ROM or DVD based storage magneto optical MO storage or any other type of non volatile storage devices suitable for storing large quantities of data. The storage devices in each storage subsystem can be organized as a Redundant Array of Inexpensive Disks RAID in which case the corresponding storage server accesses the storage subsystem using an appropriate RAID protocol.

Also connected to the interconnect are one or more management consoles each of which includes a storage management application such as a network storage manager discussed in detail below.

Recently some storage servers have been designed to have distributed architectures to facilitate clustering of storage nodes. Clustering facilitates scaling of performance and storage capacity. For example rather than being implemented in a single box a storage server may include a separate N network blade and D disk blade which are contained within separate housings and communicate with each other via some type of switching fabric or other communication medium. An N blade is an element that acts as a front end of a storage server exporting a file service abstraction to clients. A D blade manages the underlying storage. Each D blade typically manages a separate set of disks. Storage servers which implement the Data ONTAP GX operating system from NetApp can have this type of distributed architecture.

The units of storage resources allocated to each virtual storage server include one or more volumes or sub volume. A qtree QT is a sub volume that has the property of being able to identify itself within a file system by e.g. a qtree identifier qtreeid . The above architecture provides efficient utilization and management of these storage resources including creation assignment and mapping of the resources to and among the virtual storage servers.

Logically under the file system manager the operating system also includes a network layer and an associated network media access layer to allow the storage server to communicate over a network e.g. with clients . The network layer implements various protocols such as NFS CIFS HTTP SNMP and TCP IP. The network media access layer includes one or more drivers which implement one or more protocols to communicate over the interconnect such as Ethernet or Fibre Channel. Also logically under the file system manager the operating system includes a storage access layer and an associated storage driver layer to allow the storage server to communicate with the storage subsystem . The storage access layer implements a storage redundancy protocol such as RAID 4 or RAID 5 while the storage driver layer implements a lower level storage device access protocol such as Fibre Channel or SCSI. Reference numeral in shows the data access path through the operating system associated with servicing read and write requests from clients.

The operating system may also include a storage server application programming interface API through which the operating system and or an external application may obtain data related to the storage server and its storage sub system .

The network storage manager may also include a mirror manager which may according to a user s administrator s direction automatically configure a mirror relationship involving a virtual storage server whether the virtual storage server is a source server or a destination server in the mirror relationship . Similarly the backup manager may automatically configure a backup relationship in which a virtual server is a backup server. Creation and configuration of mirror and backup relationships will be further discussed below.

Management data and monitoring information are stored in the underlying databases. Respectively the virtual storage server database stores data related to each virtual storage server such as the virtual storage server s ID name hosting storage server ID and status. The storage path database holds the storage path details for each virtual storage server . Storage paths are paths of storage objects or network resources. In one embodiment each record in the storage path database includes a virtual storage server ID field a storage path field an indicator field indicating whether the storage path field records the primary storage path for the virtual storage server i.e. the storage path that has etc directory of the virtual storage server a volume sub volume ID field indicating that the volume sub volume is assigned to the virtual storage server a timestamp field recording the time the storage path is added.

The mirror relationship database and the backup relationship database store data related to the mirror and backup relationships of each virtual storage server . The storage object database maintains status and ownership information for each storage object of the hosting storage server e.g. a volume a sub volume or a LUN. The other databases maintain data related to other aspects of the management and or monitoring of the virtual storage servers .

It will be appreciated by a person or ordinary skill in the art that the above introduced monitors may be implemented as different functions and or modules of one single general monitor. The above description is only for purposes of illustration.

The above described ownership change mechanism allows each monitor to change its corresponding database asynchronously relative to making changes to the storage path database to indicate the ownership change. Yet in another embodiment these databases may be changed synchronously upon an event of ownership change.

As discussed above the virtual storage server monitor is responsible for discovering virtual storage servers on a particular hosting storage server. The virtual storage server monitor may be invoked to discover new virtual storage servers on a hosting storage server by an administrator manually or it may be automatically and periodically invoked at a predetermined time interval an hour for example . Basic details of a virtual storage server can be obtained by the monitor . These basic details can include name of the virtual storage server IP space for which it belongs to allowed protocols for this virtual storage server disallowed protocols for this virtual storage server list of all network resources of the virtual storage server status of the virtual storage server e.g. stopped or running and list of all storage objects maintained by the virtual storage server.

A global option discover virtual storage server may be implemented in the virtual storage server monitor . If the option is disabled the virtual storage server monitor will not discover new virtual storage servers but will continue to monitor the virtual storage servers that have already been discovered.

Each time the virtual storage server monitor runs it will discover the new virtual storage servers added for a hosting storage server. A virtual storage server may be destroyed for example by releasing all resources to the physical storage server and removing the configuration information associated with the virtual storage server. When the virtual storage server monitor detects that a virtual storage server is destroyed it will mark it as destroyed in the virtual storage server database .

In an embodiment of the present invention the network storage manager checks the status of the virtual storage servers and their associated resources and alerts the user of any anomalous conditions discrepancies etc. The virtual storage server monitor can be configured to execute for example every five minutes to check status changes of virtual storage server s for example being stopped or destroyed . It performs calls to the storage server API on the hosting storage server to track the status of the virtual storage server s hosted on it. In an alternate embodiment a separate monitor may periodically check status of the virtual storage server s via calling the storage server API . In case there are changes in the status the separate monitor can invoke the virtual storage server monitor to update the status information of the virtual storage servers stored in the virtual storage server database .

Initially any storage object a volume for example created on a hosting storage server is owned by the hosting storage server. If a storage object is later assigned to a virtual storage server of the hosting storage server then upon running the virtual storage server monitor adds an entry into the storage path database to indicate that the storage object is assigned to the virtual storage server. The next time when the file system monitor runs and detects the newly added entry the file system monitor changes the ownership of the storage object from the hosting storage server to the virtual storage server.

If a storage object is removed from a virtual storage server the virtual storage server monitor detects that event and changes the corresponding entry in the storage path database . The next time the file system monitor runs it will check whether any ownership changes for storage objects need to be updated. In this case the file system monitor changes the ownership for the storage object from the virtual storage server back to the hosting storage server.

To create a mirror relationship involving a virtual storage server e.g. whether the virtual storage server is the source server or the destination server the corresponding hosting storage server or servers needs to be configured with appropriate storage paths.

In an embodiment the network storage manager provides an interface through which an administrator of a virtual storage server or any user with proper privilege to manage the virtual storage server may select or designate the virtual storage server as an entity in a mirror relationship e.g. a source server or a destination server. This interface may be a user interface or an application programming interface API through which an instruction to create a mirror relationship may be transmitted to the mirror manager .

For example assume a volume v belongs to virtual storage server VSS and another volume v belongs to virtual storage server VSS . Further assume that VSS belongs to hosting storage server HSS and VSS belongs to hosting storage server HSS . To create a mirror relationship between v and v a storage path HSS vol v is generated for HSS and a storage path HSS vol v is generated for HSS . These storage paths are respectively specified as source and destination paths by HSS and HSS to establish the mirror relationship. Note that the format of the storage paths given in the above example is only for purposes of illustration. A person of ordinary skill in the art will realize that a different format for storage paths may be implemented in the present invention.

In a manner similar to managing mirror relationships an administrator may input an instruction to the backup manager via the user interface to create a backup relationship in which a virtual storage server selected by the administrator is a backup server.

For example assume again that volume v belongs to virtual storage server VSS which belongs to hosting storage server HSS and volume v belongs to virtual storage server VSS which belongs to hosting filer HSS . To create a backup relationship between a primary source q in v and secondary destination q in v storage paths HSS vol v q and HSS vol v q are generated and specified respectively by HSS and HSS .

In a storage service providers SSP environment an administrator will be allocated one or more virtual storage servers. The administrator should have permissions only to the virtual storage server s allocated to him. The administrator should not have permissions to other virtual storage servers and the hosting storage server s details in the network.

More specifically the administrator should have permissions to access only resource s uniquely assigned to the virtual storage server s allocated to him. A resource may be for example a storage object e.g. a volume a sub volume a LUN an aggregate logical container for storage objects a storage device physical container for storage objects or a network address e.g. an IP address . A resource is considered to be uniquely assigned to a virtual storage server if the storage server is logically and entirely associated with the virtual storage server. For example a volume assigned to a virtual storage server in its entirety is uniquely assigned to the virtual storage server. However when only a part of a volume a sub volume for example is assigned to a virtual storage server the volume is not uniquely assigned to the virtual server although that part of the volume is uniquely assigned to the virtual server.

In an exemplary embodiment details of an aggregate and or a storage device are always hidden from an administrator of a virtual storage server because aggregates may contain other volumes which are not part of the virtual storage server.

The bus system in is an abstraction that represents any one or more separate physical buses and or point to point connections connected by appropriate bridges adapters and or controllers. The bus system therefore may include for example a system bus a Peripheral Component Interconnect PCI bus a HyperTransport or industry standard architecture ISA bus a small computer system interface SCSI bus a universal serial bus USB or an Institute of Electrical and Electronics Engineers IEEE standard 1394 bus sometimes referred to as Firewire . The processors are the central processing units CPUs of the processing system and thus control the overall operation of the processing system. In certain embodiments the processors accomplish this by executing software stored in memory . A processor may be or may include one or more programmable general purpose or special purpose microprocessors digital signal processors DSPs programmable controllers application specific integrated circuits ASICs field programmable gate arrays FPGAs programmable logic devices PLDs or the like or a combination of such devices.

The processing system also includes memory coupled to the bus system . The memory represents any form of random access memory RAM read only memory ROM flash memory or a combination thereof. Memory stores among other things the operating system of processing system.

Also connected to the processors through the bus system are a mass storage device a storage adapter and a network adapter . Mass storage device may be or include any conventional medium for storing large quantities of data in a non volatile manner such as one or more disks. The storage adapter allows the processing system to access a storage subsystem and may be for example a Fibre Channel adapter or a SCSI adapter. The network adapter provides the processing system with the ability to communicate with remote devices over a network and may be for example an Ethernet adapter or a Fibre Channel adapter.

Memory and mass storage device store software instructions and or data which may include instructions and or data used to implement the techniques introduced here.

Thus a method and system for managing and monitoring a virtual storage server of a hosting storage server have been described.

Software to implement the technique introduced here may be stored on a machine readable medium. A machine accessible medium as the term is used herein includes any mechanism that provides i.e. stores and or transmits information in a form accessible by a machine e.g. a computer network device personal digital assistant PDA manufacturing tool any device with a set of one or more processors etc. . For example a machine accessible medium includes recordable non recordable media e.g. read only memory ROM random access memory RAM magnetic disk storage media optical storage media flash memory devices etc. etc.

 Logic as is used herein may include for example software hardware e.g. special purpose or general purpose circuitry and or combinations of hardware and software.

Although the present invention has been described with reference to specific exemplary embodiments it will be recognized that the invention is not limited to the embodiments described but can be practiced with modification and alteration within the spirit and scope of the appended claims. Accordingly the specification and drawings are to be regarded in an illustrative sense rather than a restrictive sense.

