---

title: Line rasterization techniques
abstract: A line rasterization technique in accordance with one embodiment includes conditioning a line by pulling in the ending vertex of the line or pushing out the starting vertex of the line. Thereafter, if the line exits a diamond test area of each pixel that it touches, the pixel may be lit.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08482567&OS=08482567&RS=08482567
owner: Nvidia Corporation
number: 08482567
owner_city: Santa Clara
owner_country: US
publication_date: 20061103
---
Three dimensional graphics processing is utilized in a number of applications from electronic games and movies to computer aided design CAD . Conventionally three dimensional graphics processing includes a multi step rendering process of transitioning from a database representation of three dimensional objects to a two dimensional projection of the object into a display space. The process generally includes setting up a polygon model e.g. a plurality of primitives of objects applying linear transformation to each primitive culling back facing primitives clipping the primitives against a view volume rasterizing the primitives to a pixel coordinate set shading lighting the individual pixels using interpolated or incremental shading techniques and the like.

In the conventional art aliased lines may be drawn differently depending upon the particular computer hardware. For example when drawing a line strip one or more pixels located at the end of one segment and the beginning of the next segment may be missed or may be lit twice. In another example a line may be shifted in one direction with respect to the same line drawn by a different computer system. However as computing device continue to progress it is desirable to rasterize lines so that they are drawn the same across various configurations of computer hardware.

Embodiments of the present invention are directed toward techniques for rasterizing lines. In one embodiment a method of rasterizing lines includes receiving the starting and ending vertices of a given line. The starting and or ending vertices may be conditioned. Thereafter the pixels in which the line exits a diamond test area may be lighted.

In another embodiment a computer readable medium containing a plurality of instructions which when executed cause a computing device to implement a method of conditioning a line is disclosed. The method of conditioning the line includes pulling in an ending vertex of a given line if the ending vertex is in a given portion of a pixel the ending vertex is in a second diamond test area but does not exit and both vertices of the given line are not in the same pixel. The method also includes pushing out a starting vertex if the starting vertex is in the given portion of the pixel and the given line exits a first diamond test area. The method may further include culling the given line if the ending vertex is in a given portion of the pixel the ending vertex is in the second diamond test area but does not exit and both vertices of the given line are in the same pixel. If the given line is a short line and the given line is in the first diamond test area and the second diamond test area wherein the given line is a short line if the corresponding coordinates of the starting and ending vertices are in the same pixel the method may also cull the line.

In yet another embodiment a processor includes a setup unit a rasterizer communicatively coupled to the setup unit and a data write unit communicatively coupled to the rasterizer. The setup unit receives drawing commands and parameters describing one or more geometric primitives such as lines polygons or the like. The rasterizer converts the geometric primitives into pixel data. The rasterizer includes line conditioner for pulling in an ending vertex of a given line if it is a given type the ending vertex is in a given portion of a pixel the ending vertex is in a second diamond test area but does not exit and both vertices of the given line are not in the same pixel. The line conditioner also pushes out the starting vertex of the given line if it is a given type the starting vertex is in the given portion of the pixel and the given line exits a first diamond test area. The data write unit outputs the resulting pixel data after the conditioned lines have been converted to pixel data.

Reference will now be made in detail to the embodiments of the invention examples of which are illustrated in the accompanying drawings. While the invention will be described in conjunction with these embodiments it will be understood that they are not intended to limit the invention to these embodiments. On the contrary the invention is intended to cover alternatives modifications and equivalents which may be included within the scope of the invention as defined by the appended claims. Furthermore in the following detailed description of the present invention numerous specific details are set forth in order to provide a thorough understanding of the present invention. However it is understood that the present invention may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail as not to unnecessarily obscure aspects of the present invention.

Referring to an exemplary computing device for implementing embodiments of the present invention is shown. The computing device may be a personal computer laptop computer hand held device game console personal entertainment center media center PC tablet PC computer based simulator server computer client computer minicomputer mainframe computer distributed computer system or the like. The computing device includes one or more general purpose processors e.g. CPU one or more computing device readable media and one or more input output I O devices . The I O device may include a network adapter e.g. Ethernet card CD drive DVD drive and or the like and peripherals such as a keyboard a pointing device a speaker a printer and or the like. The computing device may also include one or more specialized processors such as a graphics processing unit GPU .

The computing device readable media may be characterized as primary memory and secondary memory. Generally the secondary memory such as a magnetic and or optical storage provides for non volatile storage of computer readable instructions and data for use by the computing device . For instance the disk drive may store the operating system OS and applications and data . The primary memory such as the system memory and or graphics memory provides for volatile storage of computer readable instructions and data for use by the computing device . For instance the system memory may temporarily store a portion of the operating system and a portion of one or more applications and associated data that are currently used by the CPU GPU and the like.

The computing device readable media I O devices and GPU may be communicatively coupled to the processor by a chip set and one or more busses. The chipset acts as a simple input output hub for communicating data and instructions between the processor and the computing device readable media I O devices and GPU . In one implementation the chipset includes a northbridge and southbridge .

One or more of the processors implements a rasterization technique when rendering graphical data. In one implementation images are off loaded from the general purpose CPU to the graphics processor by transferring geometric primitive parameters draw commands and instruction for controlling the operation of the GPU . The geometric primitives may be vertex data representations of lines triangulated three dimensional models of objects and the like. The geometric primitives draw commands and instructions are transferred from the CPU to the GPU utilizing a graphics application programming interface such as the OpenGL ES graphics language Direct3D or the like. In response the GPU generates a color and depth value for each pixel to be displayed. In another implementation the GPU may be an integral part of the CPU .

One or more processors in accordance with embodiments of the present invention implement a concise and efficient implementation of well defined rasterization rules. The rasterization rules utilize line conditioning in combination with a diamond exit technique as described in more detail below.

Referring now to some concepts for understanding the resterization techniques in accordance with embodiments of the present invention are illustrated. In particular a line may be specified by a starting vertex and an ending vertex . The line may be drawn relative to an x y coordinate system . A complex line is a line strip composed of a plurality of segments . Accordingly line strips are drawn no differently than the equivalent sequences of independent lines in the same direction.

A graphical surface of an image and a display device may be divided into a plurality of pixels. The center of each pixel may be denoted by an X. In addition the pixel may be logically divided into four quadrants in accordance with the conventional x y coordinate system. When determining whether a pixel is lit or not a diamond test area may be utilized to test whether a given line is within the pixel or not. The corners of the diamond test area may for ease of understanding the present invention be labeled as corners A B C and D starting at the top and proceeding in a clockwise direction around the perimeter of the diamond test area.

Referring now to an x major and a y major diamond test area in accordance with one embodiment of the present invention are shown. An x major line is a line that has a slope of greater than or equal to 1 and less than or equal to 1 and a y major line is a line that has any other slope. As depicted in the diamond test area for an x major line includes that area within the diamond the lower left edge the lower right edge and the bottom corner of the diamond. The diamond test area for an x major line however excludes the upper left and upper right edges and the left top and right corners. As depicted in the diamond test area for a y major line includes that area within the diamond the lower left edge the lower right edge the bottom corner and the right corner of the diamond. The diamond test area for the y major line however excludes the upper left and upper right edges and the left and top corners.

Referring now to a processor in accordance with one embodiment of the present invention is shown. The processor may be a graphics processing unit GPU a central processing unit CPU or the like. The processor includes a setup unit a rasterizer and a data write unit . The rasterizer is communicatively coupled to the setup unit and the data write unit is communicatively coupled to the rasterizer . The processor may also include a gatekeeper unit a data fetch unit a micro shader vertex buffer a scoreboard a fetch cache write buffer and or the like. The units of the processor are typically arranged in a pipeline architecture.

Operation of the processor will be further explained in combination with a method of rasterizing lines as shown in . The setup unit receives geometric primitives draw command and instructions. The setup unit prepares parameters e.g. vertex data of the primitives for resterization. The setup unit may also perform clipping and viewpoint operations culling of back facing primitives and occlusion guard band clipping power management for the rest of the pipeline and or the like. The rasterizer receives the starting and ending vertices for each line to be drawn from the setup unit at .

The rasterizer receives instructions and vertex data and performs rasterization thereupon. Rasterization includes walking the primitive and generating pixel packets that contain parameters e.g. set of descriptions for each pixel . The rasterizer includes line conditioner for conditioning the starting and or ending vertex of a line or each segment of a line strip. In one implementation the line conditioner is implemented in a combination logic circuit. The line conditioner is adapted to push out the start of the line or pull in the end of the line at . In one implementation the starting vertex of a given line type may be pushed out to catch the center of the pixel if the ending vertex is in a given portion of a pixel the ending vertex is in a second diamond test area but does not exit and both vertices of the given line are not in the same pixel. The starting vertex of the given line type may be pushed out if the starting vertex is in a given portion of the pixel and the given line exits a first diamond test area. The line of the given type may also be culled if the ending vertex is in the given portion of the pixel the ending vertex is in the second diamond test area but does not exit and both vertices of the given line are in the same pixel. The line may also be culled if it is a short line and in the first diamond test area and the second diamond test area wherein the given line is a short line if the corresponding coordinates of the starting and ending vertices are in the same pixel.

The rasterizer is adapted to determine if the line starts on a corner or edge of the appropriate diamond test area for a given pixel at . The appropriate diamond test area is selected depending upon whether the line is an x major or y major line. If the line starts on an inclusive edge or corner the line starts in the given diamond test area. If the line starts on a non inclusive edge or corner the line starts outside the given diamond test area.

The rasterizer is also adapted to determine if the line ends on a corner or edge of the diamond test area at . If the line ends on an inclusive edge or corner the line ends in the given diamond test area. If the line ends on a non inclusive edge or corner the line the line ends outside the given diamond test area.

The rasterizer is also adapted to determine if the line exits one or more diamond test areas for each pixel that is touched at . A line touches a given pixel if the line exits the pixel s diamond test area when traveling along the line from the start toward the end. The rasterizer is adapted to light each pixel in which the line exits the diamond test area of the given pixel at . The data write unit outputs the resulting pixel data. In one implementation the data write unit writes the pixel data to a frame buffer.

Referring now to a method of conditioning a line in accordance with one embodiment of the present invention is shown. The method begins with receiving a starting vertex and ending vertex of a given line at . In one implementation the starting vertex may be specified by a first set of coordinates X Y and the ending vertex may be specified by a second set of coordinates X Y .

At any coordinate that is outside a maximum and minimum value is adjusted to the respective maximum or minimum value. In particular any coordinate of a vertex that is greater than a given maximum is set to the maximum value. Similarly any coordinate of a vertex that is less than a given minimum is set to the minimum value.

At the fractional portion of each coordinate of the starting and ending vertices is determined. If there is no fractional portion for a given coordinate the value of the fractional portion is set to 1.0. At the Manhattan distance from each coordinate to the pixel center is determined for each vertex. In one implementation the Manhattan distance is calculated by subtracting 0.5 from the fractional portion of each coordinate of each vertex.

At it is determined if the given line is an x major line or a y major line and if it has a positive or genitive slope. The line may be an x major line if the slope is greater than or equal to 1 and less than or equal to 1 e.g. more horizontal than vertical . The line may be a y major line if the slope is less than 1 or greater than 1 e.g. more vertical than horizontal .

At it is determined if the line is a short line. A line is short if the corresponding coordinates of the starting and ending vertices are in the same pixel. In one implementation an x major segment is a short line if the difference between the x coordinate value of the starting vertex and the fraction portion of the x coordinate of the starting vertex is equal to the difference between the x coordinate value of the ending vertex and the fraction portion of the x coordinate of the ending vertex. For a y major line the line segment is a short line if the difference between the y coordinate value of the starting vertex and the fraction portion of the y coordinate of the starting vertex is equal to the difference between the y coordinate value of the ending vertex and the fraction portion of the y coordinate value of the ending vertex.

At it is determined if the start of the line segment is in a first diamond and if the end of the line segment is in a second diamond based upon the Manhattan distances for the starting and ending vertices respectively. In one implementation the start of the line segment e.g. first vertex is in a first diamond if the sum of the absolute value of the Manhattan distance for the x coordinate of the starting vertex and the absolute value of the Manhattan distance for the y coordinate of the starting vertex is less than 0.5. The end of the line segment is in a second diamond if the sum of the absolute value of the Manhattan distance for the x coordinate of the ending vertex and the absolute value of the Manhattan distance for the y coordinate of the ending vertex is less than 0.5.

At it is determined if the starting and or ending vertices touch the third or fourth quadrant of a pixel. In one implementation the starting vertex touches the third quadrant if the difference between the fractional portions of its y coordinate and x coordinate is equal to 0.5 and if the fractional portion of its x coordinate is greater than or equal to 0.5 and less than or equal to 0.0 and the fractional portion of its y coordinate is greater than or equal to 0.0 and less than or equal to 0.5. The starting vertex touches the fourth quadrant if the sum or the fractional portions of its y coordinate and x coordinate is equal to 0.5 and if the fractional portion of its x coordinate is greater than or equal to 0.0 and less than or equal to 0.5 and the fractional portion of its y coordinate is greater than or equal to 0.0 and less than or equal to 0.5. The ending vertex touches the third quadrant if the difference between the fractional portions of its y coordinate and x coordinate is equal to 0.5 and if the fractional portion of its x coordinate is greater than or equal to 0.5 and less than or equal to 0.0 and the fractional portion of its y coordinate is greater than or equal to 0.0 and less than or equal to 0.5. The ending vertex touches the fourth quadrant if the sum of the fractional portions of its y coordinate and x coordinate is equal to 0.5 and if the fractional portion of its x coordinate is greater than or equal to 0.0 and less than or equal to 0.5 and the fractional portion of its y coordinate is greater than or equal to 0.0 and less than or equal to 0.5.

At it is determined if the starting and or ending vertices touch points A or C of a diamond test area. In one implementation the starting vertex touches point A if the fractional portion of its x coordinate is equal to 0.5 and the fractional portion of its y coordinate is equal to 0.0. The starting vertex touches point C if the fractional portion of its x coordinate is equal to 0.5 and the fractional portion of its y coordinate is equal to 0.0. The ending vertex touches point A if the fractional portion of its x coordinate is equal to 0.5 and the fractional portion of its y coordinate is equal to 0.0. The ending vertex touches point C if the fractional portion of its x coordinate is equal to 0.5 and the fractional portion of its y coordinate is equal to 0.0.

At it is determined if the line segment is in a first diamond test area and or a second diamond test area based upon whether the vertices touch particular quadrants in the pixel and points in the diamond test area. In one implementation the first vertex of an x major line is not in the first diamond test area if the first vertex touches the third or fourth quadrants does not touch point A and does not touch point C. The second vertex of the x major line is not in the second diamond test area if the second vertex touches the third or fourth quadrants does not touch point A and does not touch point C. For a y major line the first vertex is not in the first diamond test area if the first vertex touches the third or fourth quadrants and does not touch point C. The second vertex of the y major line is not in the second diamond test area if the second vertex touches the third or fourth quadrants and does not touch point C.

At the line may be culled if the line is a short line as determined in process and is in the first and second diamond test areas as determined in process . Such lines may be culled so that very short lines are not drawn.

At if a the line is a positive e.g. right going x major line b the ending vertex is in a right half of a pixel e.g. the ending vertex of the line will not cover the center c the ending vertex is in a second diamond but does not exit and d both vertices are in the same pixel than the line may be culled. However if both vertices are not in the same pixel then the line is a multi pixel line that does not exit the second diamond and should be pulled back to miss the center of the pixel at .

At if a the line is a positive x major line b the starting vertex is in the right half of a pixel and c the line exits the diamond then the line should be pushed out to catch the center of the pixel.

At the line may be culled if a the line is a negative e.g. left going x major line b the ending vertex is in a left half of a pixel c the ending vertex is in the diamond but does not exit and d both vertices are in the same pixel. However if both vertices are not in the same pixel then the line is a multi pixel line that does not exit the second diamond and should be pulled back to miss the center of the pixel at .

At if a the line is a negative x major line b the starting vertex is in the left half of a pixel and c the line exits the diamond then the line should be pushed out to catch the center of the pixel.

At the line may be culled if a the line is a positive y major line b the ending vertex is in a bottom half of a pixel e.g. the ending vertex of the line will not cover the center c the ending vertex is in the second diamond but does not exit and d both vertices are in the same pixel. However if both vertices are not in the same pixel then the line is a multi pixel line that does not exit the second diamond and should be pulled back to miss the center of the pixel at .

At if a the line is a positive y major line b the starting vertex is in the bottom half of a pixel and c the line exits the diamond then the line should be pushed out to catch the center of the pixel.

At the line may be culled if a the line is a negative e.g. left going y major line b the ending vertex is in the top half of a pixel c the ending vertex is in the diamond but does not exit and d both vertices are in the same pixel. However if both vertices are not in the same pixel then the line is a multi pixel line that does not exit the second diamond and should be pulled back to miss the center of the pixel at .

At if a the line is a negative y major line b the starting vertex is in the top half of a pixel and c the line exits the diamond then the line should be pushed out to catch the center of the pixel. The above described method of conditioning a line may be implemented in software hardware firmware or a combination thereof. An exemplary set of software instructions for implementing the above described method of conditioning a line is shown in .

The foregoing descriptions of specific embodiments of the present invention have been presented for purposes of illustration and description. They are not intended to be exhaustive or to limit the invention to the precise forms disclosed and obviously many modifications and variations are possible in light of the above teaching. The embodiments were chosen and described in order to best explain the principles of the invention and its practical application to thereby enable others skilled in the art to best utilize the invention and various embodiments with various modifications as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the Claims appended hereto and their equivalents.

