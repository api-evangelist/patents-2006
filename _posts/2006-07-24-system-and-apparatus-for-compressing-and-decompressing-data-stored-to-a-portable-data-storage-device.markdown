---

title: System and apparatus for compressing and decompressing data stored to a portable data storage device
abstract: A portable memory device is provided that is capable of easy connection to a personal computer via a universal serial bus (USB) port, IEEE 1394 (i.e., firewire) or similar port. Included in the portable memory device is a compression/decompression engine capable of compressing and decompressing data. Data residing on a personal computer or other host platform is compressed by the engine and saved to the memory of the portable memory device. Compressed data is retrieved and decompressed by the engine and transmitted to the personal computer for use by the user. Embodiments of the present invention thus provide a highly convenient system and apparatus for users to access and save larger quantities of data to a relatively small device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07631121&OS=07631121&RS=07631121
owner: Trek 2000 International Ltd.
number: 07631121
owner_city: Singapore
owner_country: SG
publication_date: 20060724
---
This is a continuation of U.S. patent application Ser. No. 10 147 124 filed May 16 2002 issued as U.S. Pat. No. 7 082 483 on Jul. 25 2006 which claims priority to International Application No. PCT SG02 00086 filed May 13 2002 the contents of which are incorporated herewith by reference in their entirety.

This application also is related to the following U.S. patent applications each of which is owned by the assignee of the present invention and is incorporated by reference in its entirety herein 

U.S. patent application Ser. No. 09 803 173 entitled PORTABLE DATA STORAGE DEVICE CAPABLE OF BEING DIRECTLY CONNECTED VIA USB PLUG TO A COMPUTER U.S. patent application Ser. No. 09 803 157 entitled PORTABLE DATA STORAGE DEVICE HAVING SECURE MODE OF OPERATION issued on Apr. 12 2005 as U.S. Pat. No. 6 880 054 U.S. patent application Ser. No. 09 898 365 entitled A PORTABLE DEVICE HAVING BIOMETRICS BASED AUTHENTICATION CAPABILITIES and U.S. patent application Ser. No. 09 898 310 entitled A PORTABLE DEVICE HAVING BIOMETRICS BASED AUTHENTICATION CAPABILITIES. 

The present invention relates to the field of storage of electronic data. More particularly the present invention relates to the compression and decompression of data stored to a portable memory device.

Portable memory devices sometimes referred to as key chain memory devices or Thumbdrives which is a trademark of the assignee of the present invention are small portable data storage devices. These devices have become a class of indispensable computer peripherals that are widely utilized in business educational and home computing. These devices are very small in comparison with other data storage devices such as personal computers PCs personal digital assistants PDAs magnetic disks or compact disks CDs . Indeed the name keychain memory device describes the devices as similar in size to a key. Portable memory devices are generally not permanently fitted to a particular host platform such as a PC. Rather they can be conveniently attached to and removed from any computer having the appropriate connection port e.g. a serial bus port like a USB port or IEEE 1394 port Firewire . Thus these portable data storage devices enable a user to transfer data among different computers that are not otherwise connected. Because these devices utilize a non volatile solid state memory e.g. flash memory as the storage medium they do not require moving parts or a mechanical drive mechanism for accessing data. The absence of a drive mechanism enables portable data storage devices to be more compact than surface storage devices such as magnetic disks and CDs. Also because there are no moving parts reading and writing to the memory can be done much more rapidly than to magnetic disks and CDs. Portable data storage devices also have a much higher memory capacity than magnetic disks holding up to 256 megabytes as compared to 1.4 megabytes for magnetic disks.

Although storing data to a portable memory device has proven useful the utility of these devices is limited by their inability to store larger quantities of data without increasing their size.

Accordingly it is an object of the present invention to provide a system and apparatus that enables users to save larger quantities of data to a portable memory device than the current state of the art would allow. This would allow manufacturers to increase the amount of data that can be stored to the memory of these devices without increasing the physical size of the memory and thus the size of the devices. Additionally this would have the added benefit of allowing manufacturers to decrease the size of these devices without decreasing the amount of data that such devices are capable of storing.

These and other objects are achieved by the present invention comprising a portable memory device that is capable of easy connection to a host platform such as a PC via a USB port IEEE 1394 i.e. firewire or similar port. Included in the device is flash memory read only memory ROM random access memory RAM USB controller and a micro controller. In addition a data compression and decompression engine is included in the portable memory device to compress decompress data as it is stored and retrieved from memory.

The portable memory device Thumbdrive is connected to a host platform such as a personal computer PC by a USB connector inserted into the PC s USB port. Data to be saved to the portable memory device is transmitted by the PC in the form of data packets to a working buffer in the portable memory device. The compression engine retrieves the data from the buffer and compresses each packet of data. Compressed data packets are stored in the flash memory. To retrieve data the compression decompression engine retrieves the data from the flash memory and decompresses it. The decompression engine places the decompressed data in the working buffer where it is then transferred to the host platform.

Typically the compression decompression software is located in the ROM then loaded into micro controller for execution. In an alternative embodiment the compression decompression engine resides in an ASIC chip in the portable device.

The compression decompression features of the portable device are invisible to the user. The user saves data but is not aware that it is being compressed. In an alternative embodiment the user is aware of these features and enables disables the compression feature as desired. Disabling the compression feature has the effect of increasing the speed at which the data can be saved.

The present invention will now be described more fully with reference to the accompanying drawings in which preferred embodiments of the invention are shown. The present invention may however be embodied in many different forms and should not be construed as being limited to the embodiments set forth herein rather these embodiments are provided so that this disclosure is thorough and complete and fully conveys the invention to those skilled in the art. Indeed the invention is intended to cover alternatives modifications and equivalents of these embodiments which are included within the scope and spirit of the invention as defined by the appended claims. Furthermore in the following detailed description of the present invention numerous specific details are set forth in order to provide a thorough understanding of the present invention. However it is clear to those of ordinary skill in the art that the present invention may be practiced without such specific details. In other instances well known methods procedures components and circuits have not been described in detail so as not to unnecessarily obscure aspects of the present invention.

Referring still to the portable memory device includes a micro controller flash memory and a data compression decompression engine . It is understood that micro controller could also be a general purpose microprocessor.

In one embodiment a working buffer is located in the micro controller. In an alternative embodiment the working buffer is located outside of the micro controller e.g. in the RAM . In the preferred embodiment the working buffer has 16 kilobytes of capacity.

It should be appreciated that data compression decompression engine maybe implemented in various ways within the scope of the present invention. In one embodiment compression decompression engine is implemented as firmware stored in a non volatile memory within portable device . In another embodiment data compression decompression engine is implemented as part of micro controller . In still another embodiment compression decompression engine is implemented as a processor separate from micro controller . In other words within the scope of the present invention compression decompression engine is not required to reside in a particular location in the portable device . Instead where compression decompression engine is to be placed is a design choice thus affording design flexibility to suit different applications in which the present invention can be utilized.

Data compression decompression engine compresses data after the data is transferred from the host platform to the portable memory device . The data is transferred in the form of data packets passed along a USB bus. The data compression decompression engine retrieves the data from the working buffer typically one sector at a time and compresses the data. In the preferred embodiment the data is compressed to 50 of its original size. Thus a packet of 512 bytes of data will be compressed to 256 bytes. After compression the data is stored to the flash memory . The compression decompression engine also decompresses data stored to the flash memory and transfers the data to the host platform .

In this embodiment the portable device includes a USB device controller which serves to control the communication between portable device and host platform such as a USB compatible PC having a USB host controller therein.

With reference still to portable device also includes a volatile memory and a non volatile memory . In a preferred embodiment volatile memory is a random access memory RAM that serves as a working memory for micro controller during its operation. Non volatile memory is a read only memory ROM in this embodiment and can be used to store firmware that performs various functions of portable memory device .

Additionally in this embodiment portable device includes a write protect switch which when activated triggers micro controller to disable write access to flash memory . It should be appreciated that write protect switch like compression decompression engine may be implemented in various ways within the scope of the present invention. For example write protect switch can be implemented by software e.g. firmware stored in a non volatile memory as part of micro controller or as a processor unit separate from micro controller . In an alternative embodiment the write protect switch can be a manual switch which is manually operated by the user.

In a currently preferred embodiment as illustrated in microprocessor controls various components of portable device including USB device controller ROM and RAM and execution of firmware code stored therein .

Optionally portable device further includes a USB port not shown that is provided as a convenient feature that can be used to couple other USB compatible device s to the portable device via USB.

In one embodiment driver software not shown application programming interface API not shown and monitoring software not shown reside in the host platform and communicate with USB host controller to facilitate the operation of portable device .

The architecture of a portable data storage device is described in U.S. patent application entitled A Portable Device Having Biometrics Based Authentication Capabilities with Ser. No. 09 898 365 filed on Jul. 3 2001 and in U.S. patent application entitled Portable Data Storage Device Capable of Being Directly Connected Via USB Plug to a Computer with Ser. No. 09 803 173.

In step host platform may send a request to portable memory device to write data to flash memory in the form of a write command. In step USB controller receives write command. Write command typically indicates the number of packets of data to follow that are to be saved.

USB Controller receives packet of data from host platform step . USB controller transmits data packet to working buffer step . In the preferred embodiment working buffer can hold a maximum of 16 kilobytes of data. If working buffer reaches maximum capacity and can no longer store additional data then the next data packet may be rejected and a negative acknowledgement NAK communication is sent by micro controller to host controller indicating that the rejected data packet was not received steps and . Host controller then retransmits rejected data packet step . This process of packet rejection and retransmission continues until the working buffer has capacity to accept an additional data packet step .

Micro controller executes data compression decompression engine Step . Compression decompression engine operates on packets of data stored in working buffer Step in a First In First Out scheme whereby data packets are compressed in the order that they are stored to working buffer with the first packet stored in working buffer being the first to be compressed and transferred to flash memory . In the preferred embodiment data is compressed to 50 of its original size. In the preferred embodiment when operating on a USB 2.0 standard compression engine operates to compress one sector 512 bytes of data at a time. In an alternative embodiment when operating on the USB 1.1 standard compression engine operates to compress 64 bytes of data at a time. Compressed data is saved to flash memory Step .

Memory mapping is controlled by the micro controller . In the preferred embodiment the host platform and user are unaware that the data is being compressed. To the host platform data appears to fill sectors in the flash memory as if the data were not compressed i.e. 512 bytes of non compressed data per sector . Thus compressed data written to the first sector would appear to the host controller to fill one entire sector. In reality the data is compressed from 512 to 256 bytes and is saved to half the sector space that would be needed for the data had it not been compressed. Thus the second packet of data after it is compressed from 512 bytes to 256 bytes may also be saved to the first sector. To the host controller the second data packet which in reality is saved to the first sector will appear to be saved to the second sector. Similarly the first data packet saved to second sector will appear to be saved to the third sector and the second data packet saved to the second sector will appear to be saved to the fourth sector.

If there is another packet of data then host controller transmits the packet of data to USB controller step and . Data compression engine continues to compress additional packets of data stored to working buffer step . When there are no more data packets to be compressed then the data compression and storage session ends.

In step user connects the portable device to a host platform . In step upon being coupled to a host platform portable device may undergo the initialization procedure described previously. Host platform requests services from portable device by sending request packets to USB host controller . USB host controller transmits packets through USB port to USB connector .

Host platform may send a request to portable device to read data requested by user step in the form of a read command. USB controller receives the read command step . Read command indicates the location of the data in the flash memory and number of packets of data to be read. Because host platform is unaware that data is compressed the read command will request data that is not necessarily in the sector in which the host platform believes it to be. For example as discussed previously the second data packet which in reality is saved to the second half of the first sector will appear to the host controller be saved to the second sector. Similarly the first data packet saved to second sector will appear to be saved to the third sector and the second data packet saved to the second sector will appear to be saved to the fourth sector. Thus host platform s data request may indicate that a particular packet of data is stored to the second sector where in reality it is stored to the second half of the first sector. To account for this micro controller operates to retrieve requested data from flash memory in accordance with the manner in which it was saved step .

In step micro controller executes data compression decompression engine . Compression decompression engine retrieves packets of requested data from flash memory step . Compression decompression engine acts to decompress dates step . Decompressed data is transferred to working buffer step . Decompressed data is transferred to USB controller step . In step data packet is transferred to the memory e.g. RAM of the host platform .

Data compression decompression engine continues to retrieve and decompress data from flash memory until all data requested has been decompressed and transferred to host platform .

Alternatively host platform may send a request to portable device to read directory of data stored to flash memory . User can then view directory on host platform to determine which data user wishes to retrieve from flash memory .

It is to be understood that the above description is only of the preferred embodiments of the invention. One skilled in the art may devise numerous other arrangements without departing from the spirit and scope of the invention. The invention is thus limited only as defined in the accompanying claims.

