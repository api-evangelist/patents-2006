---

title: Schema updating for synchronizing databases connected by wireless interface
abstract: A method of updating a database, including data records, to accord with an updated schema. The method includes obtaining, at a portable electronic device, the updated schema associated with the database. If a field is deleted in the updated schema, the data records are updated by deleting the field from each of the data records. An update command is transmitted from the portable electronic device for updating the database schema for a corresponding backup database at a server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07730028&OS=07730028&RS=07730028
owner: Research In Motion Limited
number: 07730028
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20060922
---
The present application relates to database schema updating for synchronization of data at a portable electronic device with data embodied at a communication network.

Portable electronic devices such as wireless personal digital assistants PDAs smart telephones and laptop computers with wireless capabilities have gained widespread use for a variety of functions. Such devices are commonly used for communication purposes including transportation of data and run on a wide variety of networks from data only networks such as Mobitex and DataTAC to complex voice and data networks such as GSM GPRS CDMA EDGE UMTS and CDMA2000 networks.

These portable electronic devices commonly include databases for storing data that is selectably retrievable by a user of a device. The data forms a series of data records each data record containing one or more fields each data record belonging to a database on the portable electronic device. During operation of the device the data is retrieved and displayed or otherwise made available to the user. The data can be modified added to or deleted by the user of the device.

Advances in data storage have accompanied advances in portable electronic devices to provide for backup of data stored at the electronic device. By backing up the device data can be recovered in the event of data loss at the electronic device. Various electronic devices are backed up by way of communication over a fixed wire connection between the electronic device and for example a computing station such as a desktop computer. Once the data is stored in a database at the computing station the stored data can be modified added to or deleted by a user at the computing station. Other portable electronic devices provide for backup of data stored thereon to a computing station by way of a radio interface using for example the networks listed above. Thus data is sent over a radio communication channel of a radio communication system thereby forming a communications link between the portable electronic device and a remote station a station not linked by wire communication . Again once the data is stored in a database at a computing station the stored data can be modified added to or deleted at the computing station. Thus while data stored in the database of the portable electronic device is backed up to a computing station data is also transmitted from the computing station to the portable electronic device to synchronize the databases of the portable electronic device with the databases of the computing station.

Database schemas are statically defined as Extensible Markup Language XML files. These database schemas define the tables types of records and for each type of record include information relating to each field. The information relating to each field includes for example the field name for each field a tag number a data type a maximum supported length and an indication as to whether or not the field is a key field is included for each field of a type of record in a database schema. The database schema is changed for any change in structure of any database records. With a change in a database schema data records of a database that do not conform to the new database structure defined by the new database schema are invalidated and are permanently deleted. Thus any change in a database schema at for example a portable electronic device results in the invalidation of an entire backup database of records at for example a computing station. New database records are then stored that conform to the new database schema. This occurs even with a simple modification of a single field in a database schema. This is clearly inefficient particularly where database backup occurs over the air by radio communication as backup of all records of a database can be time consuming and costly to a user paying for the service.

Reference is first made to which shows a functional block diagram of a radio communication system indicated generally by the numeral and a portable electronic device . The radio communication system provides for communications with portable electronic devices including the exemplary portable electronic device as shown. The portable electronic device and the radio communication system are operable to effect communications over a radio communications channel therebetween. Data originating at the portable electronic device is communicated to the radio communication system by way of the radio communications channel. Similarly data originating at the communication system is communicated from the radio communication system to the portable electronic device by way of the radio communications channel thereby providing data to the portable electronic device .

For the purposes of illustration the communication system is functionally represented in and a single base station is shown. The base station defines a coverage area or cell within which communications between the base station and the portable electronic device can be effectuated. It will be appreciated that the portable electronic device is movable within the cell and can be moved to coverage areas defined by other cells that are not illustrated in the present example. The communication system includes a relay device that is connected to the base station and to a synchronization server . It will be understood that the functions provided by the relay device and the synchronization server can be embodied in the same device. The synchronization server is connected to an administration server as shown. The administration server provides administrative services to the communications system and for instance provides administrative control over the synchronization server .

The synchronization server is also functionally coupled through a personal information management connector to databases of which three exemplary database types including a database a database and a database are shown. The personal information management connector interfaces between the synchronization server and the databases . It will be understood that the personal information management connector is a functional component and can be provided by way of an application on the synchronization server . The databases of the present example are of a text format such as an Extensible Markup Language XML format. The data maintained in the first second and third databases includes a number of data records each data record containing a plurality of fields that are populated with data.

The portable electronic device of which only particular functional portions are shown in for the purposes of the present description includes a plurality of databases that correspond to the databases respectively of the communication system . The databases and the databases can be selectably altered in an asymmetrical manner such that the databases of the communication system do not match the databases of the portable electronic device . In other words any or all of the databases can be altered by adding records deleting records and modifying fields of the records by adding deleting or modifying the data populating those fields.

Reference is now made to which shows a block diagram of certain internal components within the portable electronic device . The portable electronic device is based on a microcomputer that includes a processor connected to a read only memory ROM that contains a plurality of applications executable by the processor to enable the portable electronic device to perform certain functions including synchronization with the communication system . For example a synchronization agent is provided for interfacing between the synchronization server and the portable electronic device . The processor is also connected to a random access memory RAM unit and a persistent storage device which are responsible for various non volatile storage functions of the portable electronic device and in which the databases are maintained. Each of the databases are registered for synchronization with the synchronization agent upon start up of the portable electronic device . The processor receives input from input devices such as a keyboard. The processor outputs to output devices such as an LCD display. The processor is also connected to an internal clock and to a radio device which in turn is connected to an antenna . Together the radio device and the antenna are used to connect to the radio communication system over a radio communications channel. Thus the portable electronic device is operable to receive and transmit communication signals containing data that is communicated to and from the communication system via the radio device and the antenna .

It will be understood that the functions described herein can be carried out in any suitable manner. In the present example the functions are carried out by algorithms executable by the processor . For example the processor of the portable electronic device is operable to obtain an updated database schema and to store the updated database schema at the persistent storage device in a data dictionary associated with the database to which the database schema belongs. The portable electronic device is also operable to retrieve a previous database schema from memory to compare the updated database schema with the previous database schema and to generate an update command based on the comparison. The portable electronic device is further operable to update the records of the database at the portable electronic device and to transmit the update command to the communication system .

Reference is now made to which shows a block diagram of certain internal components within the synchronization server . Similar to the portable electronic device the synchronization server includes a processor connected to a read only memory ROM that includes applications executable by the processor and enables the synchronization server to perform certain functions including synchronization with the portable electronic device . The processor is also connected to a random access memory RAM unit and a persistent storage device which are responsible for various non volatile storage functions of the synchronization server . The processor is functionally connected to the databases through the personal information management connector and to the relay device which in turn is connected to the base station for connecting to the portable electronic device over a radio communications channel. Thus the synchronization server is operable to receive and transmit communication signals containing data that is communicated to and from the portable electronic device via the relay device and the base station .

Again it will be understood that the functions described herein can be carried out in any suitable manner. In the present example the functions are carried out by algorithms executable by the processor . For example the processor of the synchronization server is operable to receive communications generated by the portable electronic device including the update command. The synchronization server is further operable to request data records from the personal information management connector to update the data records based on the update command and to store the updated database records in the database to which the updated database records belong.

Database schemas are defined as Extensible Markup Language XML files that are passed from the synchronization server to the portable electronic device through the relay and the base station during an initial handshake for synchronization of one of the databases of the portable electronic device with the corresponding one of the databases at the communication system . It will be appreciated that each of the databases has an associated schema that defines the structure for the data records of that database. Thus the schema defines the field name tag identification number data type maximum supported length whether or not the field is a key field and whether or not the field is supported for synchronization for each field of the data records of the associated database.

Changes to the database schema are possible. For example changes can be made to delete a field add a new field or modify an existing field programmatically. Such programmatic changes are made by for example downloading an updated version of software to the portable electronic device by wire serial connection to a computing device including an updated database schema. It is possible that changes can be made by other means for example via the user interface of the portable electronic device .

Referring now to a method for updating databases including data records to accord with the updated database schema will now be described. The updated database schema is first obtained at the portable electronic device for one of the databases at step . The updated database schema includes changes made by any suitable means such as changes made programmatically to the database schema. Upon receipt of the updated database schema the portable electronic device stores the schema at the persistent storage device in a data dictionary in association with the one of the databases to which the updated database schema belongs step . Next the portable electronic device retrieves the previous database schema that is associated with the same one of the databases to which the updated database belongs from the persistent storage device at step . A comparison of the updated database schema to the previous database schema is then carried out at the portable electronic device at step . From the comparison of the updated database schema with the previous database schema an update command is generated in cases where the updated schema differs from the previous database schema step . Thus the changes made to the schema are determined by the comparison at step and these changes are used in an update command for updating the records of the associated database. The changes to the database schema take the form of a deletion an addition or modification of a field of data. If the changes to the database schema include the deletion of a field the records of the associated one of the databases at the portable electronic device are then updated at step . Thus a field that is made obsolete and removed from synchronization is deleted from all of the records of the associated database. Therefore the records of the associated database conform to the new database schema. If the changes to the database schema include the modification of a field the records of the associated one of the databases at the portable electronic device are updated at step . The records are updated by deleting the data in the modified field. Any new data to be added to the field must conform to the new database schema and is added by for example user entry at the input devices of the portable electronic device . Of course the data can also be added to the modified field in a synchronization operation. If a new field is added to the updated schema the new field is added in the update command. The records of the database however are not changed until data is entered for the new field by for example user entry at the input devices of the portable electronic device . After updating the records of the associated one of the databases the portable electronic device issues the update command to the server for updating the database schema by transmitting the command over radio interface to the server through the base station and relay step .

The server receives the update command for updating the database schema at step . The records of the associated one of the backup databases are updated similarly to the updates made to the records of the associated one of the databases at the portable electronic device . Thus if the changes to the database schema include the deletion of a field or the modification of a field the records of the associated one of the backup databases are retrieved through the connector at step . The records of the associated one of the backup databases are then updated to accord with the updated database schema using the update command step . With the deletion of a field in the database schema data in that field is deleted from all of the records of the associated database at step . Thus the data records of the associated database all conform to the updated database schema. With the modification of a field the records of the associated one of the databases are updated by deleting the data in the modified field at step . With the modification of a field however the field is not deleted from the database schema and thus when data is entered into the field of a record at the portable electronic device and the record is stored in the appropriate database the data is sent to the server as part of a regular data record backup operation for storage in the appropriate database at the communication system side. If a new field is added to the updated schema the records of the associated one of the databases are not retrieved and are not changed until data is entered for the new field by for example user entry at the input devices of the portable electronic device followed by a backup operation to send the data to the server . The updated database schema and updated records are then stored in the associated one of the backup databases from which they were retrieved step .

The following examples are provided to further illustrate various aspects of embodiments. These examples are intended to be illustrative only and are not intended to limit the scope of the present application.

In the present example a field of the records in the database is made obsolete and removed from synchronization. One of the e mail fields in the records of an address database for example Contacts records is made obsolete and therefore is removed from synchronization. The updated schema is received in the form of an XML file that has one less field defined therein as compared to the previous schema for the database step . The updated schema includes the updated database structure and includes a mapping between the field tags of the updated schema and the field tags of the Messaging Application Programming Interface MAPI . The updated database schema for the database is stored at the persistent storage device in the data dictionary in association with the database step . The previous schema for the address database is then retrieved from the persistent storage device step and compared to the updated schema step . An update command to update the database schema and records of the associated backup database is then generated. The update command includes the changes for the data records to accord with the new updated database schema along with an identification of the version of the schema being sent in the update command step . The schema version is provided so that future data restored to the portable electronic device using an unsupported schema version can be detected by the portable electronic device . Next the records of the database are updated by deleting the one of the e mail fields that is obsolete from each of the records Step and storing the e mail records in the database . It will be understood that each of the records of the database therefore conforms to the new database structure as defined by the updated database schema. The update command is then transmitted to the synchronization server step .

Upon receipt of the update command at the synchronization server step the data records of the corresponding backup database are retrieved step and each data record is updated by deleting the one of the e mail fields that is obsolete step . After deleting the one of the e mail fields that is obsolete the data records are stored in the backup database and the updated database schema for the backup database is stored in the data dictionary in association with the database step .

Another example will now be described with continued reference to . In the present example a field is added to the records in the database for synchronization. One of the e mail fields in the records of an address database for example Contacts records is added to allow a further e mail field to be specified and is therefore added to synchronization. The updated schema is received in the form of an XML file that has one additional field defined therein as compared to the previous schema for the database step . The updated schema includes the updated database structure including field data for the new field being added such as the field name the field tag identification number the data type the maximum supported field length whether or not the field is a key field and an indication that the field is supported for synchronization. The updated schema also includes a mapping between the field tags of the updated schema and the field tags of the Messaging Application Programming Interface MAPI . Thus a mapping between the field tag of the added field and the MAPI field tag is included. The updated database schema for the database is stored in the data dictionary in association with the database step . The previous schema for the address database is then retrieved from the persistent storage device step and compared to the updated schema step . An update command to update the database schema of the associated database is generated from the comparison between the updated schema and the previous schema. The update command includes the information for the new field being added including the field name the field tag identification number the data type the maximum supported field length whether or not the field is a key field and an indication that the field is supported for synchronization step . The update command also includes the mapping of the field tags of the updated schema to the field tags of the MAPI. Since a new field is added the records of the database are not changed. Instead the data records can be changed later by entering data into the new field defined in the updated database schema for example by user input. The update command including the mapping of the field tags of the updated schema to the field tags of the MAPI is then transmitted to the synchronization server step .

Upon receipt of the update command at the synchronization server step the updated database schema for the backup database is stored in the data dictionary in association with the database step . With the new field stored in the database schema field data can be added to the data record for example after receipt from the portable electronic device during a backup procedure. Again the records are not retrieved or updated as a new field is added. The records can be changed later by adding data to the new field. As indicated above the update command includes the mapping of the field tags of the updated schema to the field tags of the MAPI.

Yet another example will now be described with continued reference to . In the present example a field of the records in the database is modified for synchronization. For the purpose of the present example one of the fields of the records is modified by changing the data type from integers to strings. The updated schema is received in the form of an XML file that includes field data for the modified field. This field data includes the data type as a string in contrast to the previous schema for the database which indicated the data type as an integer step . The updated schema includes the updated database structure and a mapping between the field tags of the updated schema and the field tags of the Messaging Application Programming Interface MAPI . The updated database schema for the database is stored in the data dictionary in association with the database step . The previous schema for the address database is then retrieved from the persistent storage device step and compared to the updated schema step . An update command to update the database schema of the associated database is generated from the comparison between the updated schema and the previous schema. The update command includes the field information for the modified field to accord with the new updated database schema step . In the present example the update command includes the data type of the modified field. Next the records of the database are updated by deleting the modified field from each of the records Step . New data can later be added to the modified field of each data record by adding data to the modified field in accordance with the updated database schema. The update command including the mapping of the field tags of the updated schema to the field tags of the MAPI is then transmitted to the synchronization server step .

Upon receipt of the update command at the synchronization server step the data records of the corresponding backup database are retrieved step and each data record is updated by deleting the modified field step . After deleting the modified field the data records are stored in the backup database and the updated database schema for the backup database is stored in the data dictionary in association with the database step . With the modified field stored in the database schema field data can be added to the data record for example after receipt from the portable electronic device during a backup procedure.

Thus according to one aspect there is provided a method of updating a database including data records to accord with an updated schema. The method includes obtaining at a portable electronic device the updated schema associated with the database. The data records are updated by deleting a field from each of the data records if the field is deleted in the updated schema. An update command is transmitted from the portable electronic device for updating the database schema for a corresponding backup database at a server.

According to another aspect there is provided a computer readable medium having computer readable code embodied therein for obtaining at a portable electronic device an updated schema associated with a database including data records if a field is deleted in the updated schema updating the data records by deleting the field from each of the data records and transmitting an update command from the portable electronic device for updating the database schema for a corresponding backup database at a server.

According to still another aspect there is provided a portable electronic device including an input for receiving an updated schema associated with a database a memory for storing data records in the database a processor connected to the input and the memory for updating data records of the database based on the updated schema by deleting a field from each of the data records if the field is deleted in the updated schema and a transmitter connected to the processor for transmitting an update command from the portable electronic device for updating a database schema for a corresponding backup database at a server.

Advantageously a database schema is updated dynamically. Aspects of embodiments described herein provide for the comparison of new schema with old schema for determination of the changes made to a database schema. These changes are made at the portable electronic device and are transmitted from the portable electronic device to a server for updating backup records. Rather than invalidating previously backed up data the server uses schema change information to update the backup records by for example deleting fields from data records belonging to the database with the updated schema. In a further aspect the schema for databases associated with mail store content includes a mapping between field identifications of the records of the portable electronic device and field identifications in MAPI Messaging Application Programming Interface for retrieval of data for new fields from a mail server.

While the embodiments described herein are directed to particular implementations of schema updating for synchronizing databases connected by wireless interface it will be understood that modifications and variations to this embodiment are within the sphere and scope of the present application. For example in the above described example in which the field is modified the field data type is changed from integers to strings. It will be appreciated that the field can be modified in many other ways. For example the field name can be changed the maximum supported length can be changed and whether or not the field is considered to be a key field can be changed. These changes need not result in the deletion of content of the fields of each of the data records as in the above described example. It is also possible that the electronic device determines the changes made to the schema and for certain changes modifies the data of the field for each data record. For example with a simple change of a field definition from a non terminated string to a terminated string with a null terminator the portable electronic device can add a terminating character to the data field for each data record and issue an update command to the server to do the same.

It will be understood that the portable electronic device is not limited to three databases as any suitable number of databases is possible. Similarly the communication system may include any suitable number of databases. It will also be understood that the steps described hereinabove are not limited to the order in which they are described. The steps described can be performed in any suitable order as may occur to those skilled in the art.

Many other modifications and variations may occur to those skilled in the art. All such modifications and variations are believed to be within the sphere and scope of the present application.

