---

title: Ultratight navigation observation lock detector
abstract: An observation lock detector receives I and Q correlations and measurement residuals and transforms the I and Q quadrature correlation outputs based upon computed code phase and carrier phase into transformed I and Q quadrature signals communicated to conventional output lock detectors to provide validity and confidence indicator signals for indicating that the residual estimates are valid for dynamic propagation of the residuals in a navigation receiver for improved performance especially in low signal-to-noise environments such as for use in an ultratight GPS navigation system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07680221&OS=07680221&RS=07680221
owner: The Aerospace Corporation
number: 07680221
owner_city: El Segundo
owner_country: US
publication_date: 20060407
---
The invention was made with Government support under contract No. F04701 00 C 0009 by the Department of the Air Force. The Government has certain rights in the invention.

The invention relates to the field of ultratight navigation systems. More particularly the present invention is related to GPS ultratight coupling navigation receivers.

Navigation systems are increasingly dependent upon the global positioning system GPS . The navigation receiver should be able to withstand intentional or unintentional signal interference with robust signal acquisition and tracking. For this reason inertial navigation systems have been coupled to GPS signal tracking and acquisition systems for improved signal tracking and acquisition of the received signal. Inertial navigation systems INS have an inertial measurement unit IMU for processing inertial measurements. Coupling navigation data with the GPS signal tracking and acquisition system improves signal tracking and acquisition. When the inertial measurements of a navigation processor are used with a GPS signal tracking and acquisition system the combined system is tightly coupled. The tightly coupled GPS and INS system uses validated pseudorange and pseudorange rate measurements from the GPS receiver instead of the processed position and velocity measurements. In addition inertial measurement unit data is usually used to assist the receiver tracking loops and enable more noise filtering than would be possible without tracking loop aiding. The tightly coupled method has been used with the validated pseudorange and pseudorange rate measurements. Ultratight coupling systems have been disclosed in U.S. Pat. No. 6 516 021. More recently ultratight GPS and INS coupling has been proposed which drives all signals from the INS navigation solution for a period of time then examines all signals with respect to the error of the navigation solution. Ultratight receivers do not attempt to control code replicas for exact code phase alignment with the incoming signal but merely seek to observe the deviation of the incoming signal from locally generated replicas and feed that deviation information back to the code replica generators. Ultratight coupling has shown to be more robust in the presence of noise. Ultratight coupling does not require that the replica code track or lock onto the incoming signal. Uncoupled systems loosely coupled systems and tightly coupled systems have conventional lock detectors that are known to validate measurements for improved performance. The output lock detectors measure the performance of the system. However new ultratight validations and performance metrics have been sought but no proposed metric has been accepted.

A tracking loop is a combination of electronic hardware and software algorithms used to track a pseudorandom noise PRN code signal and the signal carrier. A tracking loop that tracks the PRN code is a code tracking loop. A tracking loop that tracks the carrier is a carrier tracking loop. The carrier tracking loop can track the phase or the frequency of the carrier or a combination of both. A carrier tracking loop design is adjusted to each application by designing the closed loop gains and the order of the filter to obtain the desired filtering and dynamic response. The code tracking loop attempts to drive the code phase of a replica signal to be aligned with the received signal so as to enable coherent demodulation of the received signal. The tracking loops include a signal generator that generates an estimated replica signal of the received signal using a control signal that advances or retards in time the code replica signal relative to the received signal. The code tracking loop includes a correlator that multiplies the received signal by the code replica signal and passes the multiplied signal result through a low pass filter. The code tracking loop includes a discriminator generator that generates a discriminator signal having a value related to the difference between the received signal and the replica signal. The code tracking loop also includes a controller that filters the discriminating signal into the control signal that is then communicated to the signal generator.

A fundamental function in all GPS receivers built to date is the ability of the receiver to generate a code replica signal of the received signal transmitted by a satellite that can be correlated with the code of the received signal being received from the satellite. The code replica signal is advanced or retarded until the locally generated replica signal correlates with the received code in a receiver. For loosely or tightly coupled GPS and INS systems the code tracking loop is performed by code and carrier tracking loops that determine an error signal that is a measure of the range and range rate difference between the generated and received signals. That difference between the received and replica signal is an error signal that is processed by a transfer function for generating input values communicated to a numerically controlled oscillator to advance or retard the generated code replica signal. When the code replica signal correlates with the received code the tracking loop is in lock and the feedback error signal is near zero. When the code and carrier tracking loops are in lock the state of the code and carrier generation process can be sampled to obtain a measure of the pseudorange and pseudorange rate. The pseudorange is the geometric range between the transmit antenna and receive antenna plus a bias due to the user clock error. The pseudorange rate is approximated by the amount of range change for a predetermined amount of time plus a bias due to the drift of the local oscillator frequency.

The pseudorange and pseudorange rate measurements are predicated upon the assumption that the replica is aligned with the incoming signal. Lock detectors are used to determine when the carrier and code replicas are coherently aligned with the incoming signal in terms of code phase by a code lock detector of the carrier frequency by a frequency lock detector and of the carrier phase by a phase lock detector. When the code lock detector indicates that the code of the replica is in lock with the received signal then the pseudorange measurement derived from an instantaneous sampling of the state of the code generator at a desired measurement epoch time is considered valid. When the frequency lock detector indicates that the carrier frequency is in lock with the carrier phase of the received signal then the pseudorange rate measurement is considered valid. The pseudorange rate measurement is obtained by strobing the carrier replica twice over a small period of time and determining the change in carrier phase or delta pseudorange over a discrete period of time. In the limit as the time interval goes to zero the ratio of the delta pseudorange divided by delta time approaches the instantaneous time rate of change of the pseudorange which rate of change is the pseudorange rate.

Lock detectors improve navigation performance for loosely and tightly coupled systems because the lock detectors prevent bad measurements from being sent to the integration Kalman filter. In addition to improving navigation performance the signal to noise levels at which a receiver loses code lock carrier frequency lock and carrier phase lock are used as measures of receiver performance.

The code tracking loops that track the incoming satellite received signal must adjust the phase and the frequency of the generated replica signal for many changing variables such as user and satellite relative motion and user clock drifts. These tracking loops are traditionally called the code loop and the carrier loop because the code loop tracks the phase of the pseudorandom noise PRN code and the carrier loop tracks the signal carrier frequency and the carrier phase. Although a phase locked loop is the most common way to track a carrier signal the GPS signals have a fifty hertz navigation data message superimposed on the code generation process which can potentially change the phase of the signal by 180 every twenty milliseconds. To avoid a loss of lock during this change of phase a Costas tracking loop is used in place of the conventional phase lock loop. This allows the carrier to be tracked across 50 Hz data bit changes with no loss of lock. Frequency lock loops are also used for the carrier tracking and sometimes are used in combination with phase lock loops to improve robustness. When the tracking loop error builds beyond a certain threshold value the loop is deemed to be out of lock and pseudorange and pseudorange rate measurements are not used until the loop reacquires lock.

Ultratight coupling generates all replicas based on a single navigation estimate for a period of time called an epoch. The replicas are not required to precisely track the incoming signal during the epoch but must remain within about a chip to ensure the signal is in view. The correlation outputs for every signal from a satellite are modeled by a function of the error between the navigation state estimate and the true navigation state total electron content error TEC and error rate TEC . These errors are then estimated based on examination of the correlation outputs. Ultratight coupling has been shown to be a more effective way of processing GPS and IMU signals in the presence of noise and has resulted in improved estimates of the ionospheric effects. Ultratight systems can use information from other satellites to propagate a replica of a satellite that might momentarily be obscured and hence can quickly reacquire a signal without going through a lengthy acquisition process. There are problems during detection when a particular satellite is giving poor information or when identifying when an ultratight system is not receiving valid information from GPS signal processing. Because ultratight receivers do not lock onto the incoming signal lock detectors cannot be applied to the correlation outputs to determine the validity of estimates. The validity of the estimates is not determined. As such invalid estimates can be passed to the integration Kalman filter as measurements. The integration Kalman filter will have no way of determining when the measurements are invalid. The integration Kalman will apply the invalid measurements resulting in a degraded navigation estimate. The degraded navigation estimate can cause one or more replicas to be out of the field of view of the signal resulting in greatly reduced navigation performance. Because ultratight systems never lock onto the signal the signal to noise ratio at which the receiver falls out of lock cannot be applied as a performance metric. Ultratight navigation systems disadvantageously lack an ability to quantify performance and determine when incoming signal observations are valid. These and other disadvantages are solved or reduced by the present invention.

An object of the invention is to provide validity indications for indicating when residual estimates are valid.

Another object of the invention is to provide validity indications for indicating when residual estimates are valid using noise estimates and quadrature correlations.

Yet another object of the invention is to provide validity indications for indicating when residual estimates are valid using noise estimates and quadrature correlations in an ultratight coupled system.

Yet a further object of the invention is to provide validity indications for indicating when residual estimates are valid using noise estimates and quadrature correlations in an ultratight coupled GPS navigation system.

Yet a further object of the invention is to provide an observation lock detector for providing validity indications for indicating when residual estimates are valid using noise estimates and quadrature correlations in an ultratight coupled GPS navigation system.

Still a further object of the invention is to provide an observation lock detector for providing validity indications for indicating when residual estimates are valid using noise estimates and quadrature correlations with the residuals rotating the correlations for maximizing one of the correlations for conventional lock detection of the maximized correlation for providing the validity indications.

An observation lock detector receives quadrature correlations such as early prompt and late I and Q quadrature correlations from a correlator as well as residual estimates from a prefilter and noise estimates from a noise estimator for generating validity signals and generates indicators indicating the validity of the residual estimates. The indicator signals when valid may be used in a navigation system for dynamically propagating the error state vector and the clock error estimates for continuous tracking of carrier and code phases with residual updates. The indicator signals when invalid may be used in a navigation system for statically propagating the error state vector and the clock error estimates for continuous tracking of carrier and code phases without residual updates.

The observation lock detector transforms the I and Q quadrature correlations outputs based upon the residual estimates so that conventional output lock detectors provide the validity signals for indicating that the residual estimates are valid. The observation lock detector can improve a GPS navigation receiver performance in low signal to noise environments and be applied to ultratight GPS navigation systems. The validity signals are preferably communicated to an integration filter in a navigation processor so that the integration filter does not use invalid residual estimates when computing a navigation solution and tracking the carrier phase and code phase. The ratio of the signal power to the noise power at which the validity signals indicate invalid estimates can be used as a measure of performance of an ultratight system. These and other advantages will become more apparent in the detailed description of the preferred embodiment.

An embodiment of the invention is described with reference to the figures using reference designations as shown in the figures. Referring to a global positioning system GPS inertial navigation system includes a navigation system receiving GPS signals and inertial measurement unit samples from a sensor assembly and provides position and velocity data to a control and display unit . The navigation system functions as a GPS inertial navigation system tracking GPS signals from a plurality of in view satellites not shown. The sensor assembly includes an antenna for receiving and providing received GPS signals and includes an inertial measurement unit IMU providing the IMU sample signals both of which signals are communicated to the navigation system . In the preferred form the IMU may be a microelectromechanical system MEMS IMU embedded in the antenna . The navigation system includes a downconverter for frequency downconversion of the received GPS signals using a reference oscillator providing an finternal frequency reference. The system includes an analog to digital A D converter communicating digitized GPS samples to a navigation processor and to a noise estimator that computes from the GPS samples a signal to noise ratio SNR and provides an estimated amplitude A. The noise estimator sends the noise estimates SNR and A to the navigation processor . The navigation processor also receives the IMU samples from the IMU an internal frequency reference ffrom the reference oscillator and GPS samples from the A D converter and provides the position and velocity data to the control and display units .

Referring to and more particularly to the navigation system includes a navigation processor receiving the digitized GPS samples that are communicated to mixers and . The mixers and provide demodulated inphase Iand quadrature Qsignals as demodulated quadrature signals respectively using cos and sin demodulation signals from a carrier numerically controlled oscillator NCO using a freference oscillator . The cos and sin demodulation signals are replica carrier signals for carrier demodulating the received GPS samples . The Iand Qdemodulated quadrature signals are received by a correlator also receiving early E prompt P and late L code replica signals from a chipping code generator receiving a chipping code clocking signal from a code clock NCO . The correlator may operate at 50.0 Hz. The correlator provides inphase and quadrature early prompt and late I Q I Q I and Qcorrelation signals that are communicated to a measurement residual Kalman prefilter . The correlations may be communicated at 50.0 Hertz to the measurement residual Kalman prefilter having a 1 Hertz output. The measurement residual prefilter computes the pseudorange error the pseudorange rate error dot over the pseudorange acceleration error umlaut over as well as the carrier phase the carrier frequency and the carrier phase acceleration . The pseudorange rate dot over is the first derivative time rate of the change of the pseudorange . The pseudorange acceleration umlaut over is the second derivative time rate of change of the pseudorange . The measurement residual prefilter also computes total electron content error TEC and error rate TEC as part of a residual estimates vector. The prefilter also computes a measurement covariance matrix M indicating the uncertainties in the residual estimates vector for a number of samples m over a major cycle epoch time T. The residual estimates vector outputs TEC TEC are communicated to the observation lock detector . The residual estimates vector outputs TEC TEC and M are communicated to a large integration Kalman filter that may have a one second major cycle time period between Kalman filter epochs. The observation lock detector also receives the noise estimates SNR and A from the noise estimator . The observation lock detector provides a carrier phase validity indicator PLI a carrier phase confidence indicator PLC a carrier frequency validity indicator FLI a carrier frequency confidence indicator FLC a code phase validity indicator CLI and a code phase confidence indicator CLC. All of the indicators are communicated to the integration Kalman filter . By way of example the carrier phase validity indicator PLI has a value of 1 when the carrier phase error estimate is considered valid and has a value of 0 when invalid. The observation lock detector outputs the phase validity confidence PLC that takes a value between 0 and 1 indicating a confidence level of PLI. The observation lock detector also outputs the carrier frequency validity indicator FLI that has a value of 1 when the carrier frequency is valid and has a value of 0 when invalid. The observation lock detector also outputs a carrier frequency confidence indicator FLC. The observation lock detector also outputs a code validity indicator CLI that has a value of 1 when the pseudorange error estimate is valid. The observation lock detector also outputs a code confidence indicator CLC. For the confidence indicators PLC FLC and CLC an output of 0 corresponds to no confidence and an output of 1 corresponds to certainty. For the validity indicators PLI FLI and CLI an output of 1 indicates a valid lock and an output of 0 indicates an invalid lock.

The integration Kalman filter receives PLI PLC FLI FLC CLI and CLC indicators as inputs. The integration Kalman filter in turn repetitively provides estimates of position and velocity errors in an error state vector ESV that is used by the navigation calculator to compute the output P V position and velocity data communicated to the control unit . The V and IMU samples and the error state vector ESV are communicated to the 100 Hz inertial navigation calculator that computes the best estimate of the navigation state vector solution defined by P V position and velocity data. The P V position and velocity data is calculated from the IMU samples and the error state vector ESV. At the end of each of the one second major cycle the integration Kalman filter updates the ESV and then communicates the ESV to the navigation calculator . The IMU samples are repetitively generated for example at one hundred times a second. The samples include the differential velocity samples V and the differential attitude samples that are communicated to the 100 Hz inertial navigation calculator also receiving the error state vector ESV every second from the integration Kalman filter . The P V position and velocity data is communicated to the 100 Hz pseudorange and pseudorange rate calculator that in turn provides pseudorange rate estimate to the carrier code NCO and provides a pseudorange estimate to the code NCO . The pseudorange and pseudorange rate calculator also receives calculated GPS satellite position and velocity data P V from a 100 Hz GPS satellite position and velocity calculator . The calculator also receives user clock error estimates CEE from the integration Kalman filter . The satellite P V data references the GPS satellite calculated position and velocity. The clock error estimates CEE include a clock phase error and clock frequency error that is the time derivative of the clock phase error. The calculated pseudorange estimate is equal to the geometric line of sight range to a satellite adjusted by the clock phase error estimates CEE and certain signal propagation compensation terms such as the nominal ionosphere and troposphere delays. The pseudorange rate estimate is equal to the relative geometric velocity to the satellite from the user antenna plus the clock frequency error estimate. The GPS satellite position and velocity calculator receives timing signals from a timer using the freference and receives demodulated ephemeris data from an ephemeris demodulator using the GPS samples to compute the P V GPS position and velocity data.

The correlation process of the correlator is based upon the early E prompt P and late L code replicas generated by the code generator and upon the carrier replica generated by the carrier NCO . As the pseudorange estimates and pseudorange rate estimates from the calculator are refreshed during each one hundred hertz cycle the replica carrier cos and sin signals from the NCO and the early E prompt P and late L code replicas are adjusted. The correlator operating at 50.0 Hz for example enables conventional early prompt and late correlations by providing the early prompt and late I and Q quadrature correlations to the Kalman prefilter as I Q I Q I and Qcorrelations. The I and Q quadrature correlations are used to estimate the residual estimates vector. The carrier and code phase of the replica signals as compared to the received GPS samples have offsets that is phases also known as phase errors. The carrier and code phases are used to estimate the residual estimates vector including the carrier phase the carrier frequency the carrier phase acceleration the pseudorange error and TEC error and TEC error rate from the prefilter .

Referring to and and more particularly to the residual estimates vector TEC and TEC from the prefilter is communicated to the observation lock detector for generating indicators. The observation lock detector includes an I Q maximizer that receives the residual estimates vector including the measurements TEC and TEC signals from the prefilter . The observation lock detector also receives the SNR and A noise estimates from the noise estimator . The observation lock detector also receives the I Q I I and Qcorrelations from the correlator . The maximizer generates an Iand Qmaximized vector by combining weighted sums of I I and Icorrelations into the maximized inphase vector Iand by combining weighted sums of Q Q and Qcorrelations into a quadrature maximized vector Q. The weights W W and Ware chosen so that the I t and Q t maximized quadrature signals have a maximum signal to noise ratio. The I Q maximizer also generates modified noise estimates SNRand A. The modified noise estimates SNRand Aare scalars. The observation lock detector further includes a rotation matrices generator that receives the residual estimates vector including TEC and TEC . The generator generates a rotational matrix array R. The rotational matrix array R is communicated to a rotator for rotating in reverse the maximized vector Iand Qan amount equal to the carrier phase error for generating Iand Qtransformed vector. The Iand Qtransformed vector and the modified noise estimates SNRand Aare then communicated to conventional lock detectors and . A carrier phase output lock detector provides the PLI and PLC indicators. A carrier frequency output lock detector provides the FLI and FLC indicators. A code lock output detector provides the CLI and CLC indicators. The output lock detectors and provide a PLI PLC FLI FLC CLI and CLC indicator vector indicating the validity and confidence of the carrier phase carrier frequency and code phase that is related to the pseudorange error .

The integration Kalman filter receives the indicator vector including the PLI PLC FLI FLC CLI and CLC indicators from the observation lock detector along with the prefilter residual estimates vector and the covariance matrix M from the measurement prefilter for propagating the CEE and ESV outputs. A conventional Kalman filter is modified to process the measurement error vector conditioned upon the validity and confidence of the indicators of the indicator vector . The carrier phase measurement is processed when only PLI and PLC indicators indicate that the carrier phase measurement is valid with a predetermined confidence. Carrier frequency is processed when FLI and FLC indicators indicate that the carrier frequency measurement is valid with a predetermined confidence. The pseudorange error is processed when the CLI and CLC indicators indicate that pseudorange error measurement is valid with a predetermined confidence. The code phase error is equal to the pseudorange error minus a correction for TEC. The clock estimates CEE and error state vector ESV outputs of filter are adjusted as the carrier phase carrier frequency and pseudorange error vary. When the indicators indicate invalid or low confidence in the carrier phase carrier frequency and pseudorange error the CEE and ESV are statically propagated without updates that is CEE and ESV are propagated without updates. When the PLI PLC FLI FLC CLI and CLC indicators indicate valid and high confidence in the carrier phase carrier frequency and pseudorange error the CEE and ESV outputs from the integration Kalman filter are dynamically propagated using updates of the carrier phase carrier frequency and pseudorange error measurements .

In the preferred form the dynamic and static propagation of the residuals and CEE and ESV outputs by the integration Kalman filter occurs based upon the validity and confidence PLI PLC FLI FLC CLI and CLC vector by predetermined criteria. When the indicators PLI and PLC for carrier phase indicators PLI and PLC are valid with confidence then the CEE and ESV outputs are dynamically propagated using carrier phase carrier frequency and pseudorange residual estimates. When the PLI and PLC indicators for the carrier phase are invalid and FLI and FLC indicators for the carrier frequency are valid with confidence the CEE and ESV outputs are dynamically propagated using the carrier frequency and pseudorange error residual estimates. When the PLI and PLC indicators for the carrier phase are invalid and the FLI and FLC indicators for the carrier frequency are invalid and the indicators CLI and CLC for the code phase are valid with confidence then the CEE and ESV outputs are dynamically propagated using the pseudorange range error residual estimate. When the indicators are invalid for the carrier phase the carrier frequency and code phase the CEE and ESV outputs are statically propagated without updates using the carrier phase the carrier frequency and pseudorange error residual estimates. In this manner the integration Kalman filter dynamically propagates the CEE and ESV outputs for adjusting tracking of the code phase and carrier phase when the residual estimates are valid with confidence. Otherwise the integration Kalman filter statically propagates the CEE and ESV outputs for maintaining tracking of the code phase and carrier phase when the residual estimates are invalid. As such the navigation processor tracks with updates the carrier phase and code phase only when the residual estimates are valid. The ESV output contains an estimated TEC and a position and velocity estimate. The decision to process the residual estimates and by the integration Kalman filter is done as in conventional tightly coupled receivers that use outputs from conventional lock detectors to determine when to process the pseudorange range error carrier phase and carrier frequency residual estimates.

The carrier phase lock detector is a conventional carrier phase lock detector that receives as input the Iand Qtransformed vector and the modified noise estimates SNRand A. The carrier phase lock detector outputs an indicator PLI that is 1 when the carrier phase is in lock and 0 when not in lock. The carrier phase lock detector outputs the indicator PLC that takes a value between 0 and 1 expressing the confidence in the correctness of the value of indicator PLI. The carrier frequency lock detector is a conventional carrier frequency lock detector that receives as input the Iand Qtransformed vector and the modified noise estimates SNRand A.

The carrier frequency lock detector outputs the indicator FLI that is 1 when the carrier frequency is in lock and 0 when not in lock. The carrier frequency lock detector outputs the indicator FLC that takes a value between 0 and 1 indicating the confidence in the correctness of the value of indicator FLI. The code lock detector is a conventional code lock detector that receives as input the Iand Qtransformed vector and the modified noise signal SNRand A. The code lock detector outputs the indicator CLI that is 1 when the code is in lock and 0 when not in lock. The code lock detector outputs the indicator CLC that takes a value between 0 and 1 expressing the confidence in the correctness of the value of the indicator CLI.

The observation lock detector includes a rotation matrices generator that receives the residual estimates vector TEC TEC from the Kalman prefilter for producing the rotational matrix R t for each of the N samples where N is the number of samples in an epoch T. The angle of rotation for each correlation corresponds to the estimated carrier phase error as determined from the measurement error vector. Concurrently the I Q maximizer receives early prompt and late I t and Q t correlations for each of the N samples in an epoch and stores the correlations outputs in a buffer. After receiving residual estimates TEC and TEC and SNR and A noise estimates from the Kalman prefilter for an epoch the I Q maximizer generates an estimate of the code phase offset t for each I Q correlation pair. The I Q maximizer then linearly combines the early prompt and late I Q correlations at each sample point to maximize the signal to noise level at each point. The linear combination maximizes the signal to noise ratio of the I t and Q t maximized signals. By forming I t and Q t maximized signals the maximizer is diminishing the effect of signal power loss when the prompt inphase signal Iis no longer required to be aligned with the peak. The I Q maximizer also computes the average signal to noise ratio of Iand Qmaximized vector by providing the modified SNRsignal as well as the average signal amplitude Aof the Iand Qmaximized signals. The I Q maximizer outputs Iand Qmaximized vector for each sample time t and as well as modified noise estimates SNRand A.

The I Q rotator receives the rotational matrix array R from the rotation matrices generator and receives the Iand Qmaximized signals from the I Q maximizer . For each correlation at time t in the epoch T the I Q rotator premultiplies a column vector containing I t and Q t maximized quadrature signals by a rotation matrix R t to produce I t and Q t transformed quadrature signals. The I Q rotator then combines the I t and Q t transformed quadrature signals for each sample time t to produce Iand Qtransformed vectors. The Iand Qtransformed vectors are outputs of the I Q rotator .

Referring to and more particularly to and the I Q maximizer includes a code offset calculator receiving the residual estimates TEC and TEC from the prefilter . The code offset calculator computes an estimate of the code phase offset t for each sample time t where t C TEC TEC T t C T t 1 2 T t with C C 2 fand C CK fwhere C C C and are constant and C is the speed of light and Fis the carrier frequency. The Iand Qbuffered vector containing the estimated code phase offset for all sample times in the epoch is given by a code offset . The code offset is the output of the code offset calculator . The I Q maximizer also includes a buffer that receives early prompt and late I and Q correlations for an epoch time T and combines the correlations into the buffer Iand Qvector. The Iand Qvector contains all the early prompt and late I and Q correlations for the entire epoch. Individual correlations I t and Q t are buffered as the Iand Qbuffered vector. The Iand Qvector containing all the early prompt and late I and Q correlations for the entire epoch T are the outputs of the buffer .

The I Q maximizer also includes a look up table operator that receives the code phase offset vector and looks up the early prompt and late weights W t W t and W t respectively that combine the early prompt and late I t and Q t correlations to maximize the signal to noise ratio at each correlation at time t. The I Q maximizer look up table is used by the look up table operator to determine the weights W W and W respective for early prompt and late I and Q correlations. The look up table operator also calculates the degradation factor X t that indicates the fraction of signal amplitude lost when the prompt replica is not on the peak. The look up table used by the look up table operator is used for determining the degradation factor. The look up table operator outputs the X W W and Wvectors including the degradation factor X and weights W for every sample time t in the epoch T. The I Q maximizer also includes a SNR maximizer that receives the W W and Wweight vectors from the look up table operator and receives the Iand Qvectors from the buffer . The SNR maximizer performs a weighted sum of the early prompt and late correlations for each sample time t to produce the maximized signals I t and Q t . The individual samples are then stored in the Iand Qvector that is an output of the SNR maximizer . The Iand Qvector is an output of the I Q maximizer . The I Q maximizer also includes a noise modifier which receives the degradation factor vector X and the signal to noise ratio SNR and the amplitude A as inputs and outputs the revised signal to noise ratio SNRand the revised amplitude A. The revised signal to noise ratio SNRand the revised amplitude Aare also outputs of the I Q maximizer where SNR SNR A Aand A A N X t .

Referring to all of the Figures and more particularly to the rotation matrices generator includes an angle calculator receiving the residual estimates TEC and TEC from the prefilter . The angle calculator computes an estimate of the carrier phase offset angle t for each sample time t. A carrier phase offset angle vector containing the estimated carrier phase offset angles t for all sample times t in the epoch T is an output of the angle calculator where t T t 1 2 T t . The rotation matrices generator also includes a rotation calculator which receives the carrier offset vector as an input. For each sample time t rotation calculator generates a rotation matrix R t from the estimate of the carrier phase offset t . The R t rotation matrices are grouped together in the rotational matrix array R as an output of the rotation calculator as well as the rotation matrices generator .

In operation the observation lock detector determines the validity and confidences of the lock indicator vector from estimates of replica carrier phase error replica carrier frequency error and pseudorange error . These indicators are preferably used by the integration Kalman filter in the navigation processor so that the invalid residual estimates are not used to dynamically propagate navigation signals such as clock estimates CEE and error state vector ESV. The CEE and ESV outputs are used to adjust the carrier phase and code phase during coherent carrier demodulation and code despreading of the samples . The observation lock detector detects invalid residual estimates from the prefilter so that the integration Kalman filter can ignore residual estimates and or deweight the residual estimates with low validity confidence levels so that the residual estimates are effectively declared invalid. These indicators can be used as a measurement of performance of an ultratightly coupled navigation system. The observation lock detector can be used to determine the validity of residual estimates of the received correlations .

In the rotator computes a carrier phase offset angle t . The carrier phase error is a carrier phase angle at a time t at the end of an epoch T when T t. The carrier phase offset angle t is the carrier phase error at any time t. That is the carrier phase offset angle t equals the carrier phase error at the end of an epoch. Each matrix R t of the rotational array R is defined by respective times t within the epoch. As such the rotational array R indicates the carrier phase over an epoch.

In the maximizer the code phase error is determined by the code offset calculator for looking up the weights W and degradation vector X by the look up table operator . The look up table is used to determine the weights W and vector X from code phase offset . The SNR maximizer then generates the maximized vector Iand Qfrom the buffered correlations I Q. The Iand Qmaximized vector has a maximized SNR at each time t. Concurrently the noise amplitude A is modified into the modified amplitude Ausing the degradation vector X. The modified amplitude Arepresents the degraded amplitude of the I and Q correlations . The modified SRNis the SNR of the Iand Qmaximized vector that is averaged over the epoch. The modified amplitude Ais the average amplitude of Iand Qover the epoch. Rotating Iand Qmaximized vector by the rotational array R removes the carrier phase offset over time t. The Iand Qtransformed vector includes maximized I t and Q t quadrature correlations having the carrier phase offset rotated out so that the Iinphase maximized vector is maximized and Qquadrature maximized vector is minimized.

During precise prompt correlations by the correlator the prompt correlations have a peak prompt SNR. When there is a code phase offset between the prompt replica code of the code generator and the spread spectrum code of the Iand Qcarrier demodulated signals the prompt correlation amplitude level is degraded form the peak prompt SNR. The modified SNRand amplitude Aare used by the detectors and to restore the amplitudes of the Iand Qtransformed vector to the received sample values of SNR and amplitude A for determining indicators .

When all of the residual estimates are accurate that is valid with high confidence the Iinphase transformed vector contains all of the signal power and the Qquadrature transformed vector contains no signal power. When the Iinphase transformed vector contains all of the signal power the carrier phase output lock detector provides valid and confident indicators PLI and PLC the carrier frequency output lock detector provides valid and confident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC. When the carrier phase residual estimate is not accurate and the carrier frequency residual estimate is accurate and when the Iinphase transformed vector and the Qquadrature transformed vector both contain constant signal power having a sum greater than a predetermined power value that is dependent upon SNRand A the carrier phase output lock detector provides invalid or unconfident indicators PLI and PLC the carrier frequency output lock detector provides valid and confident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC. When the carrier phase and carrier frequency residual estimates are inaccurate and the pseudorange error is accurate and when the sum of the power of Iinphase transformed vector and the Qtransformed vector is above the predetermined power value the carrier phase output lock detector provides invalid and unconfident indicators PLI and PLC the carrier frequency output lock detector provides invalid and unconfident indicators FLI and FLC and the code phase output lock detector provides valid and confident indicators CLI and CLC. When all of the residual estimates and are inaccurate the carrier phase output lock detector provides invalid and unconfident indicators PLI and PLC the carrier frequency output lock detector provides invalid and unconfident indicators FLI and FLC and the code phase output lock detector provides invalid and unconfident indicators CLI and CLC.

The observation lock detector functions to provide the operational indicators for detecting invalid residuals. The detector generates a code phase offset and a carrier angle offset from the measurement error vector and correlations . The code phase offset is used to combine the early prompt and late correlations into the I and Q maximized vector for adjusting the I and Q correlations for power alignment relative to code phase. The carrier angle offset vector then is used to rotate the Iand Qmaximized vector to align signal power relative to carrier phase resulting in the Iand Qtransform vector that is the best estimate of Iand Qcorrelations as determined by the measurement error vector . The lock indicators and determined validity of the residuals of the measurement error vector for the received I and Q correlations . In effect the observation lock detector functions to provide indicators of the validity of the residual measurements in the measurement error vector . As such the observation lock detector functions to provide a performance metric of the desired correct operation of the prefilter that generates the measurement error vector from the correlations in the first instance.

It should now be apparent that various alternative implementations can be used. The I Q maximizer could be modified to select at each time point the early E prompt P or late L I Q correlations that the residual estimates predicts has the greatest signal to noise ratio so that the modified amplitude estimate and SNR can be computed in a consistent manner. The I Q maximizer could be removed altogether and the prompt I Q could be used instead. The lock indicators and can be used for indicating changes in the validity in the pseudorange error pseudorange rate dot over and pseudorange acceleration umlaut over instead of carrier phase error carrier frequency error and code phase offset . Additionally one or more of the lock detectors and can be removed yielding a reduced set of indicators. The observation lock detector could be applied to various types of spread spectrum signals such as the m code signal. The observation lock detector can take inputs from additional correlators. The observation lock detector can take inputs from an m code envelope. Those skilled in the art can make enhancements improvements and modifications to the invention and these enhancements improvements and modifications may nonetheless fall within the spirit and scope of the following claims.

