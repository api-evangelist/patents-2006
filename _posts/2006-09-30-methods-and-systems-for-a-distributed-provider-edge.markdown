---

title: Methods and systems for a distributed provider edge
abstract: Methods and Systems are provided for a distributed Provider Edge (PE). A single Virtual Routing and Forwarding device (VRF) is associated with a single customer site. The VRF includes a single routing table (RIB) and a single forwarding table (FIB). The VRF also includes a plurality of Virtual Private Network (VPN) Protocol Instance Modules (VRP), where each VRP is associated with a different VPN from the customer site. Each VRP accesses the RIB directly and the FIB indirectly to acquiring addressing/routing information for a received data packet. Moreover, each VRP uses a data plane of the VRP to communicate the data packets to a PE backbone device. In turn, the PE backbone device uses the data plane to communicate with each of the VRPs, and the PE backbone device communicates with one or more tunnels.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08085776&OS=08085776&RS=08085776
owner: Fortinet, Inc.
number: 08085776
owner_city: Sunnyvale
owner_country: US
publication_date: 20060930
---
This application is a Continuation of application Ser. No. 10 163 073 filed on Jun. 4 2002 which is hereby incorporated by reference for all purposes.

A portion of the disclosure of this patent document contains material that is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure as it appears in the Patent and Trademark Office patent file or records but otherwise reserves all copyright rights whatsoever. The following notice applies to the software descriptions examples and data as described below and in the drawings hereto Copyright 2002 Cosine Communications Inc. All Rights Reserved.

The present invention is related to methods and systems for a distributed provider edge more specifically methods and systems are provided to distribute and integrate provider edge technology.

In today s highly interconnected computing environments a single customer can require a myriad of network configurations. For example a customer can have internal networks called Intranets external networks to other sites of the customer or to other organizations called Extranets and the customer can have one or more Virtual Private Networks VPNs . Each different VPN can be considered a separate network configuration. The customer can also have Internet network configurations to provide access to the World Wide Web WWW .

Each network configuration e.g. Intranet Extranet VPN Internet and others will have its own data addressing scheme and policies that the customer must maintain and manage. As one of ordinary skill in the art readily appreciates this is not a trivial exercise. Moreover often the customer may desire to have different network configuration interface with one another e.g. an Extranet with an Intranet and the like . This adds a layer of complexity in managing the customer s network configurations since the addressing schemes and policies between disparate network configurations are often not compatible with each other.

As a result customers have turned to Service Providers SPs to manage and outsource the customers networks. To do this a customer s network site uses a customer edge device CE . The CE can be any host computing device and or a routing device for transferring network traffic from the customer s site to the SP. Network traffic occurs as data packets transmitted over a data link e.g. Gigabit Ethernet GigE Frame Relay FR Time Division Multiplexing TDM Asynchronous Transfer Mode ATM and others . The SP receives the data packets at a Provider Edge device PE which is another host computing device and or routing device.

Typically a customer will lease hardware from a SP in order to manage the outsourced network configurations. The SP uses an Internet Protocol IP backbone to interface network traffic to the CE. Further routing tables RIBs and forwarding tables FIBs are uniquely assigned to each of the customer s network configurations in order to effectively relay network traffic within the PE. Thus the SP provisions separate routing devices for the customer to accommodate each of the customer s network configurations. As one of ordinary skill in the art readily appreciates this becomes expensive for a customer especially as the number of network configurations increase at the customer s site.

To address these problems the Internet Engineering Task Force IETF promulgated a standard referred to as Request for Comments RFC number 2547 RFC2547 . RFC2547 defines methods by which a SP with an IP backbone can more efficiently provide VPNs e.g. network configurations for its customers. RFC2547 uses Multiprotocol Label Switching MPLS and Border Gateway Protocol BGP for distributing routes of network traffic over the IP backbone. Each network configuration e.g. VPN occurring within the SP s PE includes a Virtual Routing and Forwarding Module VRFM that has its own unique RIB and FIB for acquiring routes and forwarding data packets. The disparate RIBs between VRFMs exchange routes using BGP. VRFMs enable a VPN exchange using BGP to provide VPN routing. Data between the VRFMs is transmitted as labeled packets over a backbone tunnel.

Yet RFC2547 requires a single unique RIB and FIB for each VPN. Moreover a VPN interface e.g. VPN communication protocol originating from a VPN site that is associated with a VPN exchange communicates with a single VRFM. Thus in RFC2547 each additional VPN interface requires a different instantiation of a VRFM to handle the additional VPN interface. Thus each VRFM can support only one VPN. Furthermore RFC2547 does not address how a VPN site can be enabled to access the Internet. As is readily apparent to one of ordinary skill in the art these limitations impact the scalability of the RFC2547 standard since the mapping between the RIBs FIBs and VPN interfaces are symmetric with the VRFMs. Moreover the features of the VRFMs cannot be distributed to other devices within the SP s PE.

Therefore there is a need for improving existing PE methods and systems so that the features of the RFC2547 standard and other VPN provisioning models can be fully utilized in a scalable fashion with a distributed PE. Such improvements can permit a single CE to communicate with a single PE over a single CE to PE interface channel while using a variety of disparate VPN. With such improvements the VPNs can intercommunicate as desired by the customer within the distributed PE over a single CE to PE interface channel.

According to one aspect of the present invention a distributed Provider Edge PE system is provided. The PE system includes a PE backbone device a Virtual Routing and Forwarding device VRF and a plurality of Virtual Private Network VPN Routing and Protocol Modules VRPs residing on the VRF. The PE backbone includes a data plane and the VRF is associated with a single customer site having a single routing table RIB and forwarding table FIB . Each VRP communicates directly with the RIB and indirectly with the FIB. Moreover each VRP communicates with the PE backbone device through the data plane and each VRP is associated with a single customer VPN.

According to another aspect of the present invention a method to process network traffic on a distributed PE comprising The PE receives a first data packet and the first data packet is associated with a first VPN transaction from a customer site. Also the PE receives a second data packet where the second data packet is associated with a second VPN transaction from the customer site. The first data packet is associated with a first VRP and the first VRP resides on a VRF. Further the second data packet is associated with a second VRP where the second VRP resides on the VRF. The first VRP accesses a single RIB and FIB located on the VRF to acquire first addressing information for the first data packet. The second VRP accesses the RIB and FIB located on the VRF to acquire second addressing information for the second data packet. The VRPs use a data plane associated with the VRF to communicate the first and second data packets to a PE backbone device.

In the following detailed description of various embodiments of the present invention reference is made to the accompanying drawings that form a part hereof and in which is shown by way of illustration specific embodiments in which the invention may be practiced. It is to be understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the present invention.

Various embodiments of the present invention utilize some aspects of the RFC2547 standard and other VPN provisioning modules e.g. Provider Provisioned VPN Framework PPVPN FRMWRK . Moreover BGP is used with various embodiments of the present invention to communicate imported and exported routes acquired from VPN Protocol Instance Modules VRPs e.g. via the RIB to PE backbone devices. The PE backbone devices access tunnels or Internet connections and communicate the routes to other PE systems or Internet routing devices for Internet traffic. Additionally MPLS is used to relay data packets from FIBs to tunnels and vice versa e.g. encapsulation . Of course it is readily apparent that any standard model protocol and or combination of protocols can be used to achieve the teachings of the present disclosure. All such variations are intended to fall within the broad scope of the present invention.

VRPs are unique modules in the present invention that are associated with a single VPN site. They are not directly associated with a VPN interface e.g. PE CE links defined in RFC2547 . Rather a VPN interface is associated with a VRF. Multiple VRPs can reside in a single VRF and share the same RIB and FIB thus enabling multiple VPNs for a VPN interface by making use of a single RIB and FIB at the PE. Conversely RFC2547 does associate a single VPN with a single VRFM and a VPN interface with a single VRFM thereby restricting a VPN interface of a customer to participate in a single VPN. For a customer site to participate in multiple VPNs RFC2547 requires multiple VRFMs and hence multiple RIBs and FIBs.

Moreover the use of the word device in the present disclosure need not be a single physical device since it will be readily apparent to one of ordinary skill in the art upon reading the present disclosure that a plurality of physical devices can be logically associated as a single virtual device. Additionally a normalized interface refers to a standard communication technique e.g. Application Programming Libraries link layer protocols used to communicate between a VRF and a PE backbone device of the present disclosure. The normalized interface can communicate control plane information e.g. routes directly to the PE backbone device and at the same time communicate data plane information e.g. raw data packets indirectly to the PE backbone device.

A VRF of the present disclosure is not restricted to a single VPN site . Multiple VPN sites not shown in can connect to a single VRF as long as each of the VPN sites is participating in same VPN this is consistent with IETF standards. Moreover in the present disclosure multiple VPN sites can connect to a single VRF as long as the VPN site is participating in one of the VPNs enabled by the VRF . In one embodiment of the present disclosure the VRF is associated with a single VPN site the VPN site includes a Customer Edge device CE used to transfer and receive network traffic from the PE system . In one embodiment the CE device is a CE device defined by RFC2547. Moreover the CE device can be used to process all the VPNs occurring at the VPN site . Each VRP e.g. or is associated with a single VPN from the VPN site .

Each VRP e.g. or accesses the RIB of the VRF directly to update e.g. import export routing information associated with a VPN. The VRP e.g. or uses a control interface to a BGP module in order to relay e.g. acquire distribute the routing information to from other PE systems. The VRP e.g. or provides the same functional interface to the BGP module as expected by it from the RIB in RFC2547. The VRP e.g. or by updating the RIB or FIB enables the VRF to receive VPN data from the CE or the PE backbone .

The PE backbone s interface is used by each of the VRPs e.g. and . The interface represents a control plane between the VRPs e.g. and and the backbone . The interface can be message based e.g. asynchronous or implemented as a functional Application Programming Interface API library accessible to both the PE backbone and each of the VRPs e.g. and . The interface can remain consistent with RFC2547 and other IETF standards.

Additionally a data plane interface is used to relay raw data packets from the VRF and the PE backbone . This data plane interface can include an identifier with the relayed data packets that permit the Labeled FIB of the PE backbone to determine which VPN the data packets are originating from. As one of ordinary skill in the art readily recognizes the data plane can enable accounting and other network services e.g. policy based services Network Address Translation NAT services firewall services proxy services and the like for all VPN traffic occurring in the PE system and distinguish between the various types of VPN traffic e.g. determine which VPN requires traffic to have services and policies instituted .

Unlike RFC2547 with the present invention the PE backbone acquires addressing routing information using BGP indirectly from one of the VRPs e.g. or and not directly from a RIB . Additionally multiple VRPs e.g. and are embodied on a single VRF and use the same RIB and FIB . This provides an integrated solution that permits a single VPN site to use a single VRF to participate in multiple VPNs. Moreover VPN interfaces and PE to CE interfaces are associated with the VRF and not the VRPs e.g. and . In fact any routing protocol operational on the VRF can interact with other protocols including each of the VRPs e.g. and indirectly through the RIB by importing and exporting routes. Thus a single protocol instance could be used to provide routing information to the VPN site e.g. at the CE for all VPNs.

Traffic received from the CE and PE system interfaces is used to access the VRF s FIB . If the traffic is outbound traffic then routes are sent to the PE backbone using the interface . And the data packets are sent to the PE backbone using data plane interface . The data packets are sent as labeled packets label stacking can be used to the backbone . Similarly traffic received by the backbone is sent to the VRF as IP packets e.g. not labeled over the interface e.g. routes and data plane e.g. data packets . Data can be forwarded using the VRF s FIB to the VPN site .

The LFIB is used by the PE backbone for forwarding VPN data packets received at the PE backbone . For outbound traffic a labeled entry lookup is performed against the LFIB . The lookup results in the traffic being forwarded on backbone using tunnel . The tunnel provides a path to another PE system and another PE backbone device . The traffic is sent via the tunnel as labeled packets. For inbound traffic the labeled entry lookup in the LFIB results in forwarding the traffic to an appropriate VRF as IP packets e.g. not labeled . Additionally in some embodiments of the present invention a LFIB does not reside on the PE backbone rather a combination FIB LFIB can be implemented on the VRF in this way the PE backbone is not required to do any lookup on received data packets.

As one of ordinary skill in the art now appreciates mapping of multiple VPNs to a single VRF is asymmetrical and unique with the present invention. A control data plane associated with a backbone is used to communicate data packets between the VRF and the backbone . Moreover VPN interfaces and CE to PE interfaces are associated with the VRF and not the VRPs e.g. and . Interactions between the VRPs e.g. and are achieved through the single RIB .

The PE backbone device is interfaced to backbone which includes a first tunnel and a second tunnel . In some embodiments backbone also includes an Internet tunnel . Although as one skilled in the art recognizes the Internet tunnel is actually just an Internet connection since data packets do not need to be labeled with Internet traffic. In this way a FIB can be used in some embodiments within the PE backbone . The tunnels e.g. can be MPLS Labeled Switched Paths LSPs IP Sec or any other tunnel capable of carrying labeled packets. Direct or indirect mapping of VPN routes can be used to route packets to one of the tunnels e.g. . If indirect mapping is used then a LFIB lookup e.g. swap or transform is required for outbound VPN traffic.

The VRPs e.g. and reside on the VRF each VRP e.g. or represents a separate VPN occurring within the VRF . Moreover the VRF communicates with a VPN site having a CE device . The VRF uses a plurality of interfaces associated with the different VPNs and the CE to PE communications to interact with the CE .

Each of the VRPs e.g. and has access to the first and second data planes . Each data plane e.g. and corresponds to data packets associated with a different type of VPN or Internet traffic. The VRPs e.g. and communicate directly with the RIB and indirectly with the FIB to selectively determine which data plane e.g. first or second to use when communicating with the PE backbone device . Control information e.g. routes is sent by the VRPs e.g. and to the PE backbone s control interface .

In one embodiment the first tunnel is a first VPN and the second tunnel is a second VPN. Moreover in some embodiments the first tunnel can be represented as an Internet connection e.g. destined for an Internet routing device on the Internet and the second tunnel is a VPN tunnel. Furthermore in one embodiment the first tunnel is an Intranet tunnel and the second tunnel is an Extranet tunnel. Of course a variety of tunnel communications can also be used with the present disclosure. All such tunnel combinations are included within the broad scope of the present invention. Moreover each tunnel e.g. can have different services enabled or associated with them. For example the Internet connection tunnel can include NAT services firewall services proxy services and the like. In this way the VRF can detect the data plane e.g. or and force the appropriate services or polices required for the received data packets. Additionally if Internet and VPN traffic are using the same services and policies then a data plane can be used to communicate between the PE backbone device and the VRF .

As one of ordinary skill in the art now appreciates various embodiments of PE system can permit a single instance of a VRF to support multiple disparate VPNs through the use of instances of different VRPs e.g. and enabled on the single VRF . Moreover secure Extranet and Intranet communications can be achieved for a single PE system using multiple data planes e.g. and between the VRPs e.g. and and the PE backbone device to select the appropriate tunnel e.g. or . Further a single VRF can support both VPN traffic as well as Internet traffic. The flexible approach of PE system also permits modifications e.g. new instances of VRPs e.g. and or new developed control planes using new identifiers for the data packets to be installed more easily into the PE system when additional tunnels and networks are created needed in the future.

The PE backbone devices e.g. and communicate with a backbone having a first tunnel and a second tunnel . The first PE backbone uses the first tunnel to communicate with the first SP. Similarly the second PE backbone uses the second tunnel to communicate with the second SP.

The VRF uses a plurality of VPN interfaces and CE to PE interfaces to communicate with a VPN Site having a CE . The first VRP is designed to directly access the RIB to acquire route information associated with the first SP. This information is passed along to the first backbone by using interface . Moreover the data packets are relayed to the first PE backbone using a first data plane with an identifier. The identifier is then used to lookup forwarding information in a LFIB . A determination is made that the data packets need to be relayed via the first tunnel associated with the first SP.

The second VRP is designed to directly access the RIB to acquire route information associated with the second SP. This information is passed along to the second backbone by using interface Moreover the data packets are relayed to the second PE backbone using a second data plane with an identifier. The identifier is then used to lookup forwarding information in a LFIB . A determination is made that the data packets need to be relayed via the second tunnel associated with the second SP.

In some embodiments of PE system the tunnels e.g. and communicate with additional PE systems having additional backbones e.g. and or . Moreover outbound traffic destined for one of the tunnels e.g. or is sent as labeled data packets. Inbound traffic received by one of the backbones e.g. or is forwarded to the VRPs e.g. and as IP data packets. Additionally in some embodiments the backbones e.g. and and the VRF are enabled with BGP for importing and exporting routes from the RIB directly and indirectly from the FIB .

PE system permits a single VRF associated with a CE to handle network traffic associated with multiple SPs. This permits a single VPN customer the opportunity to use multiple SP backbone providers. Thus a single customer site can allow multiple participants into a VPN where the multiple participants each use a different SP to connect and communicate with the VPN. Additionally this functionality cannot be provided with RFC2547.

In the first data packet is associated with a first VRP. The first VRP resides on a VRF. The VRF interfaces with a CE at the customer site. Moreover in the first VRP acquires first addressing routing information about the first data packet through a single RIB residing on the VRF. Also the RIB indirectly provides the first VRP with information from a single FIB also residing on the VRF.

In the second data packet is associated with a second VRP. The second VRP also resides with the first VRP on the VRF. Similarly in the second VRP acquires second addressing routing information about the second data packet through the RIB directly and the FIB indirectly e.g. through the RIB . In some embodiments the first and second addressing routing information is acquired by the VRPs by using BGP on the VRF to import and export routing information.

Both VRPs in use a single data plane associated with the VRF and a backbone device to communicate the first and second data packets from the VRF to the PE backbone device. Additionally the PE backbone device can receive backbone data packets from one or more tunnels interfaced to the PE backbone device. In one embodiment these backbone data packets are then located in the PE backbone s LFIB and relayed to either the first VRP or the second VRP via the control data plane.

In one embodiment the association between the data packets and the appropriate VRP is asymmetric and unique. Moreover in some embodiments one or more additional data planes between the VRF and the backbone is provided where each of the one or more additional data planes are associated with a different type of VPN. Some types of VPNs can include Extranets Intranets custom created VPNs and the others. Additionally a normalized Internet access data plane can be provided between the VRF and the backbone to permit Internet traffic with the VPN traffic to be sent via an Internet connection as a non labeled data packet.

Methods and systems detailed provide a distributed PE. These methods and systems create permit the distribution of processing and workload of Virtual Routing and Forwarding to multiple devices by introducing a data plane between a VRF and a PE backbone device. The VRF includes a single RIB and FIB but includes multiple instances of VRPs. Each VRP accesses the RIB and the FIB and communicates routing information via a control plane to the PE backbone device and data packets via the data plane to the PE backbone device.

Furthermore multiple data planes can be instituted to permit integration of disparate networks over the VRF. For example a data plane can be used for Internet communications Intranet communications and or Extranet communications. In this way a single VRF instituting a plurality of VRP instances can use a set of data planes to interface with a PE backbone device. The PE backbone device can then use a plurality of tunnels to communicate with additional PE systems or the Internet.

Moreover a single VRF can be interfaced to two separate PE backbone devices using disparate SPs. This is achieved by having a single VRP instance for each PE backbone device within the VRF. The appropriate VRP uses the VRF s RIB to identify data packets associated with a particular SP. The VRPs then use data planes from the VRF to the appropriate PE backbone device in order to transfer the data packets. The PE backbone device then uses the appropriate SP s tunnel to communicate with the appropriate SP.

Although specific embodiments have been illustrated and described herein it will be appreciated by one of ordinary skill in the art that any arrangement that is calculated to achieve the same purpose may be substituted for the specific embodiments shown. This application is intended to cover any adaptations or variations of the present invention. Therefore it is intended that this invention be limited only by the claims and the equivalents thereof.

