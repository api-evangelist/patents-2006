---

title: Correlation method for monitoring power amplifier
abstract: The invention provides methods and devices for estimating power amplifier nonlinearity using simple correlation techniques. Methods and devices of the invention can monitor a power amplifier that has digitally modulated inputs and an output containing more than one signal stream. A preferred method of the invention creates a test signal by forming the products of several pseudorandom noise sequences from the digitally modulated inputs to the power amplifier. Nonlinear contributions of the power amplifier output are determined by cross-correlating the test signal and the total output signal of the power amplifier. In preferred embodiments, the determined nonlinear contributions of the power amplifier are used to introduce corrective predistortion in the power amplifier.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07652532&OS=07652532&RS=07652532
owner: The Regents of the University of California
number: 07652532
owner_city: Oakland
owner_country: US
publication_date: 20060905
---
Priority is claimed under 35 U.S.C. 119 from prior provisional application Ser. No. 60 714 487 filed Sep. 6 2005.

This invention was made with Government assistance under Army Research Office Contract No. DAAD19 01 1 0496.

A field of the invention is power amplifiers. Embodiments of the invention concern RF and microwave power amplifiers for wireless communications with digitally modulated inputs and outputs having more than one signal stream. The invention may be implemented directly in forward link CDMA systems base stations and can also be implemented in reverse link systems handsets .

Nonlinearities in power amplifier performance can harm performance. In the case of wireless networks nonlinearities in the amplifiers of network stations e.g. cellular base stations can negatively affect the performance of the wireless network being served by the network station. One problem that can be caused by power amplifier nonlinearity is the creation of adjacent channel interference in a wireless communication network. The power amplifier is typically the most nonlinear part of wireless transmitters and its nonlinearity can lead to generation of interference in adjacent frequency channels as characterized by the adjacent channel power ratio ACPR and loss of signal accuracy as characterized by the error vector magnitude EVM . Accurate amplifier nonlinearity characterization is a key step for amplifier linearization synthesis. Receiver nodes can have difficulty decoding communication packets when levels of adjacent channel interference are high.

Bench top and periodic tests are currently done using test pulses. However variances in amplifier performance can be introduced by heat and age of the circuitry. Bench top tests thus fail to account for non linearity that can occur during the operational life of a particular amplifier. Periodic tests may catch life time operational changes and amplifier compensations may be implemented. However periodic tests interrupt the normal operation of amplifiers and degraded performance can occur during a period between periodic tests. Also periodic and bench tests use test signals that may not reveal all non linearities.

Conventional single tone or two tone testing is widely used to extract the amplifier nonlinearity from AM AM and AM PM distortion or intermodulation distortion measurements. See e.g. C. J. Clark et al. Power amplifier characterization using a two tone measurement technique IEEE Trans. Microwave Theory Tech. vol. 48 vol 50 no. 6 pp. 1590 1602 June 2002 A. M. Saleh Frequency independent and frequency dependent nonlinear models of TWT amplifiers IEEE Trans. Comm. vol 29 no. 11 pp. 1715 1720 November 1981 H. Ku et al. Extraction of accurate behavioral models for power amplifiers with memory effects using two tone measurements in IEEE MTT S S Int. Microwave Symp. Dig. vol. 1 pp. 139 142 June 2002 . Employing such measurements the spectral regrowth and constellation distortions of complex digital modulated signals can be predicted by various behavioral PA models. See e.g. S. W. Chen et al Effects of nonlinear distortion on CDMA communications Systems IEEE Trans. Microwave Theory Tech. vol. 44 no. 12 pp. 2743 2750 December 1996 .G. T. Zhou and J. S. Kenney Predicting spectral regrowth of nonlinear power amplifiers IEEE Trans. Commun. vol 50 no. 5 pp. 718 722 May. 2002 K. Gard et al Generalized autocorrelations of spectral regrowth from bandpass nonlinear circuits in IEEE MTT S Int. Microwave Symp. Dig. vol. 1 June 2001 pp. 9 12. However these sinusoidal tone s approaches require special input signals and are generally not applicable for characterization of amplifiers during real time operation.

Alternate adaptive methods with actual code division multiple access CDMA signals have been investigated in both time and frequency domains. While such methods have the advantage of being implemented during amplifier operation it imposes a high computational burden and requires complex hardware. For example others have proposed addressing amplifier linearity by recording the output of the amplifier over a suitable period of time and comparing it with the corresponding input signal after time alignment and scaling. See e.g. S. P. Stapleton et al. Simulation and analysis of an adaptive predistorter utilizing a complex spectral convolution IEEE Trans. Microwave Theory Tech. vol. 41 no. 4 pp. 387 393 November 1992 S. Boumaiza F. M. Ghannouchi Realistic power amplifiers characterization with application to baseband digital predistortion for 3 G base stations IEEE Trans. Microwave Theory Tech. vol 50 no. 12 pp. 3016 3021 December 2002 . The power amplifier output spectrum can be calculated by the fast Fourier transform FFT under operating conditions. This approach is often used in adaptive digital RF predistortion and provides good linearization performance. However high speed and high resolution analog to digital converters ADCs and intensive digital signal processing DSP operation are usually required. Another approach that has been proposed is to directly analyze the spectrum components of output power from amplifiers with a simplified spectrum analyzer like architecture. S. Lee et al. An adaptive predistortion RF power amplifier with a spectrum monitor for multicarrier WCDMA applications IEEE Trans. Microwave Theory Tech. vol 53 no. 2 pp. 786 793 February 2005 . With these techniques hardware complexity is still quite high and hardware components have accuracy requirements.

The invention provides methods and devices using methods of the invention for estimating power amplifier nonlinearity using simple correlation techniques. Methods and devices of the invention can monitor a power amplifier that has digitally modulated inputs and an output containing more than one signal stream. A preferred method of the invention creates a test signal by forming the products of several pseudorandom noise sequences from the digitally modulated inputs to the power amplifier. Nonlinear contributions of the power amplifier output are determined by cross correlating the test signal and the total output signal of the power amplifier. In preferred embodiments the determined nonlinear contributions of the power amplifier are used to introduce corrective predistortion in the power amplifier.

The invention provides methods and devices for estimating power amplifier nonlinearity using simple correlation techniques. Methods and devices of the invention can monitor a power amplifier that has digitally modulated inputs and an output containing more than one signal stream. A preferred method of the invention creates a test signal by forming the products of several pseudorandom noise sequences from the digitally modulated inputs to the power amplifier. Nonlinear contributions of the power amplifier output are determined by cross correlating the test signal and the total output signal of the power amplifier. In preferred embodiments the determined nonlinear contributions of the power amplifier are used to introduce corrective predistortion in the power amplifier.

Preferred methods and devices of the invention can estimate power amplifier nonlinearity without interrupting the normal amplifier operation. The out of band output power and constellation distortion can be predicted by the correlation extraction values. Simple circuits with low hardware requirements are used in preferred embodiments to estimate nonlinearity and introduce corrective predistortion to the power amplifier. Methods and devices of the invention can also be used to conduct periodic and bench tests.

Methods and devices of invention are applicable to power amplifiers with digitally modulated inputs where the output contains more than one signal stream. Methods of the invention are particularly well suited to Direct Sequence Code Divisional Multiple Access systems. For example methods and devices of the invention are applicable to CDMA 2000 or WCDMA systems. The invention can be directly used in forward link CAMA systems base stations which have well defined multiple channels available to simplify adaptive predistortion systems. It is also possible to apply the invention to reverse link applications e.g. handsets in high data rate DS CDMA systems e.g. CDMA2000 and WCDMA. Embodiments of the invention permit implementation of digital or analog low cost and low power circuits in handsets to extract the power amplifier nonlinearity and to correct the amplifier nonlinearity with either digital or analog adaptive predistortion.

In embodiments of the invention non linearities in power amplifier operation of cellular base stations are detected in real time and adaptive circuitry compensates for detected non linearities to improve wireless network performance. Bench top and periodic tests are currently done using test pulses but such techniques do not test actual operational performance of amplifiers in cellular base stations. Embodiments of the invention monitor base station power amplifier operation using actual information signals being handled by the amplifier permitting continuous performance monitoring and corrective compensation. With the invention variances in amplifier performance that can be introduced by the heat and age of the circuitry can be accounted for throughout its operational life. Similarly such variances in the power amplifiers of wireless network nodes e.g. mobile handsets can be accounted for through the operational life and corrective compensation implemented.

Preferred embodiment methods of the invention present a reasonable computational and hardware burden. Correlation is used to determine non linearity and estimate spectral re growth with the nonlinearity between a test signal and the output signal being functions of the input signal. Test signals are generated from actual amplifier signals. For example in preferred embodiments non linearity in the power amplifier of a multi channel DS CDMA system is monitored by correlation between output signals and test signals generated from the baseband CDMA signals.

In an embodiment of the invention nonlinearity and memory effects of a power amplifier are estimated during actual operation and or during a calibration phase. The estimates are then used to control the predistortion of the input signal to the amplifier to achieve a compensation of the amplifier output. The amplifier output envelope is cross correlated with a test sequence generated by forming the product of multiple uncorrelated input sequences to yield estimates of low order nonlinearity coefficients.

Specific preferred embodiments of the invention will now be discussed with respect to the drawings. The drawings include schematic representations of device components which will be fully understood by artisans with reference to the associated description. Embodiments of the invention can be implemented with analog or digital circuitry as well as in software and or firmware. Artisans will also appreciate broader aspects of the invention and additional inventive preferred features from the discussion of the preferred embodiments.

In as in a typical transceiver such as a base station or handset the digital inputs are summed by a summer and up converted by a mixer prior to amplification by the power amplifier . The baseband input signal of the power amplifier is the sum of Sfiltered by a finite impulse response FIR filter after summer and prior to mixer . The filter is a baseband waveform shaping filter and its function is to generate the band limited input signal to PA. For simplicity the FIR is omitted in but is shown in . A local oscillator provides the baseband to radio frequency transformation. The baseband output signal of the power amplifier is a nonlinear transform of the baseband input. Generally it will contain third fifth and sometimes higher order nonlinear contributions depending on the input.

In accordance with the embodiment a signal Sis created by a signal generator by forming the products of Sfor several PN sequences. Sis also a nonlinear function of the baseband input signal to the power amplifier. The nonlinear contributions of the power amplifier output can be extracted by the cross correlation between Sand the total output signal. Vis the baseband total output signal. Vis the linear amplified version of the sum of Splus the nonlinear amplified version of the sum of S and only the nonlinear version is correlated with S namely the amplified version of the sum of S. A cross correlator correlates Sand the total output signal Vout which is provided from a mixer that down converts the output of the power amplifier to extract V. The output of the cross correlator provides an estimate of nonlinearity that can be used to provide predistortion to the power amplifier .

The number of sequences used to estimate the power amplifiers linearity determines the number of orders of non linearity that will be estimated and can accordingly be accounted for by predistortion of the power amplifier . Different Ssequences can be created in order to evaluate the different orders of nonlinearity in the power amplifier output.

An example estimation will be discussed and mathematically analyzed to illustrate the operation of an example embodiment. In the following discussion it is assumed for simplicity of analysis that the amplifier is a quasi memoryless system with no significant memory effects within the modulation bandwidth. The bandpass nonlinearity of amplifiers can be described with a complex power series with odd order only. tilde over tilde over tilde over 1 where tilde over V tilde over V are the complex input and output envelope respectively and tilde over tilde over and tilde over are complex polynomial coefficients. In this example discussion the correlation estimation conducted by the cross correlator in is truncated to a fifth order polynomial. Assessment of these lowest order nonlinearity terms is of primary importance to improve linearity but the method of nonlinearity estimation is easily extended to additional orders by using additional input sequences. The trade off is computational complexity and there is a diminishing benefit for use of additional orders in the nonlinearity estimation.

In the invention the nonlinear dependence of the output Von the input Sis extracted by the correlations of the output Vand appropriately generated test sequences S which are also nonlinear functions of the input. The 3order test sequence S S S Sis used here for analysis simplicity although higher order nonlinearity can also be extracted in principle with higher order test sequences.

The output baseband signal is written by substituting 2 into 1 assuming the nonlinear transfer function of the power amplifier has real polynomial coefficients and for simplicity and the complex extension will be discussed later.

The expansion of the 3and 5order terms in 3 generates expanded terms S S S where i j and k are odd integer numbers with constraints i j k 3 or i j k 5. These terms are called equivalent Sterms because they are proportional to the 3order SPN sequence. The remaining terms are called non Sterms and they are uncorrelated with the Ssequence. The output signal can be written as a function of Sterms and other non Sterms 

where is called the equivalent 3order nonlinear coefficient which is a combination of polynomial coefficients and . C i from 1 to 5 are numerical constants which depend on the input channel number and polynomial order. Their values are determined from the numerical polynomial expansion coefficients for a fifth order nonlinear model with three input channels as shown in 5 .

The focus in the above analysis is the baseband signal processing and it was assumed that the effects of the frequency conversion parts of the transmitter on the correlation method can be ignored when the principal impairments of the modulators or demodulators are compensated by various known methods. See e.g. J. K. Cavers M. W. Liao Adaptive Compensation for Imbalance and Offset Losses in Direct Conversion Transceivers IEEE Trans. Technology vol. 42 pp. 581 588 November 1993 M. Windisch G. Fettweis Adaptive I Q Imbalance Compensation in Low IF Transmitter Architectures IEEE Vehicular Technology Conf. Dig. vol. 3 pp. 2096 2100 September 2004 .

where L is the sequence length and m is the offset index. Substituting 4 into 6 6 can be rewritten as 

The maximum cross correlation value occurs at zero offset position by PN sequences correlation properties.

The dominant term in 8 is the square of the Sterm other terms will be averaged to zero and the maximum value is proportional to .

In practical transmitters the PN sequences will pass through a finite impulse response FIR waveform shaping filter before up conversion. The analysis of this case is very similar to the case without a filter as discussed before. The difference is that the input is a summation of several filtered PN sequences as shown in 9 .

With regard to 9 the cross correlation of the output baseband signal and the Ssequence with an input FIR baseband filter can be derived. As shown in 9 the baseband input is a summation of three filtered PN sequences. Substituting 9 into 1 the output signal is written as 

Similarly the expansion of 9.1 generates Sterms and other non Sterms. There are many potential candidates for Sterms after the expansion. For example the 3order Sterms can be any of the form 9.2 .

where j from 0 to j is the offset delay. The coefficients of these Sterms are proportional to the filter s coefficients . To achieve the maximum signal power in correlation operation the optimal Stest sequence is selected as 9.3 .

The maximum correlation value occurs at a non zero offset position and is also proportional to as shown in 10 .

As a result of the partial correlation of two PN sequences other terms in 8 are not averaged to zero but to some estimation variance. A signal to noise ratio SNR formula can quantify the estimation accuracy. Among the baseband output as shown in 4 the signal is defined as the terms correlated with Ssequence and noise is defined as those terms uncorrelated with Ssequence. The signal power is the square of the coefficients of Sterm and the noise power is the variance of non Sterms and the ratio is denoted by SNR which represents the SNR before the correlation operation.

The PN sequences are assumed to be truly random for simplicity which means each element of the sequences is independent of each other and similar results can be achieved using other types of shift register generated PN sequences.

where G in dB 10 log L is the processing gain due to the correlation. The SNRis improved compared with SNRsince the noise power is reduced by the correlation. It can be seen from 12 that SNRdepends on the sequence length the ratio of polynomial coefficients and numerical constants that depend on the channel number of the input signal. illustrates the dependence of SNRupon the sequence length of sequences used to form the test signal S. For example if it is assumed that the values of C i from 1 to 5 are of same order and the a which is much less than and is ignored 12 can be approximated as 

To achieve better SNR the linear part of output signal proportional to should be cancelled out since it is uncorrelated with the Ssequence and contributes noise power in our correlation estimation method.

The peak correlation occurs at a particular offset position for a given baseband filter. shows that SNRdegrades as the time misalignment increases between the output signal and Ssequence from the optimal offset position. The filter considered herein is a standard IS 95 48 tap FIR filter.

The previous analysis can be extended to the complex baseband input signal case. The input signal in its rectangular format is 14 .

where I and Q are in phase and quadrature signals which are each the summation of several PN sequences. Substituting 14 into 1 for nonlinearity extraction purpose the nonlinear in phase portion of the output signal with odd order higher than or equal to three can be written as 2 2 15 .

where and are the real and imaginary part of the complex coefficients tilde over n equal to 1 3 and 5 respectively. The equivalent complex nonlinear coefficients can be extracted by correlation of Vand in phase or quadrature Ssequences. Max Max 16 

where Cand Care numerical constants. The maximum power correlation value Pis defined as the sum of the squares of the real and imaginary extracted coefficients i.e. tilde over tilde over 2tilde over tilde over 17 .

The 1 3 and 5coefficients were then extracted by the correlations of the simulated model output and different order Ssequences. Using these extracted coefficients AM AM and AM PM polynomial fitting curves were reconstructed as shown by dash dot curves in . The matching between measured in simulation and correlation extracted curves is good around the average input power.

Spectral regrowth can be estimated from amplifier nonlinearity together with input signal characteristics using statistical analysis. The time averaged autocorrelation of the output envelope tilde over R can be described as a function of the input autocorrelation tilde over R with different orders 18 

where tilde over R is the complex conjugate of tilde over R and P P and Prepresent the coefficients of different orders of the input autocorrelation. Pand Pare functions of the complex polynomial coefficients and Pis tilde over tilde over 2tilde over tilde over 19 .

K and Kare constant numbers for a given input signal and their detailed derivation is known in the art.

The output power spectrum is the Fourier transform of the output autocorrelation tilde over R . The same simulation setup as was used and the normalized Fourier transform of the 3and 5order input autocorrelation in 18 is shown in . It can be seen that the adjacent and alternate channel leakage power is due to the 3and 5order nonlinearity. The out of band power is largely proportional to Pand Prespectively since they are the coefficients of different orders of the input autocorrelation in 18 .

Comparing 19 with 17 the conclusion can be drawn that both the out of band power and the maximum power correlation values have very similar dependence on the polynomial coefficients. This is a fair indication that the correlation values are excellent indicators of the system nonlinearity and spectral regrowth.

PA nonlinearity is a major contributor to the error vector magnitude EVM of most transmitters illustrates the error vector magnitude of a transmitter. Point A is the ideal symbol or chip position and point B is the actual measured position in a complex modulation plane. The vector difference between points A and B is the error vector and root mean square rms EVM in 20 is usually described as the percentage value of the rms value of error vector magnitude normalized to the rms value of the ideal symbol magnitude.

The EVM calculation procedure for DS CDMA signals used herein is as follows. The sampled input signal at chip time is used as the reference vector and the sampled output signal at chip time after linear gain scaling and constant phase rotation is used as the measured vector. The difference between them is the error vector which is due to the 3and 5order nonlinearity of the polynomial PA as shown in . The squared magnitude of the error vector can be written as a quadratic function of the nonlinear coefficients Err tilde over tilde over 2 tilde over tilde over 21 

where K and K are constant numbers for a given input signal which depend on the magnitude of the input reference vectors. Comparing 21 with 17 the conclusion can be drawn that both the squared magnitude of error vector and the 3order maximum power correlation value have very similar dependence on the polynomial coefficients.

Power sweep simulation measurements were also made and the experimental test environment is shown in . The baseband input signals were generated with MATLAB and downloaded to an Agilent ESG waveform generator as the RF input to the PA under test. The PA is the same Intersil ISL3990 PA used in simulations. The baseband output signals were collected by an Agilent PSA spectrum analyzer and VSA vector signal analyzer which have large enough bandwidth and linear dynamic range to ignore their nonlinearity contributions. The PA s equivalent nonlinearity characteristics were changed by using a baseband polynomial predistorter PD implemented in MATLAB.

Predistortion simulation testing was also conducted. shows that the ACPR was improved by experimental minimization of the correlation values. The output signals after predistortion have smaller correlation values and better ACPR than before predistortion.

The three dimension contours of EVM rms and power correlation values in linear scale vs. the predistorter s coefficient tilde over b are respectively shown in . The similarity of these characteristics confirms the preceding analysis.

The simulations show that the straightforward correlation techniques of the invention can estimate the nonlinearity of a power amplifier in a wireless transmitter and predict the spectral regrowth and constellation distortion with actual multi channel DS CDMA signals. Preferred methods and devices of the invention estimate power amplifier nonlinearity and apply corrective predistortion in real time during normal operation of the power amplifier and a transceiver circuit including the power amplifier.

While specific embodiments of the present invention have been shown and described it should be understood that other modifications substitutions and alternatives are apparent to one of ordinary skill in the art. Such modifications substitutions and alternatives can be made without departing from the spirit and scope of the invention which should be determined from the appended claims.

