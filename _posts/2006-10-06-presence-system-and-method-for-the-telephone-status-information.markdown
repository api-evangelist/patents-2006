---

title: Presence system and method for the telephone status information
abstract: A system for presenting telephone state information includes a presence server ; a presence client end  and a presence contact end  which are respectively connected with the presence server  and communicate with each other through the presence server ; a user telephone line monitoring device , used for monitoring the state of the user telephone line , and sending the monitored state to the presence client end . Wherein, the presence contact end  is used for displaying presence information of a corresponding telephone state of the presence client end  it subscribed. The present invention also provides a method for presenting telephone state information. Through the invention, a client can inform his/her telephone state information to the contacts in time. The system and method do not depend on special telephone switch, and have a low cost, can be used in any area.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08438213&OS=08438213&RS=08438213
owner: Tencent Technology (Shenzhen) Company Ltd.
number: 08438213
owner_city: Shenzhen
owner_country: CN
publication_date: 20061006
---
The present invention relates to network communication technologies and more particularly to a system and a method for presenting telephone state information.

Presence service refers to a service that makes the state of a service presence client visible to a selected presence contact so as to make it possible for the contact to choose appropriate communication means time and communication service of his her own. Presence information refers to the current state of a presence client including online offline busy idle etc. The state e.g. online or offline can be obtained through detecting a network connection between a presence server and a presence client end. The state can also be configured by a client who uses the presence client end e.g. be configured to be in a meeting etc. The state still can be obtained through detection by a presence client end software. For example if the client end software has not detected any information inputted by the client for a period of time it sets the presence information of the client as leaving. A Presence contact refers to a presence client who has subscribed presence information of another presence client. For the presence client whose presence information has been subscribed by other presence client the other presence client is called a contact . The presence service has been integrated into various Instant Messaging IM software programs.

As shown in a conceptive model of a presence system includes three components a presence server a presence client end and a presence contact end. The presence server includes a hardware device and software for providing a presence service. The presence client end includes a terminal equipment and software used to log in the presence system for a presence client. The presence contact end includes a terminal and a software program used to log in the presence system for a presence contact. It should be noted that to make the description convenient the presence client end and the presence contact end are described separately. Whereas in practical presence services the presence client and the presence contact tend to be contacts to each other and they run the same software program.

Before obtaining the presence information of a presence client a presence contact must subscribe for the presence information of the presence client from the presence server. The presence server adds the presence client to a presence information subscription list of the presence contact after authentication. When the state of the presence client changes the presence server can obtain the state information of the presence client through various methods including 

1 monitoring a communication interface between the presence server and the presence client end by the presence server e.g. monitoring whether the presence client has logged on the client end software etc. 

2 configured by the presence client his her own e.g. configured to be in a meeting and reported to the presence server by the presence client 

3 monitored by the presence client e.g. if the client software has not detected any input from the presence client for a period of time the client end software configures the presence information of the presence client as leaving and reports the state information to the presence server through the presence client end.

Upon detecting the change of the presence state of the presence client the presence server distributes presence information to the presence contact who has subscribed for the presence information of the presence client. Upon receiving the presence information the presence contact end correspondingly changes the presence information of the presence client displayed on a terminal interface e.g. changes the presence information from online to busy .

Through the above mentioned techniques in the current presence system a client can make it convenient for his her contact to see various state information configured by the client or detected by a computer. So that the contact can arrange communication manner and communication time according to the state information.

Whereas traditional telephone still plays a very important part in people s everyday life and work and it is a main communication means for people. A telephone client also expects to let his her telephone state information known by his her contact therefore the contact can choose a corresponding communication mode and time according to the telephone state of the client when calling the client. Thus the contact may not call the client when the client is busy according to the telephone state of the client.

If the presence system does not have the ability of providing telephone state information a presence contact cannot know the telephone state of a presence client. Thus when needs to call the client the contact often encounters a busy telephone line. If the contact does not know when the client s telephone will be idle he can only dial for many times which wastes a lot of time and energy.

To solve this problem a solution on basis of a telephone switch is proposed to implement the presence service of the telephone state information. As shown in the solution is implemented through modifying the program of the telephone switch. Upon detecting a change on the telephone state the telephone switch sends a notification of telephone state change information to the presence server. And the corresponding presence server has been configured with data related to the telephone state information. Upon receiving the notification of the telephone state change information the presence server looks for the presence client information corresponding to the telephone number modifies the presence information related to the telephone state and distributes the telephone state change information to the contact who has subscribed for the presence information of the client.

In this solution the program of the telephone switch needs to be modified that is to say to implement a presence service of the telephone state information a large scale telephone switch reconstructions must be performed by telecommunication operators or vendors.

The reconstruction of the switch cannot be implemented in a short time so that a client can only enjoy the service in an area where the reconstruction is finished once leaving the area the client cannot use the service any more i.e. the client cannot present the telephone state to his her contact.

The present invention provides a system and a method for presenting telephone state information so as to implement a telephone state presence service which is independent of a telephone switch therefore there is no need to reconstruct the telephone switch which brought out a lower cost.

The present invention provides a system for presenting telephone state information including a presence server a presence client end a presence contact end a user telephone line monitoring device wherein the presence client end and the presence contact end are respectively connected with the presence server and communicate with each other through the presence server the presence contact end is used for displaying presence information of a corresponding telephone state of the presence client end subscribed by the presence contact end the user telephone line monitoring device connected between a user telephone line and the presence client end includes a telephone interface a monitoring device a state signal processing device a monitoring interface wherein the telephone interface the monitoring device the state signal processing device and the monitoring interface are serially connected the monitoring device is used for monitoring the state of the user telephone line connected with the telephone interface and sending the monitored state to the state signal processing device the state signal processing device is used for analyzing the state sent by the monitoring device and generating corresponding telephone state information sending the generated telephone state information to the presence client end connected with the monitoring interface via the monitoring interface .

Wherein the presence server includes a state information database a presence information subscription database an information processing device a communication interface wherein the state information database is used for storing telephone state information of the presence client end the presence information subscription database is used for storing a presence information subscription relationship between the presence client end and the presence contact end and the information processing device is connected with the communication interface the state information database and the presence information subscription database used for receiving telephone state information from the presence client end via the communication interface updating the telephone state information in the state information database searching for a corresponding presence contact end according to the presence information subscription database and distributing the telephone state information to the found presence contact end via the communication interface .

Wherein the state information database and the presence information subscription database are one database physically.

Wherein the presence client end includes a monitoring information processing device a monitoring interface a communication interface wherein the monitoring information processing device is connected with the monitoring interface the communication interface respectively used for receiving telephone state information from the user telephone line monitoring device and sending the received telephone state information to the presence server via the communication interface .

Wherein the presence contact end includes a communication interface a presence information processing device wherein the presence information processing device is connected with the communication interface used for receiving telephone state information from the presence server via the communication interface and displaying the presence information of the telephone state information.

Wherein the presence server the presence client end and the presence contact end further include modules for implementing an Instant Messaging IM function.

The present invention provides a method for presenting telephone state information including a user telephone line monitoring device monitoring the state of a user telephone line generating corresponding telephone state information according to the current state and sending the generated telephone state information to a presence client end the presence client end receiving the telephone state information and sending the received telephone state information to a presence server the presence server receiving the telephone state information and sending the received telephone state information to a presence contact end that has subscribed for the telephone state information the presence contact end receiving the telephone state information and displaying presence information of the telephone state information.

Wherein before generating corresponding telephone state information according to the current state the method further includes the user telephone line monitoring device determining whether the state of the user telephone line has changed if the state of the user telephone line has changed proceeding to the following steps otherwise returning to the step of monitoring the state of the user telephone line.

Wherein the state of the user telephone line comprises an electronic feature of the user telephone line.

Therefore a presence client can transmit his her telephone state information to his her contact when a contact initiates a call to him her a corresponding communication mode and time can be chose to save time and energy.

In addition the user telephone line monitoring device connected with the user telephone line does not depend on the telephone switch. Compared with the reconstruction of the telephone switch the cost can be greatly reduced. Besides since the monitoring of the user line does not depends on the telephone switch the problem that the client cannot use the presence service once he she leaves the reconstructed area can be solved. The present invention can be applied in any area whether it has been reconstructed or not.

The present invention will be described in detail hereinafter with reference to accompanying drawings and embodiments of the present invention.

Referring to a system for presenting telephone state information in accordance with an embodiment of the present invention includes a presence server connected with a presence client end and a presence contact end respectively and implements interconnection for the presence client end and the presence contact end the presence client end the presence contact end a user telephone line monitoring device connected with the presence client end and provides telephone state information for the presence client end and a user telephone line refers to a user line provided by a telephone switch for accessing the telephone connected with the user telephone line monitoring device and its state is monitored by the user telephone line monitoring device .

Referring to at the same time the presence server includes an information processing device a state information database used for storing user telephone state information a presence information subscription database used for storing a presence information subscription relationship between the presence client end and the presence contact end and a communication interface connected with the presence client end and the presence contact end .

The information processing device is used for performing the following tasks receiving state information of a monitored telephone from the presence client end via the communication interface searching modifying or storing telephone state information corresponding to a client logging in the presence client end in the state information database searching the presence information subscription database for a contact corresponding to the client logging in the presence client end storing a subscription relationship in the presence information subscription database distributing telephone state information to the presence contact end which has subscribed the telephone state information of the client via the communication interface .

The state information database can be implemented by relation database technology. Relation database software can be installed in the presence server and an Application Programming Interface API provided by a relation database manufacture can be adopted as well. Generally a Structured Query Language SQL is adopted as an interface program to manage the contents of the database in the relation database. The following contents shown in Table 1 are stored in the state information database 

Similarly the same relation database technology the same API and the same SQL which are adopted by the state information database can also be adopted by the presence information subscription database the following contents shown in Table 2 are stored in the presence information subscription database 

The state information database and the presence information subscription database can be combined into one database adopting the same API and the same SQL the following contents shown in Table 3 are saved in the combined database 

Referring to at the same time the presence client end refers to a terminal and software running in the terminal providing presence terminal functions for a presence client.

The presence client end includes a monitoring interface connected with the user telephone line monitoring device used for receiving telephone state information from the user telephone line monitoring device a monitoring information processing device used for processing telephone state information received from the user telephone line monitoring device it receives telephone state information via the monitoring interface and transmits the received telephone state information to the presence server via a communication interface and the communication interface connected with the presence server .

Referring to along with all the other Figures the presence contact end refers to a terminal and software running in the terminal providing presence terminal functions for one or more contacts of a presence client. The presence contact end includes a communication interface connected with the presence server and a presence information processing device used for receiving telephone state information related to the presence client end from the presence server displaying the telephone state information on a terminal interface provided by the client.

Wherein the communication interfaces between the presence server and the presence client end and the presence contact end generally adopt interfaces on basis of an Internet Protocol IP network and have their respective IP address. The presence server opens a service interface based on Transmission Control Protocol TCP or User Datagram Protocol UDP . The presence client end and the presence contact end are connected to the service interface provided by the presence server through the corresponding TCP or UDP and establish connections with the presence server after a necessary authentication. After the establishment of the connections the presence server can send data to and receive data from the presence client end or the presence contact end via the corresponding connection. The detailed implementation of this type of IP based communication interface belongs to existing technologies in the computer network communication field which will not be described herein.

In practical applications a client end is usually required to have the function of the presence client end and that of the presence contact end simultaneously i.e. the client subscribes a presence service and being subscribed by other clients at the same time. The client not only receives his her described presence information but also sends presence information to the presence server and then the presence server forwards the presence information to other subscribers. In addition the presence client end and the presence contact end can be computers Personal Digital Assistants PDAs mobile phones or other devices. Computer is taken as an example in a preferable embodiment of the present invention.

Other modules also can be added to the presence server the presence client end and the presence contact end according to practical requirements. For example when used for Instant Messaging IM services modules for implementing an IM function can be added.

Referring to at the same time the user telephone line monitoring device refers to an electronic device connected with the telephone line it includes a telephone interface connected with the user telephone line a monitoring device used for monitoring the state of the user telephone line a state signal processing device used for processing the telephone signal monitored by the monitoring device and a monitoring interface connected with the presence client end .

The state signal processing device determines the type of the change of the user telephone line state monitored by the monitoring device generates telephone state information and sends the telephone state information to the presence client end through the communication interface between the presence client end and the state signal processing device .

The monitoring interfaces between the presence client end and the user telephone line monitoring device can be implemented on basis of computer interface technologies. When the user telephone line monitoring device is a separate device outside the presence client end the interfaces can be a wireline interface such as Universal Serial Bus USB interface parallel interface serial interface interface or can be a wireless interface such as infrared Bluetooth Wireless Local Area Network WLAN etc. When the user telephone line monitoring device is a module e.g. an inserted card inside the presence client end the interfaces can be a computer bus interfaces such as Industry Standard Architecture ISA interfaces Peripheral Computer Interconnect PCI interfaces or can be other interfaces on computer such as USB interfaces parallel interfaces serial interfaces etc. Besides the interfaces between the presence client end and the user telephone line monitoring device corresponding drivers are required to implement communication through the interfaces. The implementation of the interfaces and their drivers are existing technologies in the computer field there are a large number of practical product applications and hardware components which will not be described herein. Through the interfaces between the presence client end and the user telephone line monitoring device and the drivers of the interfaces the presence client end and the user telephone line monitoring device can communicate with each other thereby implementing transmission and reception of the user telephone line state change signal.

The user telephone line monitoring device has the telephone interface connected with the user telephone line . The telephone interface can be a RJ11 interface. Through the telephone interface the user telephone line monitoring device is connected to the user telephone line .

The user telephone line monitoring device has a function of monitoring the state of the user telephone line . The principle is that the electronic feature of the user telephone line is different under different states. Therefore the user telephone line monitoring device can determine the state of the user telephone line . Taking the telecommunication network in China based on a digital program controlled switch as an example corresponding relationships between the states and the electronic features of a user telephone line include 

i.e. a state without an incoming call or an outgoing call and the telephone being hang on normally. In a common telephone system a switch provides approximate 48V direct current for a user telephone line in the idle state and the current is less than 5 A.

i.e. a state when the user initiates a call or receives a call. In a common telephone system a telephone switch provides a direct current of approximate 10 to 20V for a user telephone line in the calling state. And an audio signal behaves as a large fluctuating current is added on the voltage.

To meet the requirement of a charging telephone such as a public coin telephone a modern telephone switch may provide a connected state for a user telephone line.

A polarity reversal signal is a charging signal provided by a switch when a call is connected and the called party picks up the phone the positive and the negative polarities in the user telephone line are reversed.

In addition an electronic line with a more powerful function is developed to monitor various states as follows 

When a user picks up the phone the switch will send a dialling indication tone of a certain frequency to the phone of the user indicating the user to input a telephone number.

After the user finishes inputting the telephone number the switch will send a ringing back tone with a certain frequency and interval to the calling party when ringing the called party.

When a user is called an alternating current signal with tens of volts is added to the user telephone line then the telephone is ringing.

According to the above mentioned different electronic features of a user telephone line in different states an electronic device for monitoring the state of a user telephone line can be developed. This kind of electronic devices is popularly applied and have a lot of products e.g. SS173K222AL produced by the TDK company it is a highly integrated Single Chip Machine SCM programming MODEM chip and possesses functions of call procedure carrier response tone and long loop detection it can also generate Double Tone Multiple Frequency DTMF signals by programming. The SS173K222AL chip has four 8 bit registers for monitor which are CR0 CR1 DR TR. Wherein the DR is used for monitoring working state. And the current state of the user telephone line can be obtained by monitoring the content of the DR Register.

An implementation based on a USB interface in accordance with an embodiment of the present invention is given hereinafter 

The user telephone line monitoring device is a device with three interfaces the monitoring interface connected between the user telephone line monitoring device and the presence client end is implemented by a USB interface. Two RJ11 telephone interfaces are set one of them is connected to a telephone socket connected with the switch and the other is connected to the telephone. Inside the user telephone line monitoring device the above mentioned SS173K222AL chip is adopted to implement an SCM based control program the monitoring device and the state signal information processing device which are based on telephone chips. When a presence client uses the telephone the DR register in the SS173K222AL chip changes and sends an interrupt to the SS173K222AL chip. And the SS173K222AL chip drives the USB interface to send a data packet of a user telephone line change notification to the presence client end .

Correspondingly based on the telephone state information presence system in accordance with the embodiments of the present invention an implementation method for providing telephone state information is also provided the process of a presence client providing telephone state information for his her contacts includes the following steps 

 2 the user telephone line monitoring device detects the change of the electronic feature of the user telephone line e.g. a change from a electronic feature corresponding to the idle state to that corresponding to the connected state 

 3 the user telephone line monitoring device generates corresponding telephone state information e.g. state calling according to the current electronic feature of the user telephone line 

 4 the user telephone line monitoring device sends the generated telephone state information to the presence client end via the communication interfaces connected between the user telephone line monitoring device and the presence client end 

 5 upon receiving the telephone state information the presence client end sends the received telephone state information to the presence server via the communication interfaces connected between the presence client end and the presence server 

 6 upon receiving the telephone state information the presence server searches the state information database for the telephone state information corresponding to the client logging on the presence client end if the telephone state information of the client logging on the presence client end is existed modify or update the telephone state information of the client logging on the presence client end otherwise store the telephone state information of the client logging on the presence client end in the state information database at the same time search the presence information subscription database for the contact who has subscribed the presence information and logged on the presence contact end 

 7 the presence server distributes the telephone state information to the discovered one or more contacts via the communication interfaces connected between the presence server and the presence contact end .

 8 upon receiving the telephone state information the presence contact end displays the telephone state information on a terminal interface Wherein various presence state information can be expressed with different icons or colours for the presence information shown in the icon marked with 100 expresses that the telephone is in a idle state the icon marked with 200 expressed that the telephone is in a connected state. And the icon marked with 100 can be coloured with blue while the icon marked with 200 can be coloured with red.

