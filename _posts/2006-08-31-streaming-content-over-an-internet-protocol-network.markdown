---

title: Streaming content over an internet protocol network
abstract: Described herein are embodiments that facilitate the streaming of content over an Internet Protocol (IP) network, transparently, in a Network Address Translation (NAT) environment or a non-NAT environment. In one embodiment, there is provided a method for streaming content over an Internet Protocol (IP) network by a content provider having a content control server and a content-streaming server, the method comprising: the content control server receiving a first request from a destination for a content-streaming session; the content control server setting up the content-streaming session in response to the first request; the content-streaming server receiving an upstream message from the destination to establish communication between the content-streaming server and the destination in accordance with the set-up content-streaming session; the content control server receiving a second request to initiate streaming of the content for the set-up content-streaming session; and the content-streaming server streaming the content to the destination in response to the second request.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07788394&OS=07788394&RS=07788394
owner: General Instrument Corporation
number: 07788394
owner_city: Horsham
owner_country: US
publication_date: 20060831
---
Video on Demand VOD systems allow users to interactively select and watch video content over a network at any time desired or demanded by the users. The video content is either a streamed to a set top box whereby viewing is allowed while the video content is being downloaded or b downloaded to the users whereby an entire program is downloaded to the set top box before viewing is allowed. As referred herein a set top box STB is a device that connects to a content player a viewing device or a display e.g. television monitor and the like and some external source of signal and turns the signal into video content for display or presentation on the viewing device. The STB may receive the signal over the air e.g. via an off air antenna or satellite dish or from a wired connection e.g. via coaxial cable telephone line or the like whereby the signal is provided by an external source such as a broadcast television station cable television provider satellite television provider or any other content provider or distributor.

Traditional VOD systems employ signaling between the STB and a VOD command and control server to navigate VOD content purchase movies and control the playback of a VOD session. Thus there is no direct messaging between the set top and the video pump that actually provides streaming content to the STB. The VOD command and control server receives the session information from the server administrator or an end user and instructs the video pump how to address the VOD content for the streaming session. The video pump typically uses a User Datagram Protocol based UDP based protocol such as Real time Transport Protocol RTP or Moving Picture Experts Group MPEG over UDP to stream the VOD content through an Internet Protocol IP network in accordance with the destination IP address and UDP port provided by the VOD command and control server which the video pump uses to fill in the information in the IP header destination fields of the IP datagrams or packets of the VOD content.

As referred herein a VOD headend server is a VOD command and control server that provides metadata navigation session management and access or playback control e.g. pause play fast forward fast rewind stop of the VOD content streaming from a video pump as commanded by the VOD command and control server or the user s STB. As also referred herein a video pump is a VOD streaming server that formats and organizes the VOD content received from one or more content servers into data streams for feeding into a network for distribution to the individual end users who are individuals or any other entities that purchase subscribe or are authorized to request or demand access to the VOD content from a content provider. Thus the VOD headend server and the streaming server are typically maintained by such a content provider distributor MSO or telephone company.

In traditional cable TV based VOD systems the video pump and receiving STB are instructed to tune to a particular RF channel and use certain keys to encrypt and decrypt the content. The VOD content is not addressed to the requesting STB. The video pump and the network between the video pump and the VOD content requesting STB will cause the content to be potentially accessible by a plurality of STBs in a region that includes the VOD content requesting STB. Only one STB in that plurality will know a which frequency to tune to and b what key s to use to decrypt the content such that only the VOD content requesting STB will be able to provide the VOD content in the clear to the viewer s presentation device such as a television or stereo. This changes with the introduction of a home centralized gateway device.

Many content providers are moving toward the use of an integrated centralized gateway device in the home to provide their customers or subscribers with multiple different communication services such as telephone Internet and television services. They see such an integrated centralized home gateway as an opportunity to provide different data services to different home devices in an efficient manner. Accordingly there have been recent introductions of home gateway devices in the form of Internet Protocol based IP based multimedia routers that support Network Address Translation NAT to provide connections to different home devices from a single assigned public IP address.

The introduction of the aforementioned centralized home gateways with NAT support poses a technical challenge for set top services that typically receive streaming video over UDP IP. When the VOD content requesting STB sends a request for VOD content upstream the packets travel from the STB through the centralized home gateway through the network and to the command and control VOD server. As the packets travel through the centralized home gateway it stores the destination address of those packets. In this way when the command and control VOD server sends packets downstream to the STB the centralized home gateway recognizes the source address of those packets and allows them to pass into the local home network. The STB however never sends packets directly to the video pump providing it with VOD content. Thus when the video pump begins transmitting VOD content down to the STB the source address of that content is not known to the centralized home gateway. It therefore determines that those packets of VOD content are not for this home and are not passed onto the local home network.

In an IP based network delivery of content such as VOD it is desired to have a method for streaming such a content to a receiver such as a STB regardless of whether there is an intervening NAT enabled device or whether there is prior knowledge of the NAT type or variation employed by such a device. Accordingly described herein are methods and systems for streaming content such as VOD over IP to a receiver such as a STB that is applicable in both a NAT environment and a non NAT environment.

In one embodiment of the present invention there is provided a method for streaming content over an Internet Protocol IP network by a content provider having a content control server and a content streaming server the method comprising the content control server receiving a first request from a destination for a content streaming session the content control server setting up the content streaming session in response to the first request the content streaming server receiving an upstream message from the destination to establish communication between the content streaming server and the destination in accordance with the set up content streaming session the content control server receiving a second request to initiate streaming of the content for the set up content streaming session and the content streaming server streaming the content to the destination in response to the second request.

In another embodiment there is provided a system for streaming content over an Internet Protocol IP network comprising a content control server operable to set up a content streaming session for streaming the content a content streaming server operable for streaming the content in accordance with the content streaming session and a receiver operable to request the set up of the content streaming session by the content control server and to initiate contact with the content streaming server for bi directional communication with the content streaming server.

In still another embodiment there is provided a computer readable medium on which is encoded program code for facilitating streaming of content over an Internet Protocol IP network the program code comprising program code for requesting a content streaming session over the IP network from a content control server so as to receive a streaming of a requested content program code for initiating a contact message over the IP network to a content streaming server upon set up of the content streaming session by the content control server wherein the content streaming server is designated by the set up content streaming session and wherein the contact message is for establishing bi directional communication with the content streaming server program code for requesting the streaming of the requested content from the content control server and program code for receiving the streaming content from the content streaming server in response to the program code for requesting and in accordance with the established bi directional communication.

For simplicity and illustrative purposes the principles of the embodiments are described by referring mainly to examples thereof. In the following description numerous specific details are set forth in order to provide a thorough understanding of the embodiments. It will be apparent however to one of ordinary skill in the art that the embodiments may be practiced without limitation to these specific details. In other instances well known methods and structures have not been described in detail so as not to unnecessarily obscure the embodiments.

Throughout the present disclosure discussions are made with reference to VOD content. However it should be understood that such discussions are also applicable to any media content that is requested or demanded by an end user. Examples of media content include audio video or textual content or any combination thereof. Thus for example VOD headend servers are specific examples of content command and control servers for VOD session management and VOD streaming servers or video pumps are specific examples of content streaming servers for streaming VOD to the users.

As referred herein a server is a computer or network of computers. Examples of a server include but are not limited to one or more desktop computers one or more laptop computers one or more mainframe computers one or more networked computers one or more processor based devices or any similar types of systems and devices. Thus a server includes one or more processors of any of a number of computer processors such as processors from Intel Motorola AMD and Cyrix. Each processor is coupled to or includes at least one memory device such as a computer readable medium CRM . The processor is operable to execute computer executable program instructions stored in the CRM such as program code of applications to run the applications. The computer executable program instructions include code from any suitable computer programming language such as C C C Java or the like. Embodiments of a CRM include but are not limited to an electronic optical magnetic or other storage or transmission device capable of providing a processor of the server with computer readable instructions. Other examples of a suitable CRM include but are not limited to a floppy disk CD ROM DVD magnetic disk memory chip ROM RAM an ASIC a configured processor any optical medium any magnetic tape or any other magnetic medium or any other medium from which a computer processor is operable to read instructions.

As also referred herein a network of devices such as computers provides communication connections between the devices in the network via one or more communication protocols. For example an IP network facilitates communication between devices in such a network using IP Internet Protocol which is a well known communication protocol.

The video pump is operable to a receive the upstream message from the STB b obtain therein the translated set top IP address and UDP port number of the destination STB c verify that the session ID or some other given payload information included in the upstream message corresponds to the session established for that particular STB by the VOD headend server d send an acknowledgement to a VOD application in the STB that initiated the VOD session that the upstream message was successfully received and e stream the on demand content using the translated IP address and UDP port number that was obtained once it receives a start streaming command from the VOD headend server .

Each residence contains an integrated centralized gateway device in the form of a multimedia router that supports some implementation of NAT. As noted earlier common protocols for streaming IP based video are RTP or MPEG over UDP. Each residence also includes a LAN for connecting one or more home devices via IP STBs receivers decoders or subscriber terminals as needed. VOD messaging to access or control the streaming content from each home device is transmitted from a VOD application in each STB through the home LAN to the centralized home multimedia router which forwards it through a router to the IP network for transmission to the VOD headend office and onwards to the one or more VOD headend servers therein.

A common characteristic of the aforementioned receiver functions is that it is desirable to protect these functions from unauthorized access through implementation of the security function which receives and processes security policy data from one or more VOD headend servers to enable the receiver function in any known manner. The security function which may be implemented in hardware or software is shown as a distinct element although it should be appreciated that the proposed security architecture may be implemented as a function block without any special security hardware or software.

The user interface allows a user to enter commands e.g. to view the programming services and applications available from the receiver function using a conventional interface device such as a hand held remote control. An appropriate graphical user interface GUI may be provided for this purpose. The user may also define or modify parameters e.g. the security policy data of the security function again preferably through an appropriate user friendly interface.

The memory may be implemented as a CRM as described earlier having a firmware and or operating system OS of the STB thereon for supporting operations by the STB as further described later.

According to one embodiment a user with access to a STB may access a VOD application in the receiver function therein to initiate a VOD session for VOD streaming. Subsequent to a set up of a VOD session as facilitated by an available one of the VOD headend servers e.g. as determined by the VOD headend office the VOD application opens a standard network socket bound to a reserved set top UDP port to send and receive VOD messaging for bi directional signaling on the reserved UDP port to effect VOD over IP delivery. To support NAT at the multimedia router the VOD application employs the standard network socket to a initiate an upstream message mapped or translated through the NAT in the multimedia router for transmission to the video pump and b receive any acknowledgment of the initial NAT upstream message from the video pump before any VOD streaming commences. The upstream messaging serves two purposes a it causes a NAT binding to be established between the destination set top IP address UDP port and the source IP address UDP port of a video pump for receiving video and b it provides the set top IP address and the UDP port as translated through NAT to the video pump which is used when streaming to a STB . According to one embodiment the upstream message contains a valid VOD session identification ID so that the video pump may verify and reference an established VOD session. Subsequent upstream messages may be sent by the VOD application at a given time interval to maintain the NAT binding.

The VOD application is further operable to call a designated Application Programming Interface API residing in the receiver function in the STB to tune an IP service for VOD over IP tune that constitutes the acquisition of IP based content in with the firmware in the memory of the STB by specifying the tuner number service number enhanced control and session configuration the last further including the source IP address and UDP port number so that the firmware may receive the streaming content through the private IP address and bound UDP port number in a known manner. Tune retry logic may be added in the receiver function if the IP based tune is not successful in a defined time interval. If the IP based tune ultimately fails the VOD application may tune away or de tune to free firmware resources. It should be noted that the order of tuning and issuing a stream play request may be interchanged. The VOD application is further operable to send NAT heartbeat messages i.e. additional upstream messages to the video pumps to maintain the NAT binding or messages to another server another video pump or a VOD headend server . When the streaming session has ended the VOD application closes the network socket and tunes away or de tunes the IP tuning resources that were in use.

The VOD application also passes on the source IP address and UDP port number of the designated video pump to the firmware in the STB . When the video pump receives a start streaming command from the VOD headend server it starts streaming the VOD content to the destination IP address and UDP port obtained from the initial upstream message received from the VOD application.

The service path that is used to receive VOD over IP traffic is controlled by the firmware in the memory of the STB to maintain the tuning paradigm using logical IP tuners for IP services. This service path is highly optimized to provide a playback path for VOD over IP at high data rates. According to one embodiment the firmware continuously monitors incoming data traffic on the VOD over IP reserved UDP port regardless whether a VOD over IP tune is in effect and determines if the data is VOD messaging or VOD streaming content. It also checks the incoming data packets to ensure that they originate from the correct source IP address and UDP port of a particular video pump . If the incoming data is VOD streaming content the firmware directly sends such data to the transport decode buffers in the STB bypassing the IP stack therein. If the incoming data is VOD messaging the firmware passes the data up the IP stack to the application. As referred herein VOD messaging includes command data control data and or metadata for metadata navigation session management for content streaming. In other words VOD messaging is data other than the streaming content that affect the streaming of such content. According to one embodiment the firmware is designed and implemented so that it is operable with applications other than VOD applications that are used to receive UDP based services such as tickers news services or other push content services.

At the initiated VOD application opens a standard network socket to send an upstream message as an initial contact message through the NAT in the multimedia router to the designated video pump to create a NAT binding between the set top IP address and UDP port and the NAT translated IP address and UDP port both as translated by the NAT in the multimedia router that are seen by the video pump whereby the initiated VOD application binds a UDP port number of the STB to a predetermined reserved value. The initiated VOD application then uses this network socket for bi directional signaling or communication with the designated video pump in accordance with the setup VOD session and it may open and close such network socket at will. In one embodiment the NAT translated IP address and UDP port number of the initiated STB are sent by the initiated VOD application in the upstream message to the designated video pump which uses such information as the destination endpoint for responding to the upstream message and streaming the requested on demand content. Thus this upstream message causes the NAT translated IP address and UDP port number to be placed in the IP datagrams or IP packets of content streaming from the designated video pump to STB . Consequently NAT transparency is provided wherein it does not matter which NAT type e.g. full cone NAT restricted cone NAT port restricted cone NAT and symmetric NAT if any is employed because communication between the designated video pump and the STB is now facilitated by the upstream message.

At the designated video pump optionally responds to the initial upstream message by sending an acknowledgement of the successful receipt of the upstream message back to the initiated VOD application in the STB through the multimedia router .

At the initiated VOD application then calls up a designated Application Programming Interface API to tune an IP service for receiving the streaming content and passes on the source IP address and UDP port number of the designated video pump to the firmware in the STB .

At the initiated VOD application issues a stream play request to the VOD headend server for the requested content to be streamed from the designated video pump . For example the user decides to play the requested movie by issuing a command to the STB .

At the VOD headend server sends back a stream play response to the initiated VOD application. For example in response to the user s request to play the requested movie the VOD headend server may send back to the user a message confirming that the requested movie will be shortly streamed to the STB for viewing by the user. In response to the stream play request the VOD headend server also sends a start streaming command to the video pump to begin the content streaming. In one embodiment the order of tuning the IP service and the stream play request response may be interchanged.

At the firmware in the STB continuously monitors the incoming data traffic on the VOD over IP reserved UDP port of the network socket regardless whether a VOD to IP tune is in effect and determines if the data is VOD messaging or VOD streaming content.

At if the incoming data on the reserved UDP port of the STB is VOD messaging data the firmware passes the VOD messaging data up the IP stack in the STB as normal regardless whether a VOD over IP tune is in effect by the calling of the designated API.

At however if the incoming data on the reserved UDP port of the STB is VOD streaming content e.g. based on UDP payload length of the incoming data the firmware further determines whether the designated API has been called for a VOD over IP tune.

At if the designated API has not been called by the VOD application i.e. no VOD over IP session is in progress the VOD streaming content is discarded by the firmware.

At if the designated API has been called by the VOD application i.e. a VOD over IP session is in progress and the VOD application has passed information on the source IP address and UDP port number to the firmware the firmware will verify the source and destination IP addresses and UDP port numbers of the incoming data packets.

At if the source and destination address verification at fails the VOD streaming content is discarded.

At if the source and destination address verification passes at the firmware sends the VOD streaming content directly to the transport decode buffers of the STB for presentation to the user. According to one embodiment the firmware does not keep a record of the UDP port used in the opened IP socket for signaling and it does not interfere with the actions taken by the VOD application on that socket while a VOD over IP tune is in progress. Thus if the VOD application closes the IP socket it uses for messaging it is of no consequence to the firmware. The streaming session continues to be processed by the firmware which continues to pass the VOD streaming content to the transport decode buffers bypassing the IP stack in the STB until the VOD application tunes away or de tunes. The firmware also permits VOD messaging data to go up the IP stack where it is discarded because the previously opened IP socket is now closed.

Accordingly the systems methods and computer code described herein provide solutions to the VOD over IP problem in a NAT environment by having a set top VOD application send an initial contact message directly to the VOD streaming server video pump using both the IP address and UDP port number predetermined to support the VOD session. These solutions permit the transparent migration of cable based VOD applications to a VOD over IP environment that uses a multimedia router that supports NAT.

It should also be noted that the process flow is sufficiently flexible for applications in either a NAT or non NAT environment. In a non NAT environment wherein the multimedia router does not support NAT the process flow at is modified as follows. When the initiated VOD application in the STB opens a standard network socket to send an upstream message through the multimedia to the designated video pump there is no NAT binding at the multimedia router . In other words there is no address translation performed at the multimedia router and the actual set top IP address and UDP port of the STB is provided in the upstream message to the designated video pump which uses such information as the destination endpoint for responding to the upstream message and streaming the requested on demand content. The process flow then continues on as described above.

Accordingly the various embodiments of the process flow are operable to provide UDP IP based video delivery transparently through a multimedia router with or without NAT support. They further enable a VOD application behind the multimedia router to have bi directional communication with the streaming servers. There is no coupling of the socket operations with the tune operations because the firmware is tasked with monitoring the nature of the traffic on the bound set top port used for streaming. The monitoring of data on the reserved port is done to prevent the set top CPU from being overwhelmed by high speed streaming content passing through the IP stack. The set top may perform very poorly in this case. This situation could arise if a video server started streaming to the set top before the VOD over IP tune API was called. Also if a set top reset during a VOD streaming session it may power up and start trying to pass the streaming content on the reserved port number up the stack. By having the firmware monitor data on a specific port number it is unlikely that messaging information will not get passed up the stack to the application or that streaming content will go up the stack regardless if the socket is open or closed.

The solution is flexible and allows the application to have complete control over the sequence of events. The firmware does not have to send an upstream initial message or keep track of sending heartbeat messages to maintain a NAT binding.

The process shown in may be implemented in a general multi purpose or single purpose processor. Such a processor will execute instructions either at the assembly compiled or machine level to perform that process. Those instructions can be written by one of ordinary skill in the art following the description of and stored or transmitted on a computer readable medium. The instructions may also be created using source code or any other known computer aided design tool. A computer readable medium may be any medium capable of carrying those instructions and include a CD ROM DVD magnetic or other optical disc tape silicon memory e.g. removable non removable volatile or non volatile packetized or non packetized wireline or wireless transmission signals.

What has been described and illustrated herein are various embodiments along with some of their variations. The terms descriptions and figures used herein are set forth by way of illustration only and are not meant as limitations. Those skilled in the art will recognize that many variations are possible within the spirit and scope of the subject matter which is intended to be defined by the following claims and their equivalents in which all terms are meant in their broadest reasonable sense unless otherwise indicated.

