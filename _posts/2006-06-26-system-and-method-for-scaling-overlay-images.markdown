---

title: System and method for scaling overlay images
abstract: A system and method for scaling a composite overlay image, wherein the composite overlay image comprises a plurality of pixels and each pixel comprises at least one color channel and at least one alpha channel, and further wherein at least one pixel of the composite overlay image has an alpha value of zero and a color value that is not well defined. First, a set of pixels of the composite overlay image are identified as pixels to be dilated. The color channels of the identified pixels are then dilated to form dilated composite overlay image. Finally, the dilated composite overlay image is scaled.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08072472&OS=08072472&RS=08072472
owner: AGFA Healthcare Inc.
number: 08072472
owner_city: Toronto
owner_country: CA
publication_date: 20060626
---
The embodiments described herein relate to the processing of electronic images and in particular to an image transformation system and method for scaling images comprising multicolor and multilayer overlay images.

Modern electronic computing devices are becoming increasingly pervasive. These devices commonly include graphic displays that offer the ability to display images of increasing detail and complexity. Often the images displayed on the graphic displays are multicolored and multilayered and consist of a background image and one or more overlay images. These combined images have applications in a variety of fields including medical imaging applications such as in Picture Archive and Communication Systems PACS and computer graphics generally.

Each pixel of an electronic image such as that displayed on a computer monitor may be represented as a series of values. For example it is common for each pixel of a color electronic image to be represented by the vector R G B A where R represents red G represents green B represents blue and A represents the alpha or the opacity. R G and B may be referred to as color channels. Similarly A may be referred to as an alpha channel. Each of the colors channels can take on a value between a predetermined minimum value and a predetermined maximum value. According to one standard the minimum value is 0 and the maximum value is 255. In addition according to that standard each channel can take on an integer value between the minimum and maximum value inclusive allowing for a total of 256 values. A color channel with a value of 0 generally denotes the absence of that color in the given pixel and a color channel with a value of 255 represents the pixel being fully saturated with that color. The alpha channel represented as A may also take on a value between 0 and 255 where 0 represents the pixel being fully transparent and 255 represents the pixel being completely opaque. For example a pixel represented as 0 0 255 255 is a pixel that is fully blue and fully opaque. However if the alpha value is set to 100 then the pixel is represented as 0 0 255 100 . Such a pixel is fully blue but is translucent.

However as used from here on in the terms color channel and alpha channel will be associated with normalized values. Thus for the color channels 0 will represent the absence of a particular color while 1 will represent a fully saturated color. Similarly for the alpha channel 0 will represent full transparency and 1 will represent full opacity.

An image having an alpha channel may be overlaid on top of another image. Regardless of whether the underlying image has an alpha channel or not combining the two images may require the blending of colours. Consider the case where the overlay image has an alpha channel and the underlying image does not. Thus each pixel of the overlay image may be represented as R G B A and each pixel of the underlying image may be represented as R G B . When one image with an alpha channel is overlaid on top of another image which does not have an alpha channel the color that a particular pixel takes on is dependent on the colors of the pixels of the overlay and background images at that position as well as the opacity of the overlay image at that position. Thus for a particular pixel of a combined image the color values may be calculated as 1 1 wherein Crepresents the normalized color channels of the resulting image Crepresents the color channels of the overlay image Crepresents the color channels of the background image Arepresents the alpha value of the overlay image. Each of the C C and Care in fact vectors containing each of the color channels of the particular pixel. For example C R G B . The above described process by which the color channels are combined may be referred to as alpha blending.

It is often necessary to scale and or rotate images that contain a background image and at least one overlay image. Some prior art methods scale the overlay image and the background image separately before combining the two through the use of alpha blending. This leads to a number of undesirable qualities such as distortion or artifacts. In particular in the final image overlay lines appear thinner than they should. In addition the edges of overlays may be tinged with a dark shade which in turn results in a choppy shadow around the overlay features.

One method to overcome these problems is to combine the overlay image with the background image and then scale the combined image. However this leads to additional problems. In particular it is often the case that the background image changes or is modified relatively frequently while the overlay images remain relatively constant. In such a case this method would be overly computationally intensive and inefficient. Thus there is a need for a system and method that overcomes the above mentioned problems and can scale images having a background image and at least one overlay image.

The embodiments described herein provide in one aspect a method of scaling a composite overlay image wherein the composite overlay image comprises a plurality of pixels and each pixel comprises at least one color channel and at least one alpha channel and further wherein at least one pixel of the composite overlay image has an alpha value of zero and a colour value that is not well defined said method comprising 

The embodiments described herein provide in another aspect a system for scaling a composite overlay image wherein the composite overlay image comprises a plurality of pixels and each pixel comprises at least one color channel and at least one alpha channel and further wherein at least one pixel of the composite overlay image has an alpha value of zero and a colour value that is not well defined said system comprising 

Further aspects and advantages of the embodiments described herein will appear from the following description taken together with the accompanying drawings.

It will be appreciated that for simplicity and clarity of illustration elements shown in the figures have not necessarily been drawn to scale. For example the dimensions of some of the elements may be exaggerated relative to other elements for clarity.

It will be appreciated that for simplicity and clarity of illustration where considered appropriate reference numerals may be repeated among the figures to indicate corresponding or analogous elements or steps. In addition numerous specific details are set forth in order to provide a thorough understanding of the exemplary embodiments described herein. However it will be understood by those of ordinary skill in the art that the embodiments described herein may be practiced without these specific details. In other instances well known methods procedures and components have not been described in detail so as not to obscure the embodiments described herein. Furthermore this description is not to be considered as limiting the scope of the embodiments described herein in any way but rather as merely describing the implementation of the various embodiments described herein.

The embodiments of the systems and methods described herein may be implemented in hardware or software or a combination of both. However preferably these embodiments are implemented in computer programs executing on programmable computers each comprising at least one processor a data storage system including volatile and non volatile memory and or storage elements at least one input device and at least one output device. For example and without limitation the programmable computers may be a personal computer laptop personal data assistant and cellular telephone. Program code is applied to input data to perform the functions described herein and generate output information. The output information is applied to one or more output devices in known fashion.

Each program is preferably implemented in a high level procedural or object oriented programming and or scripting language to communicate with a computer system. However the programs can be implemented in assembly or machine language if desired. In any case the language may be a compiled or interpreted language. Each such computer program is preferably stored on a storage media or a device e.g. ROM or magnetic diskette readable by a general or special purpose programmable computer for configuring and operating the computer when the storage media or device is read by the computer to perform the procedures described herein. The inventive system may also be considered to be implemented as a computer readable storage medium configured with a computer program where the storage medium so configured causes a computer to operate in a specific and predefined manner to perform the functions described herein.

Overlay image scaling system is used to scale multicolor and multilayer images comprising a background image and at least one overlay image. More specifically it can be used to scale images having multiple overlay planes each of which may have separate colors. Various embodiments of overlay image scaling system may be applied to a variety of image formats. In particular it can be applied to any overlay image that has at least one color channel and at least one alpha channel. For example some common formats to which embodiments of the image scaling system may be applied include the gray scale image format which utilizes one color channel the RGB red green blue image format which utilizes three color channels and the CYGM cyan yellow green magenta image format which utilizes four color channels. The above example is meant to be illustrative only and is not intended to be limiting in any way.

As will be explained below overlay image scaling system combines the overlay images into one composite overlay image. It then dilates the colors of the composite overlay image. It then scales the dilated composite overlay image and background images separately. Finally it combines the scaled composite overlay image and the scaled background image. Overlay image scaling system operates such that the resulting image is free from any obvious artifacts that may occur in the prior art. In addition combining the multiple overlays into a single multi colored overlay prior to scaling allows for the use of a single color buffer and a single alpha buffer during the execution of scaling algorithms.

At step the alpha channel dilation module dilates the alpha channels of the binary image to form a dilated binary image. In other embodiments in which a binary image is not used this step would form a dilated binary alpha representation. At step the set of pixels of the composite overlay image that should be dilated are identified. As will be explained below this step involves subtracting the original binary image from the dilated binary image. At step the colours are dilated into the pixel locations identified in the previous step. Then the process ends at step . The overlay image that results from this process will be referred to as a dilated composite overlay image.

The process begins at step . At step a blank binary image is created. At step the binary image creation module selects a pixel of the overlay image. The pixel may be selected in any suitable manner. A previously selected pixel is preferably not selected again.

At step it is determined whether the alpha channel of the overlay image pixel selected at step is greater than 0. If yes then step is executed. At step the alpha channel of the equivalent binary image pixel is set to 1. A binary image pixel is equivalent to an overlay pixel if it is in the same row and column position. In contrast to the above if at step it is determined that the alpha value of the overlay image pixel is equal to 0 then step is executed. At step the alpha channel of the equivalent binary image pixel is set equal to 0. Regardless of whether step or step is executed the next step is . At step it is determined whether or not the overlay image has a pixel that has not yet been processed. If not that is if all pixels have been processed then the process ends at step . If on the other hand there are pixels that have not yet been processed then step is repeated.

It should be understood that this is exemplary only. Other embodiments do not store the binary alpha values in an image format but rather use other suitable representations. In particular the binary alpha representation need not be a raster scan. The term raster scan is used to refer to a representation in which each element is individually defined. For example in the above mentioned binary image each pixel is individually defined as being either a 1 or a 0. In contrast in a second embodiment the binary alpha representation is an array of objects. Instead of specifying the alpha value of each pixel individually this array comprises objects that define ranges of consecutive appearance of a particular value of alpha. Each of these objects may be referred to as a range object. Since the alpha channels of the binary alpha representation are binary only one of the alpha values needs to be considered. This follows from the fact that if the alpha channel of a particular pixel is not a 0 then it must be a 1 and vice versa. Thus each range object could be the vector row start column end column where row defines the row number of the image start column defines the column at which the particular value of alpha begins end column defines the column at which it ends. Thus if the second row of an image has non zero alpha channels from the third to the ninth column then one of the range objects in the array would comprise the vector 2 3 9 . Another alternative is to use an array that stores transition points. Each object would store the point after which the alpha channel changes from a 0 to 1 or vice versa.

Regardless of what method is used it preferably possible to discern from the binary alpha representation whether each pixel of the overlay image has a zero or non zero alpha channel. Thus both alpha channel and position information are preferably stored. In the case of the binary image the position information is present in that the binary values are stored in pixel position that correspond to the pixel positions of the alpha channels that they represent.

The process begins at step . At step a blank binary image is created. At step the alpha dilation module selects a pixel of the binary image. The pixel may be selected in any suitable manner. Preferably a previously selected pixel is not selected again. At step a kernel which can also be referred to as a structuring element is applied to the binary image. The kernel is applied by placing its origin over a pixel of the image. Examples of two possible kernels are illustrated in .

At step it is determined whether or not any of the 1 s within the kernel intersect with any of the pixels in the binary image that have an alpha channel of 1. If yes then step is executed. At step the alpha channel of the corresponding pixel of the dilated binary image is set equal to 1. The corresponding dilated binary image pixel is the pixel at the same column and row position as the binary image pixel to which the kernel is applied. After step step is executed. If at step it is determined that there are no pixels with an alpha value of 1 intersect with the 1 s in the kernel then step is bypassed and step is executed. At step it is determined whether the last pixel of the binary image has been reached. If not then step is repeated. If yes then the process ends at step .

In an alternative embodiment the kernel may be applied in a different manner. In particular a two dimensional kernel such as the one illustrated in can be separated into one dimensional components. Thus the image may first be dilated along each row and then the resulting image may be dilated along each column. In embodiments utilizing a binary representation that is in the form of a raster as described above this alternative allows for very simple dilation along the row direction. This follows from the fact that the representation already stores the locations at which the alpha channel changes values. The dilation of the columns is performed by the union of regions from the rows above and below a selected row. This alternative application may be particularly efficient when the binary alpha transitions are sparse or in other words when the alpha channel is relatively uniform.

The steps illustrated in may be repeated more than once. The number of times that steps are performed depends in part on the scaling algorithm used when scaling the overlay image. For example if bilinear interpolation is utilized then a single binary dilation is sufficient. A single binary dilation corresponds to a single pass through steps . On the other hand if the scaling algorithm utilizes a larger kernel size then more than one pass may be required. Generally the larger the kernel size utilized by the scaling algorithm the greater the number of binary dilations or repetitions of steps required.

Reference is now made to . illustrates an exemplary binary image that is 9 pixels wide and 9 pixels tall and contains binary alpha channels. Image represents a binary image created by binary image creation module according to steps of . Every pixel of image having a 0 corresponds to a pixel of an overlay image pixel having a 0 alpha channel. Every pixel of image having a 1 corresponds to a pixel of an overlay image pixel having a nonzero alpha channel. illustrates the image that results from the application of kernel to image of by alpha dilation module according to steps of .

At step a pixel of the subtracted binary image is selected in any suitable manner. Preferably a previously selected pixel is not selected again. At step it is determined whether the alpha channel of the pixel is equal to 1. If yes then step is executed. At step the pixel is identified as a pixel requiring color dilation. If the answer reached at step is no then step is executed in place of step . At step the pixel is identified as a pixel not requiring dilation. Regardless of whether step or is executed step is executed next. At step it is determined whether there are pixels that have not yet been examined. If not then the process ends at step . If yes then step is repeated.

At step it is determined whether the color channels of all the pixels in the neighborhood are the same. If yes then step is executed. At step the color settings of the pixel are set to be the same as that of its neighbors. However if the answer reached at step is no then step is executed. At step the color channels of the neighbors are averaged and the color channels of the selected pixels are set to the average. The averaging may be performed by any suitable means. For example in an embodiment in which the original images already have binary alpha values and where only the 8 neighboring pixels are used the averaging step can be achieved by a simple average. However in other embodiments the averaging may be accomplished by a weighted average. The weights can be determined by a number of factors including the alpha value at the pixel the proximity of the pixel and the position of the pixel. As an example of where the position may be used to affect the weighting if a 3 3 kernel is used then the corner pixels may be given less weight than the pixels that are horizontally or vertically adjacent. Similarly an example of where the proximity may be used to affect the weighting is in a 5 5 kernel the pixels that are immediately horizontally or vertically adjacent may be given greater weight than the pixels that are two pixels away in the horizontal or vertical direction. In the exemplary embodiment the color of the pixel is calculated according to the following Equation 

K i j are the kernel weights used for averaging the colors. In this alternative embodiment the kernel is a 3 3 kernel and therefore the i and j values range from 1 to 1. However in other embodiments the kernel may be of a different size and the i and j values would vary appropriately. In this alternative embodiment K 0 0 which represents the center of the kernel is 0. This means that for the purpose of Equation 3 the summation may be made shorter by skipping the step for which i j 0 0 . In addition the kernel values at each corner are also 0 which may be represented as K 1 1 0. The above equation is meant to be exemplary only. As mentioned above the number of pixels used is in part dependant on such things as the scaling algorithm used. For example for bilinear scaling choosing n 8 is sufficient. However for bicubic scaling a larger number of pixels are used. Specifically for bicubic scaling a 5 5 dilation kernel may be used. This would give 24 neighboring pixels 8 of which are immediately adjacent and 16 of which are two pixels away. In addition in one embodiment neighboring pixels with an alpha channel of 0 are ignored and the alpha channel of the original image is already binary. In such an embodiment the calculation of Ccan be written according to the following pseudo code 

The actual method used to determine the color of the pixel that is dilated into may be determined according to the particular implementation utilized. One of the above described methods may be more efficient than the other in one implementation but may be less efficient in a second implementation. Thus knowledge of the particular implementation is helpful in determining which method to use.

Regardless of whether step or is executed step is executed next. At step it is determined whether there are pixels that have not yet been examined. If not then the process ends at step . If yes then step is repeated. It is important to note that color dilation module does not affect the alpha channels of the overlay image only the color channels of the overlay image are affected by color dilation module during steps .

The flowchart presented in is meant to be exemplary only. There are other possible methods. For example steps and could be replaced with a step that performs some form of convolution. A convolution could achieve the affects of both steps and in one step. As a second example if the overlay is layered then the color chosen to be dilated into a given pixel could be the top most color of the overlay at that location. This method is simpler allows some of the dilation to occur as the overlay images are combined into one image. However the results produced may not be as good as those achieved by the above described process. Another alternative could be to use edge detection techniques. A further alternative is to use knowledge of the domain in order to determine which color should dominate.

At step it is determined whether there remains an overlay image that has not yet been processed. If not then the process ends at step . If yes then step is executed. At step the next lowest overlay is selected. Then step is executed. At step the next lowest overlay is combined with the previous composite overlay to form a new composite overlay. The alpha and color channels are calculated according to the equation above. The previous composite overlay is now the lower overlay and the overlay selected at step is the upper overlay. After step is executed step is repeated.

In order to better illustrate step of reference is now made to . illustrates the color channel portion of an overlay image . The color portion of the overlay image comprises a strip of uniform color . illustrates the alpha channel portion of the overlay image of . The alpha channel portion comprises a strip of uniform alpha values in the same position as the strip of color . Thus strip represents the color channels of a set of pixels in overlay image and strip represents the alpha channels of the same set of pixels. are similar to except that they are for a different overlay image. respectively illustrate the color channels and the alpha channels of an image formed by combining overlay images and .

Only the points of intersecting color or alpha channels require new values to be calculated. Thus the set of pixels corresponding to square color portion are the only pixels for which new color channel values must be calculated. Similarly the set of pixels corresponding to square are the only pixels for which new alpha channel values must be calculated. In this example Equation 5 which is given above could be used to calculate the color values for square . Similarly Equation 4 could be used to calculate the alpha values .

The process illustrated in is exemplary only. For example in many applications the alpha channels of the overlay images may be binary as they are in some medical imaging technology such as IMPAX and other Picture Archive and Communication Systems PACS . In such a case at any intersection point the color channel of the composite is more easily determined as each pixel of each layer is either fully opaque or fully transparent.

It will be appreciated that while the embodiments of the overlay image scaling system have been described in the context of various methods including methods for scaling multicolor and multilayer overlay images it should be understood that it is equally applicable to other types of images. The system processes and methods described are capable of being distributed in a computer program product comprising a computer readable medium that bears computer usable instructions for one or more processors. The medium may be provided in various forms including one or more diskettes compact disks tapes chips wireline transmissions satellite transmissions internet transmission or downloadings magnetic and electronic storage media digital and analog signals and the like. The computer useable instructions may also be in various forms including compiled and non compiled code.

It should be understood that various modifications can be made to the embodiments described and illustrated herein without departing from the embodiments the general scope of which is defined in the appended claims.

