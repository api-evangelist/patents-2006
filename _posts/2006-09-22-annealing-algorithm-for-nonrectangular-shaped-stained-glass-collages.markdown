---

title: Annealing algorithm for non-rectangular shaped stained glass collages
abstract: The present invention relates to a method to make effective use of non rectangular display space for displaying a collage. In an embodiment of the invention, a heterogeneous set of images can be arranged to display the region of interest of the images to avoid overlapping regions of interest. The background gaps between the regions of interest can be filled by extending the regions of interest using a Voronoi technique. This produces a stained glass effect for the collage. In an embodiment of the present invention, the technique can be applied to irregular shapes including circular shapes with a hole in the middle. In an embodiment of the present invention, the technique can be used to print labels for disks.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08144919&OS=08144919&RS=08144919
owner: Fuji Xerox Co., Ltd.
number: 08144919
owner_city: Tokyo
owner_country: JP
publication_date: 20060922
---
 1 Application Ser. No. 10 815 389 entitled Extracting Video Regions of Interest by Patrick Chiu et al. filed Mar. 31 2004 

 2 Application Ser. No. 10 815 354 entitled Generating a highly Condensed Visual Summary by Patrick Chiu et al. filed Mar. 31 2004 

 3 Application Ser. No. 10 948 730 entitled Determining Regions of Interest in Photographs and Images by Patrick Chiu et al. filed Sep. 23 2004 

 4 Application Ser. No. 10 948 823 entitled Determining Regions of Interest in Photographs and Images by Patrick Chiu et al. filed Sep. 23 2004 and

 5 Application Ser. No. 11 405 311 entitled Cascading Cluster Collages Visualization of Image Search Results on Small Displays by Patrick Chiu et al. filed Apr. 17 2006 which are all expressly incorporated in their entireties herein by reference.

The present invention relates to a method to make effective use of display space for irregularly shaped collages.

A huge amount of digital photos and videos are being created with the ubiquitous digital cameras camera cell phones and personal digital assistants. An important challenge is figuring out ways to manage and visualize collections of photos and videos. Another challenge is viewing presentation content on irregular shaped displays where the content must be condensed to efficiently and effectively be displayed.

In U.S. patent application Ser. No. 10 815 389 entitled EXTRACTING VIDEO REGIONS OF INTEREST and U.S. patent application Ser. No. 10 815 354 entitled GENERATING A HIGHLY CONDENSED VISUAL SUMMARY a method was disclosed to summarize and condense a video using a Stained Glass Visualization which shows a video using a storyboard generated from Regions of Interest ROI in the key frames of the highly ranked video segments. The ROIs are laid out and the gaps are filled by extending the ROIs using a Voronoi technique. This produces irregular boundaries and the result looks like a stained glass. Along with the visualization method an algorithm was provided for finding the ROIs in a video segment based on motion analysis.

In U.S. patent application Ser. No. 10 948 730 entitled DETERMINING REGIONS OF INTEREST IN PHOTOGRAPHS AND IMAGES and U.S. patent application Ser. No. 10 948 823 entitled DETERMINING REGIONS OF INTEREST IN PHOTOGRAPHS AND IMAGES STAINEDGLASS COLLAGES were applied to photos and synthetic images such as POWERPOINT slides.

FUJIFILM and YAMAHA have recently introduced a technology for printing disk labels called Labelflash . FUJIFILM News Releases Oct. 19 2005. Using the same laser for data recording graphics and text can be burned directly onto the dye on the label side of a disk. This technology works with DVD R and DVD R media producing a blue colored grayscale image. Using Labelflash simplifies the labeling process for the user by eliminating the need for printers sticker labels and ink see .

HP LIGHTSCRIBE is similar to Labelflash . Case L. 2005 . HP Announces availability of LightScribe products Jan. 5 2005 . The images are burned directly on the non data side of the DVD disk. The grayscale color is sepia instead of blue.

In general the irregular stained glass may have an arbitrary curve for its outer boundary and contain an arbitrary number of empty areas or holes . The user can specify such a shape by drawing the boundary and holes using standard techniques for drawing lines found in common graphics software applications. Another common way to specify a complex shape is for the user to take pre defined basic shapes e.g. rectangles triangles ellipses and place them on the canvas window.

An annealing algorithm has previously been described. Kirkpatrick S. C. D. Gelatt Jr. M. P. Vecchi. 1983 . Optimization by Simulated Annealing. 220 4598 pp. 671 680 1983.

SURETHING CD DVD LABELER DELUXE has a feature that creates a collage for a donut shaped disk or a rectangular jewel case label. It provides a 3 3 or M N rectangular grid that can be filled with images. For a donut shaped disk label the rectangular grid is cropped.

ACOUSTICA CD DVD LABEL MAKER is a popular label making software. It provides custom art for holidays and special occasions and allows the user to add images and import his photos. A related product ACOUSTICA PHOTO FOREVER finds photos on a computer hard drive and backs them up on disks. It prints out a table of contents with thumbnails on sheets of paper not disk labels.

Stained glass collages for representing a video as a collage are known. U.S. patent application Ser. Nos. 10 815 389 10 815 354 Chiu P. Girgensohn A. and Liu Q. 2004 . Stained Glass Visualization for Highly Condensed Video Summaries. Proc. IEEE Intl. Conf. on Multimedia and Expo ICME 04 . Collages of video using different sized keyframes in a storyboard layout include FXPAL Video Manga and video posters. Uchihashi S. Foote J. Girgensohn A. and Boreczky J. 1999 . Video Manga Generating semantically meaningful video summaries. Proceedings ACM Multimedia 99 pp. 383 392 Yeung M. Yeo B. L. 1997 Video visualization for compact presentation and fast browsing of pictorial content. IEEE Trans. Circuits and Syst. Video Technol. 7 5 October 1997 771 785.

Stained glass collages for representing photos and synthetic images are known. U.S. patent application Ser. Nos. 10 948 730 10 948 823 Girgensohn A. Chiu P. 2004 . Stained Glass Photo Collages. UIST 04 Poster. Photomontage generates collages by fusing images at places where they are similar. Agarwala A. Dontcheva M. Agrawala M. Drucker S. Colburn A. Curless B. Salesin D. Cohen M. 2004 . Interactive Digital Photomontage. 04 pp. 294 302. The effect is quite distinctive because with Photomontage the seams between images are minimized.

Venable has described a method for image layout. U.S. Pat. No. 6 934 052. It formats a set of images into a single contact sheet like layout for rapid viewing and cataloging. The target area is rectangular and the images are rectangular of different sizes and aspect ratios. A simulated annealing program is used. It lays out whole images all the objects are rectangles and overlaps are not allowed.

 KANDINSKY is a research system that creates collages from a set of input images plus a template. Fogarty J. Forlizzi J. Hudson S. Aesthetic information collages Generating decorative displays that contain information Proceedings of UIST 01 pp. 141 150. The template is an image with regions e.g. an abstract painting and the input images are matched and composited into the template using simulated annealing resulting in a collage.

COLLAGEMAKER is a graphics editor that has features for making and editing collages. The user can layout photos merge photos seamlessly and apply unique border and edge effects.

PHOTOMIX is a software application for digital scrap booking and photo collage creation. It has a feature for laying out a collage by providing layout templates that tessellate the canvas with different sized rectangles.

PICASA is a popular photo organizer that has features to help make photo collages. From a user selected set of photos a picture collage can be created in several styles Picture Pile Picture Grid Contact Sheet Multi Exposure. The collages are basically rectangular overlapping grid thumbnails or blended on top of each other.

In an embodiment of the present invention we define algorithms to make effective use of display space for showing regions of interest ROI of images in a non rectangular collage.

In various embodiments of the invention in order to display a plurality of images on a non rectangular target area a germ a support and an initial position on the target area can be determined for each of the images thereafter a translation vector can be calculated for one of the germs and the germ can be moved according to the translation vector. The germ can be a ROI in a photo or keyframe. The support can be the remainder of the photo or keyframe not selected as the germ. Thereafter other translation vectors can be calculated for other germs and moved accordingly until a stopping condition criteria is met. In various embodiments of the invention the plurality of images can be a set of photos. In alternative embodiments of the invention the plurality of images can be a set of video keyframes.

In various embodiments of the present invention the target area can be an irregular shape. In various alternative embodiments of the invention the target area can be circular. The germs can be arranged on the target shape such that the centroid of the germ is assigned as a point position representing the germ. The distance between this point and other points representing the distance between germs can thus be calculated. In an embodiment of the invention a uniform scaling factor can be applied to all germs in order to assure that all germs fit within the target area.

With a circular target a radial time line can be used to order the germs displayed as a collage. With a circular target a hole can be positioned in the middle of the target area. In an embodiment of the invention the circular collage can be printed on a disk as a disk label. With a circular collage printed as a disk label the hole can correspond to the axis point of rotation of the disk. In an alternative embodiment a single photo or key frame to be emphasized in the collage can be selected to occupy the central hole.

In an embodiment of the invention the initial positions of the N germs can be determined randomly. In an alternative embodiment of the present invention the germs can be iteratively moved from this random arrangement by calculating the expected distance between points on the target area and then selecting for movement a germ to a N 1 random position. In an embodiment the iteration can be carried out until a predetermined number of germs have been selected and or moved. Alternatively the iteration can be stopped when all germs are half the expected distance from all other germs. In an embodiment the selected germ is moved provided that this results in a greater distance between the selected germ and the other germs.

In an alternative embodiment of the present invention the initial position of the germs can be assigned based on the size of the germs wherein the largest germ is assigned to the point farthest from any other point and the next largest germ to the next point farthest from any other. In another alternative embodiment of the present invention the initial position of the germs can be assigned based on the sequence of the germs. For example if the germs are key frames from a video then the sequence can be the order of the keyframes in the video.

In an embodiment of the invention the germ to be moved can be randomly selected. In an alternative embodiment of the invention a germ can be selected based on the distance each germ needs to be moved wherein the germ with the greatest distance to be moved is selected.

In an embodiment of the invention the translation vector can be determined using an annealing algorithm. In various embodiments of the invention the annealing algorithm can include a dampening factor and or a perturbation factor.

In an embodiment of the invention the germs are rescaled after they are assigned a position in order to make efficient use of the target area. In an embodiment of the invention the color or composition of pixels not assigned to the germs in the target area or empty space can be assigned based on the support. In an embodiment of the invention the support corresponding to the closest germ in the target area is used to assign empty space. In an embodiment of the invention the empty space is filled by a Voronoi algorithm.

An especially useful case is the donut shaped stained glass collage for which we describe two applications. The first application is for creating and printing disk labels for DVDs with video or photos. The donut shaped stained glass matches the shape of a round disk with a hole in the middle . The stained glass is generated from the contents of the disk e.g. video or photos and provides a visual summary of the contents.

Another application of a donut shaped stained glass can be for creating a collage with a center peripheral layout. An image can be placed in the center hole for emphasis and the surrounding donut collage shows peripheral information. In contrast the collage in is rectangular and there is no single image that is emphasized due to its spatial location. The center peripheral layout is a popular feature request from users of STAINEDGLASS and can be generalized in several ways. For example the shape can be a heart instead of circular outer boundary. Another method can be to vary the number of areas for emphasis instead of having a single area in the center. A shape is considered circular if it has an outer boundary or perimeter that is round or oval and includes annular shapes.

Previously STAINEDGLASS was used only with rectangular shaped collages. However sometimes it is desirable to have irregular shaped stained glass collages. This allows users to be more expressive. There are also specific applications where it is desirable to create a collage to fit a region that is not rectangular.

Once the input images and output irregular shaped area have been specified a stained glass collage can be calculated using an annealing approach. In various embodiment of the present invention a germ can be the central object in an image. A germ can be closely related to the ROI detected in the image. In an embodiment of the present invention the germ can be the dominant ROI. In an embodiment the germ can also be the largest ROI. After the germs are laid out the empty areas can be filled using a Voronoi algorithm. The basic algorithm is illustrated in . The images are first input at step . Next the germ and support are computed for each image steps and respectively . The germs can be placed on the irregular or otherwise shaped area step . The germs can be moved according to the annealing algorithm step . Based on the new positions of the germs it can be determined if the stopping conditions have been met step . If the stopping conditions have not been met then the algorithm returns to step and another germ can be moved accordingly. If the stopping condition is met then the germs can be scaled step . Finally the empty spaces between the germs can be filled in using the Voronoi algorithm step .

The input can be a set of images. For photos these can be a small subset of favorite pictures from a collection or a selected subset of pictures to illustrate an event. For videos the images can be keyframes extracted from the video and a small subset can be selected manually by the user or automatically via content analysis algorithms e.g. U.S. Pat. No. 6 819 795 Chiu P. Girgensohn A. Polak W. Rieffel E. Wilcox L. Bennett F. 2000 . A genetic segmentation algorithm for image data streams and video. 00 pp. 666 673 .

For each image the germ and support are computed using a previously described algorithm. U.S. patent application Ser. Nos. 10 815 389 10 815 354 10 948 730 10 948 823 Chiu P. Girgensohn A. and Liu Q. 2004 . Stained Glass Visualization for Highly Condensed Video Summaries. 04 . A germ can be closely related to the regions of interest ROI detected in the image. In an embodiment of the present invention the germ can be the dominant ROI. In an embodiment the germ can also be the largest ROI. See . A support can be the image pixels outside the germ. In theory the support can extend beyond the image e.g. using panorama construction techniques to fuse adjacent photos or keyframes that overlap.

In an embodiment of the present invention the initial germ positions r can be randomly chosen. To improve the positions so that they are more spread out an estimate of the expected distance can be calculated using E target area N where N is the number of images. After the rhas been assigned rcan be determined by selecting random points until a point is greater in distance than E 2 to any other point or until a condition of M selections is met e.g. M 100 .

The germs can be assigned arbitrarily to the positions. To improve the fit between large germs and the sparser points the largest germ can be assigned to the point farthest from any other point the next largest germ to the next point farthest from any other point and so on.

In an embodiment of the present invention if the images are in a sequence and it is desirable to reward keeping adjacent images nearby the germs can be assigned to the positions r in an orderly manner. For example this can be done inductively put germ gat the position with minimum y coordinate after germ ghas been placed take all the positions with y coordinates above the bottom of g then from these take the position with minimum x coordinate for placing g.

Alternatively the germs can be placed in order initially by dividing the rectangular bounding box of the irregular area into a number of rows e.g. equal to the square root of the number of germs allowing the starting positions of the germs to be outside the irregular area. Roughly the same number of germs are placed in each row such that the distances between germs can be maximized. When a germ is outside the irregular area the distance measure to the border returns negative values for those germs indicating that those germs need to be moved larger distances. Our experiments show that this works well for the donut shaped area. shows the results of keeping 20 elliptic germs in their original order.

Germs are scaled uniformly such that their total area can be a large fraction of the irregular area e.g. 70 . Especially with a few germs the uniform scale factor may need to be selected such that the largest germ can fit inside the irregular area see . Germs can be scaled again at the end of the annealing algorithm so approximate scaling is sufficient at the initial scaling point. In the annealing algorithm the size of the germs contributes to distance computations but germ overlaps are not considered in the annealing algorithm.

In an embodiment of the present invention at each stage t 0 1 2 . . . a move for one or more germs can be computed. A germ to be moved can be selected randomly or alternatively as the germ that needs to be moved the largest distance. The random function for selecting a germ can also take the distance that the germ needs to be moved into consideration so that germs close to other germs are more likely to be selected

The moves are done one germ at a time. The alternative of computing all the moves simultaneously does not offer any significant advantages.

The movement of germ gcan be computed as a translation vector v x y in the following way. First for a germ gfind the nearest point pto the boundary of g such that pcan be either on a germ boundary excluding the i th germ or on the boundary of the irregular area.

To simplify the computation of p we can constrain a candidate point s so that s can be on a line segment between cand either another centroid or between cand a boundary point of the irregular area. Constraining candidate points to the line segment between two centroids can result in an overlap because the distance between shapes can be overestimated.

Next find a point psuch that it is the intersection of the line from cto pand a boundary of g. The idea is to move away from the nearest point to some fraction of the estimated expected distance plus a perturbation by a random vector that diminishes as the annealing progresses. More precisely we can take vas defined in equation 1.

This determines the unity vector pointing from ctowards pand moves gsuch that the distance between cand pwould be E. The germ can be moved by more than the distance E if it overlaps another germ or is partially outside the irregular area. The move can be dampened by t a dampening function such as 1 1 t 10 . The move can be perturbed by a random vector where D is the longest dimension of the bounding box of the irregular area and t is the annealing cooling schedule function given by equation 2 in which is the annealing parameter that can be tuned for the specific application and where wis a random vector whose x and y components are drawn from the interval 1.0 1.0 . exp equation 2 

The proper selection of E can be important for the algorithm. If E is chosen too small part of the irregular area might remain uncovered. In contrast a large E does not have a lasting negative effect but might delay convergence until the move is sufficiently dampened. Different values of E for other germs and for boundaries of the irregular area can improve performance. The vector vindicates the desired position for a germ at the next iteration. If this vector is very long the system might get into an undesirable state. Thus in practice it can be better to set a maximum move distance and to potentially move the same germ several times in a row.

For each i vcan be repeatedly constructed as necessary until it satisfies the criteria that the new center c v is in the interior of the irregular shape. A stopping condition limits the number of times vis computed e.g. i 100 if none of the vis satisfactory the germ is not moved.

The criteria or stopping condition that ends this repeated process can be when the maximum length attainable by the vis sufficiently small e.g. less than a pixel or after the maximum number of stages e.g. t 100 .

Once the positions of the germs have been determined the scale factor for the images can be computed by taking the largest scale factor without the germs intersecting themselves or the irregular shaped boundary. Better collages can result if a small amount of intersection is allowed e.g. 20 .

The empty spaces consist of the pixels in the irregular area outside of the germs. The Voronoi algorithm assigns to a pixel the value from its nearest germ s support. If the pixel is in the irregular area but outside the germ supports it is assigned the background color. The resulting collage will consist of non rectangular images. The boundaries between images will look similar to .

Depending on the application domain and the irregularity of the areas the algorithm can be run several times and then the best result can be chosen. The best result may be characterized by the smallest total empty area after the scaling and or after the scaling and filling operations.

For video keyframes images can be ordered by time and it can be desirable to maintain proximity of adjacent keyframes. This can also be the case for photos when several shots are taken in sequence of some incident that happened at an event.

To reduce the chance that germs would drift too far an iteration can first be performed using the annealing algorithm on the initial random locations r with the distance function defined by the point distance between each pair of locations. This will move the initial locations to more stable places. Then germ centroids can be assigned to r and the algorithm can proceed as before but limiting the movement of germs at each step.

A radial layout can be produced that reflects the time position of a keyframe in a video. A timeline ring can be placed around the rim of the disk. See . In an embodiment of the present invention the ring can be placed along an outer ring or an inner ring. In an alternative embodiment of the present invention the timeline ring can spiral around the disk.

Initially the random locations are computed and stabilized by performing the annealing algorithm on the random locations as above. Each random location can be calculated in polar coordinates where the location can be associated with a time based on its angular coordinate. Starting with the first keyframe and progressing in temporal order each keyframe germ centroid can be assigned to the random location nearest to the keyframe s time.

To make the STAINEDGLASS more customizable the user interface may provide a widget for the user to enter the parameters. For example the user can specify the scales of the images for selected photos. The user can also affect how much proximity can be maintained by specifying the amount of initial energy that determines the length of the random vectors used in the annealing process. For advanced users it can be desirable to expose all the parameters in the user interface to give the user more control.

STAINEDGLASS differs from SURETHING CD DVD LABELER DELUXE. In SURETHING the rectangular grid is cropped when a donut shaped disk label is printed. Aesthetically this can be less pleasing as a collage. Also SURETHING is liable to cut out important parts of images. STAINEDGLASS is also significantly different from Photomontage where the seams between images are minimized whereas with STAINEDGLASS the seams are highly visible to frame and delineate the individual images that make up the collage. XEROX s Veneble program differs from this invention in a number of respects including that it lays out whole images not germs all the objects are rectangles and overlaps are not allowed. KANDINSKY is solving a different problem than the present invention. KANDINSKY is more about template matching than laying out images in an empty target area. PICASA has no feature for making collages on irregular shapes e.g. disk labels .

The foregoing description of preferred embodiments of the present invention has been provided for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise forms disclosed. Many embodiments were chosen and described in order to best explain the principles of the invention and its practical application thereby enabling others skilled in the art to understand the invention for various embodiments and with various modifications that are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the claims and their equivalents.

Various embodiments of the invention may be implemented using a processor s programmed according to the teachings of the present disclosure as will be apparent to those skilled in the computer art. Appropriate software coding can readily be prepared by skilled programmers based on the teachings of the present disclosure as will be apparent to those skilled in the software art. The invention may also be implemented by the preparation of integrated circuits and or by interconnecting an appropriate network of component circuits as will be readily apparent to those skilled in the art.

Various embodiments include a computer program product which can be a storage medium media having instructions and or information stored thereon in which can be used to program a general purpose or specialized computing processor s device s to perform any of the features presented herein. The storage medium can include but is not limited to one or more of the following any type of physical media including floppy disks optical discs DVDs CD ROMs micro drives magneto optical disks holographic storage devices ROMs RAMs EPROMs EEPROMs DRAMs PRAMS VRAMs flash memory devices magnetic or optical cards nano systems including molecular memory ICs paper or paper based media and any type of media or device suitable for storing instructions and or information. Various embodiments include a computer program product that can be transmitted in whole or in parts and over one or more public and or private networks wherein the transmission includes instructions and or information which can be used by one or more processors to perform any of the features presented herein. In various embodiments the transmission may include a plurality of separate transmissions.

Stored on one or more computer readable media the present disclosure includes software for controlling the hardware of the processor s and for enabling the computer s and or processor s to interact with a human user or other device utilizing the results of the present invention. Such software may include but is not limited to device drivers interface drivers operating systems execution environments containers user interfaces and applications.

The execution of code can be direct or indirect. The code can include compiled interpreted and other types of languages. Unless otherwise limited by claim language the execution and or transmission of code and or code segments for a function can include invocations or calls to other software or devices local or remote to do the function. The invocations or calls can include invocations or calls to library modules device drivers interface drivers and remote software to do the function. The invocations or calls can include invocations or calls in distributed and client server systems.

